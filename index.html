<html>
<head><meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<style type="text/css">
<!--
span.cls_003{font-family:Arial,serif;font-size:58.0px;color:rgb(255,254,255);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_003{font-family:Arial,serif;font-size:58.0px;color:rgb(255,254,255);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_002{font-family:Arial,serif;font-size:13.1px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_002{font-family:Arial,serif;font-size:13.1px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_004{font-family:Arial,serif;font-size:10.1px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_004{font-family:Arial,serif;font-size:10.1px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_005{font-family:Arial,serif;font-size:28.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_005{font-family:Arial,serif;font-size:28.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_006{font-family:Arial,serif;font-size:16.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_006{font-family:Arial,serif;font-size:16.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_007{font-family:Arial,serif;font-size:14.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_007{font-family:Arial,serif;font-size:14.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_008{font-family:"Book Antiqua",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_008{font-family:"Book Antiqua",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_009{font-family:"Book Antiqua Bold",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_009{font-family:"Book Antiqua Bold",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_010{font-family:Courier New,serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_010{font-family:Courier New,serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_011{font-family:Arial,serif;font-size:20.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_011{font-family:Arial,serif;font-size:20.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_012{font-family:"Book Antiqua Bold",serif;font-size:12.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_012{font-family:"Book Antiqua Bold",serif;font-size:12.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_015{font-family:Arial,serif;font-size:30.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_015{font-family:Arial,serif;font-size:30.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_016{font-family:Arial,serif;font-size:12.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_016{font-family:Arial,serif;font-size:12.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_017{font-family:Arial,serif;font-size:11.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_017{font-family:Arial,serif;font-size:11.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_018{font-family:Arial,serif;font-size:11.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_018{font-family:Arial,serif;font-size:11.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_013{font-family:Arial,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_013{font-family:Arial,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_014{font-family:Arial,serif;font-size:8.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_014{font-family:Arial,serif;font-size:8.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_019{font-family:"Book Antiqua Italic",serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_019{font-family:"Book Antiqua Italic",serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_020{font-family:Arial,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_020{font-family:Arial,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_021{font-family:"Book Antiqua Italic",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_021{font-family:"Book Antiqua Italic",serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_022{font-family:Arial,serif;font-size:18.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_022{font-family:Arial,serif;font-size:18.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_023{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_023{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_024{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_024{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_025{font-family:"Book Antiqua",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_025{font-family:"Book Antiqua",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_026{font-family:"Book Antiqua",serif;font-size:8.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_026{font-family:"Book Antiqua",serif;font-size:8.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_027{font-family:"Book Antiqua Bold",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_027{font-family:"Book Antiqua Bold",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_028{font-family:Arial,serif;font-size:16.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_028{font-family:Arial,serif;font-size:16.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_029{font-family:Arial,serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_029{font-family:Arial,serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_030{font-family:"Book Antiqua Italic",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_030{font-family:"Book Antiqua Italic",serif;font-size:9.6px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_031{font-family:Courier New,serif;font-size:8.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_031{font-family:Courier New,serif;font-size:8.6px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_033{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_033{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_034{font-family:Arial,serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_034{font-family:Arial,serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_036{font-family:Arial,serif;font-size:7.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_036{font-family:Arial,serif;font-size:7.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_035{font-family:"Book Antiqua",serif;font-size:7.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_035{font-family:"Book Antiqua",serif;font-size:7.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_032{font-family:Arial,serif;font-size:8.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_032{font-family:Arial,serif;font-size:8.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_037{font-family:"Book Antiqua Italic",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_037{font-family:"Book Antiqua Italic",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
-->
</style>
<script type="text/javascript" src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/wz_jsgraphics.js"></script>
</head>
<body>
<div style="position:absolute;left:50%;margin-left:-306px;top:0px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background001.jpg" width=612 height=792></div>
<div style="position:absolute;left:48.19px;top:107.67px" class="cls_003"><span class="cls_003">Containerize your</span></div>
<div style="position:absolute;left:48.19px;top:172.69px" class="cls_003"><span class="cls_003">Apps with Docker</span></div>
<div style="position:absolute;left:48.19px;top:237.71px" class="cls_003"><span class="cls_003">and Kubernetes</span></div>
<div style="position:absolute;left:48.19px;top:422.57px" class="cls_002"><span class="cls_002">Deploy, scale, orchestrate, and manage containers</span></div>
<div style="position:absolute;left:48.19px;top:438.17px" class="cls_002"><span class="cls_002">with Docker and Kubernetes</span></div>
<div style="position:absolute;left:463.52px;top:737.19px" class="cls_004"><span class="cls_004"> </span><A HREF="http://www.packt.com/">www.packt.com</A> </div>
<div style="position:absolute;left:48.35px;top:748.19px" class="cls_002"><span class="cls_002">Dr. Gabriel N. Schenker</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:802px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background002.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:163.23px" class="cls_005"><span class="cls_005">Containerize your Apps with</span></div>
<div style="position:absolute;left:108.00px;top:196.83px" class="cls_005"><span class="cls_005">Docker and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:339.23px" class="cls_006"><span class="cls_006">Deploy, scale, orchestrate, and manage containers</span></div>
<div style="position:absolute;left:108.00px;top:358.43px" class="cls_006"><span class="cls_006">with Docker and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:470.83px" class="cls_007"><span class="cls_007">Dr. Gabriel N. Schenker</span></div>
<div style="position:absolute;left:108.00px;top:633.56px" class="cls_008"><span class="cls_008">BIRMINGHAM - MUMBAI</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:1604px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background003.jpg" width=612 height=792></div>
<div style="position:absolute;left:107.98px;top:112.65px" class="cls_006"><span class="cls_006">Containerize your Apps with Docker and Kubernetes</span></div>
<div style="position:absolute;left:107.98px;top:147.67px" class="cls_008"><span class="cls_008">Copyright © 2018 Packt Publishing</span></div>
<div style="position:absolute;left:107.98px;top:181.51px" class="cls_008"><span class="cls_008">All rights reserved. No part of this book may be reproduced, stored in a retrieval</span></div>
<div style="position:absolute;left:107.98px;top:194.11px" class="cls_008"><span class="cls_008">system, or transmitted in any form or by any means, without the prior written</span></div>
<div style="position:absolute;left:107.98px;top:206.71px" class="cls_008"><span class="cls_008">permission of the publisher, except in the case of brief quotations embedded in</span></div>
<div style="position:absolute;left:107.98px;top:219.31px" class="cls_008"><span class="cls_008">critical articles or reviews.</span></div>
<div style="position:absolute;left:107.98px;top:240.55px" class="cls_008"><span class="cls_008">Every effort has been made in the preparation of this book to ensure the accuracy</span></div>
<div style="position:absolute;left:107.98px;top:253.15px" class="cls_008"><span class="cls_008">of the information presented. However, the information contained in this book is</span></div>
<div style="position:absolute;left:107.98px;top:265.75px" class="cls_008"><span class="cls_008">sold without warranty, either express or implied. Neither the author, nor Packt</span></div>
<div style="position:absolute;left:107.98px;top:278.35px" class="cls_008"><span class="cls_008">Publishing or its dealers and distributors, will be held liable for any damages caused</span></div>
<div style="position:absolute;left:107.98px;top:290.95px" class="cls_008"><span class="cls_008">or alleged to have been caused directly or indirectly by this book.</span></div>
<div style="position:absolute;left:107.98px;top:312.19px" class="cls_008"><span class="cls_008">Packt Publishing has endeavored to provide trademark information about all of the</span></div>
<div style="position:absolute;left:107.98px;top:324.79px" class="cls_008"><span class="cls_008">companies and products mentioned in this book by the appropriate use of capitals.</span></div>
<div style="position:absolute;left:107.98px;top:337.39px" class="cls_008"><span class="cls_008">However, Packt Publishing cannot guarantee the accuracy of this information.</span></div>
<div style="position:absolute;left:107.98px;top:358.63px" class="cls_009"><span class="cls_009">Commissioning Editor:</span><span class="cls_008"> Vijin Boricha</span></div>
<div style="position:absolute;left:107.98px;top:371.23px" class="cls_009"><span class="cls_009">Acquisition Editor:</span><span class="cls_008"> Shrilekha Inani</span></div>
<div style="position:absolute;left:107.98px;top:383.83px" class="cls_009"><span class="cls_009">Content Development Editors:</span><span class="cls_008"> Ronn Kurien</span></div>
<div style="position:absolute;left:107.98px;top:396.43px" class="cls_009"><span class="cls_009">Technical Editor:</span><span class="cls_008"> Swathy Mohan</span></div>
<div style="position:absolute;left:107.98px;top:409.03px" class="cls_009"><span class="cls_009">Copy Editor:</span><span class="cls_008"> Safis Editing</span></div>
<div style="position:absolute;left:107.98px;top:421.63px" class="cls_009"><span class="cls_009">Project Coordinator:</span><span class="cls_008"> Jagdish Prabhu</span></div>
<div style="position:absolute;left:107.98px;top:434.23px" class="cls_009"><span class="cls_009">Proofreader:</span><span class="cls_008"> Safis Editing</span></div>
<div style="position:absolute;left:107.98px;top:446.83px" class="cls_009"><span class="cls_009">Indexers:</span><span class="cls_008"> Mariammal Chettiyar</span></div>
<div style="position:absolute;left:107.98px;top:459.43px" class="cls_009"><span class="cls_009">Graphics:</span><span class="cls_008"> Tom Scaria</span></div>
<div style="position:absolute;left:107.98px;top:472.03px" class="cls_009"><span class="cls_009">Production Coordinator:</span><span class="cls_008"> Nilesh Mohite</span></div>
<div style="position:absolute;left:107.98px;top:510.19px" class="cls_008"><span class="cls_008">First published: September 2018</span></div>
<div style="position:absolute;left:107.98px;top:527.11px" class="cls_008"><span class="cls_008">Production reference: 1260918</span></div>
<div style="position:absolute;left:107.98px;top:560.95px" class="cls_008"><span class="cls_008">Published by Packt Publishing Ltd.</span></div>
<div style="position:absolute;left:107.98px;top:573.55px" class="cls_008"><span class="cls_008">Livery Place</span></div>
<div style="position:absolute;left:107.98px;top:586.15px" class="cls_008"><span class="cls_008">35 Livery Street</span></div>
<div style="position:absolute;left:107.98px;top:598.75px" class="cls_008"><span class="cls_008">Birmingham B3 2PB, UK.</span></div>
<div style="position:absolute;left:107.98px;top:619.99px" class="cls_008"><span class="cls_008">ISBN 978-1-78961-036-9</span></div>
<div style="position:absolute;left:107.98px;top:642.23px" class="cls_010"><span class="cls_010"> </span><A HREF="www.packtpub.com">www.packtpub.com</A> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:2406px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background004.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:209.68px" class="cls_010"><span class="cls_010">m</span><A HREF="https://mapt.io/">apt.io</A> </div>
<div style="position:absolute;left:108.00px;top:229.92px" class="cls_008"><span class="cls_008">Mapt is an online digital library that gives you full access to over 5,000 books and</span></div>
<div style="position:absolute;left:108.00px;top:242.52px" class="cls_008"><span class="cls_008">videos, as well as industry leading tools to help you plan your personal development</span></div>
<div style="position:absolute;left:108.00px;top:255.12px" class="cls_008"><span class="cls_008">and advance your career. For more information, please visit our website.</span></div>
<div style="position:absolute;left:108.00px;top:296.26px" class="cls_011"><span class="cls_011">Why subscribe?</span></div>
<div style="position:absolute;left:126.00px;top:321.24px" class="cls_008"><span class="cls_008">•  Spend less time learning and more time coding with practical eBooks and</span></div>
<div style="position:absolute;left:144.00px;top:333.84px" class="cls_008"><span class="cls_008">Videos from over 4,000 industry professionals</span></div>
<div style="position:absolute;left:126.00px;top:350.75px" class="cls_008"><span class="cls_008">•  Learn better with Skill Plans built especially for you</span></div>
<div style="position:absolute;left:126.00px;top:367.67px" class="cls_008"><span class="cls_008">•  Get a free eBook or video every month</span></div>
<div style="position:absolute;left:126.00px;top:384.58px" class="cls_008"><span class="cls_008">•  Mapt is fully searchable</span></div>
<div style="position:absolute;left:126.00px;top:401.50px" class="cls_008"><span class="cls_008">•  Copy and paste, print, and bookmark content</span></div>
<div style="position:absolute;left:108.00px;top:438.34px" class="cls_011"><span class="cls_011">PacktPub.com</span></div>
<div style="position:absolute;left:108.00px;top:463.32px" class="cls_008"><span class="cls_008">Did you know that Packt offers eBook versions of every book published, with PDF</span></div>
<div style="position:absolute;left:108.00px;top:475.92px" class="cls_008"><span class="cls_008">and ePub files available? You can upgrade to the eBook version at </span><A HREF="http://www.packtpub.com/">www.PacktPub.</A> </span></div>
<div style="position:absolute;left:108.00px;top:488.52px" class="cls_010"><span class="cls_010"> </span><A HREF="http://www.packtpub.com/">com</A> <span class="cls_008"> and as a print book customer, you are entitled to a discount on the eBook copy.</span></div>
<div style="position:absolute;left:108.00px;top:501.12px" class="cls_008"><span class="cls_008">Get in touch with us at </span><span class="cls_010">customercare<A HREF="mailto:service@packtpub.com">@packtpub.com</A> </span><span class="cls_008"> for more details.</span></div>
<div style="position:absolute;left:108.00px;top:522.36px" class="cls_008"><span class="cls_008">At </span><A HREF="http://www.packtpub.com/">www.PacktPub.com</A> </span><span class="cls_008">, you can also read a collection of free technical articles, sign</span></div>
<div style="position:absolute;left:108.00px;top:534.96px" class="cls_008"><span class="cls_008">up for a range of free newsletters, and receive exclusive discounts and offers on</span></div>
<div style="position:absolute;left:108.00px;top:547.56px" class="cls_008"><span class="cls_008">Packt books and eBooks.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:3208px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background005.jpg" width=612 height=792></div>
<div style="position:absolute;left:351.49px;top:163.23px" class="cls_005"><span class="cls_005">Contributors</span></div>
<div style="position:absolute;left:108.00px;top:255.15px" class="cls_011"><span class="cls_011">About the author</span></div>
<div style="position:absolute;left:108.00px;top:280.43px" class="cls_012"><span class="cls_012">Dr. Gabriel N. Schenker</span><span class="cls_008"> has more than 25 years of experience as an independent</span></div>
<div style="position:absolute;left:107.99px;top:294.53px" class="cls_008"><span class="cls_008">consultant, architect, leader, trainer, mentor, and developer. Currently, Gabriel</span></div>
<div style="position:absolute;left:107.99px;top:307.13px" class="cls_008"><span class="cls_008">works as Senior Curriculum Developer at Confluent after coming from a similar</span></div>
<div style="position:absolute;left:107.99px;top:319.73px" class="cls_008"><span class="cls_008">position at Docker. Gabriel has a Ph.D. in Physics, and he is a Docker Captain, a</span></div>
<div style="position:absolute;left:107.99px;top:332.33px" class="cls_008"><span class="cls_008">Certified Docker Associate, and an ASP Insider. When not working, Gabriel enjoys</span></div>
<div style="position:absolute;left:107.99px;top:344.93px" class="cls_008"><span class="cls_008">time with his wonderful wife Veronicah and his children.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:4010px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background006.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">About the reviewer</span></div>
<div style="position:absolute;left:108.00px;top:137.20px" class="cls_012"><span class="cls_012">Xijing Zhang</span><span class="cls_008"> is currently a technical curriculum developer at Docker after</span></div>
<div style="position:absolute;left:108.00px;top:151.30px" class="cls_008"><span class="cls_008">graduating from the University of Southern California as an electrical engineer.</span></div>
<div style="position:absolute;left:108.00px;top:163.90px" class="cls_008"><span class="cls_008">Previously, she has interned on the Failure Analysis Team at SanDisk and has held</span></div>
<div style="position:absolute;left:108.00px;top:176.50px" class="cls_008"><span class="cls_008">multiple research positions at USC and Tsinghua University. She has worked on</span></div>
<div style="position:absolute;left:108.00px;top:189.10px" class="cls_008"><span class="cls_008">projects dealing with making air conditioners more efficient, nuclear power safety,</span></div>
<div style="position:absolute;left:108.00px;top:201.70px" class="cls_008"><span class="cls_008">and single photon emission.</span></div>
<div style="position:absolute;left:108.00px;top:265.72px" class="cls_012"><span class="cls_012">Peter McKee</span><span class="cls_008"> is a Software Architect and Senior Software Engineer at Docker,</span></div>
<div style="position:absolute;left:108.00px;top:279.82px" class="cls_008"><span class="cls_008">Inc. He leads the technical team that delivers the Docker Success Center. He's been</span></div>
<div style="position:absolute;left:108.00px;top:292.42px" class="cls_008"><span class="cls_008">leading and mentoring teams for more than 20 years. When not building things with</span></div>
<div style="position:absolute;left:108.00px;top:305.02px" class="cls_008"><span class="cls_008">software, he spends his time with his wife and seven kids in beautiful Austin, TX.</span></div>
<div style="position:absolute;left:108.00px;top:409.88px" class="cls_011"><span class="cls_011">Packt is searching for authors like you</span></div>
<div style="position:absolute;left:108.00px;top:434.86px" class="cls_008"><span class="cls_008">If you're interested in becoming an author for Packt, please visit </span><A HREF="http://authors.packtpub.com/">authors.packtpub.</A> </span></div>
<div style="position:absolute;left:108.00px;top:447.46px" class="cls_010"><span class="cls_010"> </span><A HREF="http://authors.packtpub.com/">com</A> <span class="cls_008"> and apply today. We have worked with thousands of developers and tech</span></div>
<div style="position:absolute;left:108.00px;top:460.06px" class="cls_008"><span class="cls_008">professionals, just like you, to help them share their insight with the global tech</span></div>
<div style="position:absolute;left:108.00px;top:472.66px" class="cls_008"><span class="cls_008">community. You can make a general application, apply for a specific hot topic that</span></div>
<div style="position:absolute;left:108.00px;top:485.26px" class="cls_008"><span class="cls_008">we are recruiting an author for, or submit your own idea.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:4812px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background007.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:4812px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background008.jpg" width=612 height=792></div>
<div style="position:absolute;left:270.52px;top:218.71px" class="cls_015"><span class="cls_015">Table of Contents</span></div>
<div style="position:absolute;left:108.00px;top:274.09px" class="cls_016"><span class="cls_016">Preface</span></div>
<div style="position:absolute;left:493.99px;top:274.09px" class="cls_016"><span class="cls_016">ix</span></div>
<div style="position:absolute;left:108.00px;top:291.37px" class="cls_016"><span class="cls_016">Chapter 1: What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:497.33px;top:291.37px" class="cls_016"><span class="cls_016">1</span></div>
<div style="position:absolute;left:115.20px;top:307.07px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:497.88px;top:307.07px" class="cls_017"><span class="cls_017">2</span></div>
<div style="position:absolute;left:115.20px;top:320.27px" class="cls_017"><span class="cls_017">What are containers?</span></div>
<div style="position:absolute;left:497.88px;top:320.27px" class="cls_017"><span class="cls_017">2</span></div>
<div style="position:absolute;left:115.20px;top:333.47px" class="cls_017"><span class="cls_017">Why are containers important?</span></div>
<div style="position:absolute;left:497.88px;top:333.47px" class="cls_017"><span class="cls_017">5</span></div>
<div style="position:absolute;left:126.00px;top:346.67px" class="cls_018"><span class="cls_018">Improving security</span></div>
<div style="position:absolute;left:497.88px;top:346.67px" class="cls_018"><span class="cls_018">5</span></div>
<div style="position:absolute;left:126.00px;top:359.87px" class="cls_018"><span class="cls_018">Simulating production-like environments</span></div>
<div style="position:absolute;left:497.88px;top:359.87px" class="cls_018"><span class="cls_018">6</span></div>
<div style="position:absolute;left:126.00px;top:373.07px" class="cls_018"><span class="cls_018">Standardizing infrastructure</span></div>
<div style="position:absolute;left:497.88px;top:373.07px" class="cls_018"><span class="cls_018">6</span></div>
<div style="position:absolute;left:115.20px;top:386.27px" class="cls_017"><span class="cls_017">What's the benefit for me or for my company?</span></div>
<div style="position:absolute;left:497.88px;top:386.27px" class="cls_017"><span class="cls_017">6</span></div>
<div style="position:absolute;left:115.20px;top:399.47px" class="cls_017"><span class="cls_017">The Moby project</span></div>
<div style="position:absolute;left:497.88px;top:399.47px" class="cls_017"><span class="cls_017">7</span></div>
<div style="position:absolute;left:115.20px;top:412.67px" class="cls_017"><span class="cls_017">Docker products</span></div>
<div style="position:absolute;left:497.88px;top:412.67px" class="cls_017"><span class="cls_017">8</span></div>
<div style="position:absolute;left:126.00px;top:425.87px" class="cls_018"><span class="cls_018">Docker CE</span></div>
<div style="position:absolute;left:497.88px;top:425.87px" class="cls_018"><span class="cls_018">8</span></div>
<div style="position:absolute;left:126.00px;top:439.07px" class="cls_018"><span class="cls_018">Docker EE</span></div>
<div style="position:absolute;left:497.88px;top:439.07px" class="cls_018"><span class="cls_018">9</span></div>
<div style="position:absolute;left:115.20px;top:452.27px" class="cls_017"><span class="cls_017">The container ecosystem</span></div>
<div style="position:absolute;left:497.88px;top:452.27px" class="cls_017"><span class="cls_017">9</span></div>
<div style="position:absolute;left:115.20px;top:465.47px" class="cls_017"><span class="cls_017">Container architecture</span></div>
<div style="position:absolute;left:491.76px;top:465.47px" class="cls_017"><span class="cls_017">10</span></div>
<div style="position:absolute;left:115.20px;top:478.67px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:492.37px;top:478.67px" class="cls_017"><span class="cls_017">11</span></div>
<div style="position:absolute;left:115.20px;top:491.87px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:491.76px;top:491.87px" class="cls_017"><span class="cls_017">12</span></div>
<div style="position:absolute;left:115.20px;top:505.07px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:491.76px;top:505.07px" class="cls_017"><span class="cls_017">13</span></div>
<div style="position:absolute;left:108.00px;top:519.85px" class="cls_016"><span class="cls_016">Chapter 2: Setting up a Working Environment</span></div>
<div style="position:absolute;left:490.66px;top:519.85px" class="cls_016"><span class="cls_016">15</span></div>
<div style="position:absolute;left:115.20px;top:535.55px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:491.76px;top:535.55px" class="cls_017"><span class="cls_017">16</span></div>
<div style="position:absolute;left:115.20px;top:548.75px" class="cls_017"><span class="cls_017">The Linux command shell</span></div>
<div style="position:absolute;left:491.76px;top:548.75px" class="cls_017"><span class="cls_017">16</span></div>
<div style="position:absolute;left:115.20px;top:561.95px" class="cls_017"><span class="cls_017">PowerShell for Windows</span></div>
<div style="position:absolute;left:491.76px;top:561.95px" class="cls_017"><span class="cls_017">17</span></div>
<div style="position:absolute;left:115.20px;top:575.15px" class="cls_017"><span class="cls_017">Using a package manager</span></div>
<div style="position:absolute;left:491.76px;top:575.15px" class="cls_017"><span class="cls_017">17</span></div>
<div style="position:absolute;left:126.00px;top:588.35px" class="cls_018"><span class="cls_018">Installing Homebrew on a macOS</span></div>
<div style="position:absolute;left:491.76px;top:588.35px" class="cls_018"><span class="cls_018">17</span></div>
<div style="position:absolute;left:126.00px;top:601.55px" class="cls_018"><span class="cls_018">Installing Chocolatey on Windows</span></div>
<div style="position:absolute;left:491.76px;top:601.55px" class="cls_018"><span class="cls_018">18</span></div>
<div style="position:absolute;left:115.20px;top:614.75px" class="cls_017"><span class="cls_017">Choosing a code editor</span></div>
<div style="position:absolute;left:491.76px;top:614.75px" class="cls_017"><span class="cls_017">19</span></div>
<div style="position:absolute;left:115.20px;top:627.95px" class="cls_017"><span class="cls_017">Docker Toolbox</span></div>
<div style="position:absolute;left:491.76px;top:627.95px" class="cls_017"><span class="cls_017">19</span></div>
<div style="position:absolute;left:299.33px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> i </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:5614px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background009.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:115.20px;top:114.37px" class="cls_017"><span class="cls_017">Docker for macOS and Docker for Windows</span></div>
<div style="position:absolute;left:491.76px;top:114.37px" class="cls_017"><span class="cls_017">22</span></div>
<div style="position:absolute;left:126.00px;top:127.57px" class="cls_018"><span class="cls_018">Installing Docker for macOS</span></div>
<div style="position:absolute;left:491.76px;top:127.57px" class="cls_018"><span class="cls_018">22</span></div>
<div style="position:absolute;left:126.00px;top:140.77px" class="cls_018"><span class="cls_018">Installing Docker for Windows</span></div>
<div style="position:absolute;left:491.76px;top:140.77px" class="cls_018"><span class="cls_018">24</span></div>
<div style="position:absolute;left:126.00px;top:153.97px" class="cls_018"><span class="cls_018">Using docker-machine on Windows with Hyper-V</span></div>
<div style="position:absolute;left:491.76px;top:153.97px" class="cls_018"><span class="cls_018">24</span></div>
<div style="position:absolute;left:115.20px;top:167.17px" class="cls_017"><span class="cls_017">Minikube</span></div>
<div style="position:absolute;left:491.76px;top:167.17px" class="cls_017"><span class="cls_017">26</span></div>
<div style="position:absolute;left:126.00px;top:180.37px" class="cls_018"><span class="cls_018">Installing Minikube on macOS and Windows</span></div>
<div style="position:absolute;left:491.76px;top:180.37px" class="cls_018"><span class="cls_018">26</span></div>
<div style="position:absolute;left:126.00px;top:193.57px" class="cls_018"><span class="cls_018">Testing Minikube and kubectl</span></div>
<div style="position:absolute;left:491.76px;top:193.57px" class="cls_018"><span class="cls_018">27</span></div>
<div style="position:absolute;left:115.20px;top:206.77px" class="cls_017"><span class="cls_017">Cloning the source code repository</span></div>
<div style="position:absolute;left:491.76px;top:206.77px" class="cls_017"><span class="cls_017">28</span></div>
<div style="position:absolute;left:115.20px;top:219.97px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:491.76px;top:219.97px" class="cls_017"><span class="cls_017">29</span></div>
<div style="position:absolute;left:115.20px;top:233.17px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:491.76px;top:233.17px" class="cls_017"><span class="cls_017">29</span></div>
<div style="position:absolute;left:115.20px;top:246.37px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:491.76px;top:246.37px" class="cls_017"><span class="cls_017">29</span></div>
<div style="position:absolute;left:108.00px;top:261.15px" class="cls_016"><span class="cls_016">Chapter 3: Working with Containers</span></div>
<div style="position:absolute;left:490.66px;top:261.15px" class="cls_016"><span class="cls_016">31</span></div>
<div style="position:absolute;left:115.20px;top:276.85px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:491.76px;top:276.85px" class="cls_017"><span class="cls_017">32</span></div>
<div style="position:absolute;left:115.20px;top:290.05px" class="cls_017"><span class="cls_017">Running the first container</span></div>
<div style="position:absolute;left:491.76px;top:290.05px" class="cls_017"><span class="cls_017">32</span></div>
<div style="position:absolute;left:115.20px;top:303.25px" class="cls_017"><span class="cls_017">Starting, stopping, and removing containers</span></div>
<div style="position:absolute;left:491.76px;top:303.25px" class="cls_017"><span class="cls_017">33</span></div>
<div style="position:absolute;left:126.00px;top:316.45px" class="cls_018"><span class="cls_018">Running a random quotes container</span></div>
<div style="position:absolute;left:491.76px;top:316.45px" class="cls_018"><span class="cls_018">35</span></div>
<div style="position:absolute;left:126.00px;top:329.65px" class="cls_018"><span class="cls_018">Listing containers</span></div>
<div style="position:absolute;left:491.76px;top:329.65px" class="cls_018"><span class="cls_018">37</span></div>
<div style="position:absolute;left:126.00px;top:342.85px" class="cls_018"><span class="cls_018">Stopping and starting containers</span></div>
<div style="position:absolute;left:491.76px;top:342.85px" class="cls_018"><span class="cls_018">38</span></div>
<div style="position:absolute;left:126.00px;top:356.05px" class="cls_018"><span class="cls_018">Removing containers</span></div>
<div style="position:absolute;left:491.76px;top:356.05px" class="cls_018"><span class="cls_018">39</span></div>
<div style="position:absolute;left:115.20px;top:369.25px" class="cls_017"><span class="cls_017">Inspecting containers</span></div>
<div style="position:absolute;left:491.76px;top:369.25px" class="cls_017"><span class="cls_017">40</span></div>
<div style="position:absolute;left:115.20px;top:382.45px" class="cls_017"><span class="cls_017">Exec into a running container</span></div>
<div style="position:absolute;left:491.76px;top:382.45px" class="cls_017"><span class="cls_017">42</span></div>
<div style="position:absolute;left:115.20px;top:395.65px" class="cls_017"><span class="cls_017">Attaching to a running container</span></div>
<div style="position:absolute;left:491.76px;top:395.65px" class="cls_017"><span class="cls_017">43</span></div>
<div style="position:absolute;left:115.20px;top:408.85px" class="cls_017"><span class="cls_017">Retrieving container logs</span></div>
<div style="position:absolute;left:491.76px;top:408.85px" class="cls_017"><span class="cls_017">45</span></div>
<div style="position:absolute;left:126.00px;top:422.05px" class="cls_018"><span class="cls_018">Logging drivers</span></div>
<div style="position:absolute;left:491.76px;top:422.05px" class="cls_018"><span class="cls_018">46</span></div>
<div style="position:absolute;left:126.00px;top:435.25px" class="cls_018"><span class="cls_018">Using a container-specific logging driver</span></div>
<div style="position:absolute;left:491.76px;top:435.25px" class="cls_018"><span class="cls_018">47</span></div>
<div style="position:absolute;left:126.00px;top:448.45px" class="cls_018"><span class="cls_018">Advanced topic - changing the default logging driver</span></div>
<div style="position:absolute;left:491.76px;top:448.45px" class="cls_018"><span class="cls_018">47</span></div>
<div style="position:absolute;left:115.20px;top:461.65px" class="cls_017"><span class="cls_017">Anatomy of containers</span></div>
<div style="position:absolute;left:491.76px;top:461.65px" class="cls_017"><span class="cls_017">48</span></div>
<div style="position:absolute;left:126.00px;top:474.85px" class="cls_018"><span class="cls_018">Architecture</span></div>
<div style="position:absolute;left:491.76px;top:474.85px" class="cls_018"><span class="cls_018">49</span></div>
<div style="position:absolute;left:126.00px;top:488.05px" class="cls_018"><span class="cls_018">Namespaces</span></div>
<div style="position:absolute;left:491.76px;top:488.05px" class="cls_018"><span class="cls_018">50</span></div>
<div style="position:absolute;left:126.00px;top:501.25px" class="cls_018"><span class="cls_018">Control groups (cgroups)</span></div>
<div style="position:absolute;left:491.76px;top:501.25px" class="cls_018"><span class="cls_018">51</span></div>
<div style="position:absolute;left:126.00px;top:514.45px" class="cls_018"><span class="cls_018">Union filesystem (UnionFS)</span></div>
<div style="position:absolute;left:491.76px;top:514.45px" class="cls_018"><span class="cls_018">52</span></div>
<div style="position:absolute;left:126.00px;top:527.65px" class="cls_018"><span class="cls_018">Container plumbing</span></div>
<div style="position:absolute;left:491.76px;top:527.65px" class="cls_018"><span class="cls_018">52</span></div>
<div style="position:absolute;left:133.20px;top:540.45px" class="cls_020"><span class="cls_020">Runc</span></div>
<div style="position:absolute;left:493.99px;top:540.45px" class="cls_020"><span class="cls_020">52</span></div>
<div style="position:absolute;left:133.20px;top:551.25px" class="cls_020"><span class="cls_020">Containerd</span></div>
<div style="position:absolute;left:493.99px;top:551.25px" class="cls_020"><span class="cls_020">52</span></div>
<div style="position:absolute;left:115.20px;top:562.45px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:491.76px;top:562.45px" class="cls_017"><span class="cls_017">53</span></div>
<div style="position:absolute;left:115.20px;top:575.65px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:491.76px;top:575.65px" class="cls_017"><span class="cls_017">53</span></div>
<div style="position:absolute;left:115.20px;top:588.85px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:491.76px;top:588.85px" class="cls_017"><span class="cls_017">53</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> ii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:6416px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background010.jpg" width=612 height=792></div>
<div style="position:absolute;left:440.96px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:108.00px;top:112.60px" class="cls_016"><span class="cls_016">Chapter 4: Creating and Managing Container Images</span></div>
<div style="position:absolute;left:490.66px;top:112.60px" class="cls_016"><span class="cls_016">55</span></div>
<div style="position:absolute;left:115.20px;top:128.30px" class="cls_017"><span class="cls_017">What are images?</span></div>
<div style="position:absolute;left:491.76px;top:128.30px" class="cls_017"><span class="cls_017">56</span></div>
<div style="position:absolute;left:126.00px;top:141.50px" class="cls_018"><span class="cls_018">The layered filesystem</span></div>
<div style="position:absolute;left:491.76px;top:141.50px" class="cls_018"><span class="cls_018">56</span></div>
<div style="position:absolute;left:126.00px;top:154.70px" class="cls_018"><span class="cls_018">The writable container layer</span></div>
<div style="position:absolute;left:491.76px;top:154.70px" class="cls_018"><span class="cls_018">58</span></div>
<div style="position:absolute;left:126.00px;top:167.90px" class="cls_018"><span class="cls_018">Copy-on-write</span></div>
<div style="position:absolute;left:491.76px;top:167.90px" class="cls_018"><span class="cls_018">59</span></div>
<div style="position:absolute;left:126.00px;top:181.10px" class="cls_018"><span class="cls_018">Graph drivers</span></div>
<div style="position:absolute;left:491.76px;top:181.10px" class="cls_018"><span class="cls_018">59</span></div>
<div style="position:absolute;left:115.20px;top:194.30px" class="cls_017"><span class="cls_017">Creating images</span></div>
<div style="position:absolute;left:491.76px;top:194.30px" class="cls_017"><span class="cls_017">60</span></div>
<div style="position:absolute;left:126.00px;top:207.50px" class="cls_018"><span class="cls_018">Interactive image creation</span></div>
<div style="position:absolute;left:491.76px;top:207.50px" class="cls_018"><span class="cls_018">60</span></div>
<div style="position:absolute;left:126.00px;top:220.70px" class="cls_018"><span class="cls_018">Using Dockerfiles</span></div>
<div style="position:absolute;left:491.76px;top:220.70px" class="cls_018"><span class="cls_018">63</span></div>
<div style="position:absolute;left:133.20px;top:233.50px" class="cls_020"><span class="cls_020">The FROM keyword</span></div>
<div style="position:absolute;left:493.99px;top:233.50px" class="cls_020"><span class="cls_020">64</span></div>
<div style="position:absolute;left:133.20px;top:244.30px" class="cls_020"><span class="cls_020">The RUN keyword</span></div>
<div style="position:absolute;left:493.99px;top:244.30px" class="cls_020"><span class="cls_020">65</span></div>
<div style="position:absolute;left:133.20px;top:255.10px" class="cls_020"><span class="cls_020">The COPY and ADD keywords</span></div>
<div style="position:absolute;left:493.99px;top:255.10px" class="cls_020"><span class="cls_020">66</span></div>
<div style="position:absolute;left:133.20px;top:265.90px" class="cls_020"><span class="cls_020">The WORKDIR keyword</span></div>
<div style="position:absolute;left:493.99px;top:265.90px" class="cls_020"><span class="cls_020">67</span></div>
<div style="position:absolute;left:133.20px;top:276.70px" class="cls_020"><span class="cls_020">The CMD and ENTRYPOINT keywords</span></div>
<div style="position:absolute;left:493.99px;top:276.70px" class="cls_020"><span class="cls_020">68</span></div>
<div style="position:absolute;left:133.20px;top:287.50px" class="cls_020"><span class="cls_020">A complex Dockerfile</span></div>
<div style="position:absolute;left:493.99px;top:287.50px" class="cls_020"><span class="cls_020">70</span></div>
<div style="position:absolute;left:133.20px;top:298.30px" class="cls_020"><span class="cls_020">Building an image</span></div>
<div style="position:absolute;left:493.99px;top:298.30px" class="cls_020"><span class="cls_020">71</span></div>
<div style="position:absolute;left:133.20px;top:309.10px" class="cls_020"><span class="cls_020">Multistep builds</span></div>
<div style="position:absolute;left:493.99px;top:309.10px" class="cls_020"><span class="cls_020">75</span></div>
<div style="position:absolute;left:133.20px;top:319.90px" class="cls_020"><span class="cls_020">Dockerfile best practices</span></div>
<div style="position:absolute;left:493.99px;top:319.90px" class="cls_020"><span class="cls_020">77</span></div>
<div style="position:absolute;left:126.00px;top:331.10px" class="cls_018"><span class="cls_018">Saving and loading images</span></div>
<div style="position:absolute;left:491.76px;top:331.10px" class="cls_018"><span class="cls_018">79</span></div>
<div style="position:absolute;left:115.20px;top:344.30px" class="cls_017"><span class="cls_017">Sharing or shipping images</span></div>
<div style="position:absolute;left:491.76px;top:344.30px" class="cls_017"><span class="cls_017">79</span></div>
<div style="position:absolute;left:126.00px;top:357.50px" class="cls_018"><span class="cls_018">Tagging an image</span></div>
<div style="position:absolute;left:491.76px;top:357.50px" class="cls_018"><span class="cls_018">80</span></div>
<div style="position:absolute;left:126.00px;top:370.70px" class="cls_018"><span class="cls_018">Image namespaces</span></div>
<div style="position:absolute;left:491.76px;top:370.70px" class="cls_018"><span class="cls_018">80</span></div>
<div style="position:absolute;left:126.00px;top:383.90px" class="cls_018"><span class="cls_018">Official images</span></div>
<div style="position:absolute;left:491.76px;top:383.90px" class="cls_018"><span class="cls_018">82</span></div>
<div style="position:absolute;left:126.00px;top:397.10px" class="cls_018"><span class="cls_018">Pushing images to a registry</span></div>
<div style="position:absolute;left:491.76px;top:397.10px" class="cls_018"><span class="cls_018">82</span></div>
<div style="position:absolute;left:115.20px;top:410.30px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:491.76px;top:410.30px" class="cls_017"><span class="cls_017">83</span></div>
<div style="position:absolute;left:115.20px;top:423.50px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:491.76px;top:423.50px" class="cls_017"><span class="cls_017">83</span></div>
<div style="position:absolute;left:115.20px;top:436.70px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:491.76px;top:436.70px" class="cls_017"><span class="cls_017">84</span></div>
<div style="position:absolute;left:108.00px;top:451.48px" class="cls_016"><span class="cls_016">Chapter 5: Data Volumes and System Management</span></div>
<div style="position:absolute;left:490.66px;top:451.48px" class="cls_016"><span class="cls_016">85</span></div>
<div style="position:absolute;left:115.20px;top:467.18px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:491.76px;top:467.18px" class="cls_017"><span class="cls_017">86</span></div>
<div style="position:absolute;left:115.20px;top:480.38px" class="cls_017"><span class="cls_017">Creating and mounting data volumes</span></div>
<div style="position:absolute;left:491.76px;top:480.38px" class="cls_017"><span class="cls_017">86</span></div>
<div style="position:absolute;left:126.00px;top:493.58px" class="cls_018"><span class="cls_018">Modifying the container layer</span></div>
<div style="position:absolute;left:491.76px;top:493.58px" class="cls_018"><span class="cls_018">86</span></div>
<div style="position:absolute;left:126.00px;top:506.78px" class="cls_018"><span class="cls_018">Creating volumes</span></div>
<div style="position:absolute;left:491.76px;top:506.78px" class="cls_018"><span class="cls_018">87</span></div>
<div style="position:absolute;left:126.00px;top:519.98px" class="cls_018"><span class="cls_018">Mounting a volume</span></div>
<div style="position:absolute;left:491.76px;top:519.98px" class="cls_018"><span class="cls_018">89</span></div>
<div style="position:absolute;left:126.00px;top:533.18px" class="cls_018"><span class="cls_018">Removing volumes</span></div>
<div style="position:absolute;left:491.76px;top:533.18px" class="cls_018"><span class="cls_018">90</span></div>
<div style="position:absolute;left:115.20px;top:546.38px" class="cls_017"><span class="cls_017">Sharing data between containers</span></div>
<div style="position:absolute;left:491.76px;top:546.38px" class="cls_017"><span class="cls_017">91</span></div>
<div style="position:absolute;left:115.20px;top:559.58px" class="cls_017"><span class="cls_017">Using host volumes</span></div>
<div style="position:absolute;left:491.76px;top:559.58px" class="cls_017"><span class="cls_017">92</span></div>
<div style="position:absolute;left:115.20px;top:572.78px" class="cls_017"><span class="cls_017">Defining volumes in images</span></div>
<div style="position:absolute;left:491.76px;top:572.78px" class="cls_017"><span class="cls_017">95</span></div>
<div style="position:absolute;left:115.20px;top:585.98px" class="cls_017"><span class="cls_017">Obtaining Docker system information</span></div>
<div style="position:absolute;left:491.76px;top:585.98px" class="cls_017"><span class="cls_017">97</span></div>
<div style="position:absolute;left:115.20px;top:599.18px" class="cls_017"><span class="cls_017">Listing resource consumption</span></div>
<div style="position:absolute;left:485.65px;top:599.18px" class="cls_017"><span class="cls_017">100</span></div>
<div style="position:absolute;left:297.10px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> iii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:7218px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background011.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:115.20px;top:114.37px" class="cls_017"><span class="cls_017">Pruning unused resources</span></div>
<div style="position:absolute;left:485.65px;top:114.37px" class="cls_017"><span class="cls_017">101</span></div>
<div style="position:absolute;left:126.00px;top:127.57px" class="cls_018"><span class="cls_018">Pruning containers</span></div>
<div style="position:absolute;left:485.65px;top:127.57px" class="cls_018"><span class="cls_018">101</span></div>
<div style="position:absolute;left:126.00px;top:140.77px" class="cls_018"><span class="cls_018">Pruning images</span></div>
<div style="position:absolute;left:485.65px;top:140.77px" class="cls_018"><span class="cls_018">102</span></div>
<div style="position:absolute;left:126.00px;top:153.97px" class="cls_018"><span class="cls_018">Pruning volumes</span></div>
<div style="position:absolute;left:485.65px;top:153.97px" class="cls_018"><span class="cls_018">103</span></div>
<div style="position:absolute;left:126.00px;top:167.17px" class="cls_018"><span class="cls_018">Pruning networks</span></div>
<div style="position:absolute;left:485.65px;top:167.17px" class="cls_018"><span class="cls_018">104</span></div>
<div style="position:absolute;left:126.00px;top:180.37px" class="cls_018"><span class="cls_018">Pruning everything</span></div>
<div style="position:absolute;left:485.65px;top:180.37px" class="cls_018"><span class="cls_018">104</span></div>
<div style="position:absolute;left:115.20px;top:193.57px" class="cls_017"><span class="cls_017">Consuming Docker system events</span></div>
<div style="position:absolute;left:485.65px;top:193.57px" class="cls_017"><span class="cls_017">104</span></div>
<div style="position:absolute;left:115.20px;top:206.77px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:206.77px" class="cls_017"><span class="cls_017">106</span></div>
<div style="position:absolute;left:115.20px;top:219.97px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:219.97px" class="cls_017"><span class="cls_017">106</span></div>
<div style="position:absolute;left:115.20px;top:233.17px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:233.17px" class="cls_017"><span class="cls_017">107</span></div>
<div style="position:absolute;left:108.00px;top:247.95px" class="cls_016"><span class="cls_016">Chapter 6: Distributed Application Architecture</span></div>
<div style="position:absolute;left:483.98px;top:247.95px" class="cls_016"><span class="cls_016">109</span></div>
<div style="position:absolute;left:115.20px;top:263.65px" class="cls_017"><span class="cls_017">What is a distributed application architecture?</span></div>
<div style="position:absolute;left:486.25px;top:263.65px" class="cls_017"><span class="cls_017">110</span></div>
<div style="position:absolute;left:126.00px;top:276.85px" class="cls_018"><span class="cls_018">Defining the terminology</span></div>
<div style="position:absolute;left:486.46px;top:276.85px" class="cls_018"><span class="cls_018">110</span></div>
<div style="position:absolute;left:115.20px;top:290.05px" class="cls_017"><span class="cls_017">Patterns and best practices</span></div>
<div style="position:absolute;left:486.25px;top:290.05px" class="cls_017"><span class="cls_017">113</span></div>
<div style="position:absolute;left:126.00px;top:303.25px" class="cls_018"><span class="cls_018">Loosely coupled components</span></div>
<div style="position:absolute;left:486.46px;top:303.25px" class="cls_018"><span class="cls_018">113</span></div>
<div style="position:absolute;left:126.00px;top:316.45px" class="cls_018"><span class="cls_018">Stateful versus stateless</span></div>
<div style="position:absolute;left:486.46px;top:316.45px" class="cls_018"><span class="cls_018">113</span></div>
<div style="position:absolute;left:126.00px;top:329.65px" class="cls_018"><span class="cls_018">Service discovery</span></div>
<div style="position:absolute;left:486.46px;top:329.65px" class="cls_018"><span class="cls_018">114</span></div>
<div style="position:absolute;left:126.00px;top:342.85px" class="cls_018"><span class="cls_018">Routing</span></div>
<div style="position:absolute;left:486.46px;top:342.85px" class="cls_018"><span class="cls_018">116</span></div>
<div style="position:absolute;left:126.00px;top:356.05px" class="cls_018"><span class="cls_018">Load balancing</span></div>
<div style="position:absolute;left:486.46px;top:356.05px" class="cls_018"><span class="cls_018">116</span></div>
<div style="position:absolute;left:126.00px;top:369.25px" class="cls_018"><span class="cls_018">Defensive programming</span></div>
<div style="position:absolute;left:486.46px;top:369.25px" class="cls_018"><span class="cls_018">117</span></div>
<div style="position:absolute;left:133.20px;top:382.05px" class="cls_020"><span class="cls_020">Retries</span></div>
<div style="position:absolute;left:489.65px;top:382.05px" class="cls_020"><span class="cls_020">117</span></div>
<div style="position:absolute;left:133.20px;top:392.85px" class="cls_020"><span class="cls_020">Logging</span></div>
<div style="position:absolute;left:489.65px;top:392.85px" class="cls_020"><span class="cls_020">117</span></div>
<div style="position:absolute;left:133.20px;top:403.65px" class="cls_020"><span class="cls_020">Error handling</span></div>
<div style="position:absolute;left:489.65px;top:403.65px" class="cls_020"><span class="cls_020">117</span></div>
<div style="position:absolute;left:126.00px;top:414.85px" class="cls_018"><span class="cls_018">Redundancy</span></div>
<div style="position:absolute;left:486.46px;top:414.85px" class="cls_018"><span class="cls_018">118</span></div>
<div style="position:absolute;left:126.00px;top:428.05px" class="cls_018"><span class="cls_018">Health checks</span></div>
<div style="position:absolute;left:486.46px;top:428.05px" class="cls_018"><span class="cls_018">118</span></div>
<div style="position:absolute;left:126.00px;top:441.25px" class="cls_018"><span class="cls_018">Circuit breaker pattern</span></div>
<div style="position:absolute;left:486.46px;top:441.25px" class="cls_018"><span class="cls_018">119</span></div>
<div style="position:absolute;left:115.20px;top:454.45px" class="cls_017"><span class="cls_017">Running in production</span></div>
<div style="position:absolute;left:485.64px;top:454.45px" class="cls_017"><span class="cls_017">120</span></div>
<div style="position:absolute;left:126.00px;top:467.65px" class="cls_018"><span class="cls_018">Logging</span></div>
<div style="position:absolute;left:485.64px;top:467.65px" class="cls_018"><span class="cls_018">120</span></div>
<div style="position:absolute;left:126.00px;top:480.85px" class="cls_018"><span class="cls_018">Tracing</span></div>
<div style="position:absolute;left:485.64px;top:480.85px" class="cls_018"><span class="cls_018">120</span></div>
<div style="position:absolute;left:126.00px;top:494.05px" class="cls_018"><span class="cls_018">Monitoring</span></div>
<div style="position:absolute;left:485.64px;top:494.05px" class="cls_018"><span class="cls_018">121</span></div>
<div style="position:absolute;left:126.00px;top:507.25px" class="cls_018"><span class="cls_018">Application updates</span></div>
<div style="position:absolute;left:485.64px;top:507.25px" class="cls_018"><span class="cls_018">121</span></div>
<div style="position:absolute;left:126.00px;top:520.45px" class="cls_018"><span class="cls_018">Rolling updates</span></div>
<div style="position:absolute;left:485.64px;top:520.45px" class="cls_018"><span class="cls_018">121</span></div>
<div style="position:absolute;left:133.20px;top:533.25px" class="cls_020"><span class="cls_020">Blue-green deployments</span></div>
<div style="position:absolute;left:488.99px;top:533.25px" class="cls_020"><span class="cls_020">122</span></div>
<div style="position:absolute;left:133.20px;top:544.05px" class="cls_020"><span class="cls_020">Canary releases</span></div>
<div style="position:absolute;left:488.99px;top:544.05px" class="cls_020"><span class="cls_020">122</span></div>
<div style="position:absolute;left:133.20px;top:554.85px" class="cls_020"><span class="cls_020">Irreversible data changes</span></div>
<div style="position:absolute;left:488.99px;top:554.85px" class="cls_020"><span class="cls_020">123</span></div>
<div style="position:absolute;left:133.20px;top:565.65px" class="cls_020"><span class="cls_020">Rollback</span></div>
<div style="position:absolute;left:488.98px;top:565.65px" class="cls_020"><span class="cls_020">123</span></div>
<div style="position:absolute;left:115.20px;top:576.85px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:576.85px" class="cls_017"><span class="cls_017">124</span></div>
<div style="position:absolute;left:115.20px;top:590.05px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:590.05px" class="cls_017"><span class="cls_017">124</span></div>
<div style="position:absolute;left:115.20px;top:603.25px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:603.25px" class="cls_017"><span class="cls_017">125</span></div>
<div style="position:absolute;left:296.48px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> iv </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:8020px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background012.jpg" width=612 height=792></div>
<div style="position:absolute;left:440.96px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:108.00px;top:112.60px" class="cls_016"><span class="cls_016">Chapter 7: Single-Host Networking</span></div>
<div style="position:absolute;left:483.98px;top:112.60px" class="cls_016"><span class="cls_016">127</span></div>
<div style="position:absolute;left:115.20px;top:128.30px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:485.65px;top:128.30px" class="cls_017"><span class="cls_017">128</span></div>
<div style="position:absolute;left:115.20px;top:141.50px" class="cls_017"><span class="cls_017">The container network model</span></div>
<div style="position:absolute;left:485.65px;top:141.50px" class="cls_017"><span class="cls_017">128</span></div>
<div style="position:absolute;left:115.20px;top:154.70px" class="cls_017"><span class="cls_017">Network firewalling</span></div>
<div style="position:absolute;left:485.65px;top:154.70px" class="cls_017"><span class="cls_017">130</span></div>
<div style="position:absolute;left:115.20px;top:167.90px" class="cls_017"><span class="cls_017">The bridge network</span></div>
<div style="position:absolute;left:485.65px;top:167.90px" class="cls_017"><span class="cls_017">131</span></div>
<div style="position:absolute;left:115.20px;top:181.10px" class="cls_017"><span class="cls_017">The host network</span></div>
<div style="position:absolute;left:485.65px;top:181.10px" class="cls_017"><span class="cls_017">141</span></div>
<div style="position:absolute;left:115.20px;top:194.30px" class="cls_017"><span class="cls_017">The null network</span></div>
<div style="position:absolute;left:485.65px;top:194.30px" class="cls_017"><span class="cls_017">142</span></div>
<div style="position:absolute;left:115.20px;top:207.50px" class="cls_017"><span class="cls_017">Running in an existing network namespace</span></div>
<div style="position:absolute;left:485.65px;top:207.50px" class="cls_017"><span class="cls_017">143</span></div>
<div style="position:absolute;left:115.20px;top:220.70px" class="cls_017"><span class="cls_017">Port management</span></div>
<div style="position:absolute;left:485.65px;top:220.70px" class="cls_017"><span class="cls_017">145</span></div>
<div style="position:absolute;left:115.20px;top:233.90px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:233.90px" class="cls_017"><span class="cls_017">147</span></div>
<div style="position:absolute;left:115.20px;top:247.10px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:247.10px" class="cls_017"><span class="cls_017">148</span></div>
<div style="position:absolute;left:115.20px;top:260.30px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:260.30px" class="cls_017"><span class="cls_017">148</span></div>
<div style="position:absolute;left:108.00px;top:275.08px" class="cls_016"><span class="cls_016">Chapter 8: Docker Compose</span></div>
<div style="position:absolute;left:483.98px;top:275.08px" class="cls_016"><span class="cls_016">149</span></div>
<div style="position:absolute;left:115.20px;top:290.78px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:485.65px;top:290.78px" class="cls_017"><span class="cls_017">150</span></div>
<div style="position:absolute;left:115.20px;top:303.98px" class="cls_017"><span class="cls_017">Demystifying declarative versus imperative</span></div>
<div style="position:absolute;left:485.65px;top:303.98px" class="cls_017"><span class="cls_017">150</span></div>
<div style="position:absolute;left:115.20px;top:317.18px" class="cls_017"><span class="cls_017">Running a multi-service app</span></div>
<div style="position:absolute;left:485.65px;top:317.18px" class="cls_017"><span class="cls_017">151</span></div>
<div style="position:absolute;left:115.20px;top:330.38px" class="cls_017"><span class="cls_017">Scaling a service</span></div>
<div style="position:absolute;left:485.65px;top:330.38px" class="cls_017"><span class="cls_017">156</span></div>
<div style="position:absolute;left:115.20px;top:343.58px" class="cls_017"><span class="cls_017">Building and pushing an application</span></div>
<div style="position:absolute;left:485.65px;top:343.58px" class="cls_017"><span class="cls_017">159</span></div>
<div style="position:absolute;left:115.20px;top:356.78px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:356.78px" class="cls_017"><span class="cls_017">160</span></div>
<div style="position:absolute;left:115.20px;top:369.98px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:369.98px" class="cls_017"><span class="cls_017">160</span></div>
<div style="position:absolute;left:115.20px;top:383.18px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:383.18px" class="cls_017"><span class="cls_017">160</span></div>
<div style="position:absolute;left:108.00px;top:397.96px" class="cls_016"><span class="cls_016">Chapter 9: Orchestrators</span></div>
<div style="position:absolute;left:483.98px;top:397.96px" class="cls_016"><span class="cls_016">161</span></div>
<div style="position:absolute;left:115.20px;top:413.66px" class="cls_017"><span class="cls_017">What are orchestrators and why do we need them?</span></div>
<div style="position:absolute;left:485.65px;top:413.66px" class="cls_017"><span class="cls_017">162</span></div>
<div style="position:absolute;left:115.20px;top:426.86px" class="cls_017"><span class="cls_017">The tasks of an orchestrator</span></div>
<div style="position:absolute;left:485.65px;top:426.86px" class="cls_017"><span class="cls_017">163</span></div>
<div style="position:absolute;left:126.00px;top:440.06px" class="cls_018"><span class="cls_018">Reconciling the desired state</span></div>
<div style="position:absolute;left:485.65px;top:440.06px" class="cls_018"><span class="cls_018">163</span></div>
<div style="position:absolute;left:126.00px;top:453.26px" class="cls_018"><span class="cls_018">Replicated and global services</span></div>
<div style="position:absolute;left:485.65px;top:453.26px" class="cls_018"><span class="cls_018">164</span></div>
<div style="position:absolute;left:126.00px;top:466.46px" class="cls_018"><span class="cls_018">Service discovery</span></div>
<div style="position:absolute;left:485.65px;top:466.46px" class="cls_018"><span class="cls_018">165</span></div>
<div style="position:absolute;left:126.00px;top:479.66px" class="cls_018"><span class="cls_018">Routing</span></div>
<div style="position:absolute;left:485.65px;top:479.66px" class="cls_018"><span class="cls_018">166</span></div>
<div style="position:absolute;left:126.00px;top:492.86px" class="cls_018"><span class="cls_018">Load balancing</span></div>
<div style="position:absolute;left:485.65px;top:492.86px" class="cls_018"><span class="cls_018">166</span></div>
<div style="position:absolute;left:126.00px;top:506.06px" class="cls_018"><span class="cls_018">Scaling</span></div>
<div style="position:absolute;left:485.65px;top:506.06px" class="cls_018"><span class="cls_018">167</span></div>
<div style="position:absolute;left:126.00px;top:519.26px" class="cls_018"><span class="cls_018">Self-healing</span></div>
<div style="position:absolute;left:485.65px;top:519.26px" class="cls_018"><span class="cls_018">168</span></div>
<div style="position:absolute;left:126.00px;top:532.46px" class="cls_018"><span class="cls_018">Zero downtime deployments</span></div>
<div style="position:absolute;left:485.65px;top:532.46px" class="cls_018"><span class="cls_018">169</span></div>
<div style="position:absolute;left:126.00px;top:545.66px" class="cls_018"><span class="cls_018">Affinity and location awareness</span></div>
<div style="position:absolute;left:485.65px;top:545.66px" class="cls_018"><span class="cls_018">170</span></div>
<div style="position:absolute;left:126.00px;top:558.86px" class="cls_018"><span class="cls_018">Security</span></div>
<div style="position:absolute;left:485.65px;top:558.86px" class="cls_018"><span class="cls_018">170</span></div>
<div style="position:absolute;left:133.20px;top:571.66px" class="cls_020"><span class="cls_020">Secure communication and cryptographic node identity</span></div>
<div style="position:absolute;left:488.99px;top:571.66px" class="cls_020"><span class="cls_020">171</span></div>
<div style="position:absolute;left:133.20px;top:582.46px" class="cls_020"><span class="cls_020">Secure networks and network policies</span></div>
<div style="position:absolute;left:488.99px;top:582.46px" class="cls_020"><span class="cls_020">171</span></div>
<div style="position:absolute;left:133.20px;top:593.26px" class="cls_020"><span class="cls_020">Role-based access control (RBAC)</span></div>
<div style="position:absolute;left:488.99px;top:593.26px" class="cls_020"><span class="cls_020">172</span></div>
<div style="position:absolute;left:133.20px;top:604.06px" class="cls_020"><span class="cls_020">Secrets</span></div>
<div style="position:absolute;left:488.99px;top:604.06px" class="cls_020"><span class="cls_020">172</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> v </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:8822px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background013.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:133.20px;top:114.91px" class="cls_020"><span class="cls_020">Content trust</span></div>
<div style="position:absolute;left:488.99px;top:114.91px" class="cls_020"><span class="cls_020">173</span></div>
<div style="position:absolute;left:133.20px;top:125.71px" class="cls_020"><span class="cls_020">Reverse uptime</span></div>
<div style="position:absolute;left:488.99px;top:125.71px" class="cls_020"><span class="cls_020">174</span></div>
<div style="position:absolute;left:126.00px;top:136.91px" class="cls_018"><span class="cls_018">Introspection</span></div>
<div style="position:absolute;left:485.64px;top:136.91px" class="cls_018"><span class="cls_018">174</span></div>
<div style="position:absolute;left:115.20px;top:150.11px" class="cls_017"><span class="cls_017">Overview of popular orchestrators</span></div>
<div style="position:absolute;left:485.64px;top:150.11px" class="cls_017"><span class="cls_017">175</span></div>
<div style="position:absolute;left:126.00px;top:163.31px" class="cls_018"><span class="cls_018">Kubernetes</span></div>
<div style="position:absolute;left:485.64px;top:163.31px" class="cls_018"><span class="cls_018">175</span></div>
<div style="position:absolute;left:126.00px;top:176.51px" class="cls_018"><span class="cls_018">Docker Swarm</span></div>
<div style="position:absolute;left:485.64px;top:176.51px" class="cls_018"><span class="cls_018">176</span></div>
<div style="position:absolute;left:126.00px;top:189.71px" class="cls_018"><span class="cls_018">Microsoft Azure Kubernetes Service (AKS)</span></div>
<div style="position:absolute;left:485.64px;top:189.71px" class="cls_018"><span class="cls_018">178</span></div>
<div style="position:absolute;left:126.00px;top:202.91px" class="cls_018"><span class="cls_018">Apache Mesos and Marathon</span></div>
<div style="position:absolute;left:485.64px;top:202.91px" class="cls_018"><span class="cls_018">178</span></div>
<div style="position:absolute;left:126.00px;top:216.11px" class="cls_018"><span class="cls_018">Amazon ECS</span></div>
<div style="position:absolute;left:485.64px;top:216.11px" class="cls_018"><span class="cls_018">179</span></div>
<div style="position:absolute;left:115.20px;top:229.31px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.64px;top:229.31px" class="cls_017"><span class="cls_017">180</span></div>
<div style="position:absolute;left:115.20px;top:242.51px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.64px;top:242.51px" class="cls_017"><span class="cls_017">180</span></div>
<div style="position:absolute;left:115.20px;top:255.71px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.64px;top:255.71px" class="cls_017"><span class="cls_017">180</span></div>
<div style="position:absolute;left:108.00px;top:270.49px" class="cls_016"><span class="cls_016">Chapter 10: Orchestrating Containerized Applications</span></div>
<div style="position:absolute;left:108.00px;top:284.89px" class="cls_016"><span class="cls_016">with Kubernetes</span></div>
<div style="position:absolute;left:483.98px;top:284.89px" class="cls_016"><span class="cls_016">181</span></div>
<div style="position:absolute;left:115.20px;top:300.59px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:485.65px;top:300.59px" class="cls_017"><span class="cls_017">182</span></div>
<div style="position:absolute;left:115.20px;top:313.79px" class="cls_017"><span class="cls_017">Architecture</span></div>
<div style="position:absolute;left:485.65px;top:313.79px" class="cls_017"><span class="cls_017">182</span></div>
<div style="position:absolute;left:115.20px;top:326.99px" class="cls_017"><span class="cls_017">Kubernetes master nodes</span></div>
<div style="position:absolute;left:485.65px;top:326.99px" class="cls_017"><span class="cls_017">185</span></div>
<div style="position:absolute;left:115.20px;top:340.19px" class="cls_017"><span class="cls_017">Cluster nodes</span></div>
<div style="position:absolute;left:485.65px;top:340.19px" class="cls_017"><span class="cls_017">186</span></div>
<div style="position:absolute;left:115.20px;top:353.39px" class="cls_017"><span class="cls_017">Introducing Minikube</span></div>
<div style="position:absolute;left:485.65px;top:353.39px" class="cls_017"><span class="cls_017">188</span></div>
<div style="position:absolute;left:115.20px;top:366.59px" class="cls_017"><span class="cls_017">Kubernetes support in Docker for Desktop</span></div>
<div style="position:absolute;left:485.65px;top:366.59px" class="cls_017"><span class="cls_017">190</span></div>
<div style="position:absolute;left:115.20px;top:379.79px" class="cls_017"><span class="cls_017">Pods</span></div>
<div style="position:absolute;left:485.65px;top:379.79px" class="cls_017"><span class="cls_017">196</span></div>
<div style="position:absolute;left:126.00px;top:392.99px" class="cls_018"><span class="cls_018">Comparing Docker Container and Kubernetes pod networking</span></div>
<div style="position:absolute;left:485.65px;top:392.99px" class="cls_018"><span class="cls_018">197</span></div>
<div style="position:absolute;left:126.00px;top:406.19px" class="cls_018"><span class="cls_018">Sharing the network namespace</span></div>
<div style="position:absolute;left:485.65px;top:406.19px" class="cls_018"><span class="cls_018">198</span></div>
<div style="position:absolute;left:126.00px;top:419.39px" class="cls_018"><span class="cls_018">Pod life cycle</span></div>
<div style="position:absolute;left:485.65px;top:419.39px" class="cls_018"><span class="cls_018">201</span></div>
<div style="position:absolute;left:126.00px;top:432.59px" class="cls_018"><span class="cls_018">Pod specification</span></div>
<div style="position:absolute;left:485.65px;top:432.59px" class="cls_018"><span class="cls_018">202</span></div>
<div style="position:absolute;left:126.00px;top:445.79px" class="cls_018"><span class="cls_018">Pods and volumes</span></div>
<div style="position:absolute;left:485.65px;top:445.79px" class="cls_018"><span class="cls_018">204</span></div>
<div style="position:absolute;left:115.20px;top:458.99px" class="cls_017"><span class="cls_017">Kubernetes ReplicaSet</span></div>
<div style="position:absolute;left:485.65px;top:458.99px" class="cls_017"><span class="cls_017">206</span></div>
<div style="position:absolute;left:126.00px;top:472.19px" class="cls_018"><span class="cls_018">ReplicaSet specification</span></div>
<div style="position:absolute;left:485.65px;top:472.19px" class="cls_018"><span class="cls_018">207</span></div>
<div style="position:absolute;left:126.00px;top:485.39px" class="cls_018"><span class="cls_018">Self-healing</span></div>
<div style="position:absolute;left:485.65px;top:485.39px" class="cls_018"><span class="cls_018">208</span></div>
<div style="position:absolute;left:115.20px;top:498.59px" class="cls_017"><span class="cls_017">Kubernetes deployment</span></div>
<div style="position:absolute;left:485.65px;top:498.59px" class="cls_017"><span class="cls_017">209</span></div>
<div style="position:absolute;left:115.20px;top:511.79px" class="cls_017"><span class="cls_017">Kubernetes service</span></div>
<div style="position:absolute;left:485.65px;top:511.79px" class="cls_017"><span class="cls_017">210</span></div>
<div style="position:absolute;left:115.20px;top:524.99px" class="cls_017"><span class="cls_017">Context-based routing</span></div>
<div style="position:absolute;left:485.65px;top:524.99px" class="cls_017"><span class="cls_017">212</span></div>
<div style="position:absolute;left:115.20px;top:538.19px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:538.19px" class="cls_017"><span class="cls_017">213</span></div>
<div style="position:absolute;left:115.20px;top:551.39px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:551.39px" class="cls_017"><span class="cls_017">213</span></div>
<div style="position:absolute;left:115.20px;top:564.59px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:564.59px" class="cls_017"><span class="cls_017">214</span></div>
<div style="position:absolute;left:108.00px;top:579.37px" class="cls_016"><span class="cls_016">Chapter 11: Deploying, Updating, and Securing an Application</span></div>
<div style="position:absolute;left:108.00px;top:593.77px" class="cls_016"><span class="cls_016">with Kubernetes</span></div>
<div style="position:absolute;left:483.98px;top:593.77px" class="cls_016"><span class="cls_016">215</span></div>
<div style="position:absolute;left:115.20px;top:609.47px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:485.65px;top:609.47px" class="cls_017"><span class="cls_017">216</span></div>
<div style="position:absolute;left:115.20px;top:622.67px" class="cls_017"><span class="cls_017">Deploying a first application</span></div>
<div style="position:absolute;left:485.65px;top:622.67px" class="cls_017"><span class="cls_017">216</span></div>
<div style="position:absolute;left:126.00px;top:635.87px" class="cls_018"><span class="cls_018">Deploying the web component</span></div>
<div style="position:absolute;left:485.65px;top:635.87px" class="cls_018"><span class="cls_018">216</span></div>
<div style="position:absolute;left:296.48px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> vi </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:9624px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background014.jpg" width=612 height=792></div>
<div style="position:absolute;left:440.96px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:126.00px;top:114.37px" class="cls_018"><span class="cls_018">Deploying the database</span></div>
<div style="position:absolute;left:485.64px;top:114.37px" class="cls_018"><span class="cls_018">220</span></div>
<div style="position:absolute;left:126.00px;top:127.57px" class="cls_018"><span class="cls_018">Streamlining the deployment</span></div>
<div style="position:absolute;left:485.64px;top:127.57px" class="cls_018"><span class="cls_018">225</span></div>
<div style="position:absolute;left:115.20px;top:140.77px" class="cls_017"><span class="cls_017">Zero downtime deployments</span></div>
<div style="position:absolute;left:485.64px;top:140.77px" class="cls_017"><span class="cls_017">226</span></div>
<div style="position:absolute;left:126.00px;top:153.97px" class="cls_018"><span class="cls_018">Rolling updates</span></div>
<div style="position:absolute;left:485.64px;top:153.97px" class="cls_018"><span class="cls_018">227</span></div>
<div style="position:absolute;left:126.00px;top:167.17px" class="cls_018"><span class="cls_018">Blue-green deployment</span></div>
<div style="position:absolute;left:485.64px;top:167.17px" class="cls_018"><span class="cls_018">230</span></div>
<div style="position:absolute;left:115.20px;top:180.37px" class="cls_017"><span class="cls_017">Kubernetes secrets</span></div>
<div style="position:absolute;left:485.64px;top:180.37px" class="cls_017"><span class="cls_017">235</span></div>
<div style="position:absolute;left:126.00px;top:193.57px" class="cls_018"><span class="cls_018">Manually defining secrets</span></div>
<div style="position:absolute;left:485.64px;top:193.57px" class="cls_018"><span class="cls_018">235</span></div>
<div style="position:absolute;left:126.00px;top:206.77px" class="cls_018"><span class="cls_018">Creating secrets with kubectl</span></div>
<div style="position:absolute;left:485.64px;top:206.77px" class="cls_018"><span class="cls_018">237</span></div>
<div style="position:absolute;left:126.00px;top:219.97px" class="cls_018"><span class="cls_018">Using secrets in a pod</span></div>
<div style="position:absolute;left:485.64px;top:219.97px" class="cls_018"><span class="cls_018">237</span></div>
<div style="position:absolute;left:126.00px;top:233.17px" class="cls_018"><span class="cls_018">Secret values in environment variables</span></div>
<div style="position:absolute;left:485.64px;top:233.17px" class="cls_018"><span class="cls_018">240</span></div>
<div style="position:absolute;left:115.20px;top:246.37px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.64px;top:246.37px" class="cls_017"><span class="cls_017">241</span></div>
<div style="position:absolute;left:115.20px;top:259.57px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.64px;top:259.57px" class="cls_017"><span class="cls_017">241</span></div>
<div style="position:absolute;left:115.20px;top:272.77px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.64px;top:272.77px" class="cls_017"><span class="cls_017">242</span></div>
<div style="position:absolute;left:108.00px;top:287.55px" class="cls_016"><span class="cls_016">Chapter 12: Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:483.98px;top:287.55px" class="cls_016"><span class="cls_016">243</span></div>
<div style="position:absolute;left:115.20px;top:303.25px" class="cls_017"><span class="cls_017">Technical requirements</span></div>
<div style="position:absolute;left:485.65px;top:303.25px" class="cls_017"><span class="cls_017">244</span></div>
<div style="position:absolute;left:115.20px;top:316.45px" class="cls_017"><span class="cls_017">Creating a fully managed Kubernetes cluster in Azure</span></div>
<div style="position:absolute;left:485.65px;top:316.45px" class="cls_017"><span class="cls_017">244</span></div>
<div style="position:absolute;left:126.00px;top:329.65px" class="cls_018"><span class="cls_018">Running the Azure CLI</span></div>
<div style="position:absolute;left:485.65px;top:329.65px" class="cls_018"><span class="cls_018">245</span></div>
<div style="position:absolute;left:126.00px;top:342.85px" class="cls_018"><span class="cls_018">Azure resource groups</span></div>
<div style="position:absolute;left:485.65px;top:342.85px" class="cls_018"><span class="cls_018">247</span></div>
<div style="position:absolute;left:126.00px;top:356.05px" class="cls_018"><span class="cls_018">Provisioning the Kubernetes cluster</span></div>
<div style="position:absolute;left:485.65px;top:356.05px" class="cls_018"><span class="cls_018">248</span></div>
<div style="position:absolute;left:115.20px;top:369.25px" class="cls_017"><span class="cls_017">Pushing Docker images to the Azure Container Registry (ACR)</span></div>
<div style="position:absolute;left:485.65px;top:369.25px" class="cls_017"><span class="cls_017">251</span></div>
<div style="position:absolute;left:126.00px;top:382.45px" class="cls_018"><span class="cls_018">Creating an ACR</span></div>
<div style="position:absolute;left:485.65px;top:382.45px" class="cls_018"><span class="cls_018">252</span></div>
<div style="position:absolute;left:126.00px;top:395.65px" class="cls_018"><span class="cls_018">Tagging and pushing Docker images</span></div>
<div style="position:absolute;left:485.65px;top:395.65px" class="cls_018"><span class="cls_018">253</span></div>
<div style="position:absolute;left:126.00px;top:408.85px" class="cls_018"><span class="cls_018">Configuring the service principal</span></div>
<div style="position:absolute;left:485.65px;top:408.85px" class="cls_018"><span class="cls_018">254</span></div>
<div style="position:absolute;left:115.20px;top:422.05px" class="cls_017"><span class="cls_017">Deploying an application into the Kubernetes cluster</span></div>
<div style="position:absolute;left:485.65px;top:422.05px" class="cls_017"><span class="cls_017">255</span></div>
<div style="position:absolute;left:115.20px;top:435.25px" class="cls_017"><span class="cls_017">Scaling the Pets application</span></div>
<div style="position:absolute;left:485.65px;top:435.25px" class="cls_017"><span class="cls_017">257</span></div>
<div style="position:absolute;left:126.00px;top:448.45px" class="cls_018"><span class="cls_018">Scaling the number of app instances</span></div>
<div style="position:absolute;left:485.65px;top:448.45px" class="cls_018"><span class="cls_018">257</span></div>
<div style="position:absolute;left:126.00px;top:461.65px" class="cls_018"><span class="cls_018">Scaling the number of cluster nodes</span></div>
<div style="position:absolute;left:485.65px;top:461.65px" class="cls_018"><span class="cls_018">258</span></div>
<div style="position:absolute;left:115.20px;top:474.85px" class="cls_017"><span class="cls_017">Monitoring the cluster and application</span></div>
<div style="position:absolute;left:485.65px;top:474.85px" class="cls_017"><span class="cls_017">260</span></div>
<div style="position:absolute;left:126.00px;top:488.05px" class="cls_018"><span class="cls_018">Creating a log analytics workspace</span></div>
<div style="position:absolute;left:485.65px;top:488.05px" class="cls_018"><span class="cls_018">261</span></div>
<div style="position:absolute;left:126.00px;top:501.25px" class="cls_018"><span class="cls_018">Monitoring the container health</span></div>
<div style="position:absolute;left:485.65px;top:501.25px" class="cls_018"><span class="cls_018">263</span></div>
<div style="position:absolute;left:126.00px;top:514.45px" class="cls_018"><span class="cls_018">Viewing the logs of Kubernetes masters</span></div>
<div style="position:absolute;left:485.65px;top:514.45px" class="cls_018"><span class="cls_018">264</span></div>
<div style="position:absolute;left:126.00px;top:527.65px" class="cls_018"><span class="cls_018">Viewing the kublet and container logs</span></div>
<div style="position:absolute;left:485.65px;top:527.65px" class="cls_018"><span class="cls_018">267</span></div>
<div style="position:absolute;left:126.00px;top:540.85px" class="cls_018"><span class="cls_018">Upgrading the application with zero downtime</span></div>
<div style="position:absolute;left:485.65px;top:540.85px" class="cls_018"><span class="cls_018">272</span></div>
<div style="position:absolute;left:126.00px;top:554.05px" class="cls_018"><span class="cls_018">Upgrading Kubernetes</span></div>
<div style="position:absolute;left:485.65px;top:554.05px" class="cls_018"><span class="cls_018">273</span></div>
<div style="position:absolute;left:115.20px;top:567.25px" class="cls_017"><span class="cls_017">Debugging the application while it is running in AKS</span></div>
<div style="position:absolute;left:485.65px;top:567.25px" class="cls_017"><span class="cls_017">275</span></div>
<div style="position:absolute;left:126.00px;top:580.45px" class="cls_018"><span class="cls_018">Creating a Kubernetes cluster for development</span></div>
<div style="position:absolute;left:485.65px;top:580.45px" class="cls_018"><span class="cls_018">275</span></div>
<div style="position:absolute;left:126.00px;top:593.65px" class="cls_018"><span class="cls_018">Configuring the environment</span></div>
<div style="position:absolute;left:485.65px;top:593.65px" class="cls_018"><span class="cls_018">277</span></div>
<div style="position:absolute;left:126.00px;top:606.85px" class="cls_018"><span class="cls_018">Deploying and running a service</span></div>
<div style="position:absolute;left:485.65px;top:606.85px" class="cls_018"><span class="cls_018">278</span></div>
<div style="position:absolute;left:126.00px;top:620.05px" class="cls_018"><span class="cls_018">Remote debugging a service using Visual Studio Code</span></div>
<div style="position:absolute;left:485.65px;top:620.05px" class="cls_018"><span class="cls_018">280</span></div>
<div style="position:absolute;left:126.00px;top:633.25px" class="cls_018"><span class="cls_018">Enabling edit-and-continue style development in the cloud</span></div>
<div style="position:absolute;left:485.65px;top:633.25px" class="cls_018"><span class="cls_018">282</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> vii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:10426px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background015.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Table of Contents</span></div>
<div style="position:absolute;left:115.20px;top:114.37px" class="cls_017"><span class="cls_017">Cleaning up</span></div>
<div style="position:absolute;left:485.65px;top:114.37px" class="cls_017"><span class="cls_017">283</span></div>
<div style="position:absolute;left:115.20px;top:127.57px" class="cls_017"><span class="cls_017">Summary</span></div>
<div style="position:absolute;left:485.65px;top:127.57px" class="cls_017"><span class="cls_017">283</span></div>
<div style="position:absolute;left:115.20px;top:140.77px" class="cls_017"><span class="cls_017">Questions</span></div>
<div style="position:absolute;left:485.65px;top:140.77px" class="cls_017"><span class="cls_017">284</span></div>
<div style="position:absolute;left:115.20px;top:153.97px" class="cls_017"><span class="cls_017">Further reading</span></div>
<div style="position:absolute;left:485.65px;top:153.97px" class="cls_017"><span class="cls_017">284</span></div>
<div style="position:absolute;left:108.00px;top:168.75px" class="cls_016"><span class="cls_016">Appendix: Assessment</span></div>
<div style="position:absolute;left:483.98px;top:168.75px" class="cls_016"><span class="cls_016">285</span></div>
<div style="position:absolute;left:115.20px;top:184.45px" class="cls_017"><span class="cls_017">Chapter 1: What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:485.65px;top:184.45px" class="cls_017"><span class="cls_017">285</span></div>
<div style="position:absolute;left:115.20px;top:197.65px" class="cls_017"><span class="cls_017">Chapter 2: Setting up a Working Environment</span></div>
<div style="position:absolute;left:485.65px;top:197.65px" class="cls_017"><span class="cls_017">286</span></div>
<div style="position:absolute;left:115.20px;top:210.85px" class="cls_017"><span class="cls_017">Chapter 3: Working with Containers</span></div>
<div style="position:absolute;left:485.65px;top:210.85px" class="cls_017"><span class="cls_017">287</span></div>
<div style="position:absolute;left:115.20px;top:224.05px" class="cls_017"><span class="cls_017">Chapter 4: Creating and Managing Container Images</span></div>
<div style="position:absolute;left:485.65px;top:224.05px" class="cls_017"><span class="cls_017">287</span></div>
<div style="position:absolute;left:115.20px;top:237.25px" class="cls_017"><span class="cls_017">Chapter 5: Data Volumes and System Management</span></div>
<div style="position:absolute;left:485.65px;top:237.25px" class="cls_017"><span class="cls_017">289</span></div>
<div style="position:absolute;left:115.20px;top:250.45px" class="cls_017"><span class="cls_017">Chapter 6: Distributed Application Architecture</span></div>
<div style="position:absolute;left:485.65px;top:250.45px" class="cls_017"><span class="cls_017">290</span></div>
<div style="position:absolute;left:115.20px;top:263.65px" class="cls_017"><span class="cls_017">Chapter 7: Single-Host Networking</span></div>
<div style="position:absolute;left:485.65px;top:263.65px" class="cls_017"><span class="cls_017">291</span></div>
<div style="position:absolute;left:115.20px;top:276.85px" class="cls_017"><span class="cls_017">Chapter 8: Docker Compose</span></div>
<div style="position:absolute;left:485.65px;top:276.85px" class="cls_017"><span class="cls_017">292</span></div>
<div style="position:absolute;left:115.20px;top:290.05px" class="cls_017"><span class="cls_017">Chapter 9: Orchestrators</span></div>
<div style="position:absolute;left:485.65px;top:290.05px" class="cls_017"><span class="cls_017">293</span></div>
<div style="position:absolute;left:115.20px;top:303.25px" class="cls_017"><span class="cls_017">Chapter 10:  Orchestrating Containerized Applications</span></div>
<div style="position:absolute;left:115.20px;top:316.45px" class="cls_017"><span class="cls_017">with Kubernetes</span></div>
<div style="position:absolute;left:485.65px;top:316.45px" class="cls_017"><span class="cls_017">294</span></div>
<div style="position:absolute;left:115.20px;top:329.65px" class="cls_017"><span class="cls_017">Chapter 11: Deploying, Updating, and Securing an Application</span></div>
<div style="position:absolute;left:115.20px;top:342.85px" class="cls_017"><span class="cls_017">with Kubernetes</span></div>
<div style="position:absolute;left:485.65px;top:342.85px" class="cls_017"><span class="cls_017">295</span></div>
<div style="position:absolute;left:115.20px;top:356.05px" class="cls_017"><span class="cls_017">Chapter 12: Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:485.65px;top:356.05px" class="cls_017"><span class="cls_017">297</span></div>
<div style="position:absolute;left:108.00px;top:370.83px" class="cls_016"><span class="cls_016">Other Books You May Enjoy</span></div>
<div style="position:absolute;left:483.98px;top:370.83px" class="cls_016"><span class="cls_016">299</span></div>
<div style="position:absolute;left:108.00px;top:388.11px" class="cls_016"><span class="cls_016">Index</span></div>
<div style="position:absolute;left:483.98px;top:388.11px" class="cls_016"><span class="cls_016">303</span></div>
<div style="position:absolute;left:294.26px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> viii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:11228px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background016.jpg" width=612 height=792></div>
<div style="position:absolute;left:400.61px;top:218.41px" class="cls_015"><span class="cls_015">Preface</span></div>
<div style="position:absolute;left:108.00px;top:272.11px" class="cls_008"><span class="cls_008">Containerization is said to be the best way to implement DevOps and the main goal of</span></div>
<div style="position:absolute;left:108.00px;top:284.71px" class="cls_008"><span class="cls_008">this book is to provide end-to-end deployment solutions for your Azure environment.</span></div>
<div style="position:absolute;left:108.00px;top:305.96px" class="cls_008"><span class="cls_008">This book will initiate with the implementation of deploying and managing</span></div>
<div style="position:absolute;left:108.00px;top:318.56px" class="cls_008"><span class="cls_008">containers along with getting you up and running with Docker and Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:331.16px" class="cls_008"><span class="cls_008">Then, this book will explain operations for container management and orchestration</span></div>
<div style="position:absolute;left:108.00px;top:343.76px" class="cls_008"><span class="cls_008">in Docker using Azure's cloud solutions. You will also learn to deploy and manage</span></div>
<div style="position:absolute;left:108.00px;top:356.36px" class="cls_008"><span class="cls_008">highly scalable applications along with setting-up production ready Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:368.96px" class="cls_008"><span class="cls_008">cluster on Azure in an intact environment. Lastly, The book will also help you</span></div>
<div style="position:absolute;left:108.00px;top:381.56px" class="cls_008"><span class="cls_008">leverage Microsoft's Docker and Kubernetes tools to build apps that can be quickly</span></div>
<div style="position:absolute;left:108.00px;top:394.16px" class="cls_008"><span class="cls_008">deployed on Azure.</span></div>
<div style="position:absolute;left:108.00px;top:415.40px" class="cls_008"><span class="cls_008">By the end of the book, you will get hands-on with some more advanced topics to</span></div>
<div style="position:absolute;left:108.00px;top:428.00px" class="cls_008"><span class="cls_008">further extend your knowledge about Docker and Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:460.49px" class="cls_011"><span class="cls_011">Who this book is for</span></div>
<div style="position:absolute;left:108.00px;top:485.47px" class="cls_008"><span class="cls_008">If you are a developer, system administrator, or DevOps engineer who wants to use</span></div>
<div style="position:absolute;left:108.00px;top:498.07px" class="cls_008"><span class="cls_008">Docker and Kubernetes to run your mission-critical applications scalable, securely,</span></div>
<div style="position:absolute;left:108.00px;top:510.67px" class="cls_008"><span class="cls_008">and highly available on-prem or in the cloud, then this book is for you. In order</span></div>
<div style="position:absolute;left:108.00px;top:523.27px" class="cls_008"><span class="cls_008">to learn from this book, you should have some basic Linux/Unix skills such as</span></div>
<div style="position:absolute;left:108.00px;top:535.87px" class="cls_008"><span class="cls_008">installing packages, editing files, managing services, and so on. If you have some</span></div>
<div style="position:absolute;left:108.00px;top:548.47px" class="cls_008"><span class="cls_008">basic virtualization experience that would be an added advantage.</span></div>
<div style="position:absolute;left:297.10px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> ix </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:12030px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background017.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">What this book covers</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_021"><span class="cls_021">Chapter 1</span><span class="cls_008">, </span><span class="cls_021">What Are Containers and Why Should I Use Them?</span><span class="cls_008">, this chapter focuses on</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">the software supply chain and the friction within it. It then presents containers as</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">a means to reduce this friction and add enterprise-grade security on top of it. In</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">this chapter, we also look into how containers and the ecosystem around them are</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">assembled. We specifically point out the distinction between the upstream OSS</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">components (Moby) that form the building blocks of the downstream products of</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">Docker and other vendors.</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_021"><span class="cls_021">Chapter 2</span><span class="cls_008">, </span><span class="cls_021">Setting up a Working Environment</span><span class="cls_008">, in this chapter discussed in detail how to</span></div>
<div style="position:absolute;left:108.00px;top:246.34px" class="cls_008"><span class="cls_008">set up an ideal environment for developers, DevOps and operators that can be used</span></div>
<div style="position:absolute;left:108.00px;top:258.94px" class="cls_008"><span class="cls_008">when working with Docker containers.</span></div>
<div style="position:absolute;left:108.00px;top:280.18px" class="cls_021"><span class="cls_021">Chapter 3</span><span class="cls_008">, </span><span class="cls_021">Working with Containers</span><span class="cls_008">, this chapter teaches how start, stop and remove</span></div>
<div style="position:absolute;left:108.00px;top:292.78px" class="cls_008"><span class="cls_008">containers. The chapter also teaches how to inspect containers to retrieve additional</span></div>
<div style="position:absolute;left:108.00px;top:305.38px" class="cls_008"><span class="cls_008">metadata of it. Furthermore, it introduces how to run additional processes or how to</span></div>
<div style="position:absolute;left:108.00px;top:317.98px" class="cls_008"><span class="cls_008">attach to the main process in an already running container. It is also showing how</span></div>
<div style="position:absolute;left:108.00px;top:330.58px" class="cls_008"><span class="cls_008">to retrieve logging information from a container that is produced by the processes</span></div>
<div style="position:absolute;left:108.00px;top:343.18px" class="cls_008"><span class="cls_008">running inside it. Finally, the chapter introduces the inner workings of a container</span></div>
<div style="position:absolute;left:108.00px;top:355.78px" class="cls_008"><span class="cls_008">including such things as Linux namespaces and cgroups.</span></div>
<div style="position:absolute;left:108.00px;top:377.02px" class="cls_021"><span class="cls_021">Chapter 4</span><span class="cls_008">, </span><span class="cls_021">Creating and Managing Container Images</span><span class="cls_008">, this chapter introduces the</span></div>
<div style="position:absolute;left:108.00px;top:389.63px" class="cls_008"><span class="cls_008">different ways how to create container images that serve as templates for containers.</span></div>
<div style="position:absolute;left:108.00px;top:402.23px" class="cls_008"><span class="cls_008">It introduces the inner structure of an image and how it is built.</span></div>
<div style="position:absolute;left:108.00px;top:423.47px" class="cls_021"><span class="cls_021">Chapter 5</span><span class="cls_008">, </span><span class="cls_021">Data Volumes and System Management</span><span class="cls_008">, this chapter introduces data volumes</span></div>
<div style="position:absolute;left:108.00px;top:436.07px" class="cls_008"><span class="cls_008">that can be used by stateful components running in containers. The chapter also</span></div>
<div style="position:absolute;left:108.00px;top:448.67px" class="cls_008"><span class="cls_008">introduces system level commands that are used to gather information about Docker</span></div>
<div style="position:absolute;left:108.00px;top:461.27px" class="cls_008"><span class="cls_008">and the underlying OS as well as commands to clean the system from orphaned</span></div>
<div style="position:absolute;left:108.00px;top:473.87px" class="cls_008"><span class="cls_008">resources. Finally, it introduces the system events generated by the Docker engine.</span></div>
<div style="position:absolute;left:108.00px;top:495.11px" class="cls_021"><span class="cls_021">Chapter 6</span><span class="cls_008">, </span><span class="cls_021">Distributed Application Architecture</span><span class="cls_008">, this chapter introduces the concept of</span></div>
<div style="position:absolute;left:108.00px;top:507.71px" class="cls_008"><span class="cls_008">a distributed application architecture and discusses the various patterns and best</span></div>
<div style="position:absolute;left:108.00px;top:520.31px" class="cls_008"><span class="cls_008">practices that are required to run a distributed application successfully. Finally,</span></div>
<div style="position:absolute;left:108.00px;top:532.91px" class="cls_008"><span class="cls_008">it discusses the additional requirements that need to be fulfilled to run such an</span></div>
<div style="position:absolute;left:108.00px;top:545.51px" class="cls_008"><span class="cls_008">application in production.</span></div>
<div style="position:absolute;left:108.00px;top:566.75px" class="cls_021"><span class="cls_021">Chapter 7</span><span class="cls_008">, </span><span class="cls_021">Single-Host Networking</span><span class="cls_008">, this chapter introduces the Docker container</span></div>
<div style="position:absolute;left:108.00px;top:579.35px" class="cls_008"><span class="cls_008">networking model and its single host implementation in the form of the bridge</span></div>
<div style="position:absolute;left:108.00px;top:591.95px" class="cls_008"><span class="cls_008">network. The chapter introduces the concept of software-defined networks and</span></div>
<div style="position:absolute;left:108.00px;top:604.55px" class="cls_008"><span class="cls_008">how they are used to secure containerized applications. Finally, it introduces</span></div>
<div style="position:absolute;left:108.00px;top:617.15px" class="cls_008"><span class="cls_008">how container ports can be opened to the public and thus make containerized</span></div>
<div style="position:absolute;left:108.00px;top:629.75px" class="cls_008"><span class="cls_008">components accessible from the outside world.</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> x </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:12832px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background018.jpg" width=612 height=792></div>
<div style="position:absolute;left:478.46px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_021"><span class="cls_021">Chapter 8</span><span class="cls_008">, </span><span class="cls_021">Docker Compose</span><span class="cls_008">, this chapter introduces the concept of an application</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">consisting of multiple services each running in a container and how Docker</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">Compose allows us to easily build, run and scale such an application using a</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">declarative approach.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_021"><span class="cls_021">Chapter 9</span><span class="cls_008">, </span><span class="cls_021">Orchestrators</span><span class="cls_008">, this chapter introduces the concept of orchestrators. It</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">teaches why orchestrators are needed and how they conceptually work. The chapter</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">will also provide an overview of the most popular orchestrators and name a few of</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">their pros and cons.</span></div>
<div style="position:absolute;left:108.00px;top:232.58px" class="cls_021"><span class="cls_021">Chapter 10</span><span class="cls_008">,  </span><span class="cls_021">Orchestrating Containerized Applications with Kubernetes</span><span class="cls_008">, this chapter</span></div>
<div style="position:absolute;left:108.00px;top:245.18px" class="cls_008"><span class="cls_008">introduces Kubernetes. Kubernetes is currently the clear leader in the container</span></div>
<div style="position:absolute;left:108.00px;top:257.78px" class="cls_008"><span class="cls_008">orchestration space. It starts with a high-level overview of the architecture of a</span></div>
<div style="position:absolute;left:108.00px;top:270.38px" class="cls_008"><span class="cls_008">Kubernetes cluster and then discusses the main objects used in Kubernetes to define</span></div>
<div style="position:absolute;left:108.00px;top:282.98px" class="cls_008"><span class="cls_008">and run containerized applications.</span></div>
<div style="position:absolute;left:108.00px;top:304.22px" class="cls_021"><span class="cls_021">Chapter 11</span><span class="cls_008">, </span><span class="cls_021">Deploying, Updating, and Securing an Application with Kubernetes</span><span class="cls_008">, this</span></div>
<div style="position:absolute;left:108.00px;top:316.82px" class="cls_008"><span class="cls_008">chapter teaches how to deploy, update and scale applications into a Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:329.42px" class="cls_008"><span class="cls_008">cluster. It also explains how zero downtime deployments are achieved to enable</span></div>
<div style="position:absolute;left:108.00px;top:342.02px" class="cls_008"><span class="cls_008">disruption free updates and rollbacks of mission-critical applications. This chapter</span></div>
<div style="position:absolute;left:108.00px;top:354.62px" class="cls_008"><span class="cls_008">also introduces Kubernetes secrets as a means to configure services with and protect</span></div>
<div style="position:absolute;left:108.00px;top:367.22px" class="cls_008"><span class="cls_008">sensitive data.</span></div>
<div style="position:absolute;left:108.00px;top:388.46px" class="cls_021"><span class="cls_021">Chapter 12</span><span class="cls_008">, </span><span class="cls_021">Running a Containerized App in the Cloud</span><span class="cls_008">, this chapter shows how to</span></div>
<div style="position:absolute;left:108.00px;top:401.06px" class="cls_008"><span class="cls_008">deploy a complex containerized application into a hosted Kubernetes cluster on</span></div>
<div style="position:absolute;left:108.00px;top:413.66px" class="cls_008"><span class="cls_008">Microsoft Azure using the Azure Kubernetes Service (AKS) offering. First it explains</span></div>
<div style="position:absolute;left:108.00px;top:426.26px" class="cls_008"><span class="cls_008">how to provision a Kubernetes cluster, second it shows how to host the Docker</span></div>
<div style="position:absolute;left:108.00px;top:438.86px" class="cls_008"><span class="cls_008">images in the Azure Container Registry and finally it demonstrates how to deploy,</span></div>
<div style="position:absolute;left:108.00px;top:451.46px" class="cls_008"><span class="cls_008">run, monitor, scale and upgrade the application. The chapter also demonstrates how</span></div>
<div style="position:absolute;left:108.00px;top:464.06px" class="cls_008"><span class="cls_008">to upgrade the version of Kubernetes in the cluster without causing any downtime.</span></div>
<div style="position:absolute;left:108.00px;top:496.55px" class="cls_011"><span class="cls_011">To get the most out of this book</span></div>
<div style="position:absolute;left:108.00px;top:521.53px" class="cls_008"><span class="cls_008">Ideally you have access to a laptop or personal computer with Windows 10</span></div>
<div style="position:absolute;left:108.00px;top:534.13px" class="cls_008"><span class="cls_008">Professional or a recent version of Mac OS X installed. A computer with any popular</span></div>
<div style="position:absolute;left:108.00px;top:546.73px" class="cls_008"><span class="cls_008">Linux OS installed works too. If you're on a Mac you should install Docker for Mac</span></div>
<div style="position:absolute;left:108.00px;top:559.33px" class="cls_008"><span class="cls_008">and if you're on Windows then install Docker for Windows. You can download them</span></div>
<div style="position:absolute;left:108.00px;top:571.93px" class="cls_008"><span class="cls_008">from here: </span><A HREF="https://www.docker.com/community-edition">https://www.docker.com/community-edition</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:593.18px" class="cls_008"><span class="cls_008">If you are on an older version of Windows or are using Windows 10 Home edition,</span></div>
<div style="position:absolute;left:108.00px;top:605.78px" class="cls_008"><span class="cls_008">then you should install Docker Toolbox. You can find the Docker Toolbox here:</span></div>
<div style="position:absolute;left:108.00px;top:618.37px" class="cls_010"><span class="cls_010"> </span><A HREF="https://docs.docker.com/toolbox/toolbox_install_windows/">https://docs.docker.com/toolbox/toolbox_install_windows/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:297.10px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> xi </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:13634px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background019.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">On the Mac, use the Terminal application, and on Windows, use a PowerShell</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">console to try out the commands you will be learning. You also need a recent version</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">of a browser such as Google Chrome, Safari or Internet Explorer. Of course you will</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">need internet access to download tools and container images that we are going to use</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">and explore in this book.</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">To follow </span><span class="cls_021">Chapter 12</span><span class="cls_008">, Running a Containerized App in the Cloud, you need access</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">to Microsoft Azure. If you do not have an existing account on Azure it is possible to</span></div>
<div style="position:absolute;left:108.00px;top:211.33px" class="cls_008"><span class="cls_008">request a trial account here at </span><A HREF="https://azure.microsoft.com/en-us/free/">https://azure.microsoft.com/en-us/free/</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:243.83px" class="cls_011"><span class="cls_011">Download the EPUB/mobi and example</span></div>
<div style="position:absolute;left:108.00px;top:267.83px" class="cls_011"><span class="cls_011">code files</span></div>
<div style="position:absolute;left:108.00px;top:292.81px" class="cls_008"><span class="cls_008">An EPUB and mobi version of this book is available free of charge on Github.</span></div>
<div style="position:absolute;left:108.00px;top:305.41px" class="cls_008"><span class="cls_008">You can download them and the code bundle at </span><A HREF="https://github.com/PacktPublishing/Containerize-your-Apps-with-Docker-and-Kubernetes">https://github.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:318.01px" class="cls_010"><span class="cls_010"> </span><A HREF="https://github.com/PacktPublishing/Containerize-your-Apps-with-Docker-and-Kubernetes">PacktPublishing/Containerize-your-Apps-with-Docker-and-Kubernetes</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:339.26px" class="cls_008"><span class="cls_008">You can download the example code files for this book from your account at</span></div>
<div style="position:absolute;left:108.00px;top:351.85px" class="cls_010"><span class="cls_010"> </span><A HREF="http://www.packtpub.com">http://www.packtpub.com</A> <span class="cls_008">. If you purchased this book elsewhere, you can visit</span></div>
<div style="position:absolute;left:108.00px;top:364.45px" class="cls_010"><span class="cls_010"> </span><A HREF="http://www.packtpub.com/support">http://www.packtpub.com/support</A> <span class="cls_008"> and register to have the files emailed directly</span></div>
<div style="position:absolute;left:108.00px;top:377.05px" class="cls_008"><span class="cls_008">to you.</span></div>
<div style="position:absolute;left:108.00px;top:398.30px" class="cls_008"><span class="cls_008">You can download the code files by following these steps:</span></div>
<div style="position:absolute;left:126.00px;top:419.53px" class="cls_008"><span class="cls_008">1.  Log in or register at </span><A HREF="http://www.packtpub.com">http://www.packtpub.com</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:436.45px" class="cls_008"><span class="cls_008">2.  Select the </span><span class="cls_009">SUPPORT</span><span class="cls_008"> tab.</span></div>
<div style="position:absolute;left:126.00px;top:453.36px" class="cls_008"><span class="cls_008">3.  Click on </span><span class="cls_009">Code Downloads & Errata</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:470.28px" class="cls_008"><span class="cls_008">4.  Enter the name of the book in the </span><span class="cls_009">Search</span><span class="cls_008"> box and follow the on-screen</span></div>
<div style="position:absolute;left:144.00px;top:482.88px" class="cls_008"><span class="cls_008">instructions.</span></div>
<div style="position:absolute;left:107.99px;top:504.12px" class="cls_008"><span class="cls_008">Once the file is downloaded, please make sure that you unzip or extract the folder</span></div>
<div style="position:absolute;left:107.99px;top:516.72px" class="cls_008"><span class="cls_008">using the latest version of:</span></div>
<div style="position:absolute;left:125.99px;top:537.96px" class="cls_008"><span class="cls_008">•  WinRAR / 7-Zip for Windows</span></div>
<div style="position:absolute;left:125.99px;top:554.88px" class="cls_008"><span class="cls_008">•  Zipeg / iZip / UnRarX for Mac</span></div>
<div style="position:absolute;left:125.99px;top:571.79px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:143.99px;top:571.79px" class="cls_008"><span class="cls_008">7-Zip / PeaZip for Linux</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> xii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:14436px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background020.jpg" width=612 height=792></div>
<div style="position:absolute;left:478.46px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The code bundle for the book is hosted on GitHub at </span><A HREF="https://github.com/appswithdockerandkubernetes/labs">https://github.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010"> </span><A HREF="https://github.com/appswithdockerandkubernetes/labs">appswithdockerandkubernetes/labs</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:148.34px" class="cls_008"><span class="cls_008">We also have other code bundles from our rich catalog of books and videos available</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_008"><span class="cls_008">at </span><A HREF="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</A> </span><span class="cls_008">. Check them out!</span></div>
<div style="position:absolute;left:108.00px;top:190.87px" class="cls_022"><span class="cls_022">Download the color images</span></div>
<div style="position:absolute;left:108.00px;top:213.85px" class="cls_008"><span class="cls_008">We also provide a PDF file that has color images of the screenshots/diagrams used</span></div>
<div style="position:absolute;left:108.00px;top:226.45px" class="cls_008"><span class="cls_008">in this book. You can download it from </span><A HREF="https://www.packtpub.com/sites/default/files/downloads/9781789610369_ColorImages.pdf">https://www.packtpub.com/sites/</A> </span></div>
<div style="position:absolute;left:108.00px;top:239.05px" class="cls_010"><span class="cls_010"> </span><A HREF="https://www.packtpub.com/sites/default/files/downloads/9781789610369_ColorImages.pdf">default/files/downloads/9781789610369_ColorImages.pdf</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:268.99px" class="cls_022"><span class="cls_022">Conventions used</span></div>
<div style="position:absolute;left:108.00px;top:291.97px" class="cls_008"><span class="cls_008">There are a number of text conventions used throughout this book.</span></div>
<div style="position:absolute;left:108.00px;top:313.21px" class="cls_010"><span class="cls_010">CodeInText</span><span class="cls_008">: Indicates code words in text, database table names, folder names,</span></div>
<div style="position:absolute;left:108.01px;top:325.81px" class="cls_008"><span class="cls_008">filenames, file extensions, pathnames, dummy URLs, user input, and Twitter</span></div>
<div style="position:absolute;left:108.01px;top:338.41px" class="cls_008"><span class="cls_008">handles. For example; "The content of each layer is mapped to a special folder</span></div>
<div style="position:absolute;left:108.01px;top:351.01px" class="cls_008"><span class="cls_008">on the host system, which is usually a subfolder of </span><span class="cls_010">/var/lib/docker/</span><span class="cls_008">."</span></div>
<div style="position:absolute;left:108.00px;top:372.26px" class="cls_008"><span class="cls_008">A block of code is set as follows:</span></div>
<div style="position:absolute;left:126.00px;top:393.19px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:126.00px;top:405.43px" class="cls_023"><span class="cls_023">COPY ./web /app/web</span></div>
<div style="position:absolute;left:126.00px;top:417.67px" class="cls_023"><span class="cls_023">COPY sample.txt /data/my-sample.txt</span></div>
<div style="position:absolute;left:126.00px;top:429.91px" class="cls_023"><span class="cls_023">ADD sample.tar /app/bin/</span></div>
<div style="position:absolute;left:126.00px;top:442.15px" class="cls_023"><span class="cls_023">ADD </span><A HREF="http://example.com/sample.txt/">http://example.com/sample.txt</A> /data/</div>
<div style="position:absolute;left:108.00px;top:461.89px" class="cls_008"><span class="cls_008">When we wish to draw your attention to a particular part of a code block, the</span></div>
<div style="position:absolute;left:108.00px;top:474.49px" class="cls_008"><span class="cls_008">relevant lines or items are set in bold:</span></div>
<div style="position:absolute;left:126.00px;top:495.43px" class="cls_023"><span class="cls_023">FROM python:2.7</span></div>
<div style="position:absolute;left:126.00px;top:507.67px" class="cls_023"><span class="cls_023">RUN mkdir -p /app</span></div>
<div style="position:absolute;left:126.00px;top:519.91px" class="cls_023"><span class="cls_023">WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:532.15px" class="cls_023"><span class="cls_023">COPY ./requirements.txt /app/</span></div>
<div style="position:absolute;left:126.00px;top:544.39px" class="cls_024"><span class="cls_024">RUN pip install -r requirements.txt</span></div>
<div style="position:absolute;left:126.00px;top:556.63px" class="cls_023"><span class="cls_023">CMD ["python", "main.py"]</span></div>
<div style="position:absolute;left:294.88px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> xiii </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:15238px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background021.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Any command-line input or output is written as follows:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">az group create --name pets-group --location westeurope</span></div>
<div style="position:absolute;left:108.00px;top:155.17px" class="cls_009"><span class="cls_009">Bold</span><span class="cls_008">: Indicates a new term, an important word, or words that you see on screen. For</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">example, in menus or dialog boxes appear in the text like this. Here is an example:</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">"Select </span><span class="cls_009">System info</span><span class="cls_008"> from the </span><span class="cls_009">Administration</span><span class="cls_008"> panel."</span></div>
<div style="position:absolute;left:209.72px;top:218.33px" class="cls_025"><span class="cls_025">Warnings or important notes appear in a box like this.</span></div>
<div style="position:absolute;left:209.06px;top:272.33px" class="cls_025"><span class="cls_025">Tips and tricks appear like this.</span></div>
<div style="position:absolute;left:108.00px;top:316.87px" class="cls_011"><span class="cls_011">Get in touch</span></div>
<div style="position:absolute;left:108.00px;top:341.85px" class="cls_008"><span class="cls_008">Feedback from our readers is always welcome.</span></div>
<div style="position:absolute;left:108.00px;top:363.09px" class="cls_009"><span class="cls_009">General feedback</span><span class="cls_008">: Email </span><span class="cls_010">customercare@packtpub.com</span><span class="cls_008">, and mention the book's</span></div>
<div style="position:absolute;left:108.00px;top:375.69px" class="cls_008"><span class="cls_008">title in the subject of your message. If you have questions about any aspect of this</span></div>
<div style="position:absolute;left:108.00px;top:388.29px" class="cls_008"><span class="cls_008">book, please email us at </span><span class="cls_010">customercare@packtpub.com</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:409.54px" class="cls_009"><span class="cls_009">Errata</span><span class="cls_008">: Although we have taken every care to ensure the accuracy of our content,</span></div>
<div style="position:absolute;left:108.00px;top:422.14px" class="cls_008"><span class="cls_008">mistakes do happen. If you have found a mistake in this book we would be grateful</span></div>
<div style="position:absolute;left:108.00px;top:434.74px" class="cls_008"><span class="cls_008">if you would report this to us. Please visit, </span><A HREF="http://www.packtpub.com/submit-errata">http://www.packtpub.com/submit-</A> </span></div>
<div style="position:absolute;left:108.00px;top:447.33px" class="cls_010"><span class="cls_010"> </span><A HREF="http://www.packtpub.com/submit-errata">errata</A> <span class="cls_008">, selecting your book, clicking on the Errata Submission Form link, and</span></div>
<div style="position:absolute;left:108.00px;top:459.93px" class="cls_008"><span class="cls_008">entering the details.</span></div>
<div style="position:absolute;left:108.00px;top:481.18px" class="cls_009"><span class="cls_009">Piracy</span><span class="cls_008">: If you come across any illegal copies of our works in any form on the</span></div>
<div style="position:absolute;left:108.00px;top:493.78px" class="cls_008"><span class="cls_008">Internet, we would be grateful if you would provide us with the location address</span></div>
<div style="position:absolute;left:108.00px;top:506.37px" class="cls_008"><span class="cls_008">or website name. Please contact us at </span><span class="cls_010">copyright@packtpub.com</span><span class="cls_008"> with a link to the</span></div>
<div style="position:absolute;left:107.99px;top:518.97px" class="cls_008"><span class="cls_008">material.</span></div>
<div style="position:absolute;left:107.99px;top:540.22px" class="cls_009"><span class="cls_009">If you are interested in becoming an author</span><span class="cls_008">: If there is a topic that you have</span></div>
<div style="position:absolute;left:107.99px;top:552.82px" class="cls_008"><span class="cls_008">expertise in and you are interested in either writing or contributing to a book,</span></div>
<div style="position:absolute;left:107.99px;top:565.41px" class="cls_008"><span class="cls_008">please visit </span><A HREF="http://authors.packtpub.com">http://authors.packtpub.com</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:294.26px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> xiv </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:16040px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background022.jpg" width=612 height=792></div>
<div style="position:absolute;left:478.46px;top:94.56px" class="cls_019"><span class="cls_019">Preface</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Reviews</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Please leave a review. Once you have read and used this book, why not leave a</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">review on the site that you purchased it from? Potential readers can then see and use</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">your unbiased opinion to make purchase decisions, we at Packt can understand what</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">you think about our products, and our authors can see your feedback on their book.</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">Thank you!</span></div>
<div style="position:absolute;left:108.00px;top:207.08px" class="cls_008"><span class="cls_008">For more information about Packt, please visit </span><A HREF="packtpub.com">packtpub.com</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> xv </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:16842px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background023.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:16842px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background024.jpg" width=612 height=792></div>
<div style="position:absolute;left:168.81px;top:218.96px" class="cls_015"><span class="cls_015">What Are Containers and</span></div>
<div style="position:absolute;left:162.72px;top:254.96px" class="cls_015"><span class="cls_015">Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:308.66px" class="cls_008"><span class="cls_008">This first chapter of this book will introduce you to the world of containers and</span></div>
<div style="position:absolute;left:108.00px;top:321.26px" class="cls_008"><span class="cls_008">their orchestration. This book assumes you have no prior knowledge in the area</span></div>
<div style="position:absolute;left:108.00px;top:333.86px" class="cls_008"><span class="cls_008">of containers, and will give you a very practical introduction into the topic.</span></div>
<div style="position:absolute;left:108.00px;top:355.10px" class="cls_008"><span class="cls_008">In this chapter, we are focusing on the software supply chain and the friction within</span></div>
<div style="position:absolute;left:108.00px;top:367.70px" class="cls_008"><span class="cls_008">it. We then present containers as a means to reduce this friction and add enterprise-</span></div>
<div style="position:absolute;left:108.00px;top:380.30px" class="cls_008"><span class="cls_008">grade security on top of it. In this chapter, we also look into how containers and</span></div>
<div style="position:absolute;left:108.00px;top:392.90px" class="cls_008"><span class="cls_008">the ecosystem around them are assembled. We specifically point out the distinction</span></div>
<div style="position:absolute;left:108.00px;top:405.50px" class="cls_008"><span class="cls_008">between the upstream </span><span class="cls_009">Operations Support System</span><span class="cls_008"> (</span><span class="cls_009">OSS</span><span class="cls_008">) components, united under</span></div>
<div style="position:absolute;left:108.00px;top:418.10px" class="cls_008"><span class="cls_008">the code name Moby, that form the building blocks of the downstream products of</span></div>
<div style="position:absolute;left:108.00px;top:430.70px" class="cls_008"><span class="cls_008">Docker and other vendors.</span></div>
<div style="position:absolute;left:108.00px;top:451.94px" class="cls_008"><span class="cls_008">The chapter covers the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:473.19px" class="cls_008"><span class="cls_008">•  What are containers?</span></div>
<div style="position:absolute;left:126.00px;top:490.10px" class="cls_008"><span class="cls_008">•  Why are containers important?</span></div>
<div style="position:absolute;left:126.00px;top:507.02px" class="cls_008"><span class="cls_008">•  What's the benefit for me or for my company?</span></div>
<div style="position:absolute;left:126.00px;top:523.93px" class="cls_008"><span class="cls_008">•  The Moby project</span></div>
<div style="position:absolute;left:126.00px;top:540.85px" class="cls_008"><span class="cls_008">•  Docker products</span></div>
<div style="position:absolute;left:126.00px;top:557.76px" class="cls_008"><span class="cls_008">•  The container ecosystem</span></div>
<div style="position:absolute;left:126.00px;top:574.68px" class="cls_008"><span class="cls_008">•  Container architecture</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 1 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:17644px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background025.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After completing this module, you will be able to:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  Explain in a few simple sentences to an interested layman what containers</span></div>
<div style="position:absolute;left:143.99px;top:148.34px" class="cls_008"><span class="cls_008">are, using an analogy such as physical containers</span></div>
<div style="position:absolute;left:126.00px;top:165.25px" class="cls_008"><span class="cls_008">•  Justify to an interested layman why containers are so important, using an</span></div>
<div style="position:absolute;left:143.99px;top:177.85px" class="cls_008"><span class="cls_008">analogy such as physical containers versus traditional shipping, or apartment</span></div>
<div style="position:absolute;left:143.99px;top:190.45px" class="cls_008"><span class="cls_008">homes versus single family homes, and so on</span></div>
<div style="position:absolute;left:126.00px;top:207.37px" class="cls_008"><span class="cls_008">•  Name at least four upstream open source components that are used by the</span></div>
<div style="position:absolute;left:143.99px;top:219.97px" class="cls_008"><span class="cls_008">Docker products, such as Docker for Mac/Windows</span></div>
<div style="position:absolute;left:126.00px;top:236.88px" class="cls_008"><span class="cls_008">•  Identify at least three Docker products</span></div>
<div style="position:absolute;left:108.00px;top:269.39px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:294.37px" class="cls_008"><span class="cls_008">This chapter is a theoretical introduction into the topic. Therefore, there are no</span></div>
<div style="position:absolute;left:108.00px;top:306.97px" class="cls_008"><span class="cls_008">special technical requirements for this chapter.</span></div>
<div style="position:absolute;left:108.00px;top:339.47px" class="cls_011"><span class="cls_011">What are containers?</span></div>
<div style="position:absolute;left:108.00px;top:364.45px" class="cls_008"><span class="cls_008">A software container is a pretty abstract thing and thus it might help if we start</span></div>
<div style="position:absolute;left:108.00px;top:377.05px" class="cls_008"><span class="cls_008">with an analogy that should be pretty familiar to most of the readers. The analogy</span></div>
<div style="position:absolute;left:108.00px;top:389.65px" class="cls_008"><span class="cls_008">is a shipping container in the transportation industry.</span></div>
<div style="position:absolute;left:108.00px;top:410.90px" class="cls_008"><span class="cls_008">We transport huge amounts of goods on trains, ships, and trucks. We unload them</span></div>
<div style="position:absolute;left:108.00px;top:423.50px" class="cls_008"><span class="cls_008">at target locations, which may be another means of transportation. Goods are</span></div>
<div style="position:absolute;left:108.00px;top:436.10px" class="cls_008"><span class="cls_008">often diverse and complex to handle. Before the invention of shipping containers,</span></div>
<div style="position:absolute;left:108.00px;top:448.70px" class="cls_008"><span class="cls_008">this unloading from one means of transportation and loading onto another was a</span></div>
<div style="position:absolute;left:108.00px;top:461.30px" class="cls_008"><span class="cls_008">really complex and tedious process. Take, for example, a farmer bringing a cart full</span></div>
<div style="position:absolute;left:108.00px;top:473.90px" class="cls_008"><span class="cls_008">of apples to a central train station where the apples are then loaded onto a train,</span></div>
<div style="position:absolute;left:108.00px;top:486.50px" class="cls_008"><span class="cls_008">together with all the apples from many other farmers. Or think of a winemaker</span></div>
<div style="position:absolute;left:108.00px;top:499.10px" class="cls_008"><span class="cls_008">bringing his barrels of wine with a truck to the port where they are unloaded, and</span></div>
<div style="position:absolute;left:108.00px;top:511.70px" class="cls_008"><span class="cls_008">then transferred to a ship that will transport the barrels overseas. Every type of good</span></div>
<div style="position:absolute;left:108.00px;top:524.30px" class="cls_008"><span class="cls_008">was packaged in its own way and thus had to be handled in its own way. Any loose</span></div>
<div style="position:absolute;left:108.00px;top:536.90px" class="cls_008"><span class="cls_008">goods risked being stolen or damaged in the process. Then, there came the container,</span></div>
<div style="position:absolute;left:108.00px;top:549.50px" class="cls_008"><span class="cls_008">and it totally revolutionized the transportation industry.</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 2 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:18446px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background026.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The container is just a metallic box with standardized dimensions. The length, width,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">and height of each container is the same. This is a very important point. Without the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">world agreeing on a standard size, shipping containers would not have become so</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">successful. Nowadays, companies who want to have their goods transported from</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">A to B package those goods into these standardized containers. Then, they call a</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">shipper which comes with a standardized means for transportation. This can be a</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">truck designed to load a container or a train whose wagons can each transport one or</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">several containers. Finally, we have ships that are specialized in transporting huge</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">amounts of containers. The shippers never need to unpack and repackage goods. For</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_008"><span class="cls_008">a shipper, a container is a just a black box; they are not interested in what is in it nor</span></div>
<div style="position:absolute;left:108.00px;top:240.49px" class="cls_008"><span class="cls_008">should they care in most cases. It is just a big iron box with standard dimensions. The</span></div>
<div style="position:absolute;left:108.00px;top:253.09px" class="cls_008"><span class="cls_008">packaging of goods into containers is now fully delegated to the parties that want to</span></div>
<div style="position:absolute;left:108.00px;top:265.69px" class="cls_008"><span class="cls_008">have their goods shipped, and they should know best how to handle and package</span></div>
<div style="position:absolute;left:108.00px;top:278.29px" class="cls_008"><span class="cls_008">those goods. Since all containers have the same standardized shape and dimensions,</span></div>
<div style="position:absolute;left:108.00px;top:290.89px" class="cls_008"><span class="cls_008">the shippers can use standardized tools to handle containers, that is, cranes that</span></div>
<div style="position:absolute;left:108.00px;top:303.49px" class="cls_008"><span class="cls_008">unload containers, say from a train or a truck, and load them onto a ship or vice</span></div>
<div style="position:absolute;left:108.00px;top:316.09px" class="cls_008"><span class="cls_008">versa. One type of crane is enough to handle all the containers that come along over</span></div>
<div style="position:absolute;left:108.00px;top:328.69px" class="cls_008"><span class="cls_008">time. Also, the means of transportation can be standardized, such as container ships,</span></div>
<div style="position:absolute;left:108.00px;top:341.29px" class="cls_008"><span class="cls_008">trucks, and trains. Because of all this standardization, all the processes in and around</span></div>
<div style="position:absolute;left:108.00px;top:353.89px" class="cls_008"><span class="cls_008">shipping goods could be standardized, and thus made much more efficient than they</span></div>
<div style="position:absolute;left:108.00px;top:366.49px" class="cls_008"><span class="cls_008">were before the age of containers.</span></div>
<div style="position:absolute;left:108.00px;top:387.74px" class="cls_008"><span class="cls_008">I think by now you should have a good understanding of why shipping containers</span></div>
<div style="position:absolute;left:108.00px;top:400.34px" class="cls_008"><span class="cls_008">are so important and why they revolutionized the whole transportation industry. I</span></div>
<div style="position:absolute;left:108.00px;top:412.94px" class="cls_008"><span class="cls_008">chose this analogy because the software containers that we are going to look at here</span></div>
<div style="position:absolute;left:108.00px;top:425.54px" class="cls_008"><span class="cls_008">fulfill the exact same role in the software supply chain as shipping containers do in</span></div>
<div style="position:absolute;left:108.00px;top:438.14px" class="cls_008"><span class="cls_008">the supply chain of physical goods.</span></div>
<div style="position:absolute;left:108.00px;top:459.38px" class="cls_008"><span class="cls_008">Let's discuss what developers used to do when they developed a new application.</span></div>
<div style="position:absolute;left:108.00px;top:471.98px" class="cls_008"><span class="cls_008">Once an application was completed in the eyes of the developers, they would hand</span></div>
<div style="position:absolute;left:108.00px;top:484.58px" class="cls_008"><span class="cls_008">this application over to the operations engineers that were then supposed to install</span></div>
<div style="position:absolute;left:108.00px;top:497.18px" class="cls_008"><span class="cls_008">it on the production servers and get it running. If the operations engineers were</span></div>
<div style="position:absolute;left:108.00px;top:509.78px" class="cls_008"><span class="cls_008">lucky, they even got an accurate document with installation instructions from the</span></div>
<div style="position:absolute;left:108.00px;top:522.38px" class="cls_008"><span class="cls_008">developers. So far so good, and life was easy. But things got a bit out of hand when</span></div>
<div style="position:absolute;left:108.00px;top:534.98px" class="cls_008"><span class="cls_008">there were many teams of developers in an enterprise that created quite different</span></div>
<div style="position:absolute;left:108.00px;top:547.58px" class="cls_008"><span class="cls_008">types of applications, yet all needed to be installed on the same production servers</span></div>
<div style="position:absolute;left:108.00px;top:560.18px" class="cls_008"><span class="cls_008">and kept running there. Usually, each application has some external dependencies</span></div>
<div style="position:absolute;left:108.00px;top:572.78px" class="cls_008"><span class="cls_008">such as which framework it was built on or what libraries it uses and so on.</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 3 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:19248px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background027.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Sometimes, two applications would use the same framework but in different</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">versions that might or might not be compatible between each other. Our operations</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">engineer's life became much harder over time. They had to be really creative with</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">how they could load their servers, or their 'ship', with different applications without</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">breaking something. Installing a new version of a certain application was a complex</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">project on its own and often needed months of planning and testing. In other words,</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">there was a lot of friction in the software supply chain. But these days, companies</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">rely more and more on software and the release cycles become shorter and</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">shorter. We cannot afford anymore to just have a new release maybe twice a year.</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_008"><span class="cls_008">Applications need to be updated in a matter of weeks or days, or sometimes even</span></div>
<div style="position:absolute;left:108.00px;top:240.49px" class="cls_008"><span class="cls_008">multiple times per day. Companies that do not comply risk going out of business</span></div>
<div style="position:absolute;left:108.00px;top:253.09px" class="cls_008"><span class="cls_008">due to the lack of agility. So, </span><span class="cls_021">what's the solution?</span></div>
<div style="position:absolute;left:108.00px;top:274.34px" class="cls_008"><span class="cls_008">A first approach was to use </span><span class="cls_009">virtual machines</span><span class="cls_008"> (</span><span class="cls_009">VMs</span><span class="cls_008">). Instead of running multiple</span></div>
<div style="position:absolute;left:108.00px;top:286.94px" class="cls_008"><span class="cls_008">applications all on the same server, companies would package and run a single</span></div>
<div style="position:absolute;left:108.00px;top:299.54px" class="cls_008"><span class="cls_008">application per VM. With it, the compatibility problems were gone and life seemed</span></div>
<div style="position:absolute;left:108.00px;top:312.14px" class="cls_008"><span class="cls_008">good again. Unfortunately, the happiness didn't last for long. VMs are pretty heavy</span></div>
<div style="position:absolute;left:108.00px;top:324.74px" class="cls_008"><span class="cls_008">beasts on their own since they all contain a full-blown OS such as Linux or Windows</span></div>
<div style="position:absolute;left:108.00px;top:337.34px" class="cls_008"><span class="cls_008">Server and all that for just a single application. This is as if in the transportation</span></div>
<div style="position:absolute;left:108.00px;top:349.94px" class="cls_008"><span class="cls_008">industry you would use a gigantic ship just to transport a truck load of bananas.</span></div>
<div style="position:absolute;left:108.00px;top:362.54px" class="cls_008"><span class="cls_008">What a waste. That can never be profitable. The ultimate solution to the problem</span></div>
<div style="position:absolute;left:108.00px;top:375.14px" class="cls_008"><span class="cls_008">was to provide something much more lightweight than VMs but also able to</span></div>
<div style="position:absolute;left:108.00px;top:387.74px" class="cls_008"><span class="cls_008">perfectly encapsulate the goods it needed to transport. Here, the goods are the actual</span></div>
<div style="position:absolute;left:108.00px;top:400.34px" class="cls_008"><span class="cls_008">application written by our developers plus (and this is important) all the external</span></div>
<div style="position:absolute;left:108.00px;top:412.94px" class="cls_008"><span class="cls_008">dependencies of the application, such as framework, libraries, configurations, and</span></div>
<div style="position:absolute;left:108.00px;top:425.54px" class="cls_008"><span class="cls_008">more. This holy grail of a software packaging mechanism was the Docker container.</span></div>
<div style="position:absolute;left:108.00px;top:446.78px" class="cls_008"><span class="cls_008">Developers use Docker containers to package their applications, frameworks, and</span></div>
<div style="position:absolute;left:108.00px;top:459.38px" class="cls_008"><span class="cls_008">libraries, and then they ship those containers to the testers or to the operations</span></div>
<div style="position:absolute;left:108.00px;top:471.98px" class="cls_008"><span class="cls_008">engineers. For the testers and operations engineers, the container is just a black box.</span></div>
<div style="position:absolute;left:108.00px;top:484.58px" class="cls_008"><span class="cls_008">Crucially, it is a standardized black box. All containers, no matter what application</span></div>
<div style="position:absolute;left:108.00px;top:497.18px" class="cls_008"><span class="cls_008">runs inside them, can be treated equally. The engineers know that if any container</span></div>
<div style="position:absolute;left:108.00px;top:509.78px" class="cls_008"><span class="cls_008">runs on their servers, then any other containers should run too. And this is actually</span></div>
<div style="position:absolute;left:108.00px;top:522.38px" class="cls_008"><span class="cls_008">true, apart from some edge cases which always exist. Thus, Docker containers are</span></div>
<div style="position:absolute;left:108.00px;top:534.98px" class="cls_008"><span class="cls_008">a means to package applications and their dependencies in a standardized way.</span></div>
<div style="position:absolute;left:108.00px;top:547.58px" class="cls_008"><span class="cls_008">Docker then coined the phrase—Build, ship and run anywhere.</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 4 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:20050px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background028.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Why are containers important?</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">These days, the time between new releases of an application becomes shorter and</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">shorter, yet the software itself doesn't become any simpler. On the contrary, software</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">projects increase in complexity. Thus, we need a way to tame the beast and simplify</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">the software supply chain.</span></div>
<div style="position:absolute;left:108.00px;top:204.64px" class="cls_022"><span class="cls_022">Improving security</span></div>
<div style="position:absolute;left:108.00px;top:227.62px" class="cls_008"><span class="cls_008">We also hear every day how much more cyber crimes are on the rise. Many well-</span></div>
<div style="position:absolute;left:108.00px;top:240.22px" class="cls_008"><span class="cls_008">known companies are affected by security breaches. Highly sensitive customer data</span></div>
<div style="position:absolute;left:108.00px;top:252.82px" class="cls_008"><span class="cls_008">gets stolen, such as social security numbers, credit card information, and more. But</span></div>
<div style="position:absolute;left:108.00px;top:265.42px" class="cls_008"><span class="cls_008">not only customer data is compromised, sensitive company secrets are also stolen.</span></div>
<div style="position:absolute;left:108.00px;top:286.66px" class="cls_008"><span class="cls_008">Containers can help in many ways. First of all, Gartner has found in a recent report</span></div>
<div style="position:absolute;left:108.00px;top:299.26px" class="cls_008"><span class="cls_008">that applications running in a container are more secure than their counterparts</span></div>
<div style="position:absolute;left:108.00px;top:311.86px" class="cls_008"><span class="cls_008">not running in a container. Containers use Linux security primitives such as Linux</span></div>
<div style="position:absolute;left:108.00px;top:324.46px" class="cls_008"><span class="cls_008">kernel namespaces to sandbox different applications running on the same computers</span></div>
<div style="position:absolute;left:108.00px;top:337.06px" class="cls_008"><span class="cls_008">and </span><span class="cls_009">control groups</span><span class="cls_008"> (</span><span class="cls_009">cgroups</span><span class="cls_008">), to avoid the noisy neighbor problem where one</span></div>
<div style="position:absolute;left:108.00px;top:349.66px" class="cls_008"><span class="cls_008">bad application is using all available resources of a server and starving all other</span></div>
<div style="position:absolute;left:108.00px;top:362.26px" class="cls_008"><span class="cls_008">applications.</span></div>
<div style="position:absolute;left:108.00px;top:383.50px" class="cls_008"><span class="cls_008">Due to the fact that container images are immutable, it is easy to have them scanned</span></div>
<div style="position:absolute;left:108.00px;top:396.10px" class="cls_008"><span class="cls_008">for known vulnerabilities and exposures, and in doing so, increase the overall</span></div>
<div style="position:absolute;left:108.00px;top:408.70px" class="cls_008"><span class="cls_008">security of our applications.</span></div>
<div style="position:absolute;left:108.00px;top:429.95px" class="cls_008"><span class="cls_008">Another way we can make our software supply chain more secure when using</span></div>
<div style="position:absolute;left:108.00px;top:442.55px" class="cls_008"><span class="cls_008">containers is to use </span><span class="cls_009">content trust</span><span class="cls_008">. Content trust basically ensures that the author of</span></div>
<div style="position:absolute;left:108.00px;top:455.14px" class="cls_008"><span class="cls_008">a container image is who they pretend to be and that the consumer of the container</span></div>
<div style="position:absolute;left:108.00px;top:467.74px" class="cls_008"><span class="cls_008">image has a guarantee that the image has not been tampered with in transit. The</span></div>
<div style="position:absolute;left:108.00px;top:480.35px" class="cls_008"><span class="cls_008">latter is known as a </span><span class="cls_009">man-in-the-middle</span><span class="cls_008"> (</span><span class="cls_009">MITM</span><span class="cls_008">) attack.</span></div>
<div style="position:absolute;left:108.00px;top:501.59px" class="cls_008"><span class="cls_008">All that I have just said is of course technically also possible without using</span></div>
<div style="position:absolute;left:108.00px;top:514.19px" class="cls_008"><span class="cls_008">containers, but since containers introduce a globally accepted standard, it makes it so</span></div>
<div style="position:absolute;left:108.00px;top:526.79px" class="cls_008"><span class="cls_008">much easier to implement those best practices and enforce them.</span></div>
<div style="position:absolute;left:108.00px;top:548.03px" class="cls_008"><span class="cls_008">OK, but security is not the only reason why containers are important. There are other</span></div>
<div style="position:absolute;left:108.00px;top:560.63px" class="cls_008"><span class="cls_008">reasons as explained in the next two sections.</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 5 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:20852px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background029.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Simulating production-like environments</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">One of them is the fact that containers make it easy to simulate a production-like</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">environment, even on a developer's laptop. If we can containerize any application,</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">then we can also containerize, say, a database such as Oracle or MS SQL Server.</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Now, everyone who has ever had to install an Oracle database on a computer</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">knows that this is not the easiest thing to do and it takes a lot of space away on your</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">computer. You wouldn't want to do that to your development laptop just to test</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">whether the application you developed really works end to end. With containers at</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">hand, I can run a full-blown relational database in a container as easily as saying 1,</span></div>
<div style="position:absolute;left:108.00px;top:236.24px" class="cls_008"><span class="cls_008">2, 3. And when I'm done with testing, I can just stop and delete the container and the</span></div>
<div style="position:absolute;left:108.00px;top:248.84px" class="cls_008"><span class="cls_008">database is gone without leaving a trace on my computer.</span></div>
<div style="position:absolute;left:108.00px;top:270.09px" class="cls_008"><span class="cls_008">Since containers are very lean compared to VMs, it is not uncommon to have many</span></div>
<div style="position:absolute;left:108.00px;top:282.69px" class="cls_008"><span class="cls_008">containers running at the same time on a developer's laptop without overwhelming</span></div>
<div style="position:absolute;left:108.00px;top:295.29px" class="cls_008"><span class="cls_008">the laptop.</span></div>
<div style="position:absolute;left:108.00px;top:325.22px" class="cls_022"><span class="cls_022">Standardizing infrastructure</span></div>
<div style="position:absolute;left:108.00px;top:348.20px" class="cls_008"><span class="cls_008">A third reason why containers are important is that operators can finally concentrate</span></div>
<div style="position:absolute;left:108.00px;top:360.80px" class="cls_008"><span class="cls_008">on what they are really good at, provisioning infrastructure, and running and</span></div>
<div style="position:absolute;left:108.00px;top:373.40px" class="cls_008"><span class="cls_008">monitoring applications in production. When the applications they have to run on a</span></div>
<div style="position:absolute;left:108.00px;top:386.00px" class="cls_008"><span class="cls_008">production system are all containerized, then operators can start to standardize their</span></div>
<div style="position:absolute;left:108.00px;top:398.60px" class="cls_008"><span class="cls_008">infrastructure. Every server becomes just another Docker host. No special libraries of</span></div>
<div style="position:absolute;left:108.00px;top:411.20px" class="cls_008"><span class="cls_008">frameworks need to be installed on those servers, just an OS and a container runtime</span></div>
<div style="position:absolute;left:108.00px;top:423.80px" class="cls_008"><span class="cls_008">such as Docker.</span></div>
<div style="position:absolute;left:108.00px;top:445.05px" class="cls_008"><span class="cls_008">Also, the operators do not have to have any intimate knowledge about the internals</span></div>
<div style="position:absolute;left:108.00px;top:457.65px" class="cls_008"><span class="cls_008">of the applications anymore since those applications run self-contained in containers</span></div>
<div style="position:absolute;left:108.00px;top:470.25px" class="cls_008"><span class="cls_008">that ought to look like black boxes to the operations engineers, similar to how the</span></div>
<div style="position:absolute;left:108.00px;top:482.85px" class="cls_008"><span class="cls_008">shipping containers look to the personnel in the transportation industry.</span></div>
<div style="position:absolute;left:108.00px;top:515.34px" class="cls_011"><span class="cls_011">What's the benefit for me or for my</span></div>
<div style="position:absolute;left:108.00px;top:539.34px" class="cls_011"><span class="cls_011">company?</span></div>
<div style="position:absolute;left:108.00px;top:564.32px" class="cls_008"><span class="cls_008">Somebody once said that today, every company of a certain size has to acknowledge</span></div>
<div style="position:absolute;left:108.00px;top:576.92px" class="cls_008"><span class="cls_008">that they need to be a software company. Software runs all businesses, period. As</span></div>
<div style="position:absolute;left:108.00px;top:589.52px" class="cls_008"><span class="cls_008">every company becomes a software company, there is a need to establish a software</span></div>
<div style="position:absolute;left:108.00px;top:602.12px" class="cls_008"><span class="cls_008">supply chain. For the company to remain competitive, their software supply</span></div>
<div style="position:absolute;left:108.00px;top:614.72px" class="cls_008"><span class="cls_008">chain has to be secure and efficient. Efficiency can be achieved through thorough</span></div>
<div style="position:absolute;left:108.00px;top:627.32px" class="cls_008"><span class="cls_008">automation and standardization. But in all three areas, security, automation, and</span></div>
<div style="position:absolute;left:108.00px;top:639.92px" class="cls_008"><span class="cls_008">standardization, containers have proven their superiority.</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 6 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:21654px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background030.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Large and well-known enterprises have reported that when containerizing existing</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">legacy applications (many call them traditional applications) and establishing a fully</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">automated software supply chain based on containers, they can reduce the cost used</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">for maintenance of those mission-critical applications by a factor of 50 to 60% and</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">they can reduce the time between new releases of these traditional applications by</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">up to 90%.</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">That said, the adoption of container technology saves these companies a lot of</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">money, and at the same time it speeds up the development process and reduces</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">the time to market.</span></div>
<div style="position:absolute;left:108.00px;top:256.43px" class="cls_011"><span class="cls_011">The Moby project</span></div>
<div style="position:absolute;left:108.00px;top:281.41px" class="cls_008"><span class="cls_008">Originally, when the company Docker introduced Docker containers, everything</span></div>
<div style="position:absolute;left:108.00px;top:294.01px" class="cls_008"><span class="cls_008">was open source. Docker didn't have any commercial products at this time. The</span></div>
<div style="position:absolute;left:108.00px;top:306.61px" class="cls_008"><span class="cls_008">Docker engine which the company developed was a monolithic piece of software.</span></div>
<div style="position:absolute;left:108.00px;top:319.21px" class="cls_008"><span class="cls_008">It contained many logical parts, such as the container runtime, a network library,</span></div>
<div style="position:absolute;left:108.00px;top:331.81px" class="cls_008"><span class="cls_008">a RESTful API, a command-line interface, and much more.</span></div>
<div style="position:absolute;left:108.00px;top:353.06px" class="cls_008"><span class="cls_008">Other vendors or projects such as Red Hat or Kubernetes were using the Docker</span></div>
<div style="position:absolute;left:108.00px;top:365.66px" class="cls_008"><span class="cls_008">engine in their own products, but most of the time they were only using part of its</span></div>
<div style="position:absolute;left:108.00px;top:378.26px" class="cls_008"><span class="cls_008">functionality. For example, Kubernetes did not use the Docker network library of</span></div>
<div style="position:absolute;left:108.00px;top:390.86px" class="cls_008"><span class="cls_008">the Docker engine but provided its own way of networking. Red Hat in turn did not</span></div>
<div style="position:absolute;left:108.00px;top:403.46px" class="cls_008"><span class="cls_008">update the Docker engine frequently and preferred to apply unofficial patches to</span></div>
<div style="position:absolute;left:108.00px;top:416.06px" class="cls_008"><span class="cls_008">older versions of the Docker engine, yet they still called it the </span><span class="cls_009">Docker engine</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:437.30px" class="cls_008"><span class="cls_008">Out of all these reasons and many more, the idea emerged that Docker had to</span></div>
<div style="position:absolute;left:108.00px;top:449.90px" class="cls_008"><span class="cls_008">do something to clearly separate the Docker open source part from the Docker</span></div>
<div style="position:absolute;left:108.00px;top:462.50px" class="cls_008"><span class="cls_008">commercial part. Furthermore, the company wanted to prevent competitors from</span></div>
<div style="position:absolute;left:108.00px;top:475.10px" class="cls_008"><span class="cls_008">using and abusing the name Docker for their own gains. This was the main reason</span></div>
<div style="position:absolute;left:108.00px;top:487.70px" class="cls_008"><span class="cls_008">why the Moby project was born. It serves as the umbrella for most of the open source</span></div>
<div style="position:absolute;left:108.00px;top:500.30px" class="cls_008"><span class="cls_008">components Docker developed and continues to develop. These open source projects</span></div>
<div style="position:absolute;left:108.00px;top:512.90px" class="cls_008"><span class="cls_008">do not carry the name Docker in them anymore.</span></div>
<div style="position:absolute;left:108.00px;top:534.14px" class="cls_008"><span class="cls_008">The Moby project encompasses components for image management, secret</span></div>
<div style="position:absolute;left:108.00px;top:546.74px" class="cls_008"><span class="cls_008">management, configuration management, and networking and provisioning,</span></div>
<div style="position:absolute;left:108.00px;top:559.34px" class="cls_008"><span class="cls_008">to name just a few. Also, part of the Moby project are special Moby tools that are,</span></div>
<div style="position:absolute;left:108.00px;top:571.94px" class="cls_008"><span class="cls_008">for example, used to assemble components into runnable artifacts.</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 7 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:22456px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background031.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Some of the components that technically would belong to the Moby project have</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">been donated by Docker to the </span><span class="cls_009">Cloud Native Computing Foundation</span><span class="cls_008"> (</span><span class="cls_009">CNCF</span><span class="cls_008">) and</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">thus do not appear in the list of components anymore. The most prominent ones are</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_010"><span class="cls_010">containerd</span><span class="cls_008"> and </span><span class="cls_010">runc</span><span class="cls_008"> which together form the container runtime.</span></div>
<div style="position:absolute;left:108.00px;top:184.79px" class="cls_011"><span class="cls_011">Docker products</span></div>
<div style="position:absolute;left:108.00px;top:209.77px" class="cls_008"><span class="cls_008">Docker currently separates its product lines into two segments. There is the</span></div>
<div style="position:absolute;left:108.00px;top:222.37px" class="cls_009"><span class="cls_009">Community Edition</span><span class="cls_008"> (</span><span class="cls_009">CE</span><span class="cls_008">) which is closed source yet completely free, and then there</span></div>
<div style="position:absolute;left:108.00px;top:234.97px" class="cls_008"><span class="cls_008">is the </span><span class="cls_009">Enterprise Edition</span><span class="cls_008"> (</span><span class="cls_009">EE</span><span class="cls_008">) which is also a closed source and needs to be licensed</span></div>
<div style="position:absolute;left:107.99px;top:247.57px" class="cls_008"><span class="cls_008">on a yearly basis. The enterprise products are backed by 24 x 7 support and are</span></div>
<div style="position:absolute;left:107.99px;top:260.17px" class="cls_008"><span class="cls_008">supported with bug fixes much longer than their CE counterparts.</span></div>
<div style="position:absolute;left:108.00px;top:290.11px" class="cls_022"><span class="cls_022">Docker CE</span></div>
<div style="position:absolute;left:108.00px;top:313.09px" class="cls_008"><span class="cls_008">The Docker community edition includes products such as the Docker Toolbox,</span></div>
<div style="position:absolute;left:108.00px;top:325.69px" class="cls_008"><span class="cls_008">Docker for Mac, and Docker for Windows. All these three products are mainly</span></div>
<div style="position:absolute;left:108.00px;top:338.29px" class="cls_008"><span class="cls_008">targeting developers.</span></div>
<div style="position:absolute;left:108.00px;top:359.54px" class="cls_008"><span class="cls_008">Docker for Mac and Docker for Windows are easy-to-install desktop applications</span></div>
<div style="position:absolute;left:108.00px;top:372.14px" class="cls_008"><span class="cls_008">that can be used to build, debug, and test Dockerized applications or services on</span></div>
<div style="position:absolute;left:108.00px;top:384.74px" class="cls_008"><span class="cls_008">a Mac or on Windows. Docker for Mac and Docker for Windows are complete</span></div>
<div style="position:absolute;left:108.00px;top:397.34px" class="cls_008"><span class="cls_008">development environments which deeply integrated with their respective hypervisor</span></div>
<div style="position:absolute;left:108.00px;top:409.94px" class="cls_008"><span class="cls_008">framework, networking, and filesystem. These tools are the fastest and most reliable</span></div>
<div style="position:absolute;left:108.00px;top:422.54px" class="cls_008"><span class="cls_008">way to run Docker on a Mac or on Windows.</span></div>
<div style="position:absolute;left:108.00px;top:443.78px" class="cls_008"><span class="cls_008">Under the umbrella of the CE, there are also two products that are more geared</span></div>
<div style="position:absolute;left:108.00px;top:456.38px" class="cls_008"><span class="cls_008">towards operations engineers. Those products are Docker for Azure and Docker</span></div>
<div style="position:absolute;left:108.00px;top:468.98px" class="cls_008"><span class="cls_008">for AWS.</span></div>
<div style="position:absolute;left:108.00px;top:490.22px" class="cls_008"><span class="cls_008">For example, with Docker for Azure, which is a native Azure application, you can</span></div>
<div style="position:absolute;left:108.00px;top:502.82px" class="cls_008"><span class="cls_008">set up Docker in a few clicks, optimized for and integrated to the underlying Azure</span></div>
<div style="position:absolute;left:108.00px;top:515.42px" class="cls_009"><span class="cls_009">Infrastructure as a Service</span><span class="cls_008"> (</span><span class="cls_009">IaaS</span><span class="cls_008">) services. It helps operations engineers to accelerate</span></div>
<div style="position:absolute;left:108.00px;top:528.02px" class="cls_008"><span class="cls_008">the time it takes to build and run Docker applications in Azure.</span></div>
<div style="position:absolute;left:108.00px;top:549.26px" class="cls_008"><span class="cls_008">Docker for AWS works in a very similar way, but for Amazon's cloud.</span></div>
<div style="position:absolute;left:297.59px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 8 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:23258px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background032.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Docker EE</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">The Docker EE consists of the two products </span><span class="cls_009">Universal Control Plane</span><span class="cls_008"> (</span><span class="cls_009">UCP</span><span class="cls_008">) and</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_009"><span class="cls_009">Docker Trusted Registry</span><span class="cls_008"> (</span><span class="cls_009">DTR</span><span class="cls_008">) that both run on top of Docker Swarm. Both are</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">Swarm applications. Docker EE builds on top of the upstream components of the</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Moby project and adds enterprise-grade features such as </span><span class="cls_009">role-based access control</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">(</span><span class="cls_009">RBAC</span><span class="cls_008">), multi tenancy, mixed clusters of Docker Swarm and Kubernetes, web-based</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">UI, and content trust, as well as image scanning on top of it.</span></div>
<div style="position:absolute;left:108.00px;top:230.94px" class="cls_011"><span class="cls_011">The container ecosystem</span></div>
<div style="position:absolute;left:108.00px;top:255.92px" class="cls_008"><span class="cls_008">There has never been a new technology introduced in IT that has penetrated the</span></div>
<div style="position:absolute;left:108.00px;top:268.52px" class="cls_008"><span class="cls_008">landscape as quickly and thoroughly as containers. Any company that doesn't want</span></div>
<div style="position:absolute;left:108.00px;top:281.12px" class="cls_008"><span class="cls_008">to be left behind cannot ignore containers. This huge interest in containers from all</span></div>
<div style="position:absolute;left:108.00px;top:293.72px" class="cls_008"><span class="cls_008">sectors of the industry has triggered a lot of innovation in this sector. Numerous</span></div>
<div style="position:absolute;left:108.00px;top:306.32px" class="cls_008"><span class="cls_008">companies have specialized in containers and either provide products that build</span></div>
<div style="position:absolute;left:108.00px;top:318.92px" class="cls_008"><span class="cls_008">on top of this technology or build tools that support it.</span></div>
<div style="position:absolute;left:108.00px;top:340.17px" class="cls_008"><span class="cls_008">Initially, Docker didn't have a solution for container orchestration thus other</span></div>
<div style="position:absolute;left:108.00px;top:352.77px" class="cls_008"><span class="cls_008">companies or projects, open source or not, tried to close this gap. The most</span></div>
<div style="position:absolute;left:108.00px;top:365.37px" class="cls_008"><span class="cls_008">prominent one is Kubernetes which was initiated by Google and then later donated</span></div>
<div style="position:absolute;left:108.00px;top:377.97px" class="cls_008"><span class="cls_008">to the CNCF. Other container orchestration products are Apache Mesos, Rancher,</span></div>
<div style="position:absolute;left:108.00px;top:390.57px" class="cls_008"><span class="cls_008">Red Hat's Open Shift, Docker's own Swarm, and more.</span></div>
<div style="position:absolute;left:108.00px;top:411.81px" class="cls_008"><span class="cls_008">More recently, the trend goes towards a service mesh. This is the new buzz word. As</span></div>
<div style="position:absolute;left:108.00px;top:424.41px" class="cls_008"><span class="cls_008">we containerize more and more applications, and as we refactor those applications</span></div>
<div style="position:absolute;left:108.00px;top:437.01px" class="cls_008"><span class="cls_008">into more microservice-oriented applications, we run into problems that simple</span></div>
<div style="position:absolute;left:108.00px;top:449.61px" class="cls_008"><span class="cls_008">orchestration software cannot solve anymore in a reliable and scalable way. Topics</span></div>
<div style="position:absolute;left:108.00px;top:462.21px" class="cls_008"><span class="cls_008">in this area are service discovery, monitoring, tracing, and log aggregation. Many</span></div>
<div style="position:absolute;left:108.00px;top:474.81px" class="cls_008"><span class="cls_008">new projects have emerged in this area, the most popular one at this time being Istio,</span></div>
<div style="position:absolute;left:108.00px;top:487.41px" class="cls_008"><span class="cls_008">which is also part of the CNCF.</span></div>
<div style="position:absolute;left:108.00px;top:508.65px" class="cls_008"><span class="cls_008">Many say that the next step in the evolution of software is functions, or more</span></div>
<div style="position:absolute;left:108.00px;top:521.25px" class="cls_008"><span class="cls_008">precisely, </span><span class="cls_009">Functions as a Service</span><span class="cls_008"> (</span><span class="cls_009">FaaS</span><span class="cls_008">). Some projects exist that provide exactly</span></div>
<div style="position:absolute;left:108.00px;top:533.85px" class="cls_008"><span class="cls_008">this kind of service and are built on top of containers. One prominent example</span></div>
<div style="position:absolute;left:108.00px;top:546.45px" class="cls_008"><span class="cls_008">is OpenFaaS.</span></div>
<div style="position:absolute;left:298.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 9 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:24060px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background033.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We have only scratched the surface of the container ecosystem. All big IT companies</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">such as Google, Microsoft, Intel, Red Hat, IBM, and more are working feverishly on</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">containers and related technologies. The CNCF which is mainly about containers</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">and related technologies, has so many registered projects, that they do not all fit on a</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">poster anymore. It's an exciting time to work in this area. And in my humble opinion,</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">this is only the beginning.</span></div>
<div style="position:absolute;left:108.00px;top:209.99px" class="cls_011"><span class="cls_011">Container architecture</span></div>
<div style="position:absolute;left:108.00px;top:234.97px" class="cls_008"><span class="cls_008">Now, let's discuss on a high level how a system that can run Docker containers is</span></div>
<div style="position:absolute;left:108.00px;top:247.57px" class="cls_008"><span class="cls_008">designed. The following diagram illustrates what a computer on which Docker has</span></div>
<div style="position:absolute;left:108.00px;top:260.17px" class="cls_008"><span class="cls_008">been installed looks like. By the way, a computer which has Docker installed is often</span></div>
<div style="position:absolute;left:108.00px;top:272.77px" class="cls_008"><span class="cls_008">called a Docker host, because it can run or host Docker containers:</span></div>
<div style="position:absolute;left:211.49px;top:475.38px" class="cls_026"><span class="cls_026">High-level architecture diagram of the Docker engine</span></div>
<div style="position:absolute;left:108.00px;top:494.12px" class="cls_008"><span class="cls_008">In the preceding diagram, we see three essential parts:</span></div>
<div style="position:absolute;left:126.00px;top:515.36px" class="cls_008"><span class="cls_008">•  On the bottom, we have the Linux operating system</span></div>
<div style="position:absolute;left:126.00px;top:532.28px" class="cls_008"><span class="cls_008">•  In the middle dark gray, we have the container runtime</span></div>
<div style="position:absolute;left:126.00px;top:549.19px" class="cls_008"><span class="cls_008">•  On the top, we have the Docker engine</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 10 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:24862px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background034.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Containers are only possible due to the fact that the Linux OS provides some</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">primitives, such as namespaces, control groups, layer capabilities, and more which</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">are leveraged in a very specific way by the container runtime and the Docker engine.</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">Linux kernel namespaces such as </span><span class="cls_009">process ID</span><span class="cls_008"> (</span><span class="cls_009">pid</span><span class="cls_008">) namespaces or </span><span class="cls_009">network</span><span class="cls_008"> (</span><span class="cls_009">net</span><span class="cls_008">)</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">namespaces allow Docker to encapsulate or sandbox processes that run inside the</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">container. Control groups make sure that containers cannot suffer from the noisy</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">neighbor syndrome, where a single application running in a container can consume</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">most or all of the available resources of the whole Docker host. Control groups allow</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">Docker to limit the resources, such as CPU time or the amount of RAM that each</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_008"><span class="cls_008">container gets maximally allocated.</span></div>
<div style="position:absolute;left:108.00px;top:249.13px" class="cls_008"><span class="cls_008">The container runtime on a Docker host consists of </span><span class="cls_010">containerd</span><span class="cls_008"> and </span><span class="cls_010">runc</span><span class="cls_008">. </span><span class="cls_010">runc</span><span class="cls_008"> is</span></div>
<div style="position:absolute;left:108.00px;top:261.73px" class="cls_008"><span class="cls_008">the low-level functionality of the container runtime and </span><span class="cls_010">containerd</span><span class="cls_008">, which is based</span></div>
<div style="position:absolute;left:108.00px;top:274.33px" class="cls_008"><span class="cls_008">on </span><span class="cls_010">runc</span><span class="cls_008">, provides the higher-level functionality. Both are open source and have been</span></div>
<div style="position:absolute;left:108.00px;top:286.93px" class="cls_008"><span class="cls_008">donated by Docker to the CNCF.</span></div>
<div style="position:absolute;left:108.00px;top:308.18px" class="cls_008"><span class="cls_008">The container runtime is responsible for the whole life cycle of a container. It pulls</span></div>
<div style="position:absolute;left:108.00px;top:320.78px" class="cls_008"><span class="cls_008">a container image (which is the template for a container) from a registry if necessary,</span></div>
<div style="position:absolute;left:108.00px;top:333.38px" class="cls_008"><span class="cls_008">creates a container from that image, initializes and runs the container, and eventually</span></div>
<div style="position:absolute;left:108.00px;top:345.98px" class="cls_008"><span class="cls_008">stops and removes the container from the system when asked.</span></div>
<div style="position:absolute;left:108.00px;top:367.22px" class="cls_008"><span class="cls_008">The Docker engine provides additional functionality on top of the container runtime,</span></div>
<div style="position:absolute;left:108.00px;top:379.82px" class="cls_008"><span class="cls_008">such as network libraries or support for plugins. It also provides a REST interface</span></div>
<div style="position:absolute;left:108.00px;top:392.42px" class="cls_008"><span class="cls_008">over which all container operations can be automated. The Docker command-line</span></div>
<div style="position:absolute;left:108.00px;top:405.02px" class="cls_008"><span class="cls_008">interface that we will use frequently in this book is one of the consumers of this</span></div>
<div style="position:absolute;left:108.00px;top:417.62px" class="cls_008"><span class="cls_008">REST interface.</span></div>
<div style="position:absolute;left:108.00px;top:450.11px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:475.09px" class="cls_008"><span class="cls_008">In this chapter, we looked at how containers can massively reduce the friction in the</span></div>
<div style="position:absolute;left:108.00px;top:487.69px" class="cls_008"><span class="cls_008">software supply chain and on top of that, make the supply chain much more secure.</span></div>
<div style="position:absolute;left:108.00px;top:508.94px" class="cls_008"><span class="cls_008">In the upcoming chapter, we will familiarize ourselves with containers. We will</span></div>
<div style="position:absolute;left:108.00px;top:521.54px" class="cls_008"><span class="cls_008">learn how to run, stop, and remove containers and otherwise manipulate them.</span></div>
<div style="position:absolute;left:108.00px;top:534.14px" class="cls_008"><span class="cls_008">We will also have a pretty good overview over the anatomy of containers. For the</span></div>
<div style="position:absolute;left:108.00px;top:546.74px" class="cls_008"><span class="cls_008">first time, we're really going to get our hands dirty and play with these containers,</span></div>
<div style="position:absolute;left:108.00px;top:559.34px" class="cls_008"><span class="cls_008">so stay tuned.</span></div>
<div style="position:absolute;left:296.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 11 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:25664px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background035.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">What Are Containers and Why Should I Use Them?</span></div>
<div style="position:absolute;left:108.00px;top:112.17px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:137.15px" class="cls_008"><span class="cls_008">Please solve the following questions to assess your learning progress:</span></div>
<div style="position:absolute;left:126.00px;top:158.39px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:143.99px;top:158.39px" class="cls_008"><span class="cls_008">Which statements are correct (multiple answers are possible)?</span></div>
<div style="position:absolute;left:161.99px;top:175.30px" class="cls_008"><span class="cls_008">1.  A container is kind of a lightweight VM</span></div>
<div style="position:absolute;left:161.99px;top:192.22px" class="cls_008"><span class="cls_008">2.  A container only runs on a Linux host</span></div>
<div style="position:absolute;left:161.99px;top:209.14px" class="cls_008"><span class="cls_008">3.  A container can only run one process</span></div>
<div style="position:absolute;left:161.99px;top:226.05px" class="cls_008"><span class="cls_008">4.  The main process in a container always has PID 1</span></div>
<div style="position:absolute;left:161.99px;top:242.97px" class="cls_008"><span class="cls_008">5.  A container is one or more processes encapsulated by Linux</span></div>
<div style="position:absolute;left:179.99px;top:255.57px" class="cls_008"><span class="cls_008">namespaces and restricted by cgroups</span></div>
<div style="position:absolute;left:125.99px;top:272.48px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:143.98px;top:272.48px" class="cls_008"><span class="cls_008">Explain to an interested layman in your own words, maybe using analogies,</span></div>
<div style="position:absolute;left:143.98px;top:285.08px" class="cls_008"><span class="cls_008">what a container is.</span></div>
<div style="position:absolute;left:125.99px;top:302.00px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:143.98px;top:302.00px" class="cls_008"><span class="cls_008">Why are containers considered to be a game changer in IT? Name three to</span></div>
<div style="position:absolute;left:143.98px;top:314.60px" class="cls_008"><span class="cls_008">four reasons.</span></div>
<div style="position:absolute;left:125.99px;top:331.51px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:143.98px;top:331.51px" class="cls_008"><span class="cls_008">What does it mean when we claim: </span><span class="cls_021">If a container runs on a given platform then it</span></div>
<div style="position:absolute;left:143.98px;top:344.11px" class="cls_021"><span class="cls_021">runs anywhere...?</span><span class="cls_008"> Name two to three reasons why this is true.</span></div>
<div style="position:absolute;left:125.98px;top:361.03px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:143.97px;top:361.03px" class="cls_008"><span class="cls_008">True or False: </span><span class="cls_021">Docker containers are only really useful for modern greenfield</span></div>
<div style="position:absolute;left:143.97px;top:373.63px" class="cls_021"><span class="cls_021">applications based on microservices</span><span class="cls_008">. Please justify your answer.</span></div>
<div style="position:absolute;left:125.98px;top:390.54px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:143.97px;top:390.54px" class="cls_008"><span class="cls_008">How much does a typical enterprise save when containerizing their legacy</span></div>
<div style="position:absolute;left:143.97px;top:403.14px" class="cls_008"><span class="cls_008">applications?</span></div>
<div style="position:absolute;left:161.97px;top:420.06px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:179.97px;top:420.06px" class="cls_008"><span class="cls_008">20%</span></div>
<div style="position:absolute;left:161.97px;top:436.98px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:179.97px;top:436.98px" class="cls_008"><span class="cls_008">33%</span></div>
<div style="position:absolute;left:161.97px;top:453.89px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:179.97px;top:453.89px" class="cls_008"><span class="cls_008">50%</span></div>
<div style="position:absolute;left:161.97px;top:470.81px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:179.97px;top:470.81px" class="cls_008"><span class="cls_008">75%</span></div>
<div style="position:absolute;left:125.97px;top:492.05px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:143.96px;top:492.05px" class="cls_008"><span class="cls_008">Which two core concepts of Linux are containers based on?</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 12 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:26466px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background036.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 1</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Here is a list of links that lead to more detailed information regarding topics we have</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">discussed </span><A HREF="https://docs.docker.com/engine/docker-overview/">in this chapter:</A> </div>
<div style="position:absolute;left:126.00px;top:170.74px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Docker overview</span><span class="cls_008"> at </span><span class="cls_010">https://docs.docker.com/engine<A HREF="https://mobyproject.org/">/docker-overview/</A> </span></div>
<div style="position:absolute;left:126.00px;top:187.66px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  <A HREF="https://mobyproject.org/">The Mob</A><span class="cls_008"> at </span><span class="cls_010">https:/<A HREF="https://www.docker.com/get-docker">/mobyproject.org/</A> </span></div>
<div style="position:absolute;left:126.00px;top:204.58px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  <A HREF="https://www.docker.com/get-docker">Docker products</A><span class="cls_008"> at </span><A HREF="https://www.docker.com/get-docker">https://www.docker.com/get-docker</A> </span></div>
<div style="position:absolute;left:126.00px;top:221.50px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  <A HREF="https://www.cncf.io/">Cloud Native Computi</A><span class="cls_008">at </span><A HREF=" https://www.cncf.io/">https://www.cncf.io/</A> </span></div>
<div style="position:absolute;left:126.00px;top:238.42px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  containerd - in<A HREF="https://containerd.io/">dustry standard contai</A><span class="cls_008"> at </span><A HREF="https://containerd.io/">https://containerd.io/</A> </span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 13 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:27268px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background037.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:27268px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background038.jpg" width=612 height=792></div>
<div style="position:absolute;left:226.06px;top:218.82px" class="cls_015"><span class="cls_015">Setting up a Working</span></div>
<div style="position:absolute;left:335.59px;top:254.82px" class="cls_015"><span class="cls_015">Environment</span></div>
<div style="position:absolute;left:108.00px;top:308.52px" class="cls_008"><span class="cls_008">In the last chapter, we learned what Docker containers are and why they're</span></div>
<div style="position:absolute;left:108.00px;top:321.12px" class="cls_008"><span class="cls_008">important. We learned what kinds of problem containers solve in a modern software</span></div>
<div style="position:absolute;left:108.00px;top:333.72px" class="cls_008"><span class="cls_008">supply chain.</span></div>
<div style="position:absolute;left:108.00px;top:354.96px" class="cls_008"><span class="cls_008">In this chapter, we are going to prepare our personal or working environment to</span></div>
<div style="position:absolute;left:108.00px;top:367.56px" class="cls_008"><span class="cls_008">work efficiently and effectively with Docker. We will discuss in detail how to set up</span></div>
<div style="position:absolute;left:108.00px;top:380.16px" class="cls_008"><span class="cls_008">an ideal environment for developers, DevOps, and operators that can be used when</span></div>
<div style="position:absolute;left:108.00px;top:392.76px" class="cls_008"><span class="cls_008">working with Docker containers.</span></div>
<div style="position:absolute;left:108.00px;top:414.00px" class="cls_008"><span class="cls_008">This chapter covers the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:435.24px" class="cls_008"><span class="cls_008">•  The Linux command shell</span></div>
<div style="position:absolute;left:126.00px;top:452.16px" class="cls_008"><span class="cls_008">•  PowerShell for Windows</span></div>
<div style="position:absolute;left:126.00px;top:469.08px" class="cls_008"><span class="cls_008">•  Using a package manager</span></div>
<div style="position:absolute;left:126.00px;top:485.99px" class="cls_008"><span class="cls_008">•  Choosing a code editor</span></div>
<div style="position:absolute;left:126.00px;top:502.91px" class="cls_008"><span class="cls_008">•  Docker Toolbox</span></div>
<div style="position:absolute;left:126.00px;top:519.82px" class="cls_008"><span class="cls_008">•  Docker for macOS and Docker for Windows</span></div>
<div style="position:absolute;left:126.00px;top:536.74px" class="cls_008"><span class="cls_008">•  Minikube</span></div>
<div style="position:absolute;left:126.00px;top:553.65px" class="cls_008"><span class="cls_008">•  Cloning the Source Code Repository</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 15 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:28070px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background039.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After completing this chapter, you will be able to do the following:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  Use an editor on your laptop that is able to edit simple files such as a</span></div>
<div style="position:absolute;left:143.99px;top:148.33px" class="cls_008"><span class="cls_008">Dockerfile or a </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file</span></div>
<div style="position:absolute;left:126.00px;top:165.25px" class="cls_008"><span class="cls_008">•  Use a shell such as Bash on macOS and PowerShell on Windows to execute</span></div>
<div style="position:absolute;left:144.00px;top:177.85px" class="cls_008"><span class="cls_008">Docker commands and other simple operations, such as navigating the folder</span></div>
<div style="position:absolute;left:144.00px;top:190.45px" class="cls_008"><span class="cls_008">structure or creating a new folder</span></div>
<div style="position:absolute;left:126.00px;top:207.37px" class="cls_008"><span class="cls_008">•  Install Docker for macOS or Docker for Windows on your computer</span></div>
<div style="position:absolute;left:126.00px;top:224.28px" class="cls_008"><span class="cls_008">•  Execute simple Docker commands such as </span><span class="cls_010">docker version</span><span class="cls_008"> or </span><span class="cls_010">docker</span></div>
<div style="position:absolute;left:144.00px;top:236.89px" class="cls_010"><span class="cls_010">container run</span><span class="cls_008"> on your Docker for macOS or Docker for Windows</span></div>
<div style="position:absolute;left:126.00px;top:253.81px" class="cls_008"><span class="cls_008">•  Successfully install Docker Toolbox on your computer</span></div>
<div style="position:absolute;left:126.00px;top:270.73px" class="cls_008"><span class="cls_008">•  Use </span><span class="cls_010">docker-machine</span><span class="cls_008"> to create a Docker host on VirtualBox</span></div>
<div style="position:absolute;left:126.00px;top:287.65px" class="cls_008"><span class="cls_008">•  Configure your local Docker CLI to remote access a Docker host running</span></div>
<div style="position:absolute;left:144.00px;top:300.25px" class="cls_008"><span class="cls_008">in VirtualBox</span></div>
<div style="position:absolute;left:108.00px;top:332.75px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:357.73px" class="cls_008"><span class="cls_008">For this chapter, you will need either macOS or Windows, preferably Windows</span></div>
<div style="position:absolute;left:108.00px;top:370.33px" class="cls_008"><span class="cls_008">10 Professional, installed. You should also have free internet access to download</span></div>
<div style="position:absolute;left:108.00px;top:382.93px" class="cls_008"><span class="cls_008">applications and the permission to install those applications on your laptop.</span></div>
<div style="position:absolute;left:108.00px;top:415.43px" class="cls_011"><span class="cls_011">The Linux command shell</span></div>
<div style="position:absolute;left:108.00px;top:440.41px" class="cls_008"><span class="cls_008">Docker containers were first developed on Linux for Linux. It is thus natural that</span></div>
<div style="position:absolute;left:108.00px;top:453.01px" class="cls_008"><span class="cls_008">the primary command-line tool used to work with Docker, also called a shell, is a</span></div>
<div style="position:absolute;left:108.00px;top:465.61px" class="cls_008"><span class="cls_008">Unix shell; remember, Linux derives from Unix. Most developers use the Bash shell.</span></div>
<div style="position:absolute;left:108.00px;top:478.21px" class="cls_008"><span class="cls_008">On some lightweight Linux distributions, such as </span><span class="cls_009">Alpine</span><span class="cls_008">, Bash is not installed and</span></div>
<div style="position:absolute;left:108.00px;top:490.81px" class="cls_008"><span class="cls_008">consequently one has to use the simpler Bourne shell, just called </span><span class="cls_009">sh</span><span class="cls_008">. Whenever we</span></div>
<div style="position:absolute;left:108.00px;top:503.41px" class="cls_008"><span class="cls_008">are working in a Linux environment, such as inside a container or on a Linux VM,</span></div>
<div style="position:absolute;left:108.00px;top:516.01px" class="cls_008"><span class="cls_008">we will use either </span><span class="cls_010">/bin/bash</span><span class="cls_008"> or </span><span class="cls_010">/bin/sh</span><span class="cls_008">, depending on their availability.</span></div>
<div style="position:absolute;left:108.00px;top:537.26px" class="cls_008"><span class="cls_008">Although macOS X is not a Linux OS, Linux and OS X are both flavors of Unix and</span></div>
<div style="position:absolute;left:108.00px;top:549.86px" class="cls_008"><span class="cls_008">thus support the same types of tools. Among those tools are the shells. So, when</span></div>
<div style="position:absolute;left:108.00px;top:562.46px" class="cls_008"><span class="cls_008">working on a macOS, you will probably be using the Bash shell.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 16 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:28872px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background040.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In this book, we expect from the readers a familiarity with the most basic scripting</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">commands in Bash, and PowerShell if you are working on Windows. If you are an</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">absolute beginner, then we strongly recommend that you familiarize yourself with</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the following cheat sheets:</span></div>
<div style="position:absolute;left:126.00px;top:173.54px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Linux Command Line Cheat Sheet</span><span class="cls_008"> by Dave Child at </span><A HREF="http://bit.ly/2mTQr8l">http://bit.ly/2mTQr8l</A> </span></div>
<div style="position:absolute;left:126.00px;top:190.45px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  PowerShell Basic Cheat Sheet</span><span class="cls_008"> at </span><A HREF="http://bit.ly/2EPHxze">http://bit.ly/2EPHxze</A> </span></div>
<div style="position:absolute;left:108.00px;top:222.95px" class="cls_011"><span class="cls_011">PowerShell for Windows</span></div>
<div style="position:absolute;left:108.00px;top:247.93px" class="cls_008"><span class="cls_008">On a Windows computer, laptop, or server, we have multiple command-line</span></div>
<div style="position:absolute;left:108.00px;top:260.53px" class="cls_008"><span class="cls_008">tools available. The most familiar is the command shell. It has been available on</span></div>
<div style="position:absolute;left:108.00px;top:273.13px" class="cls_008"><span class="cls_008">any Windows computer for decades. It is a very simple shell. For more advanced</span></div>
<div style="position:absolute;left:108.00px;top:285.73px" class="cls_008"><span class="cls_008">scripting, Microsoft has developed PowerShell. PowerShell is very powerful and</span></div>
<div style="position:absolute;left:108.00px;top:298.33px" class="cls_008"><span class="cls_008">very popular among engineers working on Windows. On Windows 10, finally, we</span></div>
<div style="position:absolute;left:108.00px;top:310.93px" class="cls_008"><span class="cls_008">have the so-called </span><span class="cls_009">Windows Subsystem for Linux</span><span class="cls_008">, which allows us to use any Linux</span></div>
<div style="position:absolute;left:108.00px;top:323.53px" class="cls_008"><span class="cls_008">tool, such as the Bash or Bourne shells. Apart from this, there also exist other tools</span></div>
<div style="position:absolute;left:108.00px;top:336.13px" class="cls_008"><span class="cls_008">that install a Bash shell on Windows, for example, the Git Bash shell. In this book, all</span></div>
<div style="position:absolute;left:108.00px;top:348.73px" class="cls_008"><span class="cls_008">commands will use Bash syntax. Most of the commands also run in PowerShell.</span></div>
<div style="position:absolute;left:108.00px;top:369.98px" class="cls_008"><span class="cls_008">Our recommendation for you is thus to either use PowerShell or any other Bash tool</span></div>
<div style="position:absolute;left:108.00px;top:382.58px" class="cls_008"><span class="cls_008">to work with Docker on Windows.</span></div>
<div style="position:absolute;left:108.00px;top:415.07px" class="cls_011"><span class="cls_011">Using a package manager</span></div>
<div style="position:absolute;left:108.00px;top:440.05px" class="cls_008"><span class="cls_008">The easiest way to install software on a macOS or Windows laptop is to use a good</span></div>
<div style="position:absolute;left:108.00px;top:452.65px" class="cls_008"><span class="cls_008">package manager. On a macOS, most people use </span><span class="cls_009">Homebrew</span><span class="cls_008"> and on Windows,</span></div>
<div style="position:absolute;left:108.00px;top:465.25px" class="cls_009"><span class="cls_009">Chocolatey</span><span class="cls_008"> is a good choice.</span></div>
<div style="position:absolute;left:108.00px;top:495.19px" class="cls_022"><span class="cls_022">Installing Homebrew on a macOS</span></div>
<div style="position:absolute;left:108.00px;top:518.17px" class="cls_008"><span class="cls_008">Installing Homebrew on a macOS is easy; just follow the instructions at</span></div>
<div style="position:absolute;left:108.00px;top:530.77px" class="cls_010"><span class="cls_010"> </span><A HREF="https://brew.sh/">https://brew.sh/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:552.02px" class="cls_008"><span class="cls_008">The following is the command to install Homebrew:</span></div>
<div style="position:absolute;left:126.00px;top:572.95px" class="cls_024"><span class="cls_024">/usr/bin/ruby -e "$(curl -fsSL </span><A HREF="https://raw.githubusercontent.com/">https://raw.githubusercontent.com/</A> </div>
<div style="position:absolute;left:126.00px;top:583.75px" class="cls_024"><span class="cls_024">Homebrew/install/master/install)"</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 17 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:29674px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background041.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once the installation is finished, test whether Homebrew is working by entering</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">brew --version</span><span class="cls_008"> in the Terminal. You should see something like this:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ brew --version</span></div>
<div style="position:absolute;left:126.00px;top:158.83px" class="cls_024"><span class="cls_024">Homebrew 1.4.3</span></div>
<div style="position:absolute;left:126.00px;top:169.63px" class="cls_024"><span class="cls_024">Homebrew/homebrew-core (git revision f4e35; last commit 2018-01-11)</span></div>
<div style="position:absolute;left:108.00px;top:189.37px" class="cls_008"><span class="cls_008">Now, we are ready to use Homebrew to install tools and utilities. If we, for example,</span></div>
<div style="position:absolute;left:108.00px;top:201.97px" class="cls_008"><span class="cls_008">want to install the Vi text editor, we can do so like this:</span></div>
<div style="position:absolute;left:126.00px;top:222.91px" class="cls_024"><span class="cls_024">$ brew install vim</span></div>
<div style="position:absolute;left:108.00px;top:242.65px" class="cls_008"><span class="cls_008">This will then download and install the editor for you.</span></div>
<div style="position:absolute;left:108.00px;top:272.59px" class="cls_022"><span class="cls_022">Installing Chocolatey on Windows</span></div>
<div style="position:absolute;left:108.00px;top:295.57px" class="cls_008"><span class="cls_008">To install the Chocolatey package manager on Windows, please follow the</span></div>
<div style="position:absolute;left:108.00px;top:308.17px" class="cls_008"><span class="cls_008">instructions at </span><A HREF="https://chocolatey.org/">https://chocolatey.org/</A> </span><span class="cls_008"> or just execute the following command in</span></div>
<div style="position:absolute;left:108.00px;top:320.77px" class="cls_008"><span class="cls_008">a PowerShell Terminal that you have run as administrator:</span></div>
<div style="position:absolute;left:126.00px;top:341.71px" class="cls_024"><span class="cls_024">PS> Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object</span></div>
<div style="position:absolute;left:126.00px;top:352.51px" class="cls_024"><span class="cls_024">System.Net.WebClient).DownloadString('</span><A HREF="https://chocolatey.org/install./">https://chocolatey.org/install.</A> </div>
<div style="position:absolute;left:126.00px;top:363.31px" class="cls_024"><span class="cls_024">ps1'))</span></div>
<div style="position:absolute;left:108.00px;top:383.05px" class="cls_008"><span class="cls_008">Once Chocolatey is installed, test it with the command </span><span class="cls_010">choco</span><span class="cls_008"> without additional</span></div>
<div style="position:absolute;left:108.00px;top:395.65px" class="cls_008"><span class="cls_008">parameters. You should see output similar to the following:</span></div>
<div style="position:absolute;left:126.00px;top:416.59px" class="cls_024"><span class="cls_024">PS> choco</span></div>
<div style="position:absolute;left:126.00px;top:427.39px" class="cls_024"><span class="cls_024">Chocolatey v0.10.3</span></div>
<div style="position:absolute;left:108.00px;top:447.13px" class="cls_008"><span class="cls_008">To install an application such as the Vi editor, use the following command:</span></div>
<div style="position:absolute;left:126.00px;top:468.07px" class="cls_024"><span class="cls_024">PS> choco install -y vim</span></div>
<div style="position:absolute;left:108.00px;top:487.81px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">-y</span><span class="cls_008"> parameter makes sure that the installation happens without asking for</span></div>
<div style="position:absolute;left:108.00px;top:500.41px" class="cls_008"><span class="cls_008">reconfirmation. Please note that once Chocolatey has installed an application, you</span></div>
<div style="position:absolute;left:108.00px;top:513.01px" class="cls_008"><span class="cls_008">need to open a new PowerShell window to use it.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 18 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:30476px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background042.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Choosing a code editor</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Using a good code editor is essential to working productively with Docker. Of</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">course, which editor is the best is highly controversial and depends on your personal</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">preference. A lot of people use Vim, or others such as Emacs, Atom, Sublime, or</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_009"><span class="cls_009">Visual Studio</span><span class="cls_008"> (</span><span class="cls_009">VS</span><span class="cls_008">) Code, to just name a few. If you have not yet decided which</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">editor is best suited for you, then I highly recommend that you try VS Code. This</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">is a free and lightweight editor, yet it is very powerful and is available for macOS,</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">Windows, and Linux. Give it a try. You can download VS Code from </span><A HREF="https://code.visualstudio.com/download">https://</A> </span></div>
<div style="position:absolute;left:108.00px;top:225.10px" class="cls_010"><span class="cls_010"> </span><A HREF="https://code.visualstudio.com/download">code.visualstudio.com/download</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:246.34px" class="cls_008"><span class="cls_008">But if you already have a favorite code editor, then please continue using it. As</span></div>
<div style="position:absolute;left:108.00px;top:258.94px" class="cls_008"><span class="cls_008">long as you can edit text files, you're good to go. If your editor supports syntax</span></div>
<div style="position:absolute;left:108.00px;top:271.54px" class="cls_008"><span class="cls_008">highlighting for Dockerfiles and JSON and YAML files, then even better.</span></div>
<div style="position:absolute;left:108.00px;top:304.04px" class="cls_011"><span class="cls_011">Docker Toolbox</span></div>
<div style="position:absolute;left:108.00px;top:329.02px" class="cls_008"><span class="cls_008">Docker Toolbox has been available for developers for a few years. It precedes the</span></div>
<div style="position:absolute;left:108.00px;top:341.62px" class="cls_008"><span class="cls_008">newer tools such as Docker for macOS and Docker for Windows. The toolbox allows</span></div>
<div style="position:absolute;left:108.00px;top:354.22px" class="cls_008"><span class="cls_008">a user to work very elegantly with containers on any macOS or Windows computer.</span></div>
<div style="position:absolute;left:108.00px;top:366.82px" class="cls_008"><span class="cls_008">Containers must run on a Linux host. Neither Windows or macOS can run containers</span></div>
<div style="position:absolute;left:108.00px;top:379.42px" class="cls_008"><span class="cls_008">natively. Thus, we need to run a Linux VM on our laptop, where we can then run</span></div>
<div style="position:absolute;left:108.00px;top:392.02px" class="cls_008"><span class="cls_008">our containers. Docker Toolbox installs VirtualBox on our laptop, which is used to</span></div>
<div style="position:absolute;left:108.00px;top:404.62px" class="cls_008"><span class="cls_008">run the Linux VMs we need.</span></div>
<div style="position:absolute;left:182.52px;top:434.27px" class="cls_025"><span class="cls_025">As a Windows user, you might already be aware that there exists</span></div>
<div style="position:absolute;left:182.52px;top:445.67px" class="cls_025"><span class="cls_025">so-called Windows containers that run natively on Windows. And</span></div>
<div style="position:absolute;left:182.52px;top:457.07px" class="cls_025"><span class="cls_025">you are right. Recently, Microsoft has ported the Docker engine</span></div>
<div style="position:absolute;left:182.52px;top:468.47px" class="cls_025"><span class="cls_025">to Windows and it is now possible to run Windows containers</span></div>
<div style="position:absolute;left:182.52px;top:479.87px" class="cls_025"><span class="cls_025">directly on a Windows Server 2016 without the need for a VM.</span></div>
<div style="position:absolute;left:182.52px;top:491.27px" class="cls_025"><span class="cls_025">So, now we have two flavors of containers, Linux containers and</span></div>
<div style="position:absolute;left:182.52px;top:502.67px" class="cls_025"><span class="cls_025">Windows containers. The former only run on Linux host and</span></div>
<div style="position:absolute;left:182.52px;top:514.07px" class="cls_025"><span class="cls_025">the latter only run on a Windows Server. In this book, we are</span></div>
<div style="position:absolute;left:182.52px;top:525.47px" class="cls_025"><span class="cls_025">exclusively discussing Linux containers, but most of the things we</span></div>
<div style="position:absolute;left:182.52px;top:536.87px" class="cls_025"><span class="cls_025">learn also apply to Windows containers.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 19 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:31278px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background043.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Let's use </span><span class="cls_010">docker-machine</span><span class="cls_008"> to set up our environment. Firstly, we list all Docker-</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">ready VMs we have currently defined on our system. If you have just installed</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">Docker Toolbox, you should see the following output:</span></div>
<div style="position:absolute;left:254.91px;top:206.60px" class="cls_026"><span class="cls_026">List of all Docker-ready VMs</span></div>
<div style="position:absolute;left:108.00px;top:225.34px" class="cls_008"><span class="cls_008">The IP address used might be different in your case, but it will be definitely</span></div>
<div style="position:absolute;left:108.00px;top:237.94px" class="cls_008"><span class="cls_008">in the </span><span class="cls_010">192.168.0.0/24</span><span class="cls_008"> range. We can also see that the VM has Docker version</span></div>
<div style="position:absolute;left:108.00px;top:250.54px" class="cls_010"><span class="cls_010">18.04.0-ce</span><span class="cls_008"> installed.</span></div>
<div style="position:absolute;left:108.01px;top:271.78px" class="cls_008"><span class="cls_008">If, for some reason, you don't have a default VM or you have accidentally deleted it,</span></div>
<div style="position:absolute;left:108.01px;top:284.38px" class="cls_008"><span class="cls_008">you can create it using the following command:</span></div>
<div style="position:absolute;left:126.00px;top:305.32px" class="cls_024"><span class="cls_024">$ docker-machine create --driver virtualbox default</span></div>
<div style="position:absolute;left:108.00px;top:325.06px" class="cls_008"><span class="cls_008">The output you should see looks as follows:</span></div>
<div style="position:absolute;left:226.69px;top:570.11px" class="cls_026"><span class="cls_026">Creating the VM called default in VirtualBox</span></div>
<div style="position:absolute;left:108.00px;top:588.85px" class="cls_008"><span class="cls_008">To see how to connect your Docker client to the Docker Engine running on this</span></div>
<div style="position:absolute;left:108.00px;top:601.45px" class="cls_008"><span class="cls_008">virtual machine, run the following command:</span></div>
<div style="position:absolute;left:126.00px;top:622.39px" class="cls_024"><span class="cls_024">$ docker-machine env default</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 20 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:32080px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background044.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once we have our VM called </span><span class="cls_010">default</span><span class="cls_008"> ready, we can try to SSH into it:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">$ docker-machine ssh default</span></div>
<div style="position:absolute;left:108.00px;top:155.17px" class="cls_008"><span class="cls_008">When executing the preceding command, we are greeted by a boot2docker welcome</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">message.</span></div>
<div style="position:absolute;left:108.00px;top:189.01px" class="cls_008"><span class="cls_008">Type </span><span class="cls_010">docker --version</span><span class="cls_008"> in the Command Prompt as follows:</span></div>
<div style="position:absolute;left:126.00px;top:209.95px" class="cls_024"><span class="cls_024">docker@default:~$ docker --version</span></div>
<div style="position:absolute;left:126.00px;top:220.75px" class="cls_024"><span class="cls_024">Docker version 18.06.1-ce, build e68fc7a</span></div>
<div style="position:absolute;left:108.00px;top:240.49px" class="cls_008"><span class="cls_008">Now, let's try to run a container:</span></div>
<div style="position:absolute;left:126.00px;top:261.43px" class="cls_024"><span class="cls_024">docker@default:~$ docker run hello-world</span></div>
<div style="position:absolute;left:108.00px;top:281.17px" class="cls_008"><span class="cls_008">This will produce the following output:</span></div>
<div style="position:absolute;left:229.51px;top:633.82px" class="cls_026"><span class="cls_026">Running the Docker Hello World container</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 21 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:32882px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background045.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Docker for macOS and Docker for</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">Windows</span></div>
<div style="position:absolute;left:108.00px;top:160.90px" class="cls_008"><span class="cls_008">If you are using a macOS or have Windows 10 Professional installed on your laptop,</span></div>
<div style="position:absolute;left:108.00px;top:173.50px" class="cls_008"><span class="cls_008">then we strongly recommend that you install Docker for macOS or Docker for</span></div>
<div style="position:absolute;left:108.00px;top:186.10px" class="cls_008"><span class="cls_008">Windows. These tools give you the best experience when working with containers.</span></div>
<div style="position:absolute;left:108.00px;top:198.70px" class="cls_008"><span class="cls_008">Note, older versions of Windows or Windows 10 Home edition cannot run Docker</span></div>
<div style="position:absolute;left:108.00px;top:211.30px" class="cls_008"><span class="cls_008">for Windows. Docker for Windows uses Hyper-V to run containers transparently in</span></div>
<div style="position:absolute;left:108.00px;top:223.90px" class="cls_008"><span class="cls_008">a VM but Hyper-V is not available on older versions of Windows nor is it available</span></div>
<div style="position:absolute;left:108.00px;top:236.50px" class="cls_008"><span class="cls_008">in the Home edition.</span></div>
<div style="position:absolute;left:108.00px;top:266.44px" class="cls_022"><span class="cls_022">Installing Docker for macOS</span></div>
<div style="position:absolute;left:108.00px;top:289.42px" class="cls_008"><span class="cls_008">Navigate to the following link to download Docker for macOS at </span><A HREF="https://docs.docker.com/docker-for-mac/install/">https://docs.</A> </span></div>
<div style="position:absolute;left:108.00px;top:302.02px" class="cls_010"><span class="cls_010"> </span><A HREF="https://docs.docker.com/docker-for-mac/install/">docker.com/docker-for-mac/install/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:188.64px;top:333.37px" class="cls_025"><span class="cls_025">There is a stable version and a so-called edge version of the tool</span></div>
<div style="position:absolute;left:188.64px;top:344.77px" class="cls_025"><span class="cls_025">available. In this book, we are going to use some newer features</span></div>
<div style="position:absolute;left:188.64px;top:356.17px" class="cls_025"><span class="cls_025">and Kubernetes, which at the time of writing are only available</span></div>
<div style="position:absolute;left:188.64px;top:367.57px" class="cls_025"><span class="cls_025">in the edge version. Thus, please select this version.</span></div>
<div style="position:absolute;left:108.00px;top:394.62px" class="cls_008"><span class="cls_008">To start the installation:</span></div>
<div style="position:absolute;left:126.00px;top:415.86px" class="cls_008"><span class="cls_008">1.  Click on the </span><span class="cls_009">Get Docker for Mac (Edge)</span><span class="cls_008"> button and follow the instructions.</span></div>
<div style="position:absolute;left:126.00px;top:432.78px" class="cls_008"><span class="cls_008">2.  Once you have successfully installed Docker for macOS, open a Terminal.</span></div>
<div style="position:absolute;left:143.99px;top:445.38px" class="cls_008"><span class="cls_008">Press command + spacebar to open Spotlight and type </span><span class="cls_010">terminal</span><span class="cls_008">, then hit</span></div>
<div style="position:absolute;left:144.00px;top:457.98px" class="cls_021"><span class="cls_021">enter</span><span class="cls_008">. The Apple Terminal will open as follows:</span></div>
<div style="position:absolute;left:262.07px;top:558.18px" class="cls_026"><span class="cls_026">Apple Terminal window</span></div>
<div style="position:absolute;left:126.00px;top:576.92px" class="cls_008"><span class="cls_008">3.  Type </span><span class="cls_010">docker --version</span><span class="cls_008"> in the Command Prompt and hit </span><span class="cls_021">enter</span><span class="cls_008">. If Docker</span></div>
<div style="position:absolute;left:144.00px;top:589.52px" class="cls_008"><span class="cls_008">for macOS is correctly installed, you should get an output similar to the</span></div>
<div style="position:absolute;left:144.00px;top:602.12px" class="cls_008"><span class="cls_008">following:</span></div>
<div style="position:absolute;left:165.60px;top:618.74px" class="cls_024"><span class="cls_024">$ docker -version</span></div>
<div style="position:absolute;left:165.60px;top:630.98px" class="cls_024"><span class="cls_024">Docker version 18.02.0-ce-rc2, build f968a2c</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 22 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:33684px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background046.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">4.  To see whether you can run containers, enter the following command into</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">the Terminal and hit </span><span class="cls_021">enter</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:165.60px;top:143.71px" class="cls_024"><span class="cls_024">$ docker run hello-world</span></div>
<div style="position:absolute;left:108.00px;top:163.45px" class="cls_008"><span class="cls_008">If all goes well, your output should look something like the following:</span></div>
<div style="position:absolute;left:204.35px;top:492.87px" class="cls_026"><span class="cls_026">Running the Hello World container on Docker for macOS</span></div>
<div style="position:absolute;left:108.00px;top:511.61px" class="cls_008"><span class="cls_008">Congratulations, you are now ready to work with Docker containers.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 23 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:34486px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background047.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Installing Docker for Windows</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Note, you can only install Docker for Windows on Windows 10 Professional or</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">Windows Server 2016 since it requires Hyper-V, which is not available on older</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">Windows versions or on the Home edition of Windows 10. If you are using</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Windows 10 Home or an older version of Windows, you will need to stick</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">with Docker Toolbox.</span></div>
<div style="position:absolute;left:126.00px;top:207.09px" class="cls_008"><span class="cls_008">1.  Navigate to the following link to download Docker for Windows at</span></div>
<div style="position:absolute;left:144.00px;top:219.68px" class="cls_010"><span class="cls_010"> </span><A HREF="https://docs.docker.com/docker-for-windows/install/">https://docs.docker.com/docker-for-windows/install/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:183.60px;top:251.04px" class="cls_025"><span class="cls_025">There is a stable version and a so-called edge version of the tool</span></div>
<div style="position:absolute;left:183.60px;top:262.44px" class="cls_025"><span class="cls_025">available. In this book, we are going to use some newer features</span></div>
<div style="position:absolute;left:183.60px;top:273.84px" class="cls_025"><span class="cls_025">and Kubernetes, which at the time of writing are only available in</span></div>
<div style="position:absolute;left:183.60px;top:285.24px" class="cls_025"><span class="cls_025">the edge version. Thus, please select this version.</span></div>
<div style="position:absolute;left:126.00px;top:312.28px" class="cls_008"><span class="cls_008">2.  To start the installation, click on the </span><span class="cls_009">Get Docker for Windows (Edge)</span><span class="cls_008"> button</span></div>
<div style="position:absolute;left:144.00px;top:324.88px" class="cls_008"><span class="cls_008">and follow the instructions. With Docker for Windows, you can develop, run,</span></div>
<div style="position:absolute;left:144.00px;top:337.48px" class="cls_008"><span class="cls_008">and test Linux containers and Windows containers. In this book, though, we</span></div>
<div style="position:absolute;left:144.00px;top:350.08px" class="cls_008"><span class="cls_008">are only discussing Linux containers.</span></div>
<div style="position:absolute;left:126.00px;top:367.00px" class="cls_008"><span class="cls_008">3.  Once you have successfully installed Docker for Windows. Open a</span></div>
<div style="position:absolute;left:144.00px;top:379.60px" class="cls_008"><span class="cls_008">PowerShell window and type </span><span class="cls_010">docker --version</span><span class="cls_008"> in the Command Prompt.</span></div>
<div style="position:absolute;left:144.01px;top:392.20px" class="cls_008"><span class="cls_008">You should see something like the following:</span></div>
<div style="position:absolute;left:165.60px;top:408.82px" class="cls_024"><span class="cls_024">PS> docker --version</span></div>
<div style="position:absolute;left:165.60px;top:419.62px" class="cls_024"><span class="cls_024">Docker version 18.04.0-ce, build 3d479c0</span></div>
<div style="position:absolute;left:108.00px;top:448.06px" class="cls_022"><span class="cls_022">Using docker-machine on Windows with</span></div>
<div style="position:absolute;left:108.00px;top:469.66px" class="cls_022"><span class="cls_022">Hyper-V</span></div>
<div style="position:absolute;left:108.00px;top:492.64px" class="cls_008"><span class="cls_008">If you have Docker for Windows installed on your Windows laptop, then you also</span></div>
<div style="position:absolute;left:108.00px;top:505.24px" class="cls_008"><span class="cls_008">have Hyper-V enabled. In this case, you can't use Docker Toolbox since it uses</span></div>
<div style="position:absolute;left:108.00px;top:517.84px" class="cls_008"><span class="cls_008">VirtualBox, and Hyper-V and VirtualBox cannot coexist and run at the same time. In</span></div>
<div style="position:absolute;left:108.00px;top:530.44px" class="cls_008"><span class="cls_008">this case, you can use </span><span class="cls_010">docker-machine</span><span class="cls_008"> with the Hyper-V driver.</span></div>
<div style="position:absolute;left:126.00px;top:551.68px" class="cls_008"><span class="cls_008">1.  Open a PowerShell console as an administrator. Install </span><span class="cls_010">docker-machine</span></div>
<div style="position:absolute;left:144.00px;top:564.28px" class="cls_008"><span class="cls_008">using Chocolatey as follows:</span></div>
<div style="position:absolute;left:165.60px;top:580.90px" class="cls_024"><span class="cls_024">PS> choco install -y docker-machine</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 24 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:35288px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background048.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">Using Window's Hyper-V manager create a new internal switch called </span><span class="cls_010">DM</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_010"><span class="cls_010">Internal Switch</span><span class="cls_008">, where </span><span class="cls_010">DM</span><span class="cls_008"> stands for </span><span class="cls_009">docker-machine</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:144.01px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:143.99px;top:144.01px" class="cls_008"><span class="cls_008">Create a VM called </span><span class="cls_010">default</span><span class="cls_008"> in Hyper-V with the following command:</span></div>
<div style="position:absolute;left:165.60px;top:160.63px" class="cls_024"><span class="cls_024">PS> docker-machine create --driver hyperv --hyperv-virtual-</span></div>
<div style="position:absolute;left:165.60px;top:171.43px" class="cls_024"><span class="cls_024">switch "DM Internal Switch" default</span></div>
<div style="position:absolute;left:203.04px;top:202.19px" class="cls_025"><span class="cls_025">You must run the preceding command in administrator</span></div>
<div style="position:absolute;left:203.04px;top:213.59px" class="cls_025"><span class="cls_025">mode or it will fail.</span></div>
<div style="position:absolute;left:144.00px;top:241.53px" class="cls_008"><span class="cls_008">You should see the following output generated by the preceding command:</span></div>
<div style="position:absolute;left:165.60px;top:262.47px" class="cls_024"><span class="cls_024">Running pre-create checks...</span></div>
<div style="position:absolute;left:165.60px;top:273.27px" class="cls_024"><span class="cls_024">(boot2docker) Image cache directory does not exist, creating</span></div>
<div style="position:absolute;left:165.60px;top:284.07px" class="cls_024"><span class="cls_024">it at C:\Users\Docker\.docker\machine\cache...</span></div>
<div style="position:absolute;left:165.60px;top:294.87px" class="cls_024"><span class="cls_024">(boot2docker) No default Boot2Docker ISO found locally,</span></div>
<div style="position:absolute;left:165.60px;top:305.67px" class="cls_024"><span class="cls_024">downloading the latest release...</span></div>
<div style="position:absolute;left:165.60px;top:316.47px" class="cls_024"><span class="cls_024">(boot2docker) Latest release for github.com/boot2docker/</span></div>
<div style="position:absolute;left:165.60px;top:327.27px" class="cls_024"><span class="cls_024">boot2docker is v18.06.1-ce</span></div>
<div style="position:absolute;left:165.60px;top:359.67px" class="cls_024"><span class="cls_024">Checking connection to Docker...</span></div>
<div style="position:absolute;left:165.60px;top:370.47px" class="cls_024"><span class="cls_024">Docker is up and running!</span></div>
<div style="position:absolute;left:165.60px;top:381.27px" class="cls_024"><span class="cls_024">To see how to connect your Docker Client to the Docker Engine</span></div>
<div style="position:absolute;left:165.60px;top:392.07px" class="cls_024"><span class="cls_024">running on this virtual machine, run: C:\Program Files\Doc</span></div>
<div style="position:absolute;left:165.60px;top:402.87px" class="cls_024"><span class="cls_024">ker\Docker\Resources\bin\docker-machine.exe env default</span></div>
<div style="position:absolute;left:126.00px;top:422.61px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:422.61px" class="cls_008"><span class="cls_008">To see how to connect your Docker client to the Docker Engine running on</span></div>
<div style="position:absolute;left:144.00px;top:435.21px" class="cls_008"><span class="cls_008">this virtual machine, run the following:</span></div>
<div style="position:absolute;left:165.60px;top:451.83px" class="cls_024"><span class="cls_024">C:\Program Files\Docker\Docker\Resources\bin\docker-machine.</span></div>
<div style="position:absolute;left:165.60px;top:462.63px" class="cls_024"><span class="cls_024">exe env default</span></div>
<div style="position:absolute;left:126.00px;top:482.37px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:482.37px" class="cls_008"><span class="cls_008">Listing all VMs generated by </span><span class="cls_010">docker-machine</span><span class="cls_008"> gives us the following output:</span></div>
<div style="position:absolute;left:165.60px;top:498.99px" class="cls_024"><span class="cls_024">PS C:\WINDOWS\system32> docker-machine ls</span></div>
<div style="position:absolute;left:165.60px;top:509.79px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:241.20px;top:509.79px" class="cls_024"><span class="cls_024">ACTIVE</span></div>
<div style="position:absolute;left:289.80px;top:509.79px" class="cls_024"><span class="cls_024">DRIVER</span></div>
<div style="position:absolute;left:338.40px;top:509.79px" class="cls_024"><span class="cls_024">STATE</span></div>
<div style="position:absolute;left:392.40px;top:509.79px" class="cls_024"><span class="cls_024">URL</span></div>
<div style="position:absolute;left:165.60px;top:520.59px" class="cls_024"><span class="cls_024">SWARM</span></div>
<div style="position:absolute;left:208.80px;top:520.59px" class="cls_024"><span class="cls_024">DOCKER</span></div>
<div style="position:absolute;left:284.40px;top:520.59px" class="cls_024"><span class="cls_024">ERRORS</span></div>
<div style="position:absolute;left:165.60px;top:531.39px" class="cls_024"><span class="cls_024">default .</span></div>
<div style="position:absolute;left:241.20px;top:531.39px" class="cls_024"><span class="cls_024">-</span></div>
<div style="position:absolute;left:289.80px;top:531.39px" class="cls_024"><span class="cls_024">hyperv</span></div>
<div style="position:absolute;left:338.40px;top:531.39px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:392.40px;top:531.39px" class="cls_024"><span class="cls_024">tcp://[...]:2376</span></div>
<div style="position:absolute;left:165.60px;top:542.19px" class="cls_024"><span class="cls_024">v18.06.1-ce</span></div>
<div style="position:absolute;left:126.00px;top:561.93px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:144.00px;top:561.93px" class="cls_008"><span class="cls_008">Now, let's SSH into our </span><span class="cls_010">boot2docker</span><span class="cls_008"> VM:</span></div>
<div style="position:absolute;left:165.60px;top:582.87px" class="cls_024"><span class="cls_024">PS> docker-machine ssh default</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 25 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:36090px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background049.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">You should be greeted by the welcome screen.</span></div>
<div style="position:absolute;left:144.00px;top:131.41px" class="cls_008"><span class="cls_008">We can test the VM by executing our </span><span class="cls_010">docker version</span><span class="cls_008"> command, which is</span></div>
<div style="position:absolute;left:144.00px;top:144.01px" class="cls_008"><span class="cls_008">shown as follows:</span></div>
<div style="position:absolute;left:226.74px;top:378.43px" class="cls_026"><span class="cls_026">Version of the Docker client (CLI) and server</span></div>
<div style="position:absolute;left:144.00px;top:397.17px" class="cls_008"><span class="cls_008">This is definitely a Linux VM, as we can see on the </span><span class="cls_010">OS/Arch</span><span class="cls_008"> entry, and has</span></div>
<div style="position:absolute;left:144.00px;top:409.77px" class="cls_008"><span class="cls_008">Docker </span><span class="cls_010">18.06.1-ce</span><span class="cls_008"> installed.</span></div>
<div style="position:absolute;left:108.00px;top:442.27px" class="cls_011"><span class="cls_011">Minikube</span></div>
<div style="position:absolute;left:108.00px;top:467.25px" class="cls_008"><span class="cls_008">If you cannot use Docker for macOS or Windows or, for some reason, you only have</span></div>
<div style="position:absolute;left:108.00px;top:479.85px" class="cls_008"><span class="cls_008">access to an older version of the tool that does not yet support Kubernetes, then it is a</span></div>
<div style="position:absolute;left:108.00px;top:492.45px" class="cls_008"><span class="cls_008">good idea to install Minikube. Minikube provisions a single-node Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:505.05px" class="cls_008"><span class="cls_008">on your workstation and is accessible through </span><span class="cls_009">kubectl</span><span class="cls_008">, which is the command-line</span></div>
<div style="position:absolute;left:108.00px;top:517.65px" class="cls_008"><span class="cls_008">tool used to work with Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:547.59px" class="cls_022"><span class="cls_022">Installing Minikube on macOS and Windows</span></div>
<div style="position:absolute;left:108.00px;top:570.57px" class="cls_008"><span class="cls_008">To install Minikube for macOS or Windows, navigate to the following link at</span></div>
<div style="position:absolute;left:108.00px;top:583.17px" class="cls_010"><span class="cls_010"> </span><A HREF="https://kubernetes.io/docs/tasks/tools/install-minikube/">https://kubernetes.io/docs/tasks/tools/install-minikube/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.01px;top:604.41px" class="cls_008"><span class="cls_008">Follow the instructions carefully. If you have the Docker Toolbox installed, then you</span></div>
<div style="position:absolute;left:108.01px;top:617.01px" class="cls_008"><span class="cls_008">already have a hypervisor on your system since the Docker Toolbox installer also</span></div>
<div style="position:absolute;left:108.01px;top:629.61px" class="cls_008"><span class="cls_008">installed VirtualBox. Otherwise, I recommend that you install VirtualBox first.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 26 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:36892px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background050.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If you have Docker for macOS or Windows installed, then you already have </span><span class="cls_010">kubectl</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">installed with it, thus you can skip that step too. Otherwise, follow the instructions</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">on the site.</span></div>
<div style="position:absolute;left:108.00px;top:160.94px" class="cls_008"><span class="cls_008">Finally, select the latest binary for Minikube for macOS or Windows and install it.</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_008"><span class="cls_008">For macOS, the latest binary is called </span><span class="cls_010">minikube-darwin-amd64</span><span class="cls_008"> and for Windows it</span></div>
<div style="position:absolute;left:108.00px;top:186.13px" class="cls_008"><span class="cls_008">is </span><span class="cls_010">minikube-windows-amd64</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:216.07px" class="cls_022"><span class="cls_022">Testing Minikube and kubectl</span></div>
<div style="position:absolute;left:108.00px;top:239.05px" class="cls_008"><span class="cls_008">Once Minikube is successfully installed on your workstation, open a Terminal and</span></div>
<div style="position:absolute;left:108.00px;top:251.65px" class="cls_008"><span class="cls_008">test the installation.</span></div>
<div style="position:absolute;left:126.00px;top:272.89px" class="cls_008"><span class="cls_008">1.  First, we need to start Minikube. Enter </span><span class="cls_010">minikube start</span><span class="cls_008"> at the command</span></div>
<div style="position:absolute;left:143.99px;top:285.49px" class="cls_008"><span class="cls_008">line. The output should look like the following:</span></div>
<div style="position:absolute;left:273.79px;top:468.16px" class="cls_026"><span class="cls_026">Starting Minikube</span></div>
<div style="position:absolute;left:126.00px;top:486.90px" class="cls_008"><span class="cls_008">2.  Now, enter </span><span class="cls_010">kubectl version</span><span class="cls_008"> and hit </span><span class="cls_021">enter</span><span class="cls_008"> to see something like the</span></div>
<div style="position:absolute;left:144.00px;top:499.50px" class="cls_008"><span class="cls_008">following screenshot:</span></div>
<div style="position:absolute;left:200.15px;top:582.52px" class="cls_026"><span class="cls_026">Determining the version of the Kubernetes client and server</span></div>
<div style="position:absolute;left:144.00px;top:601.26px" class="cls_008"><span class="cls_008">If the preceding command fails, for example, by timing out, then it could be</span></div>
<div style="position:absolute;left:144.00px;top:613.86px" class="cls_008"><span class="cls_008">that your </span><span class="cls_010">kubectl</span><span class="cls_008"> is not configured for the right context. </span><span class="cls_010">kubectl</span><span class="cls_008"> can be</span></div>
<div style="position:absolute;left:144.00px;top:626.46px" class="cls_008"><span class="cls_008">used to work with many different Kubernetes clusters. Each cluster is called</span></div>
<div style="position:absolute;left:144.00px;top:639.06px" class="cls_008"><span class="cls_008">a context.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 27 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:37694px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background051.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Setting up a Working Environment</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">To find out which context </span><span class="cls_010">kubectl</span><span class="cls_008"> is currently configured for, use the</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:165.60px;top:143.71px" class="cls_024"><span class="cls_024">$ kubectl config current-context</span></div>
<div style="position:absolute;left:165.60px;top:154.51px" class="cls_024"><span class="cls_024">minikube</span></div>
<div style="position:absolute;left:144.00px;top:174.25px" class="cls_008"><span class="cls_008">The answer should be </span><span class="cls_010">minikube</span><span class="cls_008">, as shown in the preceding output.</span></div>
<div style="position:absolute;left:126.00px;top:195.50px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:143.99px;top:195.49px" class="cls_008"><span class="cls_008">If this is not the case, use </span><span class="cls_010">kubectl config get-contexts</span><span class="cls_008"> to list all contexts</span></div>
<div style="position:absolute;left:144.00px;top:208.09px" class="cls_008"><span class="cls_008">that are defined on your system and then set the current context to </span><span class="cls_010">minikube</span></div>
<div style="position:absolute;left:144.00px;top:220.69px" class="cls_008"><span class="cls_008">as follows:</span></div>
<div style="position:absolute;left:165.60px;top:237.31px" class="cls_024"><span class="cls_024">$ kubectl config use-context minikube</span></div>
<div style="position:absolute;left:144.00px;top:257.05px" class="cls_008"><span class="cls_008">The configuration for </span><span class="cls_010">kubectl</span><span class="cls_008">, where it stores the contexts, is normally</span></div>
<div style="position:absolute;left:144.00px;top:269.65px" class="cls_008"><span class="cls_008">found in </span><span class="cls_010">~/.kube/config</span><span class="cls_008">, but this can be overridden by defining an</span></div>
<div style="position:absolute;left:144.00px;top:282.25px" class="cls_008"><span class="cls_008">environment variable called </span><span class="cls_010">KUBECONFIG</span><span class="cls_008">. You might need to unset this</span></div>
<div style="position:absolute;left:144.00px;top:294.85px" class="cls_008"><span class="cls_008">variable if it is set on your computer.</span></div>
<div style="position:absolute;left:144.00px;top:311.77px" class="cls_008"><span class="cls_008">For more in-depth information about how to configure and use Kubernetes</span></div>
<div style="position:absolute;left:144.00px;top:324.37px" class="cls_008"><span class="cls_008">contexts, consult the link at </span><A HREF="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">https://kubernetes.io/docs/concepts/</A> </span></div>
<div style="position:absolute;left:144.00px;top:336.97px" class="cls_010"><span class="cls_010"> </span><A HREF="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">configuration/organize-cluster-access-kubeconfig/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:144.00px;top:353.89px" class="cls_008"><span class="cls_008">Assuming Minikube and </span><span class="cls_010">kubectl</span><span class="cls_008"> work as expected, we can now use</span></div>
<div style="position:absolute;left:144.00px;top:366.49px" class="cls_010"><span class="cls_010">kubectl</span><span class="cls_008"> to get information about the Kubernetes cluster.</span></div>
<div style="position:absolute;left:126.00px;top:387.74px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:387.74px" class="cls_008"><span class="cls_008">Enter the following command:</span></div>
<div style="position:absolute;left:165.60px;top:404.35px" class="cls_024"><span class="cls_024">$ kubectl get nodes</span></div>
<div style="position:absolute;left:165.60px;top:415.15px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:225.00px;top:415.15px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:279.00px;top:415.15px" class="cls_024"><span class="cls_024">ROLES</span></div>
<div style="position:absolute;left:333.00px;top:415.15px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:387.00px;top:415.15px" class="cls_024"><span class="cls_024">VERSION</span></div>
<div style="position:absolute;left:165.60px;top:425.95px" class="cls_024"><span class="cls_024">minikube</span></div>
<div style="position:absolute;left:225.00px;top:425.95px" class="cls_024"><span class="cls_024">Ready</span></div>
<div style="position:absolute;left:279.00px;top:425.95px" class="cls_024"><span class="cls_024">&lt;none></span></div>
<div style="position:absolute;left:333.00px;top:425.95px" class="cls_024"><span class="cls_024">47d</span></div>
<div style="position:absolute;left:387.00px;top:425.95px" class="cls_024"><span class="cls_024">v1.9.0</span></div>
<div style="position:absolute;left:108.00px;top:445.69px" class="cls_008"><span class="cls_008">Evidently, we have a cluster of one node, which in my case has Kubernetes </span><span class="cls_010">v1.9.0</span></div>
<div style="position:absolute;left:108.00px;top:458.29px" class="cls_008"><span class="cls_008">installed on it.</span></div>
<div style="position:absolute;left:108.00px;top:490.79px" class="cls_011"><span class="cls_011">Cloning the source code repository</span></div>
<div style="position:absolute;left:108.00px;top:515.77px" class="cls_008"><span class="cls_008">This book is accompanied by source code publicly available in a GitHub repository</span></div>
<div style="position:absolute;left:108.00px;top:528.37px" class="cls_008"><span class="cls_008">at </span><A HREF="https://github.com/appswithdockerandkubernetes/labs">https://github.com/appswithdockerandkubernetes/labs</A> </span><span class="cls_008">. Clone that</span></div>
<div style="position:absolute;left:108.00px;top:540.97px" class="cls_008"><span class="cls_008">repository to your local machine.</span></div>
<div style="position:absolute;left:108.00px;top:562.22px" class="cls_008"><span class="cls_008">First create a new folder for example, in your home folder such as </span><span class="cls_010">apps-with-</span></div>
<div style="position:absolute;left:108.00px;top:574.81px" class="cls_010"><span class="cls_010">docker-and-kubernetes</span><span class="cls_008"> and navigate to it:</span></div>
<div style="position:absolute;left:144.00px;top:595.75px" class="cls_024"><span class="cls_024">$ mkdir -p ~/apps-with-docker-and-kubernetes \</span></div>
<div style="position:absolute;left:154.80px;top:606.55px" class="cls_024"><span class="cls_024">cd apps-with-docker-and-kubernetes</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 28 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:38496px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background052.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 2</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">And then clone the repository with the following command:</span></div>
<div style="position:absolute;left:144.00px;top:135.43px" class="cls_024"><span class="cls_024">$ git clone </span><A HREF="https://github.com/appswithdockerandkubernetes/labs./">https://github.com/appswithdockerandkubernetes/labs.</A> </div>
<div style="position:absolute;left:144.00px;top:146.23px" class="cls_024"><span class="cls_024">git</span></div>
<div style="position:absolute;left:108.00px;top:177.23px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:202.21px" class="cls_008"><span class="cls_008">In this chapter, we set up and configured our personal or working environment</span></div>
<div style="position:absolute;left:108.00px;top:214.81px" class="cls_008"><span class="cls_008">so that we can productively work with Docker containers. This equally applies for</span></div>
<div style="position:absolute;left:108.00px;top:227.41px" class="cls_008"><span class="cls_008">developers, DevOps, and operations engineers. In that context, we made sure that</span></div>
<div style="position:absolute;left:108.00px;top:240.01px" class="cls_008"><span class="cls_008">we use a good editor, have Docker for macOS or Windows installed, and can also use</span></div>
<div style="position:absolute;left:108.00px;top:252.61px" class="cls_010"><span class="cls_010">docker-machine</span><span class="cls_008"> to create VMs in VirtualBox or Hyper-V which we can use to run</span></div>
<div style="position:absolute;left:108.00px;top:265.21px" class="cls_008"><span class="cls_008">and test containers.</span></div>
<div style="position:absolute;left:108.00px;top:286.46px" class="cls_008"><span class="cls_008">In the next chapter, we're going to learn all the important facts about containers. For</span></div>
<div style="position:absolute;left:108.00px;top:299.06px" class="cls_008"><span class="cls_008">example, we will explore how we can run, stop, list, and delete containers, but more</span></div>
<div style="position:absolute;left:108.00px;top:311.66px" class="cls_008"><span class="cls_008">than that, we will also dive deep into the anatomy of containers.</span></div>
<div style="position:absolute;left:108.00px;top:344.15px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:369.13px" class="cls_008"><span class="cls_008">On the basis of your reading of this chapter, please answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:390.37px" class="cls_008"><span class="cls_008">1.  What is </span><span class="cls_010">docker-machine</span><span class="cls_008"> used for? Name three to four scenarios.</span></div>
<div style="position:absolute;left:126.00px;top:407.29px" class="cls_008"><span class="cls_008">2.  True or false? With Docker for Windows, one can develop and run Linux</span></div>
<div style="position:absolute;left:144.00px;top:419.89px" class="cls_008"><span class="cls_008">containers.</span></div>
<div style="position:absolute;left:126.00px;top:436.80px" class="cls_008"><span class="cls_008">3.  Why are good scripting skills (such as Bash or PowerShell) essential for a</span></div>
<div style="position:absolute;left:144.00px;top:449.40px" class="cls_008"><span class="cls_008">productive use of containers?</span></div>
<div style="position:absolute;left:126.00px;top:466.32px" class="cls_008"><span class="cls_008">4.  Name three to four Linux distributions on which Docker is certified to run.</span></div>
<div style="position:absolute;left:126.00px;top:483.24px" class="cls_008"><span class="cls_008">5.  Name all the Windows versions on which you can run Windows containers.</span></div>
<div style="position:absolute;left:108.00px;top:515.75px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:540.73px" class="cls_008"><span class="cls_008">Consider the following link for further reading:</span></div>
<div style="position:absolute;left:126.00px;top:561.98px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Run Docker on Hyper-V with Docker Machine</span><span class="cls_008"> at </span><A HREF="http://bit.ly/2HGMPiI">http://bit.ly/2HGMPiI</A> </span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 29 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:39298px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background053.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:39298px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background054.jpg" width=612 height=792></div>
<div style="position:absolute;left:179.42px;top:219.88px" class="cls_015"><span class="cls_015">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:273.58px" class="cls_008"><span class="cls_008">In the previous chapter, you learned how to optimally prepare your working</span></div>
<div style="position:absolute;left:108.00px;top:286.18px" class="cls_008"><span class="cls_008">environment for the productive and frictionless use of Docker. In this chapter,</span></div>
<div style="position:absolute;left:108.00px;top:298.78px" class="cls_008"><span class="cls_008">we are going to get our hands dirty and learn everything that is important to work</span></div>
<div style="position:absolute;left:108.00px;top:311.38px" class="cls_008"><span class="cls_008">with containers. Here are the topics we're going to cover in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:332.62px" class="cls_008"><span class="cls_008">•  Running the first container</span></div>
<div style="position:absolute;left:126.00px;top:349.54px" class="cls_008"><span class="cls_008">•  Starting, stopping, and removing containers</span></div>
<div style="position:absolute;left:126.00px;top:366.45px" class="cls_008"><span class="cls_008">•  Inspecting containers</span></div>
<div style="position:absolute;left:126.00px;top:383.37px" class="cls_008"><span class="cls_008">•  Exec into a running container</span></div>
<div style="position:absolute;left:126.00px;top:400.28px" class="cls_008"><span class="cls_008">•  Attaching to a running container</span></div>
<div style="position:absolute;left:126.00px;top:417.20px" class="cls_008"><span class="cls_008">•  Retrieving container logs</span></div>
<div style="position:absolute;left:126.00px;top:434.11px" class="cls_008"><span class="cls_008">•  Anatomy of containers</span></div>
<div style="position:absolute;left:107.99px;top:455.36px" class="cls_008"><span class="cls_008">After finishing this chapter you will be able to do the following things:</span></div>
<div style="position:absolute;left:125.99px;top:476.60px" class="cls_008"><span class="cls_008">•  Run, stop, and delete a container based on an existing image, such as</span></div>
<div style="position:absolute;left:143.98px;top:489.20px" class="cls_008"><span class="cls_008">NGINX, busybox, or alpine</span></div>
<div style="position:absolute;left:125.99px;top:506.11px" class="cls_008"><span class="cls_008">•  List all containers on the system</span></div>
<div style="position:absolute;left:125.99px;top:523.03px" class="cls_008"><span class="cls_008">•  Inspect the metadata of a running or stopped container</span></div>
<div style="position:absolute;left:125.99px;top:539.94px" class="cls_008"><span class="cls_008">•  Retrieve the logs produced by an application running inside a container</span></div>
<div style="position:absolute;left:125.99px;top:556.86px" class="cls_008"><span class="cls_008">•  Run a process such as </span><span class="cls_010">/bin/sh</span><span class="cls_008"> in an already-running container.</span></div>
<div style="position:absolute;left:126.00px;top:573.82px" class="cls_008"><span class="cls_008">•  Attach a Terminal to an already-running container</span></div>
<div style="position:absolute;left:126.00px;top:590.73px" class="cls_008"><span class="cls_008">•  Explain in your own words to an interested layman the underpinnings</span></div>
<div style="position:absolute;left:144.00px;top:603.33px" class="cls_008"><span class="cls_008">of a container</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 31 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:40100px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background055.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">For this chapter, you should have installed Docker for Mac or Docker for Windows.</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">If you are on an older version of Windows or are using Windows 10 Home Edition,</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">then you should have Docker Toolbox installed and ready to use. On macOS, use</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">the Terminal application, and on Windows, a PowerShell console to try out the</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">commands you will be learning.</span></div>
<div style="position:absolute;left:108.00px;top:219.80px" class="cls_011"><span class="cls_011">Running the first container</span></div>
<div style="position:absolute;left:108.00px;top:244.78px" class="cls_008"><span class="cls_008">Before we start, we want to make sure that Docker is installed correctly on your</span></div>
<div style="position:absolute;left:108.00px;top:257.38px" class="cls_008"><span class="cls_008">system and ready to accept your commands. Open a new Terminal window</span></div>
<div style="position:absolute;left:108.00px;top:269.98px" class="cls_008"><span class="cls_008">and type in the following command:</span></div>
<div style="position:absolute;left:126.00px;top:290.92px" class="cls_024"><span class="cls_024">$ docker -v</span></div>
<div style="position:absolute;left:108.00px;top:310.66px" class="cls_008"><span class="cls_008">If everything works correctly, you should see the version of Docker installed on your</span></div>
<div style="position:absolute;left:108.00px;top:323.26px" class="cls_008"><span class="cls_008">laptop output in the Terminal. At the time of writing, it looks like this:</span></div>
<div style="position:absolute;left:126.00px;top:344.20px" class="cls_024"><span class="cls_024">Docker version 17.12.0-ce-rc2, build f9cde63</span></div>
<div style="position:absolute;left:108.00px;top:363.94px" class="cls_008"><span class="cls_008">If this doesn't work, then something with your installation is not right. Please make</span></div>
<div style="position:absolute;left:108.00px;top:376.54px" class="cls_008"><span class="cls_008">sure that you have followed the instructions in the previous chapter on how to install</span></div>
<div style="position:absolute;left:108.00px;top:389.14px" class="cls_008"><span class="cls_008">Docker for Mac or Docker for Windows on your system.</span></div>
<div style="position:absolute;left:108.00px;top:410.38px" class="cls_008"><span class="cls_008">So, you're ready to see some action. Please type the following command into your</span></div>
<div style="position:absolute;left:108.00px;top:422.98px" class="cls_008"><span class="cls_008">Terminal window and hit return:</span></div>
<div style="position:absolute;left:126.00px;top:443.92px" class="cls_024"><span class="cls_024">$ docker container run alpine echo "Hello World"</span></div>
<div style="position:absolute;left:108.00px;top:463.66px" class="cls_008"><span class="cls_008">When you run the preceding command the first time, you should see an output in</span></div>
<div style="position:absolute;left:108.00px;top:476.26px" class="cls_008"><span class="cls_008">your Terminal window similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:497.20px" class="cls_024"><span class="cls_024">Unable to find image 'alpine:latest' locally</span></div>
<div style="position:absolute;left:126.00px;top:509.44px" class="cls_024"><span class="cls_024">latest: Pulling from library/alpine</span></div>
<div style="position:absolute;left:126.00px;top:521.68px" class="cls_024"><span class="cls_024">2fdfe1cd78c2: Pull complete</span></div>
<div style="position:absolute;left:126.00px;top:533.92px" class="cls_024"><span class="cls_024">Digest: sha256:ccba511b...</span></div>
<div style="position:absolute;left:126.00px;top:546.16px" class="cls_024"><span class="cls_024">Status: Downloaded newer image for alpine:latest</span></div>
<div style="position:absolute;left:126.00px;top:558.40px" class="cls_024"><span class="cls_024">Hello World</span></div>
<div style="position:absolute;left:108.00px;top:578.14px" class="cls_008"><span class="cls_008">Now that was easy! Let's try to run the very same command again:</span></div>
<div style="position:absolute;left:126.00px;top:599.08px" class="cls_024"><span class="cls_024">$ docker container run alpine echo "Hello World"</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 32 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:40902px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background056.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The second, third, or nth time you run the preceding command, you should see only</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">this output in your Terminal:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">Hello World</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">Try to work out why the first time you run a command you see a different output</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">than all the subsequent times. Don't worry if you can't figure it out, we will explain</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">the reasons in detail in the following sections of the chapter.</span></div>
<div style="position:absolute;left:108.00px;top:225.47px" class="cls_011"><span class="cls_011">Starting, stopping, and removing</span></div>
<div style="position:absolute;left:108.00px;top:249.47px" class="cls_011"><span class="cls_011">containers</span></div>
<div style="position:absolute;left:108.00px;top:274.45px" class="cls_008"><span class="cls_008">You have successfully run a container in the previous section. Now we want</span></div>
<div style="position:absolute;left:108.00px;top:287.05px" class="cls_008"><span class="cls_008">to investigate in detail what exactly happened and why. Let's look again at the</span></div>
<div style="position:absolute;left:108.00px;top:299.65px" class="cls_008"><span class="cls_008">command we used:</span></div>
<div style="position:absolute;left:126.00px;top:320.59px" class="cls_024"><span class="cls_024">$ docker container run alpine echo "Hello World"</span></div>
<div style="position:absolute;left:108.00px;top:340.33px" class="cls_008"><span class="cls_008">This command contains multiple parts. First and foremost, we have the word</span></div>
<div style="position:absolute;left:108.00px;top:352.93px" class="cls_010"><span class="cls_010">docker</span><span class="cls_008">. This is the name of the Docker </span><span class="cls_009">command-line interface</span><span class="cls_008"> (</span><span class="cls_009">CLI</span><span class="cls_008">), which we are</span></div>
<div style="position:absolute;left:108.00px;top:365.53px" class="cls_008"><span class="cls_008">using to interact with the Docker engine that is responsible to run containers. Next,</span></div>
<div style="position:absolute;left:108.00px;top:378.13px" class="cls_008"><span class="cls_008">we have the word </span><span class="cls_010">container</span><span class="cls_008">, which indicates the context we are working with. As</span></div>
<div style="position:absolute;left:108.00px;top:390.73px" class="cls_008"><span class="cls_008">we want to run a container, our context is the word </span><span class="cls_010">container</span><span class="cls_008">. Next is the actual</span></div>
<div style="position:absolute;left:108.00px;top:403.33px" class="cls_008"><span class="cls_008">command we want to execute in the given context, which is </span><span class="cls_010">run</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:424.57px" class="cls_008"><span class="cls_008">Let me recap—so far, we have </span><span class="cls_010">docker container run</span><span class="cls_008">, which means, </span><span class="cls_021">Hey Docker,</span></div>
<div style="position:absolute;left:108.00px;top:437.17px" class="cls_021"><span class="cls_021">we want to run a container</span></div>
<div style="position:absolute;left:108.00px;top:458.42px" class="cls_008"><span class="cls_008">Now we also need to tell Docker which container to run. In this case, this is the so-</span></div>
<div style="position:absolute;left:108.00px;top:471.01px" class="cls_008"><span class="cls_008">called </span><span class="cls_010">alpine</span><span class="cls_008"> container. Finally, we need to define what kind of process or task shall</span></div>
<div style="position:absolute;left:108.00px;top:483.61px" class="cls_008"><span class="cls_008">be executed inside the container when it is running. In our case, this is the last part of</span></div>
<div style="position:absolute;left:108.00px;top:496.21px" class="cls_008"><span class="cls_008">the command, </span><span class="cls_010">echo "Hello World"</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:517.46px" class="cls_008"><span class="cls_008">The following figure can help you to get a better approach to the whole thing:</span></div>
<div style="position:absolute;left:220.28px;top:628.83px" class="cls_026"><span class="cls_026">Anatomy of the docker container run expression</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 33 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:41704px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background057.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now that we have understood the various parts of a command to run a container,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">let's try to run another container with a different process running inside it. Type the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">following command into your Terminal:</span></div>
<div style="position:absolute;left:108.00px;top:160.63px" class="cls_024"><span class="cls_024">$ docker container run centos ping -c 5 127.0.0.1</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">You should see output in your Terminal window similar to the following:</span></div>
<div style="position:absolute;left:126.00px;top:201.31px" class="cls_024"><span class="cls_024">Unable to find image 'centos:latest' locally</span></div>
<div style="position:absolute;left:126.00px;top:213.55px" class="cls_024"><span class="cls_024">latest: Pulling from library/centos</span></div>
<div style="position:absolute;left:126.00px;top:225.79px" class="cls_024"><span class="cls_024">85432449fd0f: Pull complete</span></div>
<div style="position:absolute;left:126.00px;top:238.03px" class="cls_024"><span class="cls_024">Digest: sha256:3b1a65e9a05...</span></div>
<div style="position:absolute;left:126.00px;top:250.27px" class="cls_024"><span class="cls_024">Status: Downloaded newer image for centos:latest</span></div>
<div style="position:absolute;left:126.00px;top:262.51px" class="cls_024"><span class="cls_024">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span></div>
<div style="position:absolute;left:126.00px;top:274.75px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.022 ms</span></div>
<div style="position:absolute;left:126.00px;top:286.99px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.019 ms</span></div>
<div style="position:absolute;left:126.00px;top:299.23px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.029 ms</span></div>
<div style="position:absolute;left:126.00px;top:311.47px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.030 ms</span></div>
<div style="position:absolute;left:126.00px;top:323.71px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.029 ms</span></div>
<div style="position:absolute;left:126.00px;top:348.19px" class="cls_024"><span class="cls_024">--- 127.0.0.1 ping statistics ---</span></div>
<div style="position:absolute;left:126.00px;top:360.43px" class="cls_024"><span class="cls_024">5 packets transmitted, 5 received, 0% packet loss, time 4103ms</span></div>
<div style="position:absolute;left:126.00px;top:372.67px" class="cls_024"><span class="cls_024">rtt min/avg/max/mdev = 0.021/0.027/0.029/0.003 ms</span></div>
<div style="position:absolute;left:108.00px;top:392.41px" class="cls_008"><span class="cls_008">What changed is that, this time, the container image we're using is </span><span class="cls_010">centos</span><span class="cls_008"> and the</span></div>
<div style="position:absolute;left:108.00px;top:405.01px" class="cls_008"><span class="cls_008">process we're executing inside the </span><span class="cls_010">centos</span><span class="cls_008"> container is </span><span class="cls_010">ping -c 5 127.0.0.1</span><span class="cls_008">, which</span></div>
<div style="position:absolute;left:108.00px;top:417.61px" class="cls_008"><span class="cls_008">pings the loopback address five times until it stops.</span></div>
<div style="position:absolute;left:108.00px;top:438.86px" class="cls_008"><span class="cls_008">Let's analyze the output in detail:</span></div>
<div style="position:absolute;left:126.00px;top:460.10px" class="cls_008"><span class="cls_008">•  The first line is as follows:</span></div>
<div style="position:absolute;left:144.00px;top:476.71px" class="cls_024"><span class="cls_024">Unable to find image 'centos:latest' locally</span></div>
<div style="position:absolute;left:144.00px;top:496.45px" class="cls_008"><span class="cls_008">This tells us that Docker didn't find an image named </span><span class="cls_010">centos:latest</span><span class="cls_008"> in the</span></div>
<div style="position:absolute;left:144.00px;top:509.05px" class="cls_008"><span class="cls_008">local cache of the system. So, Docker knows that it has to pull the image from</span></div>
<div style="position:absolute;left:144.00px;top:521.65px" class="cls_008"><span class="cls_008">some registry where container images are stored. By default, your Docker</span></div>
<div style="position:absolute;left:144.00px;top:534.25px" class="cls_008"><span class="cls_008">environment is configured such as that images are pulled from the Docker</span></div>
<div style="position:absolute;left:144.00px;top:546.85px" class="cls_008"><span class="cls_008">Hub at </span><span class="cls_010">docker.io</span><span class="cls_008">. This is expressed by the second line, as follows:</span></div>
<div style="position:absolute;left:144.00px;top:567.79px" class="cls_024"><span class="cls_024">latest: Pulling from library/centos</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 34 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:42506px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background058.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•  The next three lines of output are as follows:</span></div>
<div style="position:absolute;left:165.60px;top:131.11px" class="cls_024"><span class="cls_024">85432449fd0f: Pull complete</span></div>
<div style="position:absolute;left:165.60px;top:146.23px" class="cls_024"><span class="cls_024">Digest: sha256:3b1a65e9a05...</span></div>
<div style="position:absolute;left:165.60px;top:161.35px" class="cls_024"><span class="cls_024">Status: Downloaded newer image for centos:latest</span></div>
<div style="position:absolute;left:144.00px;top:181.09px" class="cls_008"><span class="cls_008">This tells us that Docker has successfully pulled the image centos:latest from</span></div>
<div style="position:absolute;left:144.00px;top:193.69px" class="cls_008"><span class="cls_008">the Docker Hub.</span></div>
<div style="position:absolute;left:108.00px;top:214.94px" class="cls_008"><span class="cls_008">All the subsequent lines of the output are generated by the process we ran inside the</span></div>
<div style="position:absolute;left:108.00px;top:227.54px" class="cls_008"><span class="cls_008">container, which is the ping tool in this case. If you have been attentive so far, then</span></div>
<div style="position:absolute;left:108.00px;top:240.13px" class="cls_008"><span class="cls_008">you might have noticed the keyword </span><span class="cls_010">latest</span><span class="cls_008"> occurring a few times. Each image has</span></div>
<div style="position:absolute;left:108.00px;top:252.73px" class="cls_008"><span class="cls_008">a version (also called a tag), and if we don't specify a version explicitly, then Docker</span></div>
<div style="position:absolute;left:108.00px;top:265.33px" class="cls_008"><span class="cls_008">automatically assumes it as latest.</span></div>
<div style="position:absolute;left:108.00px;top:286.58px" class="cls_008"><span class="cls_008">If we run the preceding container again on our system, the first five lines of the</span></div>
<div style="position:absolute;left:108.00px;top:299.18px" class="cls_008"><span class="cls_008">output will be missing since, this time, Docker will find the container image cached</span></div>
<div style="position:absolute;left:108.00px;top:311.78px" class="cls_008"><span class="cls_008">locally and thus won't have to download it first. To verify this, try it out.</span></div>
<div style="position:absolute;left:108.00px;top:341.71px" class="cls_022"><span class="cls_022">Running a random quotes container</span></div>
<div style="position:absolute;left:108.00px;top:364.69px" class="cls_008"><span class="cls_008">For the subsequent sections of this chapter, we need a container that runs</span></div>
<div style="position:absolute;left:108.00px;top:377.29px" class="cls_008"><span class="cls_008">continuously in the background and produces some interesting output. That's</span></div>
<div style="position:absolute;left:108.00px;top:389.89px" class="cls_008"><span class="cls_008">why we have chosen an algorithm that produces random quotes. The API that</span></div>
<div style="position:absolute;left:108.00px;top:402.49px" class="cls_008"><span class="cls_008">produces those free random quotes can be found at </span><A HREF="https://talaikis.com/random_quotes_api/">https://talaikis.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:415.09px" class="cls_010"><span class="cls_010"> </span><A HREF="https://talaikis.com/random_quotes_api/">random_quotes_api/</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:436.34px" class="cls_008"><span class="cls_008">Now the goal is to have a process running inside a container that produces a new</span></div>
<div style="position:absolute;left:108.00px;top:448.94px" class="cls_008"><span class="cls_008">random quote every five seconds and outputs the quote to STDOUT. The following</span></div>
<div style="position:absolute;left:108.00px;top:461.54px" class="cls_008"><span class="cls_008">script will do exactly that:</span></div>
<div style="position:absolute;left:126.00px;top:482.47px" class="cls_023"><span class="cls_023">while :</span></div>
<div style="position:absolute;left:126.00px;top:494.71px" class="cls_023"><span class="cls_023">do</span></div>
<div style="position:absolute;left:147.60px;top:506.95px" class="cls_023"><span class="cls_023">wget -qO- </span><A HREF="https://talaikis.com/api/quotes/random/">https://talaikis.com/api/quotes/random</A> </div>
<div style="position:absolute;left:147.60px;top:519.19px" class="cls_023"><span class="cls_023">printf 'n'</span></div>
<div style="position:absolute;left:147.60px;top:531.43px" class="cls_023"><span class="cls_023">sleep 5</span></div>
<div style="position:absolute;left:126.00px;top:543.67px" class="cls_023"><span class="cls_023">done</span></div>
<div style="position:absolute;left:108.00px;top:563.41px" class="cls_008"><span class="cls_008">Try it in a Terminal window. Stop the script by pressing </span><span class="cls_021">Ctrl</span><span class="cls_008">+ </span><span class="cls_021">C</span><span class="cls_008">. The output should</span></div>
<div style="position:absolute;left:108.00px;top:576.01px" class="cls_008"><span class="cls_008">look similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:596.95px" class="cls_023"><span class="cls_023">{"quote":"Martha Stewart is extremely talented. Her designs are</span></div>
<div style="position:absolute;left:126.00px;top:607.75px" class="cls_023"><span class="cls_023">picture perfect. Our philosophy is life is messy, and rather than</span></div>
<div style="position:absolute;left:126.00px;top:618.55px" class="cls_023"><span class="cls_023">being afraid of those messes we design products that work the way we</span></div>
<div style="position:absolute;left:126.00px;top:629.35px" class="cls_023"><span class="cls_023">live.","author":"Kathy Ireland","cat":"design"}</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 35 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:43308px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background059.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:126.00px;top:114.01px" class="cls_023"><span class="cls_023">{"quote":"We can reach our potential, but to do so, we must</span></div>
<div style="position:absolute;left:126.00px;top:124.81px" class="cls_023"><span class="cls_023">reach within ourselves. We must summon the strength, the will,</span></div>
<div style="position:absolute;left:126.00px;top:135.61px" class="cls_023"><span class="cls_023">and the faith to move forward - to be bold - to invest in our</span></div>
<div style="position:absolute;left:126.00px;top:146.41px" class="cls_023"><span class="cls_023">future.","author":"John Hoeven","cat":"faith"}</span></div>
<div style="position:absolute;left:108.00px;top:166.14px" class="cls_008"><span class="cls_008">Each response is a JSON-formatted string with the quote, its author, and its category.</span></div>
<div style="position:absolute;left:108.00px;top:187.38px" class="cls_008"><span class="cls_008">Now, let's run this in an </span><span class="cls_010">alpine</span><span class="cls_008"> container as a daemon in the background. For this,</span></div>
<div style="position:absolute;left:108.00px;top:199.98px" class="cls_008"><span class="cls_008">we need to compact the preceding script into a one-liner and execute it using the </span><span class="cls_010">/</span></div>
<div style="position:absolute;left:108.00px;top:212.58px" class="cls_010"><span class="cls_010">bin/sh -c "..."</span><span class="cls_008"> syntax. Our Docker expression will look as follows :</span></div>
<div style="position:absolute;left:126.00px;top:233.52px" class="cls_024"><span class="cls_024">$ docker container run -d --name quotes alpine \</span></div>
<div style="position:absolute;left:142.20px;top:245.76px" class="cls_024"><span class="cls_024">/bin/sh -c "while :; do wget -qO- </span><A HREF="https://talaikis.com/api/quotes/">https://talaikis.com/api/quotes/</A> </div>
<div style="position:absolute;left:126.00px;top:256.56px" class="cls_024"><span class="cls_024">random; printf '\n'; sleep 5; done"</span></div>
<div style="position:absolute;left:108.00px;top:276.30px" class="cls_008"><span class="cls_008">In the preceding expression, we have used two new command-line parameters,</span></div>
<div style="position:absolute;left:108.00px;top:288.90px" class="cls_010"><span class="cls_010">-d</span><span class="cls_008"> and </span><span class="cls_010">--name</span><span class="cls_008">. The </span><span class="cls_010">-d</span><span class="cls_008"> tells Docker to run the process running in the container as</span></div>
<div style="position:absolute;left:108.00px;top:301.50px" class="cls_008"><span class="cls_008">a Linux daemon. The </span><span class="cls_010">--name</span><span class="cls_008"> parameter in turn can be used to give the container</span></div>
<div style="position:absolute;left:108.01px;top:314.10px" class="cls_008"><span class="cls_008">an explicit name. In the preceding sample, the name we chose is </span><span class="cls_010">quotes</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:335.34px" class="cls_008"><span class="cls_008">If we don't specify an explicit container name when we run a container, then Docker</span></div>
<div style="position:absolute;left:108.00px;top:347.94px" class="cls_008"><span class="cls_008">will automatically assign the container a random but unique name. This name will be</span></div>
<div style="position:absolute;left:108.00px;top:360.54px" class="cls_008"><span class="cls_008">composed of the name of a famous scientist and and adjective. Such names could be</span></div>
<div style="position:absolute;left:108.00px;top:373.14px" class="cls_010"><span class="cls_010">boring_borg</span><span class="cls_008"> or </span><span class="cls_010">angry_goldberg</span><span class="cls_008">. Quite humorous our Docker engineers, </span><span class="cls_021">isn't it?</span></div>
<div style="position:absolute;left:108.00px;top:394.38px" class="cls_008"><span class="cls_008">One important takeaway is that the container name has to be unique on the system.</span></div>
<div style="position:absolute;left:108.00px;top:406.98px" class="cls_008"><span class="cls_008">Let's make sure that the quotes container is up and running:</span></div>
<div style="position:absolute;left:126.00px;top:427.92px" class="cls_024"><span class="cls_024">$ docker container ls -l</span></div>
<div style="position:absolute;left:108.00px;top:447.66px" class="cls_008"><span class="cls_008">This should give us something like this:</span></div>
<div style="position:absolute;left:255.06px;top:509.51px" class="cls_026"><span class="cls_026">Listing the last run container</span></div>
<div style="position:absolute;left:108.00px;top:528.25px" class="cls_008"><span class="cls_008">The important part of the preceding output is the </span><span class="cls_010">STATUS</span><span class="cls_008"> column, which in</span></div>
<div style="position:absolute;left:108.00px;top:540.85px" class="cls_008"><span class="cls_008">this case is </span><span class="cls_010">Up 16 seconds</span><span class="cls_008">. That is, the container has been up and running</span></div>
<div style="position:absolute;left:108.00px;top:553.45px" class="cls_008"><span class="cls_008">for 16 seconds now.</span></div>
<div style="position:absolute;left:108.00px;top:574.69px" class="cls_008"><span class="cls_008">Don't worry if the last Docker command is not yet familiar to you, we will come back</span></div>
<div style="position:absolute;left:108.00px;top:587.29px" class="cls_008"><span class="cls_008">to it in the next section.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 36 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:44110px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background060.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Listing containers</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">As we continue to run containers over time, we get a lot of them in our system.</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">To find out what is currently-running on our host, we can use the container </span><span class="cls_010">list</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">command as follows:</span></div>
<div style="position:absolute;left:126.00px;top:181.58px" class="cls_024"><span class="cls_024">$ docker container ls</span></div>
<div style="position:absolute;left:108.00px;top:201.32px" class="cls_008"><span class="cls_008">This will list all currently-running containers. Such a list might look similar to this:</span></div>
<div style="position:absolute;left:229.48px;top:273.26px" class="cls_026"><span class="cls_026">List of all containers running on the system</span></div>
<div style="position:absolute;left:108.00px;top:292.00px" class="cls_008"><span class="cls_008">By default, Docker outputs seven columns with the following meanings:</span></div>
<div style="position:absolute;left:114.64px;top:321.11px" class="cls_027"><span class="cls_027">Column</span></div>
<div style="position:absolute;left:202.04px;top:321.11px" class="cls_027"><span class="cls_027">Description</span></div>
<div style="position:absolute;left:114.64px;top:335.54px" class="cls_010"><span class="cls_010">Container ID</span></div>
<div style="position:absolute;left:202.04px;top:336.01px" class="cls_025"><span class="cls_025">The unique ID of the container. It is a SHA-256.</span></div>
<div style="position:absolute;left:202.04px;top:350.92px" class="cls_025"><span class="cls_025">The name of the container image from which this container is</span></div>
<div style="position:absolute;left:114.64px;top:356.15px" class="cls_010"><span class="cls_010">Image</span></div>
<div style="position:absolute;left:202.04px;top:362.32px" class="cls_025"><span class="cls_025">instantiated.</span></div>
<div style="position:absolute;left:114.64px;top:376.75px" class="cls_010"><span class="cls_010">Command</span></div>
<div style="position:absolute;left:202.04px;top:377.23px" class="cls_025"><span class="cls_025">The command that is used to run the main process in the container.</span></div>
<div style="position:absolute;left:114.64px;top:391.66px" class="cls_010"><span class="cls_010">Created</span></div>
<div style="position:absolute;left:202.04px;top:392.13px" class="cls_025"><span class="cls_025">The date and time when the container was created.</span></div>
<div style="position:absolute;left:202.04px;top:407.04px" class="cls_025"><span class="cls_025">The status of the container (created, restarting, running, removing,</span></div>
<div style="position:absolute;left:114.64px;top:412.26px" class="cls_010"><span class="cls_010">Status</span></div>
<div style="position:absolute;left:202.04px;top:418.44px" class="cls_025"><span class="cls_025">paused, exited, or dead).</span></div>
<div style="position:absolute;left:114.64px;top:432.87px" class="cls_010"><span class="cls_010">Ports</span></div>
<div style="position:absolute;left:202.04px;top:433.34px" class="cls_025"><span class="cls_025">The list of container ports that have been mapped to the host.</span></div>
<div style="position:absolute;left:114.64px;top:447.77px" class="cls_010"><span class="cls_010">Names</span></div>
<div style="position:absolute;left:202.04px;top:448.25px" class="cls_025"><span class="cls_025">The name assigned to this container (multiple names are possible).</span></div>
<div style="position:absolute;left:108.00px;top:473.07px" class="cls_008"><span class="cls_008">If we want to list not only the currently running containers but all containers that</span></div>
<div style="position:absolute;left:108.00px;top:485.67px" class="cls_008"><span class="cls_008">are defined on our system, then we can use the command-line parameter </span><span class="cls_010">-a</span><span class="cls_008"> or </span><span class="cls_010">--all</span></div>
<div style="position:absolute;left:108.00px;top:498.27px" class="cls_008"><span class="cls_008">as follows:</span></div>
<div style="position:absolute;left:126.00px;top:519.21px" class="cls_024"><span class="cls_024">$ docker container ls -a</span></div>
<div style="position:absolute;left:108.00px;top:538.95px" class="cls_008"><span class="cls_008">This will list containers in any state, such as </span><span class="cls_010">created</span><span class="cls_008">, </span><span class="cls_010">running</span><span class="cls_008">, or </span><span class="cls_010">exited</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:560.19px" class="cls_008"><span class="cls_008">Sometimes, we want to just list the IDs of all containers. For this, we have the</span></div>
<div style="position:absolute;left:108.00px;top:572.79px" class="cls_008"><span class="cls_008">parameter </span><span class="cls_010">-q</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:593.73px" class="cls_024"><span class="cls_024">$ docker container ls -q</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 37 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:44912px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background061.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">You might wonder where this is useful.  The following command demonstrates</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">where it can be very helpful:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker container rm -f $(docker container ls -a -q)</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">Lean back and take a deep breath. Then, try to find out what the preceding command</span></div>
<div style="position:absolute;left:107.98px;top:180.37px" class="cls_008"><span class="cls_008">does. Don't read any further until you find the answer or give up.</span></div>
<div style="position:absolute;left:107.98px;top:201.62px" class="cls_008"><span class="cls_008">Right: the preceding command deletes all containers that are currently defined on</span></div>
<div style="position:absolute;left:107.98px;top:214.21px" class="cls_008"><span class="cls_008">the system, including the stopped ones. The </span><span class="cls_010">rm</span><span class="cls_008"> command stands for remove, and it</span></div>
<div style="position:absolute;left:108.00px;top:226.81px" class="cls_008"><span class="cls_008">will be explained further down.</span></div>
<div style="position:absolute;left:108.00px;top:248.05px" class="cls_008"><span class="cls_008">In the previous section, we used the parameter </span><span class="cls_010">-l</span><span class="cls_008"> in the list command. Try to use</span></div>
<div style="position:absolute;left:108.00px;top:260.65px" class="cls_008"><span class="cls_008">Docker help to find out what the </span><span class="cls_010">-l</span><span class="cls_008"> parameter stands for. You can invoke help for</span></div>
<div style="position:absolute;left:108.00px;top:273.25px" class="cls_008"><span class="cls_008">the list command as follows:</span></div>
<div style="position:absolute;left:126.00px;top:294.19px" class="cls_024"><span class="cls_024">$ docker container ls -h</span></div>
<div style="position:absolute;left:108.00px;top:322.63px" class="cls_022"><span class="cls_022">Stopping and starting containers</span></div>
<div style="position:absolute;left:108.00px;top:345.61px" class="cls_008"><span class="cls_008">Sometimes, we want to (temporarily) stop a running container. Let's try this</span></div>
<div style="position:absolute;left:108.00px;top:358.21px" class="cls_008"><span class="cls_008">out with the quotes container we used previously. Run the container again</span></div>
<div style="position:absolute;left:108.00px;top:370.81px" class="cls_008"><span class="cls_008">with this command:</span></div>
<div style="position:absolute;left:126.00px;top:391.75px" class="cls_024"><span class="cls_024">$ docker container run -d --name quotes alpine \</span></div>
<div style="position:absolute;left:142.20px;top:403.99px" class="cls_024"><span class="cls_024">/bin/sh -c "while :; do wget -qO- </span><A HREF="https://talaikis.com/api/quotes/">https://talaikis.com/api/quotes/</A> </div>
<div style="position:absolute;left:126.00px;top:414.79px" class="cls_024"><span class="cls_024">random; printf '\n'; sleep 5; done"</span></div>
<div style="position:absolute;left:108.00px;top:434.53px" class="cls_008"><span class="cls_008">Now, if we want to stop this container then we can do so by issuing this command:</span></div>
<div style="position:absolute;left:126.00px;top:455.47px" class="cls_024"><span class="cls_024">$ docker container stop quotes</span></div>
<div style="position:absolute;left:108.00px;top:475.21px" class="cls_008"><span class="cls_008">When you try to stop the quotes container, you will probably note that it takes a</span></div>
<div style="position:absolute;left:108.00px;top:487.81px" class="cls_008"><span class="cls_008">while for this command to be executed. To be precise, it takes about 10 seconds.</span></div>
<div style="position:absolute;left:108.00px;top:500.41px" class="cls_021"><span class="cls_021">Why is this the case?</span></div>
<div style="position:absolute;left:108.00px;top:521.65px" class="cls_008"><span class="cls_008">Docker sends a Linux </span><span class="cls_010">SIGTERM</span><span class="cls_008"> signal to the main process running inside the</span></div>
<div style="position:absolute;left:108.00px;top:534.25px" class="cls_008"><span class="cls_008">container. If the process doesn't react to this signal and terminate itself, Docker</span></div>
<div style="position:absolute;left:108.00px;top:546.85px" class="cls_008"><span class="cls_008">waits for 10 seconds and then sends </span><span class="cls_010">SIGKILL</span><span class="cls_008">, which will kill the process forcefully</span></div>
<div style="position:absolute;left:108.00px;top:559.45px" class="cls_008"><span class="cls_008">and terminate the container.</span></div>
<div style="position:absolute;left:108.00px;top:580.70px" class="cls_008"><span class="cls_008">In the preceding command, we have used the name of the container to specify which</span></div>
<div style="position:absolute;left:108.00px;top:593.30px" class="cls_008"><span class="cls_008">container we want to stop. But we could also have used the container ID instead.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 38 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:45714px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background062.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_021"><span class="cls_021">How do we get the ID of a container?</span><span class="cls_008"> There are several ways of doing so. The manual</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">approach is to list all running containers and find the one that we're looking for</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">in the list. From there, we copy its ID. A more automated way is to use some shell</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">scripting and environment variables. If, for example, we want to get the ID of the</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">quotes container, we can use this expression:</span></div>
<div style="position:absolute;left:126.00px;top:185.83px" class="cls_024"><span class="cls_024">$ export CONTAINER_ID=$(docker container ls | grep quotes | awk</span></div>
<div style="position:absolute;left:126.00px;top:196.63px" class="cls_024"><span class="cls_024">'{print $1}')</span></div>
<div style="position:absolute;left:108.00px;top:216.37px" class="cls_008"><span class="cls_008">Now, instead of using the container name, we can use the variable </span><span class="cls_010">$CONTAINER_ID</span><span class="cls_008"> in</span></div>
<div style="position:absolute;left:108.00px;top:228.97px" class="cls_008"><span class="cls_008">our expression:</span></div>
<div style="position:absolute;left:126.00px;top:249.91px" class="cls_024"><span class="cls_024">$ docker container stop $CONTAINER_ID</span></div>
<div style="position:absolute;left:108.00px;top:269.65px" class="cls_008"><span class="cls_008">Once we have stopped the container, its status changes to </span><span class="cls_010">Exited</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:290.89px" class="cls_008"><span class="cls_008">If a container is stopped, it can be started again using the </span><span class="cls_010">docker container start</span></div>
<div style="position:absolute;left:108.00px;top:303.49px" class="cls_008"><span class="cls_008">command. Let's do this with our quotes container. It is good to have it running again,</span></div>
<div style="position:absolute;left:108.00px;top:316.09px" class="cls_008"><span class="cls_008">as we'll need it in the subsequent sections of this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:337.03px" class="cls_024"><span class="cls_024">$ docker container start quotes</span></div>
<div style="position:absolute;left:108.00px;top:365.47px" class="cls_022"><span class="cls_022">Removing containers</span></div>
<div style="position:absolute;left:108.00px;top:388.45px" class="cls_008"><span class="cls_008">When we run the </span><span class="cls_010">docker container ls -a</span><span class="cls_008"> command, we can see quite a few</span></div>
<div style="position:absolute;left:108.00px;top:401.05px" class="cls_008"><span class="cls_008">containers that are in </span><span class="cls_010">Exited</span><span class="cls_008"> status. If we don't need these containers anymore,</span></div>
<div style="position:absolute;left:108.00px;top:413.65px" class="cls_008"><span class="cls_008">then it is a good thing to remove them from memory, otherwise they unnecessarily</span></div>
<div style="position:absolute;left:108.00px;top:426.25px" class="cls_008"><span class="cls_008">occupy precious resources. The command to remove a container is:</span></div>
<div style="position:absolute;left:126.00px;top:447.19px" class="cls_024"><span class="cls_024">$ docker container rm &lt;container ID></span></div>
<div style="position:absolute;left:108.00px;top:466.93px" class="cls_008"><span class="cls_008">Another command to remove a container is:</span></div>
<div style="position:absolute;left:126.00px;top:487.87px" class="cls_024"><span class="cls_024">$ docker container rm &lt;container name></span></div>
<div style="position:absolute;left:108.00px;top:507.61px" class="cls_008"><span class="cls_008">Try to remove one of your exited containers using its ID.</span></div>
<div style="position:absolute;left:108.00px;top:528.86px" class="cls_008"><span class="cls_008">Sometimes, removing a container will not work as it is still running. If we want to</span></div>
<div style="position:absolute;left:108.00px;top:541.46px" class="cls_008"><span class="cls_008">force a removal, no matter what the condition of the container currently is, we can</span></div>
<div style="position:absolute;left:108.00px;top:554.05px" class="cls_008"><span class="cls_008">use the command-line parameter </span><span class="cls_010">-f</span><span class="cls_008"> or </span><span class="cls_010">--force</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 39 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:46516px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background063.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Inspecting containers</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Containers are runtime instances of an image and have a lot of associated data that</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">characterizes their behavior. To get more information about a specific container, we</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">can use the </span><span class="cls_010">inspect</span><span class="cls_008"> command. As usual, we have to provide either the container</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">ID or name to identify the container of which we want to obtain the data. So, let's</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">inspect our sample container:</span></div>
<div style="position:absolute;left:126.00px;top:208.24px" class="cls_024"><span class="cls_024">$ docker container inspect quotes</span></div>
<div style="position:absolute;left:108.00px;top:227.98px" class="cls_008"><span class="cls_008">The response is a big JSON object full of details. It looks similar to this:</span></div>
<div style="position:absolute;left:147.60px;top:248.92px" class="cls_023"><span class="cls_023">[</span></div>
<div style="position:absolute;left:169.20px;top:261.16px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:190.80px;top:273.40px" class="cls_023"><span class="cls_023">"Id": "c5c1c68c87...",</span></div>
<div style="position:absolute;left:190.80px;top:285.64px" class="cls_023"><span class="cls_023">"Created": "2017-12-30T11:55:51.223271182Z",</span></div>
<div style="position:absolute;left:190.80px;top:297.88px" class="cls_023"><span class="cls_023">"Path": "/bin/sh",</span></div>
<div style="position:absolute;left:190.80px;top:310.12px" class="cls_023"><span class="cls_023">"Args": [</span></div>
<div style="position:absolute;left:212.40px;top:322.36px" class="cls_023"><span class="cls_023">"-c",</span></div>
<div style="position:absolute;left:212.40px;top:334.60px" class="cls_023"><span class="cls_023">"while :; do wget -qO- </span><A HREF="https://talaikis.com/api/">https://talaikis.com/api/</A> </div>
<div style="position:absolute;left:126.00px;top:345.40px" class="cls_023"><span class="cls_023">quotes/random; printf '\n'; sleep 5; done"</span></div>
<div style="position:absolute;left:190.80px;top:357.64px" class="cls_023"><span class="cls_023">],</span></div>
<div style="position:absolute;left:190.80px;top:369.88px" class="cls_023"><span class="cls_023">"State": {</span></div>
<div style="position:absolute;left:212.40px;top:382.12px" class="cls_023"><span class="cls_023">"Status": "running",</span></div>
<div style="position:absolute;left:212.40px;top:394.36px" class="cls_023"><span class="cls_023">"Running": true,</span></div>
<div style="position:absolute;left:190.80px;top:418.84px" class="cls_023"><span class="cls_023">},</span></div>
<div style="position:absolute;left:190.80px;top:431.08px" class="cls_023"><span class="cls_023">"Image": "sha256:e21c333399e0...",</span></div>
<div style="position:absolute;left:190.80px;top:455.56px" class="cls_023"><span class="cls_023">"Mounts": [],</span></div>
<div style="position:absolute;left:190.80px;top:467.80px" class="cls_023"><span class="cls_023">"Config": {</span></div>
<div style="position:absolute;left:212.40px;top:480.04px" class="cls_023"><span class="cls_023">"Hostname": "c5c1c68c87dd",</span></div>
<div style="position:absolute;left:212.40px;top:492.28px" class="cls_023"><span class="cls_023">"Domainname": "",</span></div>
<div style="position:absolute;left:190.80px;top:516.76px" class="cls_023"><span class="cls_023">},</span></div>
<div style="position:absolute;left:190.80px;top:529.00px" class="cls_023"><span class="cls_023">"NetworkSettings": {</span></div>
<div style="position:absolute;left:212.40px;top:541.24px" class="cls_023"><span class="cls_023">"Bridge": "",</span></div>
<div style="position:absolute;left:212.40px;top:553.48px" class="cls_023"><span class="cls_023">"SandboxID": "2fd6c43b6fe5...",</span></div>
<div style="position:absolute;left:190.80px;top:577.96px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:169.20px;top:590.20px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:147.60px;top:602.44px" class="cls_023"><span class="cls_023">]</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 40 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:47318px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background064.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The output has been shortened for readability.</span></div>
<div style="position:absolute;left:108.00px;top:135.74px" class="cls_008"><span class="cls_008">Please take a moment to analyze what you got. You should see information such as:</span></div>
<div style="position:absolute;left:126.00px;top:156.98px" class="cls_008"><span class="cls_008">•  The ID of the container</span></div>
<div style="position:absolute;left:126.00px;top:173.89px" class="cls_008"><span class="cls_008">•  The creation date and time of the container</span></div>
<div style="position:absolute;left:126.00px;top:190.81px" class="cls_008"><span class="cls_008">•  From which image the container is built and so on</span></div>
<div style="position:absolute;left:107.99px;top:212.05px" class="cls_008"><span class="cls_008">Many sections of the output, such as </span><span class="cls_010">Mounts</span><span class="cls_008"> or </span><span class="cls_010">NetworkSettings</span><span class="cls_008"> don't make much</span></div>
<div style="position:absolute;left:108.00px;top:224.65px" class="cls_008"><span class="cls_008">sense right now, but we will certainly discuss those in the upcoming chapters of the</span></div>
<div style="position:absolute;left:108.00px;top:237.25px" class="cls_008"><span class="cls_008">book. The data you're seeing here is also named the </span><span class="cls_009">metadata</span><span class="cls_008"> of a container. We will</span></div>
<div style="position:absolute;left:108.00px;top:249.85px" class="cls_008"><span class="cls_008">be using the </span><span class="cls_010">inspect</span><span class="cls_008"> command quite often in the remainder of the book as a source</span></div>
<div style="position:absolute;left:108.00px;top:262.45px" class="cls_008"><span class="cls_008">of information.</span></div>
<div style="position:absolute;left:108.00px;top:283.70px" class="cls_008"><span class="cls_008">Sometimes, we need just a tiny bit of the overall information, and to achieve this, we</span></div>
<div style="position:absolute;left:108.00px;top:296.30px" class="cls_008"><span class="cls_008">can either use the </span><span class="cls_009">grep tool</span><span class="cls_008"> or a </span><span class="cls_009">filter</span><span class="cls_008">. The former method does not always result in</span></div>
<div style="position:absolute;left:108.00px;top:308.90px" class="cls_008"><span class="cls_008">the expected answer, so let's look into the latter approach:</span></div>
<div style="position:absolute;left:126.00px;top:329.83px" class="cls_024"><span class="cls_024">$ docker container inspect -f "{{json .State}}" quotes | jq</span></div>
<div style="position:absolute;left:108.00px;top:349.57px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">-f</span><span class="cls_008"> or </span><span class="cls_010">--filter</span><span class="cls_008"> parameter is used to define the filter. The filter expression itself</span></div>
<div style="position:absolute;left:108.00px;top:362.17px" class="cls_008"><span class="cls_008">uses the </span><span class="cls_009">Go template</span><span class="cls_008"> syntax. In this example, we only want to see the state part of</span></div>
<div style="position:absolute;left:108.00px;top:374.77px" class="cls_008"><span class="cls_008">the whole output in the JSON format.</span></div>
<div style="position:absolute;left:108.00px;top:396.02px" class="cls_008"><span class="cls_008">To nicely format the output, we pipe the result into the jq tool:</span></div>
<div style="position:absolute;left:129.60px;top:416.95px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:140.40px;top:432.07px" class="cls_024"><span class="cls_024">"Status": "running",</span></div>
<div style="position:absolute;left:140.40px;top:447.19px" class="cls_024"><span class="cls_024">"Running": true,</span></div>
<div style="position:absolute;left:140.40px;top:462.31px" class="cls_024"><span class="cls_024">"Paused": false,</span></div>
<div style="position:absolute;left:140.40px;top:477.43px" class="cls_024"><span class="cls_024">"Restarting": false,</span></div>
<div style="position:absolute;left:140.40px;top:492.55px" class="cls_024"><span class="cls_024">"OOMKilled": false,</span></div>
<div style="position:absolute;left:140.40px;top:507.67px" class="cls_024"><span class="cls_024">"Dead": false,</span></div>
<div style="position:absolute;left:140.40px;top:522.79px" class="cls_024"><span class="cls_024">"Pid": 6759,</span></div>
<div style="position:absolute;left:140.40px;top:537.91px" class="cls_024"><span class="cls_024">"ExitCode": 0,</span></div>
<div style="position:absolute;left:140.40px;top:553.03px" class="cls_024"><span class="cls_024">"Error": "",</span></div>
<div style="position:absolute;left:140.40px;top:568.15px" class="cls_024"><span class="cls_024">"StartedAt": "2017-12-31T10:31:51.893299997Z",</span></div>
<div style="position:absolute;left:140.40px;top:583.27px" class="cls_024"><span class="cls_024">"FinishedAt": "0001-01-01T00:00:00Z"</span></div>
<div style="position:absolute;left:129.60px;top:598.39px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 41 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:48120px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background065.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Exec into a running container</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Sometimes, we want to run another process inside an already-running container. A</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">typical reason could be to try to debug a misbehaving container. </span><span class="cls_021">How can we do this?</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">First, we need to know either the ID or the name of the container, and then we can</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">define which process we want to run and how we want it to run. Once again, we use</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">our currently-running quotes container and we run a shell interactively inside it with</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">the following command:</span></div>
<div style="position:absolute;left:126.00px;top:220.84px" class="cls_024"><span class="cls_024">$ docker container exec -i -t quotes /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:240.58px" class="cls_008"><span class="cls_008">The flag </span><span class="cls_010">-i</span><span class="cls_008"> signifies that we want to run the additional process interactively, and</span></div>
<div style="position:absolute;left:108.00px;top:253.18px" class="cls_010"><span class="cls_010">-t</span><span class="cls_008"> tells Docker that we want it to provide us with a TTY (a terminal emulator) for</span></div>
<div style="position:absolute;left:108.00px;top:265.78px" class="cls_008"><span class="cls_008">the command. Finally, the process we run is </span><span class="cls_010">/bin/sh</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:287.02px" class="cls_008"><span class="cls_008">If we execute the preceding command in our Terminal, then we will be presented</span></div>
<div style="position:absolute;left:108.00px;top:299.62px" class="cls_008"><span class="cls_008">with a new prompt. We're now in a shell inside the quotes container. We can easily</span></div>
<div style="position:absolute;left:108.00px;top:312.22px" class="cls_008"><span class="cls_008">prove that by, for example, executing the </span><span class="cls_010">ps</span><span class="cls_008"> command, which will list all running</span></div>
<div style="position:absolute;left:108.00px;top:324.82px" class="cls_008"><span class="cls_008">processes in the context:</span></div>
<div style="position:absolute;left:126.00px;top:345.76px" class="cls_024"><span class="cls_024"># / ps</span></div>
<div style="position:absolute;left:108.00px;top:365.50px" class="cls_008"><span class="cls_008">The result should look somewhat similar to this:</span></div>
<div style="position:absolute;left:211.99px;top:467.95px" class="cls_026"><span class="cls_026">List of Processes running inside the quotes Container</span></div>
<div style="position:absolute;left:108.00px;top:486.69px" class="cls_008"><span class="cls_008">We can clearly see that the process with </span><span class="cls_010">PID 1</span><span class="cls_008"> is the command that we have</span></div>
<div style="position:absolute;left:108.00px;top:499.29px" class="cls_008"><span class="cls_008">defined to run inside the quotes container. The process with </span><span class="cls_010">PID 1</span><span class="cls_008"> is also named</span></div>
<div style="position:absolute;left:108.00px;top:511.89px" class="cls_008"><span class="cls_008">the main process.</span></div>
<div style="position:absolute;left:108.00px;top:533.13px" class="cls_008"><span class="cls_008">Leave the container by entering </span><span class="cls_010">exit</span><span class="cls_008"> at the prompt. We cannot only execute additional</span></div>
<div style="position:absolute;left:108.00px;top:545.73px" class="cls_008"><span class="cls_008">processes interactive in a container. Please consider the following command:</span></div>
<div style="position:absolute;left:126.00px;top:566.67px" class="cls_024"><span class="cls_024">$ docker container exec quotes ps</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 42 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:48922px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background066.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The output evidently looks very similar to the preceding output:</span></div>
<div style="position:absolute;left:211.99px;top:217.49px" class="cls_026"><span class="cls_026">List of Processes running inside the quotes Container</span></div>
<div style="position:absolute;left:108.00px;top:236.23px" class="cls_008"><span class="cls_008">We can even run processes as daemon using the flag </span><span class="cls_010">-d</span><span class="cls_008"> and define environment</span></div>
<div style="position:absolute;left:108.00px;top:248.83px" class="cls_008"><span class="cls_008">variables using the </span><span class="cls_010">-e</span><span class="cls_008"> flag variables as follows:</span></div>
<div style="position:absolute;left:126.00px;top:269.77px" class="cls_024"><span class="cls_024">$ docker container exec -it \</span></div>
<div style="position:absolute;left:147.60px;top:282.01px" class="cls_024"><span class="cls_024">-e MY_VAR="Hello World" \</span></div>
<div style="position:absolute;left:147.60px;top:294.25px" class="cls_024"><span class="cls_024">quotes /bin/sh</span></div>
<div style="position:absolute;left:126.00px;top:306.49px" class="cls_024"><span class="cls_024"># / echo $MY_VAR</span></div>
<div style="position:absolute;left:126.00px;top:318.73px" class="cls_024"><span class="cls_024">Hello World</span></div>
<div style="position:absolute;left:126.00px;top:330.97px" class="cls_024"><span class="cls_024"># / exit</span></div>
<div style="position:absolute;left:108.00px;top:361.97px" class="cls_011"><span class="cls_011">Attaching to a running container</span></div>
<div style="position:absolute;left:108.00px;top:386.95px" class="cls_008"><span class="cls_008">We can use the </span><span class="cls_010">attach</span><span class="cls_008"> command to attach our Terminal's standard input, output,</span></div>
<div style="position:absolute;left:108.00px;top:399.55px" class="cls_008"><span class="cls_008">and error (or any combination of the three) to a running container using the ID or</span></div>
<div style="position:absolute;left:108.00px;top:412.15px" class="cls_008"><span class="cls_008">name of the container. Let's do this for our quotes container:</span></div>
<div style="position:absolute;left:126.00px;top:433.09px" class="cls_024"><span class="cls_024">$ docker container attach quotes</span></div>
<div style="position:absolute;left:108.00px;top:452.83px" class="cls_008"><span class="cls_008">In this case, we will see every five seconds or so a new quote appearing in</span></div>
<div style="position:absolute;left:108.00px;top:465.43px" class="cls_008"><span class="cls_008">the output.</span></div>
<div style="position:absolute;left:108.00px;top:486.67px" class="cls_008"><span class="cls_008">To quit the container without stopping or killing it, we can press the key combination</span></div>
<div style="position:absolute;left:108.00px;top:499.27px" class="cls_021"><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">P</span><span class="cls_008"> </span><span class="cls_021">Ctrl</span><span class="cls_008">+ </span><span class="cls_021">Q</span><span class="cls_008">. This detaches us from the container while leaving it running in the</span></div>
<div style="position:absolute;left:108.00px;top:511.87px" class="cls_008"><span class="cls_008">background. On the other hand, if we want to detach and stop the container at the</span></div>
<div style="position:absolute;left:108.00px;top:524.47px" class="cls_008"><span class="cls_008">same time, we can just press </span><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">C</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:545.71px" class="cls_008"><span class="cls_008">Let's run another container, this time an Nginx web server:</span></div>
<div style="position:absolute;left:126.00px;top:566.65px" class="cls_024"><span class="cls_024">$ docker run -d --name nginx -p 8080:80 nginx:alpine</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 43 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:49724px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background067.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Here, we run the Alpine version of Nginx as a daemon in a container named</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">nginx</span><span class="cls_008">. The </span><span class="cls_010">-p 8080:80</span><span class="cls_008"> command-line parameter opens port </span><span class="cls_010">8080</span><span class="cls_008"> on the host for</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">access to the Nginx web server running inside the container. Don't worry about</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the syntax here as we will explain this feature in more detail in the </span><span class="cls_021">Chapter 7</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_021"><span class="cls_021">Single-Host Networking</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:186.13px" class="cls_008"><span class="cls_008">Let's see whether we can access Nginx, using the </span><span class="cls_010">curl</span><span class="cls_008"> tool and running</span></div>
<div style="position:absolute;left:108.00px;top:198.73px" class="cls_008"><span class="cls_008">this command:</span></div>
<div style="position:absolute;left:126.00px;top:219.67px" class="cls_024"><span class="cls_024">$ curl -4 localhost:8080</span></div>
<div style="position:absolute;left:108.00px;top:239.41px" class="cls_008"><span class="cls_008">If all works correctly, you should be greeted by the welcome page of Nginx:</span></div>
<div style="position:absolute;left:126.00px;top:260.35px" class="cls_023"><span class="cls_023">&lt;html></span></div>
<div style="position:absolute;left:126.00px;top:272.59px" class="cls_023"><span class="cls_023">&lt;head></span></div>
<div style="position:absolute;left:126.00px;top:284.83px" class="cls_023"><span class="cls_023">&lt;title>Welcome to nginx!&lt;/title></span></div>
<div style="position:absolute;left:126.00px;top:297.07px" class="cls_023"><span class="cls_023">&lt;style></span></div>
<div style="position:absolute;left:147.60px;top:309.31px" class="cls_023"><span class="cls_023">body {</span></div>
<div style="position:absolute;left:169.20px;top:321.55px" class="cls_023"><span class="cls_023">width: 35em;</span></div>
<div style="position:absolute;left:169.20px;top:333.79px" class="cls_023"><span class="cls_023">margin: 0 auto;</span></div>
<div style="position:absolute;left:169.20px;top:346.03px" class="cls_023"><span class="cls_023">font-family: Tahoma, Verdana, Arial, sans-serif;</span></div>
<div style="position:absolute;left:147.60px;top:358.27px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:126.00px;top:370.51px" class="cls_023"><span class="cls_023">&lt;/style></span></div>
<div style="position:absolute;left:126.00px;top:382.75px" class="cls_023"><span class="cls_023">&lt;/head></span></div>
<div style="position:absolute;left:126.00px;top:394.99px" class="cls_023"><span class="cls_023">&lt;body></span></div>
<div style="position:absolute;left:126.00px;top:407.23px" class="cls_023"><span class="cls_023">&lt;h1>Welcome to nginx!&lt;/h1></span></div>
<div style="position:absolute;left:126.00px;top:419.47px" class="cls_023"><span class="cls_023">&lt;p>If you see this page, the nginx web server is successfully</span></div>
<div style="position:absolute;left:126.00px;top:430.27px" class="cls_023"><span class="cls_023">installed and</span></div>
<div style="position:absolute;left:126.00px;top:442.51px" class="cls_023"><span class="cls_023">working. Further configuration is required.&lt;/p></span></div>
<div style="position:absolute;left:126.00px;top:466.99px" class="cls_023"><span class="cls_023">&lt;p>For online documentation and support please refer to</span></div>
<div style="position:absolute;left:126.00px;top:479.23px" class="cls_023"><span class="cls_023">&lt;a href="</span><A HREF="http://nginx.org/"/">http://nginx.org/"</A>>nginx.org&lt;/a>.&lt;br/></div>
<div style="position:absolute;left:126.00px;top:491.47px" class="cls_023"><span class="cls_023">Commercial support is available at</span></div>
<div style="position:absolute;left:126.00px;top:503.71px" class="cls_023"><span class="cls_023">&lt;a href="</span><A HREF="http://nginx.com/"/">http://nginx.com/"</A>>nginx.com&lt;/a>.&lt;/p></div>
<div style="position:absolute;left:126.00px;top:528.19px" class="cls_023"><span class="cls_023">&lt;p>&lt;em>Thank you for using nginx.&lt;/em>&lt;/p></span></div>
<div style="position:absolute;left:126.00px;top:540.43px" class="cls_023"><span class="cls_023">&lt;/body></span></div>
<div style="position:absolute;left:126.00px;top:552.67px" class="cls_023"><span class="cls_023">&lt;/html></span></div>
<div style="position:absolute;left:108.00px;top:572.41px" class="cls_008"><span class="cls_008">Now, let's attach our Terminal to the </span><span class="cls_010">nginx</span><span class="cls_008"> container to observe what's happening:</span></div>
<div style="position:absolute;left:126.00px;top:593.35px" class="cls_024"><span class="cls_024">$ docker container attach nginx</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 44 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:50526px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background068.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once you are attached to the container, you first will not see anything. But now open</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">another Terminal, and in this new Terminal window, repeat the </span><span class="cls_010">curl</span><span class="cls_008"> command a</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">few times using the following script:</span></div>
<div style="position:absolute;left:126.00px;top:160.63px" class="cls_023"><span class="cls_023">$ for n in {1..10}; do curl -4 localhost:8080; done</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">You should see the logging output of Nginx, which looks similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:201.31px" class="cls_024"><span class="cls_024">172.17.0.1 - - [06/Jan/2018:12:20:00 +0000] "GET / HTTP/1.1" 200 612</span></div>
<div style="position:absolute;left:126.00px;top:212.11px" class="cls_024"><span class="cls_024">"-" "curl/7.54.0" "-"</span></div>
<div style="position:absolute;left:126.00px;top:224.35px" class="cls_024"><span class="cls_024">172.17.0.1 - - [06/Jan/2018:12:20:03 +0000] "GET / HTTP/1.1" 200 612</span></div>
<div style="position:absolute;left:126.00px;top:235.15px" class="cls_024"><span class="cls_024">"-" "curl/7.54.0" "-"</span></div>
<div style="position:absolute;left:126.00px;top:247.39px" class="cls_024"><span class="cls_024">172.17.0.1 - - [06/Jan/2018:12:20:05 +0000] "GET / HTTP/1.1" 200 612</span></div>
<div style="position:absolute;left:126.00px;top:258.19px" class="cls_024"><span class="cls_024">"-" "curl/7.54.0" "-"</span></div>
<div style="position:absolute;left:108.00px;top:277.93px" class="cls_008"><span class="cls_008">Quit the container by pressing </span><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">C</span><span class="cls_008">. This will detach your Terminal and, at the</span></div>
<div style="position:absolute;left:108.00px;top:290.53px" class="cls_008"><span class="cls_008">same time, stop the </span><span class="cls_010">nginx</span><span class="cls_008"> container.</span></div>
<div style="position:absolute;left:108.00px;top:311.77px" class="cls_008"><span class="cls_008">To clean up, remove the </span><span class="cls_010">nginx</span><span class="cls_008"> container with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:332.71px" class="cls_024"><span class="cls_024">$ docker container rm nginx</span></div>
<div style="position:absolute;left:108.00px;top:363.71px" class="cls_011"><span class="cls_011">Retrieving container logs</span></div>
<div style="position:absolute;left:108.00px;top:388.69px" class="cls_008"><span class="cls_008">It is a best practice for any good application to generate some logging information</span></div>
<div style="position:absolute;left:108.00px;top:401.29px" class="cls_008"><span class="cls_008">that developers and operators alike can use to find out what the application is doing</span></div>
<div style="position:absolute;left:108.00px;top:413.89px" class="cls_008"><span class="cls_008">at a given time, and whether there are any problems to help pinpoint the root cause</span></div>
<div style="position:absolute;left:108.00px;top:426.49px" class="cls_008"><span class="cls_008">of the issue.</span></div>
<div style="position:absolute;left:108.00px;top:447.74px" class="cls_008"><span class="cls_008">When running inside a container, the application should preferably output the log</span></div>
<div style="position:absolute;left:108.00px;top:460.34px" class="cls_008"><span class="cls_008">items to STDOUT and STDERR and not into a file. If the logging output is directed</span></div>
<div style="position:absolute;left:108.00px;top:472.94px" class="cls_008"><span class="cls_008">to STDOUT and STDERR, then Docker can collect this information and keep it ready</span></div>
<div style="position:absolute;left:108.00px;top:485.54px" class="cls_008"><span class="cls_008">for consumption by a user or any other external system.</span></div>
<div style="position:absolute;left:108.00px;top:506.77px" class="cls_008"><span class="cls_008">To access the logs of a given container, we can use the </span><span class="cls_010">docker container logs</span></div>
<div style="position:absolute;left:108.00px;top:519.37px" class="cls_008"><span class="cls_008">command. If, for example, we want to retrieve the logs of our </span><span class="cls_010">quotes</span><span class="cls_008"> container, we</span></div>
<div style="position:absolute;left:108.00px;top:531.97px" class="cls_008"><span class="cls_008">can use the following expression:</span></div>
<div style="position:absolute;left:126.00px;top:552.91px" class="cls_024"><span class="cls_024">$ docker container logs quotes</span></div>
<div style="position:absolute;left:108.00px;top:572.65px" class="cls_008"><span class="cls_008">This will retrieve the whole log produced by the application from the very beginning</span></div>
<div style="position:absolute;left:108.00px;top:585.25px" class="cls_008"><span class="cls_008">of its existence.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 45 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:51328px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background069.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:167.30px;top:122.61px" class="cls_025"><span class="cls_025">Stop, wait a second—this is not quite true, what I just said, that the</span></div>
<div style="position:absolute;left:167.30px;top:134.01px" class="cls_025"><span class="cls_025">full log, from the beginning of the containers existence is available. By</span></div>
<div style="position:absolute;left:167.30px;top:145.41px" class="cls_025"><span class="cls_025">default, Docker uses the so-called </span><span class="cls_010">json-file</span><span class="cls_025"> logging driver. This driver</span></div>
<div style="position:absolute;left:167.30px;top:156.81px" class="cls_025"><span class="cls_025">stores the logging information in a file. And if there is a file rolling policy</span></div>
<div style="position:absolute;left:167.30px;top:168.21px" class="cls_025"><span class="cls_025">defined, then </span><span class="cls_010">docker container logs</span><span class="cls_025"> only retrieves what is in the</span></div>
<div style="position:absolute;left:167.30px;top:179.61px" class="cls_025"><span class="cls_025">current active log file and not what is in previous, rolled files that still</span></div>
<div style="position:absolute;left:167.30px;top:191.01px" class="cls_025"><span class="cls_025">might or might not be available on the host though.</span></div>
<div style="position:absolute;left:108.00px;top:215.46px" class="cls_008"><span class="cls_008">If we want to only get a few of the latest entries, we can use the </span><span class="cls_010">-t</span><span class="cls_008"> or </span><span class="cls_010">--tail</span></div>
<div style="position:absolute;left:108.00px;top:228.06px" class="cls_008"><span class="cls_008">parameter, as follows:</span></div>
<div style="position:absolute;left:126.00px;top:249.00px" class="cls_024"><span class="cls_024">$ docker container logs --tail 5 quotes</span></div>
<div style="position:absolute;left:108.00px;top:268.74px" class="cls_008"><span class="cls_008">This will retrieve only the last five items the process running inside the</span></div>
<div style="position:absolute;left:108.00px;top:281.34px" class="cls_008"><span class="cls_008">container produced.</span></div>
<div style="position:absolute;left:108.00px;top:302.58px" class="cls_008"><span class="cls_008">Sometimes, we want to follow the log that is produced by a container. This is</span></div>
<div style="position:absolute;left:108.00px;top:315.18px" class="cls_008"><span class="cls_008">possible when using the parameter </span><span class="cls_010">-f</span><span class="cls_008"> or </span><span class="cls_010">--follow</span><span class="cls_008">. The following expression</span></div>
<div style="position:absolute;left:108.00px;top:327.78px" class="cls_008"><span class="cls_008">will output the last five log items and then follow the log as it is produced by</span></div>
<div style="position:absolute;left:108.00px;top:340.38px" class="cls_008"><span class="cls_008">the containerized process:</span></div>
<div style="position:absolute;left:126.00px;top:361.32px" class="cls_024"><span class="cls_024">$ docker container logs --tail 5 --follow quotes</span></div>
<div style="position:absolute;left:108.00px;top:389.76px" class="cls_022"><span class="cls_022">Logging drivers</span></div>
<div style="position:absolute;left:108.00px;top:412.74px" class="cls_008"><span class="cls_008">Docker includes multiple logging mechanisms to help us get information from</span></div>
<div style="position:absolute;left:108.00px;top:425.34px" class="cls_008"><span class="cls_008">running containers. These mechanisms are named </span><span class="cls_009">logging drivers</span><span class="cls_008">. Which logging</span></div>
<div style="position:absolute;left:108.01px;top:437.94px" class="cls_008"><span class="cls_008">driver is used can be configured at the Docker daemon level. The default logging</span></div>
<div style="position:absolute;left:108.01px;top:450.54px" class="cls_008"><span class="cls_008">driver is </span><span class="cls_010">json-file</span><span class="cls_008">. Some of the drivers that are currently supported natively are:</span></div>
<div style="position:absolute;left:112.29px;top:479.65px" class="cls_027"><span class="cls_027">Driver</span></div>
<div style="position:absolute;left:182.15px;top:479.65px" class="cls_027"><span class="cls_027">Description</span></div>
<div style="position:absolute;left:112.29px;top:494.08px" class="cls_010"><span class="cls_010">none</span></div>
<div style="position:absolute;left:182.15px;top:494.55px" class="cls_025"><span class="cls_025">No log output for the specific container is produced.</span></div>
<div style="position:absolute;left:182.15px;top:509.46px" class="cls_025"><span class="cls_025">This is the default driver. The logging information is stored in files,</span></div>
<div style="position:absolute;left:112.29px;top:514.68px" class="cls_010"><span class="cls_010">json-file</span></div>
<div style="position:absolute;left:182.15px;top:520.86px" class="cls_025"><span class="cls_025">formatted as JSON.</span></div>
<div style="position:absolute;left:182.15px;top:535.76px" class="cls_025"><span class="cls_025">If the journals daemon is running on the host machine, we can use this</span></div>
<div style="position:absolute;left:112.29px;top:540.99px" class="cls_010"><span class="cls_010">journald</span></div>
<div style="position:absolute;left:182.15px;top:547.16px" class="cls_025"><span class="cls_025">driver. It forwards logging to the </span><span class="cls_010">journald</span><span class="cls_025"> daemon.</span></div>
<div style="position:absolute;left:182.15px;top:562.07px" class="cls_025"><span class="cls_025">If the </span><span class="cls_010">syslog</span><span class="cls_025"> daemon is running on the host machine, we can configure</span></div>
<div style="position:absolute;left:112.29px;top:567.29px" class="cls_010"><span class="cls_010">syslog</span></div>
<div style="position:absolute;left:182.15px;top:573.47px" class="cls_025"><span class="cls_025">this driver, which will forward the log messages to the </span><span class="cls_010">syslog</span><span class="cls_025"> daemon.</span></div>
<div style="position:absolute;left:182.15px;top:588.38px" class="cls_025"><span class="cls_025">When using this driver, log messages are written to a </span><span class="cls_027">Graylog Extended</span></div>
<div style="position:absolute;left:112.29px;top:599.30px" class="cls_010"><span class="cls_010">gelf</span></div>
<div style="position:absolute;left:182.15px;top:599.78px" class="cls_027"><span class="cls_027">Log Format</span><span class="cls_025"> (</span><span class="cls_027">GELF</span><span class="cls_025">) endpoint. Popular examples of such endpoints are</span></div>
<div style="position:absolute;left:182.15px;top:611.18px" class="cls_025"><span class="cls_025">Graylog and Logstash.</span></div>
<div style="position:absolute;left:182.15px;top:626.08px" class="cls_025"><span class="cls_025">Assuming that the </span><span class="cls_010">fluentd</span><span class="cls_025"> daemon is installed on the host system, this</span></div>
<div style="position:absolute;left:112.29px;top:631.31px" class="cls_010"><span class="cls_010">fluentd</span></div>
<div style="position:absolute;left:182.15px;top:637.48px" class="cls_025"><span class="cls_025">driver writes log messages to it.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 46 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:52130px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background070.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:180.25px;top:123.91px" class="cls_025"><span class="cls_025">If you change the logging driver, please be aware that the </span><span class="cls_010">docker</span></div>
<div style="position:absolute;left:180.25px;top:135.31px" class="cls_010"><span class="cls_010">container logs</span><span class="cls_025"> command is only available for the </span><span class="cls_010">json-file</span></div>
<div style="position:absolute;left:180.25px;top:146.71px" class="cls_025"><span class="cls_025">and </span><span class="cls_010">journald</span><span class="cls_025"> drivers.</span></div>
<div style="position:absolute;left:108.00px;top:180.80px" class="cls_022"><span class="cls_022">Using a container-specific logging driver</span></div>
<div style="position:absolute;left:108.00px;top:203.78px" class="cls_008"><span class="cls_008">We have seen that the logging driver can be set globally in the Docker daemon</span></div>
<div style="position:absolute;left:108.00px;top:216.38px" class="cls_008"><span class="cls_008">configuration file. But we can also define the logging driver on a container by</span></div>
<div style="position:absolute;left:108.00px;top:228.98px" class="cls_008"><span class="cls_008">container basis. In the following example, we are running a </span><span class="cls_010">busybox</span><span class="cls_008"> container and</span></div>
<div style="position:absolute;left:108.00px;top:241.58px" class="cls_008"><span class="cls_008">use the </span><span class="cls_010">--log-driver</span><span class="cls_008"> parameter to configure the </span><span class="cls_010">none</span><span class="cls_008"> logging driver:</span></div>
<div style="position:absolute;left:126.00px;top:262.52px" class="cls_024"><span class="cls_024">$ docker container run --name test -it \</span></div>
<div style="position:absolute;left:147.60px;top:274.76px" class="cls_024"><span class="cls_024">--log-driver none \</span></div>
<div style="position:absolute;left:147.60px;top:287.00px" class="cls_024"><span class="cls_024">busybox sh -c 'for N in 1 2 3; do echo "Hello $N"; done'</span></div>
<div style="position:absolute;left:108.00px;top:306.74px" class="cls_008"><span class="cls_008">We should see the following:</span></div>
<div style="position:absolute;left:126.00px;top:327.68px" class="cls_024"><span class="cls_024">Hello 1</span></div>
<div style="position:absolute;left:126.00px;top:339.92px" class="cls_024"><span class="cls_024">Hello 2</span></div>
<div style="position:absolute;left:126.00px;top:352.16px" class="cls_024"><span class="cls_024">Hello 3</span></div>
<div style="position:absolute;left:108.00px;top:371.90px" class="cls_008"><span class="cls_008">Now, let's try to get the logs of the preceding container:</span></div>
<div style="position:absolute;left:126.00px;top:392.84px" class="cls_024"><span class="cls_024">$ docker container logs test</span></div>
<div style="position:absolute;left:108.00px;top:412.58px" class="cls_008"><span class="cls_008">The output is as follows:</span></div>
<div style="position:absolute;left:126.00px;top:433.52px" class="cls_024"><span class="cls_024">Error response from daemon: configured logging driver does not support</span></div>
<div style="position:absolute;left:126.00px;top:444.32px" class="cls_024"><span class="cls_024">reading</span></div>
<div style="position:absolute;left:108.00px;top:464.06px" class="cls_008"><span class="cls_008">This is to be expected, since the </span><span class="cls_010">none</span><span class="cls_008"> driver does not produce any logging output.</span></div>
<div style="position:absolute;left:108.00px;top:476.66px" class="cls_008"><span class="cls_008">Let's clean up and remove the </span><span class="cls_010">test</span><span class="cls_008"> container:</span></div>
<div style="position:absolute;left:126.00px;top:497.60px" class="cls_024"><span class="cls_024">$ docker container rm test</span></div>
<div style="position:absolute;left:108.00px;top:526.04px" class="cls_022"><span class="cls_022">Advanced topic - changing the default</span></div>
<div style="position:absolute;left:108.00px;top:547.64px" class="cls_022"><span class="cls_022">logging driver</span></div>
<div style="position:absolute;left:108.00px;top:570.62px" class="cls_008"><span class="cls_008">Let's change the default logging driver of a Linux host. The easiest way to do</span></div>
<div style="position:absolute;left:108.00px;top:583.22px" class="cls_008"><span class="cls_008">this is on a real Linux host. For this purpose, we're going to use Vagrant with</span></div>
<div style="position:absolute;left:108.00px;top:595.82px" class="cls_008"><span class="cls_008">an Ubuntu image:</span></div>
<div style="position:absolute;left:126.00px;top:616.76px" class="cls_024"><span class="cls_024">$ vagrant init bento/ubuntu-17.04</span></div>
<div style="position:absolute;left:126.00px;top:629.00px" class="cls_024"><span class="cls_024">$ vagrant up</span></div>
<div style="position:absolute;left:126.00px;top:641.24px" class="cls_024"><span class="cls_024">$ vagrant ssh</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 47 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:52932px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background071.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once inside the Ubuntu VM, we want to edit the Docker daemon configuration file.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">Navigate to the folder </span><span class="cls_010">/etc/docker</span><span class="cls_008"> and run </span><span class="cls_010">vi</span><span class="cls_008"> as follows:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ vi daemon.json</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">Enter the following content:</span></div>
<div style="position:absolute;left:126.00px;top:188.71px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:136.80px;top:200.95px" class="cls_023"><span class="cls_023">"Log-driver": "json-log",</span></div>
<div style="position:absolute;left:136.80px;top:213.19px" class="cls_023"><span class="cls_023">"log-opts": {</span></div>
<div style="position:absolute;left:147.60px;top:225.43px" class="cls_023"><span class="cls_023">"max-size": "10m",</span></div>
<div style="position:absolute;left:147.60px;top:237.67px" class="cls_023"><span class="cls_023">"max-file": 3</span></div>
<div style="position:absolute;left:136.80px;top:249.91px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:126.00px;top:262.15px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:108.00px;top:281.89px" class="cls_008"><span class="cls_008">Save and exit Vi by first pressing </span><span class="cls_021">Esc</span><span class="cls_008"> and then typing </span><span class="cls_010">:w:q</span><span class="cls_008"> and finally hitting the</span></div>
<div style="position:absolute;left:108.00px;top:294.49px" class="cls_021"><span class="cls_021">Enter</span><span class="cls_008"> key.</span></div>
<div style="position:absolute;left:108.00px;top:315.73px" class="cls_008"><span class="cls_008">The preceding definition tells the Docker daemon to use the </span><span class="cls_010">json-log</span><span class="cls_008"> driver with a</span></div>
<div style="position:absolute;left:108.00px;top:328.33px" class="cls_008"><span class="cls_008">maximum log file size of 10 MB before it is rolled, and the maximum number of log</span></div>
<div style="position:absolute;left:108.00px;top:340.93px" class="cls_008"><span class="cls_008">files that can be present on the system is </span><span class="cls_010">3</span><span class="cls_008"> before the oldest file gets purged.</span></div>
<div style="position:absolute;left:108.00px;top:362.17px" class="cls_008"><span class="cls_008">Now we have to send a </span><span class="cls_010">SIGHUP</span><span class="cls_008"> signal to the Docker daemon so that it picks up the</span></div>
<div style="position:absolute;left:108.00px;top:374.77px" class="cls_008"><span class="cls_008">changes in the configuration file:</span></div>
<div style="position:absolute;left:126.00px;top:395.71px" class="cls_024"><span class="cls_024">$ sudo kill -SIGHUP $(pidof dockerd)</span></div>
<div style="position:absolute;left:173.05px;top:426.47px" class="cls_025"><span class="cls_025">Note that the preceding command only reloads the config file and does</span></div>
<div style="position:absolute;left:173.05px;top:437.87px" class="cls_025"><span class="cls_025">not restart the daemon.</span></div>
<div style="position:absolute;left:108.00px;top:476.71px" class="cls_011"><span class="cls_011">Anatomy of containers</span></div>
<div style="position:absolute;left:108.00px;top:501.69px" class="cls_008"><span class="cls_008">Many individuals wrongly compare containers to VMs. However, this is a</span></div>
<div style="position:absolute;left:108.00px;top:514.29px" class="cls_008"><span class="cls_008">questionable comparison. Containers are not just lightweight VMs. OK then,</span></div>
<div style="position:absolute;left:108.00px;top:526.89px" class="cls_021"><span class="cls_021">what is the correct description of a container?</span></div>
<div style="position:absolute;left:108.00px;top:548.14px" class="cls_008"><span class="cls_008">Containers are specially encapsulated and secured processes running on the</span></div>
<div style="position:absolute;left:108.00px;top:560.74px" class="cls_008"><span class="cls_008">host system.</span></div>
<div style="position:absolute;left:108.00px;top:581.98px" class="cls_008"><span class="cls_008">Containers leverage a lot of features and primitives available in the Linux OS.</span></div>
<div style="position:absolute;left:108.00px;top:594.58px" class="cls_008"><span class="cls_008">The most important ones are </span><span class="cls_009">namespaces</span><span class="cls_008"> and </span><span class="cls_009">cgroups</span><span class="cls_008">. All processes running in</span></div>
<div style="position:absolute;left:108.00px;top:607.18px" class="cls_008"><span class="cls_008">containers share the same Linux kernel of the underlying host operating system.</span></div>
<div style="position:absolute;left:108.00px;top:619.78px" class="cls_008"><span class="cls_008">This is fundamentally different compared with VMs, as each VM contains its own</span></div>
<div style="position:absolute;left:108.00px;top:632.38px" class="cls_008"><span class="cls_008">full-blown operating system.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 48 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:53734px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background072.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The startup times of a typical container can be measured in milliseconds, while</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">a VM normally needs several seconds to minutes to startup. VMs are meant to be</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">long-living. It is a primary goal of each operations engineer to maximize the uptime</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">of their VMs. Contrary to that, containers are meant to be ephemeral. They come</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">and go in a quick cadence.</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">Let's first get a high-level overview of the architecture that enables us to run containers.</span></div>
<div style="position:absolute;left:108.00px;top:216.07px" class="cls_022"><span class="cls_022">Architecture</span></div>
<div style="position:absolute;left:108.00px;top:239.05px" class="cls_008"><span class="cls_008">Here, we have an architectural diagram on how this all fits together:</span></div>
<div style="position:absolute;left:247.19px;top:428.95px" class="cls_026"><span class="cls_026">High level architecture of Docker</span></div>
<div style="position:absolute;left:108.00px;top:447.69px" class="cls_008"><span class="cls_008">On the lower part of the the preceding figure, we have the Linux operating system</span></div>
<div style="position:absolute;left:108.00px;top:460.29px" class="cls_008"><span class="cls_008">with its cgroups, namespaces, and layer capabilities as well as other functionality</span></div>
<div style="position:absolute;left:108.00px;top:472.89px" class="cls_008"><span class="cls_008">that we do not need to explicitly mention here. Then, there is an intermediary layer</span></div>
<div style="position:absolute;left:108.00px;top:485.49px" class="cls_008"><span class="cls_008">composed of </span><span class="cls_009">containerd</span><span class="cls_008"> and </span><span class="cls_009">runc</span><span class="cls_008">. On top of all that now sits the Docker engine. The</span></div>
<div style="position:absolute;left:108.00px;top:498.09px" class="cls_008"><span class="cls_008">Docker engine offers a RESTful interface to the outside world that can be accessed</span></div>
<div style="position:absolute;left:108.00px;top:510.69px" class="cls_008"><span class="cls_008">by any tool, such as the Docker CLI, Docker for Mac, and Docker for Windows or</span></div>
<div style="position:absolute;left:108.00px;top:523.29px" class="cls_008"><span class="cls_008">Kubernetes to just name a few.</span></div>
<div style="position:absolute;left:108.00px;top:544.53px" class="cls_008"><span class="cls_008">Let's now describe the main building blocks in a bit more detail.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 49 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:54536px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background073.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Namespaces</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Linux namespaces had been around for years before they were leveraged by Docker</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">for their containers. A namespace is an abstraction of global resources such as</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">filesystems, network access, process tree (also named PID namespace) or the system</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">group IDs, and user IDs. A Linux system is initialized with a single instance of each</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">namespace type. After initialization, additional namespaces can be created or joined.</span></div>
<div style="position:absolute;left:108.00px;top:207.09px" class="cls_008"><span class="cls_008">The Linux namespaces originated in 2002 in the 2.4.19 kernel. In kernel version 3.8,</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">user namespaces were introduced and with it, namespaces were ready to be used</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">by containers.</span></div>
<div style="position:absolute;left:108.00px;top:253.53px" class="cls_008"><span class="cls_008">If we wrap a running process, say, in a filesystem namespace, then this process has</span></div>
<div style="position:absolute;left:108.00px;top:266.13px" class="cls_008"><span class="cls_008">the illusion that it owns its own complete filesystem. This of course is not true; it</span></div>
<div style="position:absolute;left:108.00px;top:278.73px" class="cls_008"><span class="cls_008">is only a virtual FS. From the perspective of the host, the contained process gets a</span></div>
<div style="position:absolute;left:108.00px;top:291.33px" class="cls_008"><span class="cls_008">shielded subsection of the overall FS. It is like a filesystem in a filesystem:</span></div>
<div style="position:absolute;left:108.00px;top:541.14px" class="cls_008"><span class="cls_008">The same applies for all the other global resources for which namespaces exist. The</span></div>
<div style="position:absolute;left:108.00px;top:553.74px" class="cls_008"><span class="cls_008">user ID namespace is another example. Having a user namespace, we can now define</span></div>
<div style="position:absolute;left:108.00px;top:566.34px" class="cls_008"><span class="cls_008">a user </span><span class="cls_010">jdoe</span><span class="cls_008"> many times on the system as long at it is living in its own namespace.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 50 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:55338px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background074.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The PID namespace is what keeps processes in one container from seeing or</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">interacting with processes in another container. A process might have the apparent</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">PID </span><span class="cls_009">1</span><span class="cls_008"> inside a container, but if we examine it from the host system, it would have</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">an ordinary PID, say </span><span class="cls_009">334</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:254.22px;top:342.71px" class="cls_026"><span class="cls_026">Process tree on a Docker host</span></div>
<div style="position:absolute;left:108.00px;top:361.45px" class="cls_008"><span class="cls_008">In a given namespace, we can run one to many processes. That is important when</span></div>
<div style="position:absolute;left:108.00px;top:374.05px" class="cls_008"><span class="cls_008">we talk about containers, and we have experienced that already when we executed</span></div>
<div style="position:absolute;left:108.00px;top:386.65px" class="cls_008"><span class="cls_008">another process in an already-running container.</span></div>
<div style="position:absolute;left:108.00px;top:416.59px" class="cls_022"><span class="cls_022">Control groups (cgroups)</span></div>
<div style="position:absolute;left:108.00px;top:439.57px" class="cls_008"><span class="cls_008">Linux cgroups are used to limit, manage, and isolate resource usage of collections of</span></div>
<div style="position:absolute;left:108.00px;top:452.17px" class="cls_008"><span class="cls_008">processes running on a system. Resources are CPU time, system memory, network</span></div>
<div style="position:absolute;left:108.00px;top:464.77px" class="cls_008"><span class="cls_008">bandwidth, or combinations of these resources, and so on.</span></div>
<div style="position:absolute;left:108.00px;top:486.01px" class="cls_008"><span class="cls_008">Engineers at Google have originally implemented this feature starting in 2006. The</span></div>
<div style="position:absolute;left:108.00px;top:498.61px" class="cls_008"><span class="cls_008">cgroups functionality was merged into the Linux kernel mainline in kernel version</span></div>
<div style="position:absolute;left:108.00px;top:511.21px" class="cls_008"><span class="cls_008">2.6.24, which was released in January 2008.</span></div>
<div style="position:absolute;left:108.00px;top:532.45px" class="cls_008"><span class="cls_008">Using cgroups, administrators can limit the resources that containers can consume.</span></div>
<div style="position:absolute;left:108.00px;top:545.05px" class="cls_008"><span class="cls_008">With this, one can avoid, for example, the classical </span><span class="cls_021">noisy neighbor</span><span class="cls_008"> problem, where</span></div>
<div style="position:absolute;left:108.00px;top:557.65px" class="cls_008"><span class="cls_008">a rogue process running in a container consumes all CPU time or reserves massive</span></div>
<div style="position:absolute;left:108.00px;top:570.25px" class="cls_008"><span class="cls_008">amounts of RAM and, as such, starves all the other processes running on the host,</span></div>
<div style="position:absolute;left:108.00px;top:582.85px" class="cls_008"><span class="cls_008">whether they're containerized or not.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 51 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:56140px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background075.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Working with Containers</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Union filesystem (UnionFS)</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">The UnionFS forms the backbone of what is known as container images. We will</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">discuss container images in detail in the next chapter. At this time, we want to just</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">understand a bit better what a UnionFS is and how it works. UnionFS is mainly used</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">on Linux and allows files and directories of distinct filesystems to be overlaid and</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">with it form a single coherent file system. In this context, the individual filesystems</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">are called branches. Contents of directories that have the same path within the</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">merged branches will be seen together in a single merged directory, within the new,</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">virtual filesystem. When merging branches, the priority between the branches is</span></div>
<div style="position:absolute;left:108.00px;top:236.24px" class="cls_008"><span class="cls_008">specified. In that way, when two branches contain the same file, the one with the</span></div>
<div style="position:absolute;left:108.00px;top:248.84px" class="cls_008"><span class="cls_008">higher priority is seen in the final FS.</span></div>
<div style="position:absolute;left:108.00px;top:278.78px" class="cls_022"><span class="cls_022">Container plumbing</span></div>
<div style="position:absolute;left:108.00px;top:301.76px" class="cls_008"><span class="cls_008">The basement on top of which the Docker engine is built; we can also call it the</span></div>
<div style="position:absolute;left:108.00px;top:314.36px" class="cls_009"><span class="cls_009">container plumbing</span><span class="cls_008"> and is formed by the two component—</span><span class="cls_009">runc</span><span class="cls_008"> and </span><span class="cls_009">containerd</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:335.61px" class="cls_008"><span class="cls_008">Originally, Docker was built in a monolithic way and contained all the functionality</span></div>
<div style="position:absolute;left:108.00px;top:348.21px" class="cls_008"><span class="cls_008">necessary to run containers. Over time, this became too rigid and Docker started</span></div>
<div style="position:absolute;left:108.00px;top:360.81px" class="cls_008"><span class="cls_008">to break out parts of the functionality into their own components. Two important</span></div>
<div style="position:absolute;left:108.00px;top:373.41px" class="cls_008"><span class="cls_008">components are runc and containerd.</span></div>
<div style="position:absolute;left:108.00px;top:401.50px" class="cls_028"><span class="cls_028">Runc</span></div>
<div style="position:absolute;left:108.00px;top:422.48px" class="cls_008"><span class="cls_008">Runc is a lightweight, portable container runtime. It provides full support for Linux</span></div>
<div style="position:absolute;left:108.00px;top:435.08px" class="cls_008"><span class="cls_008">namespaces as well as native support for all security features available on Linux,</span></div>
<div style="position:absolute;left:108.00px;top:447.68px" class="cls_008"><span class="cls_008">such as SELinux, AppArmor, seccomp, and cgroups.</span></div>
<div style="position:absolute;left:108.00px;top:468.93px" class="cls_008"><span class="cls_008">Runc is a tool for spawning and running containers according to the </span><span class="cls_009">Open</span></div>
<div style="position:absolute;left:108.00px;top:481.53px" class="cls_009"><span class="cls_009">Container Initiative</span><span class="cls_008"> (</span><span class="cls_009">OCI</span><span class="cls_008">) specification. It is a formally specified configuration</span></div>
<div style="position:absolute;left:108.00px;top:494.13px" class="cls_008"><span class="cls_008">format, governed by the </span><span class="cls_009">Open Container Project</span><span class="cls_008"> (</span><span class="cls_009">OCP</span><span class="cls_008">) under the auspices of</span></div>
<div style="position:absolute;left:108.00px;top:506.73px" class="cls_008"><span class="cls_008">the Linux Foundation.</span></div>
<div style="position:absolute;left:108.00px;top:534.82px" class="cls_028"><span class="cls_028">Containerd</span></div>
<div style="position:absolute;left:108.00px;top:555.80px" class="cls_008"><span class="cls_008">Runc is a low-level implementation of a container runtime; containerd builds on top</span></div>
<div style="position:absolute;left:108.00px;top:568.40px" class="cls_008"><span class="cls_008">of it, and adds higher-level features, such as image transfer and storage, container</span></div>
<div style="position:absolute;left:108.00px;top:581.00px" class="cls_008"><span class="cls_008">execution, and supervision, as well as network and storage attachments. With</span></div>
<div style="position:absolute;left:108.00px;top:593.60px" class="cls_008"><span class="cls_008">this, it manages the complete life cycle of containers. Containerd is the reference</span></div>
<div style="position:absolute;left:108.00px;top:606.20px" class="cls_008"><span class="cls_008">implementation of the OCI specifications and is by far the most popular and</span></div>
<div style="position:absolute;left:108.00px;top:618.80px" class="cls_008"><span class="cls_008">widely-used container runtime.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 52 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:56942px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background076.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 3</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Containerd has been donated to and accepted by the CNCF in 2017. There exist</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">alternative implementations of the OCI specification. Some of them are rkt by</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">CoreOS, CRI-O by RedHat, and LXD by Linux Containers. However, containerd at</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">this time is by far the most popular container runtime and is the default runtime of</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">Kubernetes 1.8 or later and the Docker platform.</span></div>
<div style="position:absolute;left:108.00px;top:197.39px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:222.37px" class="cls_008"><span class="cls_008">In this chapter, you learned how to work with containers that are based on existing</span></div>
<div style="position:absolute;left:108.00px;top:234.97px" class="cls_008"><span class="cls_008">images. We showed how to run, stop, start, and remove a container. Then, we</span></div>
<div style="position:absolute;left:108.00px;top:247.57px" class="cls_008"><span class="cls_008">inspected the metadata of a container, extracted the logs of it, and learned how to run</span></div>
<div style="position:absolute;left:108.00px;top:260.17px" class="cls_008"><span class="cls_008">an arbitrary process in an already-running container. Last but not least, we dug a bit</span></div>
<div style="position:absolute;left:108.00px;top:272.77px" class="cls_008"><span class="cls_008">deeper and investigated how containers work and what features of the underlying</span></div>
<div style="position:absolute;left:108.00px;top:285.37px" class="cls_008"><span class="cls_008">Linux operating system they leverage.</span></div>
<div style="position:absolute;left:108.00px;top:306.62px" class="cls_008"><span class="cls_008">In the next chapter, you're going to learn what container images are and how we</span></div>
<div style="position:absolute;left:108.00px;top:319.22px" class="cls_008"><span class="cls_008">can build and share our own custom images. We're also discussing the best practices</span></div>
<div style="position:absolute;left:108.00px;top:331.82px" class="cls_008"><span class="cls_008">commonly used when building custom images, such as minimizing their size and</span></div>
<div style="position:absolute;left:108.00px;top:344.42px" class="cls_008"><span class="cls_008">leveraging the image cache. Stay tuned!</span></div>
<div style="position:absolute;left:108.00px;top:376.91px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:401.89px" class="cls_008"><span class="cls_008">To assess your learning progress please answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:423.14px" class="cls_008"><span class="cls_008">1.  What are the states of a container?</span></div>
<div style="position:absolute;left:126.00px;top:440.05px" class="cls_008"><span class="cls_008">2.  Which command helps us to find out what is currently running on our host?</span></div>
<div style="position:absolute;left:126.00px;top:456.97px" class="cls_008"><span class="cls_008">3.  Which command is used to list the IDs of all containers?</span></div>
<div style="position:absolute;left:108.00px;top:489.47px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:514.45px" class="cls_008"><span class="cls_008">The following articles give you some more information related to the topics we</span></div>
<div style="position:absolute;left:108.00px;top:527.05px" class="cls_008"><span class="cls_008">discussed in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:548.30px" class="cls_008"><span class="cls_008">•  Docker container at </span><A HREF="http://dockr.ly/2iLBV2I">http://dockr.ly/2iLBV2I</A> </span></div>
<div style="position:absolute;left:126.00px;top:565.21px" class="cls_008"><span class="cls_008">•  Getting started with containers at </span><A HREF="http://dockr.ly/2gmxKWB">http://dockr.ly/2gmxKWB</A> </span></div>
<div style="position:absolute;left:126.00px;top:582.13px" class="cls_008"><span class="cls_008">•  Isolate containers with a user namespace at </span><A HREF="http://dockr.ly/2gmyKdf">http://dockr.ly/2gmyKdf</A> </span></div>
<div style="position:absolute;left:126.00px;top:599.05px" class="cls_008"><span class="cls_008">•  Limit container's resources at </span><A HREF="http://dockr.ly/2wqN5Nn">http://dockr.ly/2wqN5Nn</A> </span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 53 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:57744px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background077.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:57744px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background078.jpg" width=612 height=792></div>
<div style="position:absolute;left:192.12px;top:218.71px" class="cls_015"><span class="cls_015">Creating and Managing</span></div>
<div style="position:absolute;left:267.21px;top:254.71px" class="cls_015"><span class="cls_015">Container Images</span></div>
<div style="position:absolute;left:108.00px;top:308.41px" class="cls_008"><span class="cls_008">In the previous chapter, we learned what containers are and how to run, stop,</span></div>
<div style="position:absolute;left:108.00px;top:321.01px" class="cls_008"><span class="cls_008">remove, list, and inspect them. We extracted the logging information of some</span></div>
<div style="position:absolute;left:108.00px;top:333.61px" class="cls_008"><span class="cls_008">containers, ran other processes inside an already running container, and finally we</span></div>
<div style="position:absolute;left:108.00px;top:346.21px" class="cls_008"><span class="cls_008">dived deep into the anatomy of containers. Whenever we ran a container, we created</span></div>
<div style="position:absolute;left:108.00px;top:358.81px" class="cls_008"><span class="cls_008">it using a container image. In this chapter, we will be familiarizing ourselves with</span></div>
<div style="position:absolute;left:108.00px;top:371.41px" class="cls_008"><span class="cls_008">these container images. We will learn in detail what they are, how to create them,</span></div>
<div style="position:absolute;left:108.00px;top:384.01px" class="cls_008"><span class="cls_008">and how to distribute them.</span></div>
<div style="position:absolute;left:108.00px;top:405.26px" class="cls_008"><span class="cls_008">This chapter will cover the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:426.50px" class="cls_008"><span class="cls_008">•  What images are?</span></div>
<div style="position:absolute;left:126.00px;top:443.41px" class="cls_008"><span class="cls_008">•  Creating images</span></div>
<div style="position:absolute;left:126.00px;top:460.33px" class="cls_008"><span class="cls_008">•  Sharing or shipping images</span></div>
<div style="position:absolute;left:107.99px;top:481.57px" class="cls_008"><span class="cls_008">After completing this chapter, you will be able to do the following:</span></div>
<div style="position:absolute;left:125.99px;top:502.81px" class="cls_008"><span class="cls_008">•  Name three of the most important characteristics of a container image</span></div>
<div style="position:absolute;left:125.99px;top:519.73px" class="cls_008"><span class="cls_008">•  Create a custom image by interactively changing the container layer and</span></div>
<div style="position:absolute;left:143.98px;top:532.33px" class="cls_008"><span class="cls_008">committing it</span></div>
<div style="position:absolute;left:125.99px;top:549.24px" class="cls_008"><span class="cls_008">•  Author a simple Dockerfile using keywords such as </span><span class="cls_010">FROM</span><span class="cls_008">, </span><span class="cls_010">COPY</span><span class="cls_008">, </span><span class="cls_010">RUN</span><span class="cls_008">, </span><span class="cls_010">CMD</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:144.00px;top:561.85px" class="cls_008"><span class="cls_008">and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> to generate a custom image</span></div>
<div style="position:absolute;left:126.00px;top:578.77px" class="cls_008"><span class="cls_008">•  Export an existing image using </span><span class="cls_010">docker image save</span><span class="cls_008"> and import it into</span></div>
<div style="position:absolute;left:144.00px;top:591.37px" class="cls_008"><span class="cls_008">another Docker host using </span><span class="cls_010">docker image load</span></div>
<div style="position:absolute;left:126.00px;top:608.29px" class="cls_008"><span class="cls_008">•  Write a two-step Dockerfile that minimizes the size of the resulting image</span></div>
<div style="position:absolute;left:144.00px;top:620.89px" class="cls_008"><span class="cls_008">by only including the resulting artifacts (binaries) in the final image</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 55 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:58546px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background079.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">What are images?</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">In Linux, everything is a file. The whole operating system is basically a filesystem</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">with files and folders stored on the local disk. This is an important fact to remember</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">when looking at what container images are. As we will see, an image is basically a</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">big tarball containing a filesystem. More specifically, it contains a layered filesystem.</span></div>
<div style="position:absolute;left:108.00px;top:204.64px" class="cls_022"><span class="cls_022">The layered filesystem</span></div>
<div style="position:absolute;left:108.00px;top:227.62px" class="cls_008"><span class="cls_008">Container images are templates from which containers are created. These images are</span></div>
<div style="position:absolute;left:108.00px;top:240.22px" class="cls_008"><span class="cls_008">not just one monolithic block, but are composed of many layers. The first layer in the</span></div>
<div style="position:absolute;left:108.00px;top:252.82px" class="cls_008"><span class="cls_008">image is called the base layer:</span></div>
<div style="position:absolute;left:253.68px;top:411.37px" class="cls_026"><span class="cls_026">The image as a stack of layers</span></div>
<div style="position:absolute;left:108.00px;top:430.11px" class="cls_008"><span class="cls_008">Each individual layer contains files and folders. Each layer only contains the</span></div>
<div style="position:absolute;left:108.00px;top:442.71px" class="cls_008"><span class="cls_008">changes to the filesystem with respect to the underlying layers. Docker uses a union</span></div>
<div style="position:absolute;left:108.00px;top:455.31px" class="cls_008"><span class="cls_008">filesystem—as discussed in </span><span class="cls_021">Chapter 3</span><span class="cls_008">, </span><span class="cls_021">Working with Containers</span><span class="cls_008">—to create a virtual</span></div>
<div style="position:absolute;left:108.00px;top:467.91px" class="cls_008"><span class="cls_008">filesystem out of the set of layers. A storage driver handles the details regarding the</span></div>
<div style="position:absolute;left:108.00px;top:480.51px" class="cls_008"><span class="cls_008">way these layers interact with each other. Different storage drivers are available that</span></div>
<div style="position:absolute;left:108.00px;top:493.11px" class="cls_008"><span class="cls_008">have advantages and disadvantages in different situations.</span></div>
<div style="position:absolute;left:108.00px;top:514.35px" class="cls_008"><span class="cls_008">The layers of a container image are all immutable. Immutable means that once</span></div>
<div style="position:absolute;left:108.00px;top:526.95px" class="cls_008"><span class="cls_008">generated, the layer cannot ever be changed. The only possible operation affecting</span></div>
<div style="position:absolute;left:108.00px;top:539.55px" class="cls_008"><span class="cls_008">the layer is the physical deletion of it. This immutability of layers is important</span></div>
<div style="position:absolute;left:108.00px;top:552.15px" class="cls_008"><span class="cls_008">because it opens up a tremendous amount of opportunities, as we will see.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 56 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:59348px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background080.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the following image, we can see what a custom image for a web application using</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">Nginx as a web server could look like:</span></div>
<div style="position:absolute;left:213.70px;top:208.11px" class="cls_026"><span class="cls_026">A sample custom image based on Alpine and Nginx</span></div>
<div style="position:absolute;left:108.00px;top:226.85px" class="cls_008"><span class="cls_008">Our base layer here consists of the Alpine Linux distribution. Then, on top of that,</span></div>
<div style="position:absolute;left:108.00px;top:239.45px" class="cls_008"><span class="cls_008">we have a layer where Nginx is added on top of Alpine. Finally, the third layer</span></div>
<div style="position:absolute;left:108.00px;top:252.05px" class="cls_008"><span class="cls_008">contains all the files that make up the web application, such as HTML, CSS, and</span></div>
<div style="position:absolute;left:108.00px;top:264.65px" class="cls_008"><span class="cls_008">JavaScript files.</span></div>
<div style="position:absolute;left:108.00px;top:285.89px" class="cls_008"><span class="cls_008">As has been said previously, each image starts with a base image. Typically, this</span></div>
<div style="position:absolute;left:108.00px;top:298.49px" class="cls_008"><span class="cls_008">base image is one of the official images found on Docker Hub, such as a Linux distro,</span></div>
<div style="position:absolute;left:108.00px;top:311.09px" class="cls_008"><span class="cls_008">Alpine, Ubuntu, or CentOS. However, it is also possible to create an image from</span></div>
<div style="position:absolute;left:108.00px;top:323.69px" class="cls_008"><span class="cls_008">scratch.</span></div>
<div style="position:absolute;left:165.37px;top:359.08px" class="cls_025"><span class="cls_025">Docker Hub is a public registry for container images. It is a central hub</span></div>
<div style="position:absolute;left:165.37px;top:370.48px" class="cls_025"><span class="cls_025">ideally suited for sharing public container images.</span></div>
<div style="position:absolute;left:108.00px;top:401.57px" class="cls_008"><span class="cls_008">Each layer only contains the delta of changes in regard to the previous set of layers.</span></div>
<div style="position:absolute;left:108.00px;top:414.17px" class="cls_008"><span class="cls_008">The content of each layer is mapped to a special folder on the host system, which is</span></div>
<div style="position:absolute;left:108.00px;top:426.77px" class="cls_008"><span class="cls_008">usually a subfolder of </span><span class="cls_010">/var/lib/docker/</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:448.01px" class="cls_008"><span class="cls_008">Since layers are immutable, they can be cached without ever becoming stale. This is</span></div>
<div style="position:absolute;left:108.00px;top:460.61px" class="cls_008"><span class="cls_008">a big advantage, as we will see.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 57 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:60150px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background081.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">The writable container layer</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">As we have discussed, a container image is made of a stack of immutable or read-</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">only layers. When the Docker engine creates a container from such an image, it adds</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">a writable container layer on top of this stack of immutable layers. Our stack now</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">looks as follows:</span></div>
<div style="position:absolute;left:256.16px;top:313.17px" class="cls_026"><span class="cls_026">The writable container layer</span></div>
<div style="position:absolute;left:108.00px;top:331.91px" class="cls_008"><span class="cls_008">The container layer is marked as read/write. Another advantage of the immutability</span></div>
<div style="position:absolute;left:108.00px;top:344.51px" class="cls_008"><span class="cls_008">of image layers is that they can be shared among many containers created from this</span></div>
<div style="position:absolute;left:108.00px;top:357.11px" class="cls_008"><span class="cls_008">image. All that is needed is a thin, writable container layer for each container:</span></div>
<div style="position:absolute;left:216.98px;top:558.54px" class="cls_026"><span class="cls_026">Multiple containers sharing the same image layers</span></div>
<div style="position:absolute;left:108.00px;top:577.28px" class="cls_008"><span class="cls_008">This technique, of course, results in a tremendous reduction of resources that are</span></div>
<div style="position:absolute;left:108.00px;top:589.88px" class="cls_008"><span class="cls_008">consumed. Furthermore, this helps to decrease the loading time of a container since</span></div>
<div style="position:absolute;left:108.00px;top:602.48px" class="cls_008"><span class="cls_008">only a thin container layer has to be created once the image layers have been loaded</span></div>
<div style="position:absolute;left:108.00px;top:615.08px" class="cls_008"><span class="cls_008">into memory, which only happens for the first container.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 58 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:60952px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background082.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Copy-on-write</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Docker uses the copy-on-write technique when dealing with images. Copy-on-write</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">is a strategy of sharing and copying files for maximum efficiency. If a layer uses a file</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">or folder that is available in one of the low-lying layers, then it just uses it. If, on the</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">other hand, a layer wants to modify, say, a file from a low-lying layer, then it first</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">copies this file up to the target layer and then modifies it. In the following figure,</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">we can see a glimpse of what this means:</span></div>
<div style="position:absolute;left:279.88px;top:366.37px" class="cls_026"><span class="cls_026">Copy-on-write</span></div>
<div style="position:absolute;left:108.00px;top:385.11px" class="cls_008"><span class="cls_008">The second layer wants to modify </span><span class="cls_009">File 2</span><span class="cls_008">, which is present in the base layer. Thus, it</span></div>
<div style="position:absolute;left:108.00px;top:397.71px" class="cls_008"><span class="cls_008">copied it up and then modified it. Now, let's say that we're sitting in the top layer of</span></div>
<div style="position:absolute;left:108.00px;top:410.31px" class="cls_008"><span class="cls_008">the preceding figure. This layer will use </span><span class="cls_009">File 1</span><span class="cls_008"> from the base layer and </span><span class="cls_009">File 2</span><span class="cls_008"> and </span><span class="cls_009">File</span></div>
<div style="position:absolute;left:108.00px;top:422.91px" class="cls_009"><span class="cls_009">3</span><span class="cls_008"> from the second layer.</span></div>
<div style="position:absolute;left:108.00px;top:452.85px" class="cls_022"><span class="cls_022">Graph drivers</span></div>
<div style="position:absolute;left:108.00px;top:475.83px" class="cls_008"><span class="cls_008">Graph drivers are what enable the union filesystem. Graph drivers are also called</span></div>
<div style="position:absolute;left:108.00px;top:488.43px" class="cls_008"><span class="cls_008">storage drivers and are used when dealing with the layered container images. A</span></div>
<div style="position:absolute;left:108.00px;top:501.03px" class="cls_008"><span class="cls_008">graph driver consolidates the multiple image layers into a root filesystem for the</span></div>
<div style="position:absolute;left:108.00px;top:513.63px" class="cls_008"><span class="cls_008">mount namespace of the container. Or, put differently, the driver controls how</span></div>
<div style="position:absolute;left:108.00px;top:526.23px" class="cls_008"><span class="cls_008">images and containers are stored and managed on the Docker host.</span></div>
<div style="position:absolute;left:108.00px;top:547.48px" class="cls_008"><span class="cls_008">Docker supports several different graph drivers using a pluggable architecture.</span></div>
<div style="position:absolute;left:108.00px;top:560.08px" class="cls_008"><span class="cls_008">The preferred driver is overlay2 followed by overlay.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 59 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:61754px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background083.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Creating images</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">There are three ways to create a new container image on your system. The first one is</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">by interactively building a container that contains all the additions and changes one</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">desires and then committing those changes into a new image. The second and most</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">important way is to use a Dockerfile to describe what's in the new image and then</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">build this image using that Dockerfile as a manifest. Finally, the third way of</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">creating an image is by importing it into the system from a tarball.</span></div>
<div style="position:absolute;left:108.00px;top:221.14px" class="cls_008"><span class="cls_008">Now, let's look at these three ways in detail.</span></div>
<div style="position:absolute;left:108.00px;top:251.08px" class="cls_022"><span class="cls_022">Interactive image creation</span></div>
<div style="position:absolute;left:108.00px;top:274.06px" class="cls_008"><span class="cls_008">The first way we can create a custom image is by interactively building a container.</span></div>
<div style="position:absolute;left:108.00px;top:286.66px" class="cls_008"><span class="cls_008">That is, we start with a base image that we want to use as a template and run</span></div>
<div style="position:absolute;left:108.00px;top:299.26px" class="cls_008"><span class="cls_008">a container of it interactively. Let's say that this is the </span><span class="cls_010">alpine</span><span class="cls_008"> image.</span></div>
<div style="position:absolute;left:108.00px;top:311.86px" class="cls_008"><span class="cls_008">The command to run the container would then be as follows:</span></div>
<div style="position:absolute;left:126.00px;top:332.80px" class="cls_024"><span class="cls_024">$ docker container run -it --name sample alpine /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:352.54px" class="cls_008"><span class="cls_008">By default, the alpine container does not have the </span><span class="cls_010">ping</span><span class="cls_008"> tool installed. Let's assume</span></div>
<div style="position:absolute;left:108.00px;top:365.14px" class="cls_008"><span class="cls_008">we want to create a new custom image that has </span><span class="cls_010">ping</span><span class="cls_008"> installed. Inside the container,</span></div>
<div style="position:absolute;left:107.99px;top:377.74px" class="cls_008"><span class="cls_008">we can then run the following command:</span></div>
<div style="position:absolute;left:126.00px;top:398.68px" class="cls_024"><span class="cls_024">/ # apk update && apk add iputils</span></div>
<div style="position:absolute;left:108.00px;top:418.42px" class="cls_008"><span class="cls_008">This uses the Alpine package manager </span><span class="cls_010">apk</span><span class="cls_008"> to install the </span><span class="cls_010">iputils</span><span class="cls_008"> library, of which</span></div>
<div style="position:absolute;left:108.00px;top:431.02px" class="cls_010"><span class="cls_010">ping</span><span class="cls_008"> is a part. The output of the preceding command should look as follows:</span></div>
<div style="position:absolute;left:126.00px;top:451.96px" class="cls_024"><span class="cls_024">fetch </span><A HREF="http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/apkindex./">http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/APKINDEX.</A> </div>
<div style="position:absolute;left:126.00px;top:462.76px" class="cls_024"><span class="cls_024">tar.gz</span></div>
<div style="position:absolute;left:126.00px;top:475.00px" class="cls_024"><span class="cls_024">fetch </span><A HREF="http://dl-cdn.alpinelinux.org/alpine/v3.7/community/x86_64/">http://dl-cdn.alpinelinux.org/alpine/v3.7/community/x86_64/</A> </div>
<div style="position:absolute;left:126.00px;top:485.80px" class="cls_024"><span class="cls_024">APKINDEX.tar.gz</span></div>
<div style="position:absolute;left:126.00px;top:498.04px" class="cls_024"><span class="cls_024">v3.7.0-50-gc8da5122a4 [</span><A HREF="http://dl-cdn.alpinelinux.org/alpine/v3.7/main/">http://dl-cdn.alpinelinux.org/alpine/v3.7/main</A>]</div>
<div style="position:absolute;left:126.00px;top:510.28px" class="cls_024"><span class="cls_024">v3.7.0-49-g06d6ae04c3 [</span><A HREF="http://dl-cdn.alpinelinux.org/alpine/v3.7/">http://dl-cdn.alpinelinux.org/alpine/v3.7/</A> </div>
<div style="position:absolute;left:126.00px;top:521.08px" class="cls_024"><span class="cls_024">community]</span></div>
<div style="position:absolute;left:126.00px;top:533.32px" class="cls_024"><span class="cls_024">OK: 9046 distinct packages available</span></div>
<div style="position:absolute;left:126.00px;top:545.56px" class="cls_024"><span class="cls_024">(1/2) Installing libcap (2.25-r1)</span></div>
<div style="position:absolute;left:126.00px;top:557.80px" class="cls_024"><span class="cls_024">(2/2) Installing iputils (20121221-r8)</span></div>
<div style="position:absolute;left:126.00px;top:570.04px" class="cls_024"><span class="cls_024">Executing busybox-1.27.2-r6.trigger</span></div>
<div style="position:absolute;left:126.00px;top:582.28px" class="cls_024"><span class="cls_024">OK: 4 MiB in 13 packages</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 60 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:62556px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background084.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, we can indeed use </span><span class="cls_010">ping</span><span class="cls_008">, as the following snippet shows:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">/ # ping 127.0.0.1</span></div>
<div style="position:absolute;left:126.00px;top:147.67px" class="cls_024"><span class="cls_024">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span></div>
<div style="position:absolute;left:126.00px;top:159.91px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.028 ms</span></div>
<div style="position:absolute;left:126.00px;top:172.15px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.044 ms</span></div>
<div style="position:absolute;left:126.00px;top:184.39px" class="cls_024"><span class="cls_024">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.049 ms</span></div>
<div style="position:absolute;left:126.00px;top:196.63px" class="cls_024"><span class="cls_024">^C</span></div>
<div style="position:absolute;left:126.00px;top:208.87px" class="cls_024"><span class="cls_024">--- 127.0.0.1 ping statistics ---</span></div>
<div style="position:absolute;left:126.00px;top:221.11px" class="cls_024"><span class="cls_024">3 packets transmitted, 3 received, 0% packet loss, time 2108ms</span></div>
<div style="position:absolute;left:126.00px;top:233.35px" class="cls_024"><span class="cls_024">rtt min/avg/max/mdev = 0.028/0.040/0.049/0.010 ms</span></div>
<div style="position:absolute;left:108.00px;top:253.09px" class="cls_008"><span class="cls_008">Once we have finished our customization, we can quit the container by typing </span><span class="cls_010">exit</span></div>
<div style="position:absolute;left:108.00px;top:265.69px" class="cls_008"><span class="cls_008">at the prompt. If we now list all containers with </span><span class="cls_010">docker container ls -a</span><span class="cls_008">, we can</span></div>
<div style="position:absolute;left:108.00px;top:278.29px" class="cls_008"><span class="cls_008">see that our sample container has a status of </span><span class="cls_010">Exited</span><span class="cls_008">, but still exists on the system:</span></div>
<div style="position:absolute;left:126.00px;top:299.23px" class="cls_024"><span class="cls_024">$ docker container ls -a | grep sample</span></div>
<div style="position:absolute;left:126.00px;top:311.47px" class="cls_024"><span class="cls_024">eff7c92a1b98</span></div>
<div style="position:absolute;left:212.40px;top:311.47px" class="cls_024"><span class="cls_024">alpine</span></div>
<div style="position:absolute;left:266.40px;top:311.47px" class="cls_024"><span class="cls_024">"/bin/sh"</span></div>
<div style="position:absolute;left:336.60px;top:311.47px" class="cls_024"><span class="cls_024">2 minutes ago</span></div>
<div style="position:absolute;left:439.20px;top:311.47px" class="cls_024"><span class="cls_024">Exited (0)</span></div>
<div style="position:absolute;left:108.00px;top:342.01px" class="cls_008"><span class="cls_008">If we want to see what has changed in our container in relation to the base image,</span></div>
<div style="position:absolute;left:108.00px;top:354.61px" class="cls_008"><span class="cls_008">we can use the </span><span class="cls_010">docker container diff</span><span class="cls_008"> command as follows:</span></div>
<div style="position:absolute;left:126.00px;top:375.55px" class="cls_024"><span class="cls_024">$ docker container diff sample</span></div>
<div style="position:absolute;left:108.00px;top:395.29px" class="cls_008"><span class="cls_008">The output should present a list of all modifications done on the filesystem of the</span></div>
<div style="position:absolute;left:108.00px;top:407.89px" class="cls_008"><span class="cls_008">container:</span></div>
<div style="position:absolute;left:126.00px;top:428.83px" class="cls_024"><span class="cls_024">C /bin</span></div>
<div style="position:absolute;left:126.00px;top:441.07px" class="cls_024"><span class="cls_024">C /bin/ping</span></div>
<div style="position:absolute;left:126.00px;top:453.31px" class="cls_024"><span class="cls_024">C /bin/ping6</span></div>
<div style="position:absolute;left:126.00px;top:465.55px" class="cls_024"><span class="cls_024">A /bin/traceroute6</span></div>
<div style="position:absolute;left:126.00px;top:477.79px" class="cls_024"><span class="cls_024">C /etc/apk</span></div>
<div style="position:absolute;left:126.00px;top:490.03px" class="cls_024"><span class="cls_024">C /etc/apk/world</span></div>
<div style="position:absolute;left:126.00px;top:502.27px" class="cls_024"><span class="cls_024">C /lib/apk/db</span></div>
<div style="position:absolute;left:126.00px;top:514.51px" class="cls_024"><span class="cls_024">C /lib/apk/db/installed</span></div>
<div style="position:absolute;left:126.00px;top:526.75px" class="cls_024"><span class="cls_024">C /lib/apk/db/lock</span></div>
<div style="position:absolute;left:126.00px;top:538.99px" class="cls_024"><span class="cls_024">C /lib/apk/db/scripts.tar</span></div>
<div style="position:absolute;left:126.00px;top:551.23px" class="cls_024"><span class="cls_024">C /lib/apk/db/triggers</span></div>
<div style="position:absolute;left:126.00px;top:563.47px" class="cls_024"><span class="cls_024">C /root</span></div>
<div style="position:absolute;left:126.00px;top:575.71px" class="cls_024"><span class="cls_024">A /root/.ash_history</span></div>
<div style="position:absolute;left:126.00px;top:587.95px" class="cls_024"><span class="cls_024">C /usr/lib</span></div>
<div style="position:absolute;left:126.00px;top:600.19px" class="cls_024"><span class="cls_024">A /usr/lib/libcap.so.2</span></div>
<div style="position:absolute;left:126.00px;top:612.43px" class="cls_024"><span class="cls_024">A /usr/lib/libcap.so.2.25</span></div>
<div style="position:absolute;left:126.00px;top:624.67px" class="cls_024"><span class="cls_024">C /usr/sbin</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 61 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:63358px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background085.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:126.00px;top:114.01px" class="cls_024"><span class="cls_024">C /usr/sbin/arping</span></div>
<div style="position:absolute;left:126.00px;top:126.25px" class="cls_024"><span class="cls_024">A /usr/sbin/capsh</span></div>
<div style="position:absolute;left:126.00px;top:138.49px" class="cls_024"><span class="cls_024">A /usr/sbin/clockdiff</span></div>
<div style="position:absolute;left:126.00px;top:150.73px" class="cls_024"><span class="cls_024">A /usr/sbin/getcap</span></div>
<div style="position:absolute;left:126.00px;top:162.97px" class="cls_024"><span class="cls_024">A /usr/sbin/getpcaps</span></div>
<div style="position:absolute;left:126.00px;top:175.21px" class="cls_024"><span class="cls_024">A /usr/sbin/ipg</span></div>
<div style="position:absolute;left:126.00px;top:187.45px" class="cls_024"><span class="cls_024">A /usr/sbin/rarpd</span></div>
<div style="position:absolute;left:126.00px;top:199.69px" class="cls_024"><span class="cls_024">A /usr/sbin/rdisc</span></div>
<div style="position:absolute;left:126.00px;top:211.93px" class="cls_024"><span class="cls_024">A /usr/sbin/setcap</span></div>
<div style="position:absolute;left:126.00px;top:224.17px" class="cls_024"><span class="cls_024">A /usr/sbin/tftpd</span></div>
<div style="position:absolute;left:126.00px;top:236.41px" class="cls_024"><span class="cls_024">A /usr/sbin/tracepath</span></div>
<div style="position:absolute;left:126.00px;top:248.65px" class="cls_024"><span class="cls_024">A /usr/sbin/tracepath6</span></div>
<div style="position:absolute;left:126.00px;top:260.89px" class="cls_024"><span class="cls_024">C /var/cache/apk</span></div>
<div style="position:absolute;left:126.00px;top:273.13px" class="cls_024"><span class="cls_024">A /var/cache/apk/APKINDEX.5022a8a2.tar.gz</span></div>
<div style="position:absolute;left:126.00px;top:285.37px" class="cls_024"><span class="cls_024">A /var/cache/apk/APKINDEX.70c88391.tar.gz</span></div>
<div style="position:absolute;left:126.00px;top:297.61px" class="cls_024"><span class="cls_024">C /var/cache/misc</span></div>
<div style="position:absolute;left:108.00px;top:317.34px" class="cls_008"><span class="cls_008">In the preceding list, </span><span class="cls_010">A</span><span class="cls_008"> stands for </span><span class="cls_021">added</span><span class="cls_008">, and </span><span class="cls_010">C</span><span class="cls_008"> for </span><span class="cls_021">changed</span><span class="cls_008">. If we had any deleted files,</span></div>
<div style="position:absolute;left:108.00px;top:329.94px" class="cls_008"><span class="cls_008">then those would be prefixed with </span><span class="cls_010">D</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:351.18px" class="cls_008"><span class="cls_008">We can now use the </span><span class="cls_010">docker container commit</span><span class="cls_008"> command to persist our</span></div>
<div style="position:absolute;left:108.00px;top:363.78px" class="cls_008"><span class="cls_008">modifications and create a new image from them:</span></div>
<div style="position:absolute;left:126.00px;top:384.72px" class="cls_024"><span class="cls_024">$ docker container commit sample my-alpine</span></div>
<div style="position:absolute;left:126.00px;top:396.96px" class="cls_024"><span class="cls_024">sha256:44bca4141130ee8702e8e8efd1beb3cf4fe5aadb62a0c69a6995afd49c</span></div>
<div style="position:absolute;left:126.00px;top:407.76px" class="cls_024"><span class="cls_024">2e7419</span></div>
<div style="position:absolute;left:108.00px;top:427.50px" class="cls_008"><span class="cls_008">With the preceding command, we have specified that the new image shall be called</span></div>
<div style="position:absolute;left:108.00px;top:440.10px" class="cls_010"><span class="cls_010">my-alpine</span><span class="cls_008">. The output generated by the preceding command corresponds to the ID</span></div>
<div style="position:absolute;left:108.00px;top:452.70px" class="cls_008"><span class="cls_008">of the newly generated image. We can verify this by listing all images on our system,</span></div>
<div style="position:absolute;left:108.00px;top:465.30px" class="cls_008"><span class="cls_008">as follows:</span></div>
<div style="position:absolute;left:126.00px;top:486.24px" class="cls_024"><span class="cls_024">$ docker image ls</span></div>
<div style="position:absolute;left:108.00px;top:505.98px" class="cls_008"><span class="cls_008">We can see this image ID (shortened) as follows:</span></div>
<div style="position:absolute;left:126.00px;top:526.92px" class="cls_024"><span class="cls_024">REPOSITORY TAG</span></div>
<div style="position:absolute;left:234.00px;top:526.92px" class="cls_024"><span class="cls_024">IMAGE ID</span></div>
<div style="position:absolute;left:320.40px;top:526.92px" class="cls_024"><span class="cls_024">CREATED</span></div>
<div style="position:absolute;left:439.20px;top:526.92px" class="cls_024"><span class="cls_024">SIZE</span></div>
<div style="position:absolute;left:126.00px;top:539.16px" class="cls_024"><span class="cls_024">my-alpine  latest</span></div>
<div style="position:absolute;left:234.00px;top:539.16px" class="cls_024"><span class="cls_024">44bca4141130</span></div>
<div style="position:absolute;left:320.40px;top:539.16px" class="cls_024"><span class="cls_024">About a minute ago</span></div>
<div style="position:absolute;left:439.20px;top:539.16px" class="cls_024"><span class="cls_024">5.64MB</span></div>
<div style="position:absolute;left:108.00px;top:571.14px" class="cls_008"><span class="cls_008">We can see that the image  named </span><span class="cls_010">my-alpine</span><span class="cls_008">, has the expected ID of </span><span class="cls_010">44bca4141130</span></div>
<div style="position:absolute;left:108.00px;top:583.74px" class="cls_008"><span class="cls_008">and automatically got a tag </span><span class="cls_010">latest</span><span class="cls_008"> assigned. This happens since we did not</span></div>
<div style="position:absolute;left:108.00px;top:596.34px" class="cls_008"><span class="cls_008">explicitly define a tag ourselves. In this case, Docker always defaults to the tag</span></div>
<div style="position:absolute;left:108.00px;top:608.94px" class="cls_010"><span class="cls_010">latest</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 62 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:64160px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background086.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we want to see how our custom image has been built, we can use the history</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">command as follows:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker image history my-alpine</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">This will print the list of layers our image consists of:</span></div>
<div style="position:absolute;left:126.00px;top:188.71px" class="cls_024"><span class="cls_024">IMAGE</span></div>
<div style="position:absolute;left:217.80px;top:188.71px" class="cls_024"><span class="cls_024">CREATED</span></div>
<div style="position:absolute;left:304.20px;top:188.71px" class="cls_024"><span class="cls_024">CREATED BY</span></div>
<div style="position:absolute;left:412.20px;top:188.71px" class="cls_024"><span class="cls_024">SIZE</span></div>
<div style="position:absolute;left:126.00px;top:199.51px" class="cls_024"><span class="cls_024">COMMENT</span></div>
<div style="position:absolute;left:126.00px;top:211.75px" class="cls_024"><span class="cls_024">44bca4141130</span></div>
<div style="position:absolute;left:217.80px;top:211.75px" class="cls_024"><span class="cls_024">3 minutes ago</span></div>
<div style="position:absolute;left:304.20px;top:211.75px" class="cls_024"><span class="cls_024">/bin/sh</span></div>
<div style="position:absolute;left:412.20px;top:211.75px" class="cls_024"><span class="cls_024">1.5MB</span></div>
<div style="position:absolute;left:126.00px;top:223.99px" class="cls_024"><span class="cls_024">e21c333399e0</span></div>
<div style="position:absolute;left:217.80px;top:223.99px" class="cls_024"><span class="cls_024">6 weeks ago</span></div>
<div style="position:absolute;left:304.20px;top:223.99px" class="cls_024"><span class="cls_024">/bin/sh -c #...</span></div>
<div style="position:absolute;left:412.20px;top:223.99px" class="cls_024"><span class="cls_024">0B</span></div>
<div style="position:absolute;left:126.00px;top:236.23px" class="cls_024"><span class="cls_024">&lt;missing></span></div>
<div style="position:absolute;left:217.80px;top:236.23px" class="cls_024"><span class="cls_024">6 weeks ago</span></div>
<div style="position:absolute;left:304.20px;top:236.23px" class="cls_024"><span class="cls_024">/bin/sh -c #...</span></div>
<div style="position:absolute;left:412.20px;top:236.23px" class="cls_024"><span class="cls_024">4.14MB</span></div>
<div style="position:absolute;left:108.00px;top:255.97px" class="cls_008"><span class="cls_008">The first layer in the preceding list is the one that we just created by adding the</span></div>
<div style="position:absolute;left:108.00px;top:268.57px" class="cls_010"><span class="cls_010">iputils</span><span class="cls_008"> package.</span></div>
<div style="position:absolute;left:108.00px;top:298.51px" class="cls_022"><span class="cls_022">Using Dockerfiles</span></div>
<div style="position:absolute;left:108.00px;top:321.49px" class="cls_008"><span class="cls_008">Manually creating custom images as shown in the previous section of this chapter</span></div>
<div style="position:absolute;left:108.00px;top:334.09px" class="cls_008"><span class="cls_008">is very helpful when doing exploration, creating prototypes, or making feasibility</span></div>
<div style="position:absolute;left:108.00px;top:346.69px" class="cls_008"><span class="cls_008">studies. But it has a serious drawback: it is a manual process and thus is not</span></div>
<div style="position:absolute;left:108.00px;top:359.29px" class="cls_008"><span class="cls_008">repeatable or scalable. It is also as error-prone as any task executed manually</span></div>
<div style="position:absolute;left:108.00px;top:371.89px" class="cls_008"><span class="cls_008">by humans. There must be a better way.</span></div>
<div style="position:absolute;left:108.00px;top:393.14px" class="cls_008"><span class="cls_008">This is where the so-called Dockerfile comes into play. The Dockerfile is a text file</span></div>
<div style="position:absolute;left:108.00px;top:405.74px" class="cls_008"><span class="cls_008">that is usually literally called Dockerfile. It contains instructions on how to build</span></div>
<div style="position:absolute;left:108.00px;top:418.34px" class="cls_008"><span class="cls_008">a custom container image. It is a declarative way of building images.</span></div>
<div style="position:absolute;left:165.37px;top:450.27px" class="cls_025"><span class="cls_025">Declarative versus imperative</span></div>
<div style="position:absolute;left:165.37px;top:465.99px" class="cls_025"><span class="cls_025">In computer science, in general and with Docker specifically, one often</span></div>
<div style="position:absolute;left:165.37px;top:477.39px" class="cls_025"><span class="cls_025">uses a declarative way of defining a task. One describes the expected</span></div>
<div style="position:absolute;left:165.37px;top:488.79px" class="cls_025"><span class="cls_025">outcome and lets the system figure out how to achieve this goal, rather</span></div>
<div style="position:absolute;left:165.37px;top:500.19px" class="cls_025"><span class="cls_025">than giving step-by-step instructions to the system on how to achieve this</span></div>
<div style="position:absolute;left:165.37px;top:511.59px" class="cls_025"><span class="cls_025">desired outcome. The latter is the imperative approach.</span></div>
<div style="position:absolute;left:108.00px;top:539.21px" class="cls_008"><span class="cls_008">Let's look at a sample Dockerfile:</span></div>
<div style="position:absolute;left:126.00px;top:560.15px" class="cls_024"><span class="cls_024">FROM python:2.7</span></div>
<div style="position:absolute;left:126.00px;top:572.39px" class="cls_024"><span class="cls_024">RUN mkdir -p /app</span></div>
<div style="position:absolute;left:126.00px;top:584.63px" class="cls_024"><span class="cls_024">WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:596.87px" class="cls_024"><span class="cls_024">COPY ./requirements.txt /app/</span></div>
<div style="position:absolute;left:126.00px;top:609.11px" class="cls_024"><span class="cls_024">RUN pip install -r requirements.txt</span></div>
<div style="position:absolute;left:126.00px;top:621.35px" class="cls_024"><span class="cls_024">CMD ["python", "main.py"]</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 63 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:64962px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background087.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This is a Dockerfile as it is used to containerize a Python 2.7 application. As we can</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">see, the file has six lines, each starting with a keyword such as </span><span class="cls_010">FROM</span><span class="cls_008">, </span><span class="cls_010">RUN</span><span class="cls_008">, or </span><span class="cls_010">COPY</span><span class="cls_008">. It</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">is a convention to write the keywords in all caps, but that is not a must.</span></div>
<div style="position:absolute;left:108.00px;top:160.94px" class="cls_008"><span class="cls_008">Each line of the Dockerfile results in a layer in the resulting image. In the following</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">image, the image is drawn upside down compared to the previous illustrations in</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">this chapter, showing an image as a stack of layers. Here, the base layer is shown</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">on top. Don't let yourself be confused by this. In reality, the base layer is always the</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">lowest layer in the stack:</span></div>
<div style="position:absolute;left:219.79px;top:390.16px" class="cls_026"><span class="cls_026">The relation of Dockerfile and layers in an image</span></div>
<div style="position:absolute;left:108.00px;top:408.90px" class="cls_008"><span class="cls_008">Now let's look at the individual keywords in more detail.</span></div>
<div style="position:absolute;left:108.00px;top:437.00px" class="cls_028"><span class="cls_028">The FROM keyword</span></div>
<div style="position:absolute;left:108.00px;top:457.98px" class="cls_008"><span class="cls_008">Most Dockerfiles start with the </span><span class="cls_010">FROM</span><span class="cls_008"> keyword. With it, we define which base image</span></div>
<div style="position:absolute;left:108.00px;top:470.58px" class="cls_008"><span class="cls_008">we want to start building our custom image from. If we want to build starting with</span></div>
<div style="position:absolute;left:108.01px;top:483.18px" class="cls_008"><span class="cls_008">CentOS 7, for example, we would have the following line in the Dockerfile:</span></div>
<div style="position:absolute;left:126.00px;top:504.12px" class="cls_023"><span class="cls_023">FROM centos:7</span></div>
<div style="position:absolute;left:108.00px;top:523.86px" class="cls_008"><span class="cls_008">On Docker Hub, there are curated or official images for all major Linux distros, as</span></div>
<div style="position:absolute;left:108.00px;top:536.46px" class="cls_008"><span class="cls_008">well as for all important development frameworks or languages, such as Python,</span></div>
<div style="position:absolute;left:108.00px;top:549.06px" class="cls_008"><span class="cls_008">Node JS, Ruby, Go, and many more. Depending on our need, we should select the</span></div>
<div style="position:absolute;left:108.00px;top:561.66px" class="cls_008"><span class="cls_008">most appropriate base image.</span></div>
<div style="position:absolute;left:108.00px;top:582.91px" class="cls_008"><span class="cls_008">For example, if I want to containerize a Python 2.7 application, I might want to select</span></div>
<div style="position:absolute;left:108.00px;top:595.50px" class="cls_008"><span class="cls_008">the relevant official </span><span class="cls_010">python:2.7</span><span class="cls_008"> image.</span></div>
<div style="position:absolute;left:108.00px;top:616.75px" class="cls_008"><span class="cls_008">If we really want to start from scratch, we can also use the following statement:</span></div>
<div style="position:absolute;left:126.00px;top:637.68px" class="cls_023"><span class="cls_023">FROM scratch</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 64 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:65764px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background088.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This is useful in the context of building super minimal images that only, for example,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">contain a single binary, the actual statically linked executable, such as </span><span class="cls_010">Hello-World</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">The scratch image is literally an empty base image.</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_010"><span class="cls_010">FROM scratch</span><span class="cls_008"> is corresponds to a </span><span class="cls_010">no-op</span><span class="cls_008"> (no operation) in the Dockerfile, and as</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_008"><span class="cls_008">such does not generate a layer in the resulting container image.</span></div>
<div style="position:absolute;left:108.00px;top:201.63px" class="cls_028"><span class="cls_028">The RUN keyword</span></div>
<div style="position:absolute;left:108.00px;top:222.61px" class="cls_008"><span class="cls_008">The next important keyword is </span><span class="cls_010">RUN</span><span class="cls_008">. The argument for </span><span class="cls_010">RUN</span><span class="cls_008"> is any valid Linux</span></div>
<div style="position:absolute;left:108.00px;top:235.21px" class="cls_008"><span class="cls_008">command, such as the following:</span></div>
<div style="position:absolute;left:126.00px;top:256.15px" class="cls_024"><span class="cls_024">RUN yum install -y wget</span></div>
<div style="position:absolute;left:108.00px;top:275.89px" class="cls_008"><span class="cls_008">The preceding command is using the CentOS package manager </span><span class="cls_010">yum</span><span class="cls_008"> to install the</span></div>
<div style="position:absolute;left:108.00px;top:288.49px" class="cls_010"><span class="cls_010">wget</span><span class="cls_008"> package into the running container. This assumes that our base image is</span></div>
<div style="position:absolute;left:108.00px;top:301.09px" class="cls_008"><span class="cls_008">CentOS or RHEL. If we had Ubuntu as our base image, then the command would</span></div>
<div style="position:absolute;left:108.00px;top:313.69px" class="cls_008"><span class="cls_008">look similar to the following:</span></div>
<div style="position:absolute;left:126.00px;top:334.63px" class="cls_024"><span class="cls_024">RUN apt-get update && apt-get install -y wget</span></div>
<div style="position:absolute;left:108.00px;top:354.37px" class="cls_008"><span class="cls_008">It would look like this because Ubuntu uses </span><span class="cls_010">apt-get</span><span class="cls_008"> as a package manager.</span></div>
<div style="position:absolute;left:108.00px;top:366.97px" class="cls_008"><span class="cls_008">Similarly, we could define a line with </span><span class="cls_010">RUN</span><span class="cls_008"> like this:</span></div>
<div style="position:absolute;left:126.00px;top:387.91px" class="cls_023"><span class="cls_023">RUN mkdir -p /app && cd /app</span></div>
<div style="position:absolute;left:108.00px;top:407.65px" class="cls_008"><span class="cls_008">We could also do this:</span></div>
<div style="position:absolute;left:126.00px;top:428.59px" class="cls_023"><span class="cls_023">RUN tar -xJC /usr/src/python --strip-components=1 -f python.tar.xz</span></div>
<div style="position:absolute;left:108.00px;top:448.33px" class="cls_008"><span class="cls_008">Here, the former creates a </span><span class="cls_010">/app</span><span class="cls_008"> folder in the container and navigates to it, and the</span></div>
<div style="position:absolute;left:108.00px;top:460.93px" class="cls_008"><span class="cls_008">latter untars a file to a given location. It is completely fine, and even recommended,</span></div>
<div style="position:absolute;left:108.00px;top:473.53px" class="cls_008"><span class="cls_008">for you to format a Linux command using more than one physical line, such as this:</span></div>
<div style="position:absolute;left:126.00px;top:494.47px" class="cls_024"><span class="cls_024">RUN apt-get update \</span></div>
<div style="position:absolute;left:136.80px;top:506.71px" class="cls_024"><span class="cls_024">&& apt-get install -y --no-install-recommends \</span></div>
<div style="position:absolute;left:147.60px;top:518.95px" class="cls_024"><span class="cls_024">ca-certificates \</span></div>
<div style="position:absolute;left:147.60px;top:531.19px" class="cls_024"><span class="cls_024">libexpat1 \</span></div>
<div style="position:absolute;left:147.60px;top:543.43px" class="cls_024"><span class="cls_024">libffi6 \</span></div>
<div style="position:absolute;left:147.60px;top:555.67px" class="cls_024"><span class="cls_024">libgdbm3 \</span></div>
<div style="position:absolute;left:147.60px;top:567.91px" class="cls_024"><span class="cls_024">libreadline7 \</span></div>
<div style="position:absolute;left:147.60px;top:580.15px" class="cls_024"><span class="cls_024">libsqlite3-0 \</span></div>
<div style="position:absolute;left:147.60px;top:592.39px" class="cls_024"><span class="cls_024">libssl1.1 \</span></div>
<div style="position:absolute;left:136.80px;top:604.63px" class="cls_024"><span class="cls_024">&& rm -rf /var/lib/apt/lists/*</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 65 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:66566px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background089.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we use more than one line, we need to put a backslash (</span><span class="cls_010">\</span><span class="cls_008">) at the end of the lines to</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">indicate to the shell that the command continues on the next line.</span></div>
<div style="position:absolute;left:108.00px;top:148.34px" class="cls_008"><span class="cls_008">Try to find out what the preceding command does.</span></div>
<div style="position:absolute;left:108.00px;top:176.43px" class="cls_028"><span class="cls_028">The COPY and ADD keywords</span></div>
<div style="position:absolute;left:108.00px;top:197.41px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">COPY</span><span class="cls_008"> and </span><span class="cls_010">ADD</span><span class="cls_008"> keywords are very important since, in the end, we want to add</span></div>
<div style="position:absolute;left:108.00px;top:210.01px" class="cls_008"><span class="cls_008">some content to an existing base image to make it a custom image. Most of the time,</span></div>
<div style="position:absolute;left:108.00px;top:222.61px" class="cls_008"><span class="cls_008">these are a few source files of, say, a web application or a few binaries of a compiled</span></div>
<div style="position:absolute;left:108.00px;top:235.21px" class="cls_008"><span class="cls_008">application.</span></div>
<div style="position:absolute;left:108.00px;top:256.46px" class="cls_008"><span class="cls_008">These two keywords are used to copy files and folders from the host into the image</span></div>
<div style="position:absolute;left:108.00px;top:269.06px" class="cls_008"><span class="cls_008">that we're building. The two keywords are very similar, with the exception that the</span></div>
<div style="position:absolute;left:108.00px;top:281.65px" class="cls_010"><span class="cls_010">ADD</span><span class="cls_008"> keyword also lets us copy and unpack TAR files, as well as provide a URL as</span></div>
<div style="position:absolute;left:108.00px;top:294.25px" class="cls_008"><span class="cls_008">a source for the files and folders to copy.</span></div>
<div style="position:absolute;left:108.00px;top:315.50px" class="cls_008"><span class="cls_008">Let's look at a few examples of how these two keywords can be used:</span></div>
<div style="position:absolute;left:126.00px;top:336.43px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:126.00px;top:348.67px" class="cls_023"><span class="cls_023">COPY ./web /app/web</span></div>
<div style="position:absolute;left:126.00px;top:360.91px" class="cls_023"><span class="cls_023">COPY sample.txt /data/my-sample.txt</span></div>
<div style="position:absolute;left:126.00px;top:373.15px" class="cls_023"><span class="cls_023">ADD sample.tar /app/bin/</span></div>
<div style="position:absolute;left:126.00px;top:385.39px" class="cls_023"><span class="cls_023">ADD </span><A HREF="http://example.com/sample.txt/">http://example.com/sample.txt</A> /data/</div>
<div style="position:absolute;left:108.00px;top:405.13px" class="cls_008"><span class="cls_008">In the preceding lines of code:</span></div>
<div style="position:absolute;left:126.00px;top:426.38px" class="cls_008"><span class="cls_008">•  The first line copies all files and folders from the current directory recursively</span></div>
<div style="position:absolute;left:143.99px;top:438.97px" class="cls_008"><span class="cls_008">to the </span><span class="cls_010">/app</span><span class="cls_008"> folder inside the container image</span></div>
<div style="position:absolute;left:126.00px;top:455.89px" class="cls_008"><span class="cls_008">•  The second line copies everything in the </span><span class="cls_010">web</span><span class="cls_008"> subfolder to the target folder, </span><span class="cls_010">/</span></div>
<div style="position:absolute;left:144.00px;top:468.29px" class="cls_010"><span class="cls_010">app/web</span></div>
<div style="position:absolute;left:126.00px;top:484.21px" class="cls_008"><span class="cls_008">•  The third line copies a single file, </span><span class="cls_010">sample.txt</span><span class="cls_008">, into the target folder, </span><span class="cls_010">/data</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:144.00px;top:496.81px" class="cls_008"><span class="cls_008">and at the same time, renames it to </span><span class="cls_010">my-sample.txt</span></div>
<div style="position:absolute;left:126.00px;top:513.73px" class="cls_008"><span class="cls_008">•  The fourth statement unpacks the </span><span class="cls_010">sample.tar</span><span class="cls_008"> file into the target folder, </span><span class="cls_010">/</span></div>
<div style="position:absolute;left:144.00px;top:526.13px" class="cls_010"><span class="cls_010">app/bin</span></div>
<div style="position:absolute;left:126.00px;top:542.05px" class="cls_008"><span class="cls_008">•  Finally, the last statement copies the remote file, </span><span class="cls_010">sample.txt</span><span class="cls_008">, into the target</span></div>
<div style="position:absolute;left:144.00px;top:554.65px" class="cls_008"><span class="cls_008">file, </span><span class="cls_010">/data</span></div>
<div style="position:absolute;left:108.00px;top:575.89px" class="cls_008"><span class="cls_008">Wildcards are allowed in the source path. For example, the following statement</span></div>
<div style="position:absolute;left:108.00px;top:588.49px" class="cls_008"><span class="cls_008">copies all files starting with </span><span class="cls_010">sample</span><span class="cls_008"> to the </span><span class="cls_010">mydir</span><span class="cls_008"> folder inside the image:</span></div>
<div style="position:absolute;left:126.00px;top:609.43px" class="cls_023"><span class="cls_023">COPY ./sample* /mydir/</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 66 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:67368px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background090.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">From a security perspective, it is important to know that by default, all files and</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">folders inside the image will have a </span><span class="cls_009">user ID</span><span class="cls_008"> (</span><span class="cls_009">UID</span><span class="cls_008">) and a </span><span class="cls_009">group ID</span><span class="cls_008"> (</span><span class="cls_009">GID</span><span class="cls_008">) of </span><span class="cls_010">0</span><span class="cls_008">. The</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">good thing is that for both </span><span class="cls_010">ADD</span><span class="cls_008"> and </span><span class="cls_010">COPY</span><span class="cls_008">, we can change the ownership that the files</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">will have inside the image using the optional </span><span class="cls_010">--chown</span><span class="cls_008"> flag, as follows:</span></div>
<div style="position:absolute;left:126.00px;top:173.23px" class="cls_023"><span class="cls_023">ADD --chown=11:22 ./data/files* /app/data/</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">The preceding statement will copy all files starting with the name </span><span class="cls_010">web</span><span class="cls_008"> and put them</span></div>
<div style="position:absolute;left:108.00px;top:205.57px" class="cls_008"><span class="cls_008">into the </span><span class="cls_010">/app/data</span><span class="cls_008"> folder in the image, and at the same time assign user </span><span class="cls_010">11</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:108.00px;top:218.17px" class="cls_008"><span class="cls_008">group </span><span class="cls_010">22</span><span class="cls_008"> to these files.</span></div>
<div style="position:absolute;left:108.00px;top:239.42px" class="cls_008"><span class="cls_008">Instead of numbers, one could also use names for the user and group, but then these</span></div>
<div style="position:absolute;left:108.00px;top:252.02px" class="cls_008"><span class="cls_008">entities would have to be already defined in the root filesystem of the image at </span><span class="cls_010">/etc/</span></div>
<div style="position:absolute;left:108.00px;top:264.61px" class="cls_010"><span class="cls_010">passwd</span><span class="cls_008"> and </span><span class="cls_010">/etc/group</span><span class="cls_008"> respectively, otherwise the build of the image would fail.</span></div>
<div style="position:absolute;left:108.00px;top:292.71px" class="cls_028"><span class="cls_028">The WORKDIR keyword</span></div>
<div style="position:absolute;left:108.00px;top:313.69px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">WORKDIR</span><span class="cls_008"> keyword defines the working directory or context that is used when</span></div>
<div style="position:absolute;left:108.00px;top:326.29px" class="cls_008"><span class="cls_008">a container is run from our custom image. So, if I want to set the context to</span></div>
<div style="position:absolute;left:108.00px;top:338.89px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">/app/bin</span><span class="cls_008"> folder inside the image, my expression in the Dockerfile would</span></div>
<div style="position:absolute;left:108.00px;top:351.49px" class="cls_008"><span class="cls_008">have to look as follows:</span></div>
<div style="position:absolute;left:126.00px;top:372.43px" class="cls_023"><span class="cls_023">WORKDIR /app/bin</span></div>
<div style="position:absolute;left:108.00px;top:392.17px" class="cls_008"><span class="cls_008">All activity that happens inside the image after the preceding line will use this</span></div>
<div style="position:absolute;left:108.00px;top:404.77px" class="cls_008"><span class="cls_008">directory as the working directory. It is very important to note that the following</span></div>
<div style="position:absolute;left:108.00px;top:417.37px" class="cls_008"><span class="cls_008">two snippets from a Dockerfile are not the same:</span></div>
<div style="position:absolute;left:126.00px;top:438.31px" class="cls_023"><span class="cls_023">RUN cd /app/bin</span></div>
<div style="position:absolute;left:126.00px;top:450.55px" class="cls_023"><span class="cls_023">RUN touch sample.txt</span></div>
<div style="position:absolute;left:108.00px;top:470.29px" class="cls_008"><span class="cls_008">Compare the preceding code with the following code:</span></div>
<div style="position:absolute;left:126.00px;top:491.23px" class="cls_023"><span class="cls_023">WORKDIR /app/bin</span></div>
<div style="position:absolute;left:126.00px;top:503.47px" class="cls_023"><span class="cls_023">RUN touch sample.txt</span></div>
<div style="position:absolute;left:108.00px;top:523.21px" class="cls_008"><span class="cls_008">The former will create the file in the root of the image filesystem, while the latter</span></div>
<div style="position:absolute;left:108.00px;top:535.81px" class="cls_008"><span class="cls_008">will create the file at the expected location in the </span><span class="cls_010">/app/bin</span><span class="cls_008"> folder. Only the </span><span class="cls_010">WORKDIR</span></div>
<div style="position:absolute;left:108.00px;top:548.41px" class="cls_008"><span class="cls_008">keyword sets the context across the layers of the image. The </span><span class="cls_010">cd</span><span class="cls_008"> command alone is</span></div>
<div style="position:absolute;left:108.00px;top:561.01px" class="cls_008"><span class="cls_008">not persisted across layers.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 67 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:68170px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background091.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">The CMD and ENTRYPOINT keywords</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">CMD</span><span class="cls_008"> and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> keywords are special. While all other keywords defined for</span></div>
<div style="position:absolute;left:108.00px;top:146.59px" class="cls_008"><span class="cls_008">a Dockerfile are executed at the time the image is built by the Docker builder, these</span></div>
<div style="position:absolute;left:108.00px;top:159.19px" class="cls_008"><span class="cls_008">two are actually definitions of what will happen when a container is started from the</span></div>
<div style="position:absolute;left:108.00px;top:171.79px" class="cls_008"><span class="cls_008">image we define. When the container runtime starts a container, it needs to know</span></div>
<div style="position:absolute;left:108.00px;top:184.39px" class="cls_008"><span class="cls_008">what the process or application will be that has to run inside this container. That is</span></div>
<div style="position:absolute;left:108.00px;top:196.99px" class="cls_008"><span class="cls_008">exactly what </span><span class="cls_010">CMD</span><span class="cls_008"> and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> are used for—to tell Docker what the start process</span></div>
<div style="position:absolute;left:108.00px;top:209.59px" class="cls_008"><span class="cls_008">is and how to start that process.</span></div>
<div style="position:absolute;left:108.00px;top:230.83px" class="cls_008"><span class="cls_008">Now, the differences between </span><span class="cls_010">CMD</span><span class="cls_008"> and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> are subtle, and honestly most</span></div>
<div style="position:absolute;left:108.00px;top:243.43px" class="cls_008"><span class="cls_008">users don't fully understand them or use them in the intended way. Luckily, in most</span></div>
<div style="position:absolute;left:108.00px;top:256.03px" class="cls_008"><span class="cls_008">cases, this is not a problem and the container will run anyway; it's just the handling</span></div>
<div style="position:absolute;left:108.00px;top:268.63px" class="cls_008"><span class="cls_008">of it that is not as straightforward as it could be.</span></div>
<div style="position:absolute;left:108.00px;top:289.87px" class="cls_008"><span class="cls_008">To better understand how to use the two keywords, let's analyze what a typical</span></div>
<div style="position:absolute;left:108.00px;top:302.47px" class="cls_008"><span class="cls_008">Linux command or expression looks like—for example, let's take the ping utility</span></div>
<div style="position:absolute;left:108.00px;top:315.07px" class="cls_008"><span class="cls_008">as an example, as follows:</span></div>
<div style="position:absolute;left:126.00px;top:336.01px" class="cls_024"><span class="cls_024">$ ping 8.8.8.8 -c 3</span></div>
<div style="position:absolute;left:108.00px;top:355.75px" class="cls_008"><span class="cls_008">In the preceding expression, </span><span class="cls_010">ping</span><span class="cls_008"> is the command and </span><span class="cls_010">8.8.8.8 -c 3</span><span class="cls_008"> are the</span></div>
<div style="position:absolute;left:108.00px;top:368.35px" class="cls_008"><span class="cls_008">parameters to this command. Let's look at another expression:</span></div>
<div style="position:absolute;left:126.00px;top:389.29px" class="cls_024"><span class="cls_024">$ wget -O - </span><A HREF="http://example.com/downloads/script.sh/">http://example.com/downloads/script.sh</A> </div>
<div style="position:absolute;left:108.00px;top:409.03px" class="cls_008"><span class="cls_008">Again, in the preceding expression, </span><span class="cls_010">wget</span><span class="cls_008"> is the command and </span><span class="cls_010">-O - <A HREF="http://">http://</A> </span></div>
<div style="position:absolute;left:108.00px;top:421.63px" class="cls_010"><span class="cls_010">example.com/downloads/script.sh</span><span class="cls_008"> are the parameters.</span></div>
<div style="position:absolute;left:108.00px;top:442.87px" class="cls_008"><span class="cls_008">Now that we have dealt with this, we can get back to </span><span class="cls_010">CMD</span><span class="cls_008"> and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:455.47px" class="cls_010"><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> is used to define the command of the expression while </span><span class="cls_010">CMD</span><span class="cls_008"> is used to</span></div>
<div style="position:absolute;left:108.01px;top:468.07px" class="cls_008"><span class="cls_008">define the parameters for the command. Thus, a Dockerfile using </span><span class="cls_010">alpine</span><span class="cls_008"> as the base</span></div>
<div style="position:absolute;left:108.00px;top:480.67px" class="cls_008"><span class="cls_008">image and defining </span><span class="cls_010">ping</span><span class="cls_008"> as the process to run in the container could look as follows:</span></div>
<div style="position:absolute;left:126.00px;top:501.61px" class="cls_023"><span class="cls_023">FROM alpine:latest</span></div>
<div style="position:absolute;left:126.00px;top:513.85px" class="cls_023"><span class="cls_023">ENTRYPOINT ["ping"]</span></div>
<div style="position:absolute;left:126.00px;top:526.09px" class="cls_023"><span class="cls_023">CMD ["8.8.8.8", "-c", "3"]</span></div>
<div style="position:absolute;left:108.00px;top:545.83px" class="cls_008"><span class="cls_008">For both </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> and </span><span class="cls_010">CMD</span><span class="cls_008">, the values are formatted as a JSON array of strings,</span></div>
<div style="position:absolute;left:108.00px;top:558.43px" class="cls_008"><span class="cls_008">where the individual items correspond to the tokens of the expression that are</span></div>
<div style="position:absolute;left:108.00px;top:571.03px" class="cls_008"><span class="cls_008">separated by whitespace. This is the preferred way of defining </span><span class="cls_010">CMD</span><span class="cls_008"> and </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:583.63px" class="cls_008"><span class="cls_008">It is also called the </span><span class="cls_009">exec</span><span class="cls_008"> form.</span></div>
<div style="position:absolute;left:108.00px;top:604.87px" class="cls_008"><span class="cls_008">Alternatively, one can also use what's called the </span><span class="cls_009">shell</span><span class="cls_008"> form, for example:</span></div>
<div style="position:absolute;left:126.00px;top:625.81px" class="cls_023"><span class="cls_023">CMD command param1 param2</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 68 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:68972px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background092.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can now build an image from the preceding Dockerfile, as follows:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">$ docker image build -t pinger .</span></div>
<div style="position:absolute;left:108.00px;top:155.17px" class="cls_008"><span class="cls_008">Then, we can run a container from the </span><span class="cls_010">pinger</span><span class="cls_008"> image we just created:</span></div>
<div style="position:absolute;left:126.00px;top:176.11px" class="cls_024"><span class="cls_024">$ docker container run --rm -it pinger</span></div>
<div style="position:absolute;left:126.00px;top:188.35px" class="cls_024"><span class="cls_024">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span></div>
<div style="position:absolute;left:126.00px;top:200.59px" class="cls_024"><span class="cls_024">64 bytes from 8.8.8.8: seq=0 ttl=37 time=19.298 ms</span></div>
<div style="position:absolute;left:126.00px;top:212.83px" class="cls_024"><span class="cls_024">64 bytes from 8.8.8.8: seq=1 ttl=37 time=27.890 ms</span></div>
<div style="position:absolute;left:126.00px;top:225.07px" class="cls_024"><span class="cls_024">64 bytes from 8.8.8.8: seq=2 ttl=37 time=30.702 ms</span></div>
<div style="position:absolute;left:108.00px;top:244.81px" class="cls_008"><span class="cls_008">The beauty of this is that I can now override the </span><span class="cls_010">CMD</span><span class="cls_008"> part that I have defined in</span></div>
<div style="position:absolute;left:108.00px;top:257.41px" class="cls_008"><span class="cls_008">the Dockerfile (remember, it was </span><span class="cls_010">["8.8.8.8", "-c", "3"]</span><span class="cls_008">) when I create a new</span></div>
<div style="position:absolute;left:108.00px;top:270.01px" class="cls_008"><span class="cls_008">container by adding the new values at the end of the </span><span class="cls_010">docker container run</span></div>
<div style="position:absolute;left:108.00px;top:282.61px" class="cls_008"><span class="cls_008">expression:</span></div>
<div style="position:absolute;left:126.00px;top:303.55px" class="cls_024"><span class="cls_024">$ docker container run --rm -it pinger -w 5 127.0.0.1</span></div>
<div style="position:absolute;left:108.00px;top:323.29px" class="cls_008"><span class="cls_008">This will now cause the container to ping the loopback for </span><span class="cls_010">5</span><span class="cls_008"> seconds.</span></div>
<div style="position:absolute;left:108.00px;top:344.53px" class="cls_008"><span class="cls_008">If we want to override what's defined in the </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> in the Dockerfile, we need</span></div>
<div style="position:absolute;left:108.00px;top:357.13px" class="cls_008"><span class="cls_008">to use the </span><span class="cls_010">--entrypoint</span><span class="cls_008"> parameter in the </span><span class="cls_010">docker container run</span><span class="cls_008"> expression. Let's</span></div>
<div style="position:absolute;left:108.00px;top:369.73px" class="cls_008"><span class="cls_008">say we want to execute a shell in the container instead of the </span><span class="cls_010">ping</span><span class="cls_008"> command. We</span></div>
<div style="position:absolute;left:108.00px;top:382.33px" class="cls_008"><span class="cls_008">could do so by using the following command:</span></div>
<div style="position:absolute;left:126.00px;top:403.27px" class="cls_024"><span class="cls_024">$ docker container run --rm -it --entrypoint /bin/sh pinger</span></div>
<div style="position:absolute;left:108.00px;top:423.01px" class="cls_008"><span class="cls_008">We will then find ourselves inside the container. Type </span><span class="cls_010">exit</span><span class="cls_008"> to leave the container.</span></div>
<div style="position:absolute;left:108.00px;top:444.26px" class="cls_008"><span class="cls_008">As I already mentioned, we do not necessarily have to follow best practices and</span></div>
<div style="position:absolute;left:108.00px;top:456.85px" class="cls_008"><span class="cls_008">define the command through </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> and the parameters through </span><span class="cls_010">CMD</span><span class="cls_008">, but we</span></div>
<div style="position:absolute;left:108.00px;top:469.45px" class="cls_008"><span class="cls_008">can instead enter the whole expression as a value of </span><span class="cls_010">CMD</span><span class="cls_008"> and it will work:</span></div>
<div style="position:absolute;left:126.00px;top:490.39px" class="cls_023"><span class="cls_023">FROM alpine:latest</span></div>
<div style="position:absolute;left:126.00px;top:502.63px" class="cls_023"><span class="cls_023">CMD wget -O - </span><A HREF="http://www.google.com/">http://www.google.com</A> </div>
<div style="position:absolute;left:108.00px;top:522.37px" class="cls_008"><span class="cls_008">Here, I have even used the </span><span class="cls_009">shell</span><span class="cls_008"> form to define the </span><span class="cls_009">CMD</span><span class="cls_008">. But what does really</span></div>
<div style="position:absolute;left:108.00px;top:534.97px" class="cls_008"><span class="cls_008">happen in this situation where </span><span class="cls_010">ENTRYPOINT</span><span class="cls_008"> is undefined? If you leave </span><span class="cls_010">ENTRYPOINT</span></div>
<div style="position:absolute;left:108.00px;top:547.57px" class="cls_008"><span class="cls_008">undefined, then it will have the default value of </span><span class="cls_010">/bin/sh -c</span><span class="cls_008">, and whatever is</span></div>
<div style="position:absolute;left:108.00px;top:560.17px" class="cls_008"><span class="cls_008">the value of </span><span class="cls_010">CMD</span><span class="cls_008"> will be passed as a string to the shell command. The preceding</span></div>
<div style="position:absolute;left:108.00px;top:572.77px" class="cls_008"><span class="cls_008">definition would thereby result in entering the following process to run inside the</span></div>
<div style="position:absolute;left:108.00px;top:585.37px" class="cls_008"><span class="cls_008">container:</span></div>
<div style="position:absolute;left:126.00px;top:606.31px" class="cls_023"><span class="cls_023">/bin/sh -c "wget -O - </span><A HREF="http://www.google.com"/">http://www.google.com"</A> </div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 69 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:69774px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background093.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Consequently, </span><span class="cls_010">/bin/sh</span><span class="cls_008"> is the main process running inside the container, and it will</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">start a new child process to run the </span><span class="cls_010">wget</span><span class="cls_008"> utility.</span></div>
<div style="position:absolute;left:108.00px;top:155.19px" class="cls_028"><span class="cls_028">A complex Dockerfile</span></div>
<div style="position:absolute;left:108.00px;top:176.17px" class="cls_008"><span class="cls_008">We have discussed the most important keywords commonly used in Dockerfiles.</span></div>
<div style="position:absolute;left:108.00px;top:188.77px" class="cls_008"><span class="cls_008">Let's look at a realistic and somewhat complex example of a Dockerfile. The</span></div>
<div style="position:absolute;left:108.00px;top:201.37px" class="cls_008"><span class="cls_008">interested reader might note that it looks very similar to the first Dockerfile that we</span></div>
<div style="position:absolute;left:108.00px;top:213.97px" class="cls_008"><span class="cls_008">presented in this chapter. Here is the content:</span></div>
<div style="position:absolute;left:126.00px;top:234.91px" class="cls_023"><span class="cls_023">FROM node:9.4</span></div>
<div style="position:absolute;left:126.00px;top:247.15px" class="cls_023"><span class="cls_023">RUN mkdir -p /app</span></div>
<div style="position:absolute;left:126.00px;top:259.39px" class="cls_023"><span class="cls_023">WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:271.63px" class="cls_023"><span class="cls_023">COPY package.json /app/</span></div>
<div style="position:absolute;left:126.00px;top:283.87px" class="cls_023"><span class="cls_023">RUN npm install</span></div>
<div style="position:absolute;left:126.00px;top:296.11px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:126.00px;top:308.35px" class="cls_023"><span class="cls_023">ENTRYPOINT ["npm"]</span></div>
<div style="position:absolute;left:126.00px;top:320.59px" class="cls_023"><span class="cls_023">CMD ["start"]</span></div>
<div style="position:absolute;left:108.00px;top:340.33px" class="cls_008"><span class="cls_008">OK, so what is happening here? Evidently, this is a Dockerfile that is used to build an</span></div>
<div style="position:absolute;left:108.00px;top:352.93px" class="cls_008"><span class="cls_008">image for a Node.js application; we can deduce this from the fact that the base image</span></div>
<div style="position:absolute;left:108.00px;top:365.53px" class="cls_010"><span class="cls_010">node:9.4</span><span class="cls_008"> is used. Then the second line is an instruction to create a </span><span class="cls_010">/app</span><span class="cls_008"> folder in</span></div>
<div style="position:absolute;left:108.00px;top:378.13px" class="cls_008"><span class="cls_008">the filesystem of the image. The third line defines the working directory or context</span></div>
<div style="position:absolute;left:108.00px;top:390.73px" class="cls_008"><span class="cls_008">in the image to be this new </span><span class="cls_010">/app</span><span class="cls_008"> folder. Then, on line four, we copy a </span><span class="cls_010">package.json</span></div>
<div style="position:absolute;left:108.00px;top:403.33px" class="cls_008"><span class="cls_008">file into the </span><span class="cls_010">/app</span><span class="cls_008"> folder inside the image. After this, on line five, we execute the </span><span class="cls_010">npm</span></div>
<div style="position:absolute;left:108.00px;top:415.93px" class="cls_010"><span class="cls_010">install</span><span class="cls_008"> command inside the container; remember, our context is the </span><span class="cls_010">/app</span><span class="cls_008"> folder</span></div>
<div style="position:absolute;left:108.00px;top:428.53px" class="cls_008"><span class="cls_008">and thus, </span><span class="cls_010">npm</span><span class="cls_008"> will find the </span><span class="cls_010">package.json</span><span class="cls_008"> file there that we copied on line four.</span></div>
<div style="position:absolute;left:108.00px;top:449.78px" class="cls_008"><span class="cls_008">After all Node.js dependencies are installed, we copy the rest of the application files</span></div>
<div style="position:absolute;left:108.00px;top:462.37px" class="cls_008"><span class="cls_008">from the current folder of the host into the </span><span class="cls_010">/app</span><span class="cls_008"> folder of the image.</span></div>
<div style="position:absolute;left:108.00px;top:483.62px" class="cls_008"><span class="cls_008">Finally, on the last two lines, we define what the startup command shall be when</span></div>
<div style="position:absolute;left:108.00px;top:496.21px" class="cls_008"><span class="cls_008">a container is run from this image. In our case, it is </span><span class="cls_010">npm start</span><span class="cls_008">, which will start the</span></div>
<div style="position:absolute;left:108.00px;top:508.81px" class="cls_008"><span class="cls_008">Node application.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 70 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:70576px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background094.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">Building an image</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">Follow the below steps to build an image:</span></div>
<div style="position:absolute;left:126.00px;top:155.23px" class="cls_008"><span class="cls_008">1.  In your </span><span class="cls_010">home</span><span class="cls_008"> directory, create a </span><span class="cls_010">FundamentalsOfDocker</span><span class="cls_008"> folder and</span></div>
<div style="position:absolute;left:144.00px;top:167.83px" class="cls_008"><span class="cls_008">navigate to it:</span></div>
<div style="position:absolute;left:165.60px;top:184.45px" class="cls_024"><span class="cls_024">$ mkdir ~/FundamentalsOfDocker</span></div>
<div style="position:absolute;left:165.60px;top:199.57px" class="cls_024"><span class="cls_024">$ cd ~/FundamentalsOfDocker</span></div>
<div style="position:absolute;left:126.00px;top:219.31px" class="cls_008"><span class="cls_008">2.  In the preceding folder, create a </span><span class="cls_010">sample1</span><span class="cls_008"> subfolder and navigate to it:</span></div>
<div style="position:absolute;left:165.60px;top:235.93px" class="cls_024"><span class="cls_024">$ mkdir sample1 && cd sample1</span></div>
<div style="position:absolute;left:126.00px;top:255.67px" class="cls_008"><span class="cls_008">3.  Use your favorite editor to create a file called </span><span class="cls_010">Dockerfile</span><span class="cls_008"> inside this</span></div>
<div style="position:absolute;left:144.00px;top:268.27px" class="cls_008"><span class="cls_008">sample folder with the following content:</span></div>
<div style="position:absolute;left:165.60px;top:284.89px" class="cls_023"><span class="cls_023">FROM centos:7</span></div>
<div style="position:absolute;left:165.60px;top:300.01px" class="cls_023"><span class="cls_023">RUN yum install -y wget</span></div>
<div style="position:absolute;left:126.00px;top:319.75px" class="cls_008"><span class="cls_008">4.  Save the file and exit your editor. Back in the Terminal, we can now build</span></div>
<div style="position:absolute;left:144.00px;top:332.35px" class="cls_008"><span class="cls_008">a new container image using the preceding Dockerfile as a manifest or</span></div>
<div style="position:absolute;left:144.00px;top:344.95px" class="cls_008"><span class="cls_008">construction plan:</span></div>
<div style="position:absolute;left:165.60px;top:361.57px" class="cls_024"><span class="cls_024">$ docker image build -t my-centos .</span></div>
<div style="position:absolute;left:108.00px;top:381.31px" class="cls_008"><span class="cls_008">Please note that there is a period at the end of the preceding command. This</span></div>
<div style="position:absolute;left:108.00px;top:393.91px" class="cls_008"><span class="cls_008">command means that the Docker builder is creating a new image called </span><span class="cls_010">my-centos</span></div>
<div style="position:absolute;left:108.00px;top:406.51px" class="cls_008"><span class="cls_008">using the Dockerfile that is present in the current directory. Here, the period at the</span></div>
<div style="position:absolute;left:108.00px;top:419.11px" class="cls_008"><span class="cls_008">end of the command stands for </span><span class="cls_021">current directory</span><span class="cls_008">. We could also write the preceding</span></div>
<div style="position:absolute;left:108.00px;top:431.71px" class="cls_008"><span class="cls_008">command as follows, with the same result:</span></div>
<div style="position:absolute;left:126.00px;top:452.65px" class="cls_024"><span class="cls_024">$ docker image build -t my-centos -f Dockerfile .</span></div>
<div style="position:absolute;left:108.00px;top:472.39px" class="cls_008"><span class="cls_008">But we can omit the </span><span class="cls_010">-f</span><span class="cls_008"> parameter, since the builder assumes that the Dockerfile is</span></div>
<div style="position:absolute;left:108.00px;top:484.99px" class="cls_008"><span class="cls_008">literally called </span><span class="cls_010">Dockerfile</span><span class="cls_008">. We only ever need the </span><span class="cls_010">-f</span><span class="cls_008"> parameter if our Dockerfile</span></div>
<div style="position:absolute;left:108.00px;top:497.59px" class="cls_008"><span class="cls_008">has a different name or is not located in the current directory.</span></div>
<div style="position:absolute;left:108.00px;top:518.83px" class="cls_008"><span class="cls_008">The preceding command gives us this (shortened) output:</span></div>
<div style="position:absolute;left:126.00px;top:539.77px" class="cls_024"><span class="cls_024">Sending build context to Docker daemon 2.048kB</span></div>
<div style="position:absolute;left:126.00px;top:552.01px" class="cls_024"><span class="cls_024">Step 1/2 : FROM centos:7</span></div>
<div style="position:absolute;left:126.00px;top:564.25px" class="cls_024"><span class="cls_024">7: Pulling from library/centos</span></div>
<div style="position:absolute;left:126.00px;top:576.49px" class="cls_024"><span class="cls_024">af4b0a2388c6: Pull complete</span></div>
<div style="position:absolute;left:126.00px;top:588.73px" class="cls_024"><span class="cls_024">Digest: sha256:2671f7a3eea36ce43609e9fe7435ade83094291055f1c96d9d1d1d</span></div>
<div style="position:absolute;left:126.00px;top:599.53px" class="cls_024"><span class="cls_024">7c0b986a5d</span></div>
<div style="position:absolute;left:126.00px;top:611.77px" class="cls_024"><span class="cls_024">Status: Downloaded newer image for centos:7</span></div>
<div style="position:absolute;left:126.00px;top:624.01px" class="cls_024"><span class="cls_024">---> ff426288ea90</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 71 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:71378px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background095.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:126.00px;top:114.01px" class="cls_024"><span class="cls_024">Step 2/2 : RUN yum install -y wget</span></div>
<div style="position:absolute;left:126.00px;top:126.25px" class="cls_024"><span class="cls_024">---> Running in bb726903820c</span></div>
<div style="position:absolute;left:126.00px;top:138.49px" class="cls_024"><span class="cls_024">Loaded plugins: fastestmirror, ovl</span></div>
<div style="position:absolute;left:126.00px;top:150.73px" class="cls_024"><span class="cls_024">Determining fastest mirrors</span></div>
<div style="position:absolute;left:126.00px;top:162.97px" class="cls_024"><span class="cls_024">* base: mirror.dal10.us.leaseweb.net</span></div>
<div style="position:absolute;left:126.00px;top:175.21px" class="cls_024"><span class="cls_024">* extras: repos-tx.psychz.net</span></div>
<div style="position:absolute;left:126.00px;top:187.45px" class="cls_024"><span class="cls_024">* updates: pubmirrors.dal.corespace.com</span></div>
<div style="position:absolute;left:126.00px;top:199.69px" class="cls_024"><span class="cls_024">Resolving Dependencies</span></div>
<div style="position:absolute;left:126.00px;top:211.93px" class="cls_024"><span class="cls_024">--> Running transaction check</span></div>
<div style="position:absolute;left:126.00px;top:224.17px" class="cls_024"><span class="cls_024">---> Package wget.x86_64 0:1.14-15.el7_4.1 will be installed</span></div>
<div style="position:absolute;left:126.00px;top:248.65px" class="cls_024"><span class="cls_024">Installed:</span></div>
<div style="position:absolute;left:126.00px;top:260.89px" class="cls_024"><span class="cls_024">wget.x86_64 0:1.14-15.el7_4.1</span></div>
<div style="position:absolute;left:126.00px;top:273.13px" class="cls_024"><span class="cls_024">Complete!</span></div>
<div style="position:absolute;left:126.00px;top:285.37px" class="cls_024"><span class="cls_024">Removing intermediate container bb726903820c</span></div>
<div style="position:absolute;left:126.00px;top:297.61px" class="cls_024"><span class="cls_024">---> bc070cc81b87</span></div>
<div style="position:absolute;left:126.00px;top:309.85px" class="cls_024"><span class="cls_024">Successfully built bc070cc81b87</span></div>
<div style="position:absolute;left:126.00px;top:322.09px" class="cls_024"><span class="cls_024">Successfully tagged my-centos:latest</span></div>
<div style="position:absolute;left:108.00px;top:341.82px" class="cls_008"><span class="cls_008">Let's analyze this output:</span></div>
<div style="position:absolute;left:126.00px;top:363.06px" class="cls_008"><span class="cls_008">1.  First, we have the following line:</span></div>
<div style="position:absolute;left:165.60px;top:379.68px" class="cls_024"><span class="cls_024">Sending build context to Docker daemon 2.048kB</span></div>
<div style="position:absolute;left:144.00px;top:399.42px" class="cls_008"><span class="cls_008">The first thing the builder does is package the files in the current build</span></div>
<div style="position:absolute;left:144.00px;top:412.02px" class="cls_008"><span class="cls_008">context, excluding the files and folder mentioned in the </span><span class="cls_010">.dockerignore</span><span class="cls_008"> file,</span></div>
<div style="position:absolute;left:144.00px;top:424.62px" class="cls_008"><span class="cls_008">if present, and sends the resulting </span><span class="cls_010">.tar</span><span class="cls_008"> file to the Docker daemon.</span></div>
<div style="position:absolute;left:126.00px;top:445.86px" class="cls_008"><span class="cls_008">2.  Next, we have the following lines:</span></div>
<div style="position:absolute;left:165.60px;top:462.48px" class="cls_024"><span class="cls_024">Step 1/2 : FROM centos:7</span></div>
<div style="position:absolute;left:165.60px;top:477.60px" class="cls_024"><span class="cls_024">7: Pulling from library/centos</span></div>
<div style="position:absolute;left:165.60px;top:492.72px" class="cls_024"><span class="cls_024">af4b0a2388c6: Pull complete</span></div>
<div style="position:absolute;left:165.60px;top:507.84px" class="cls_024"><span class="cls_024">Digest: sha256:2671f7a...</span></div>
<div style="position:absolute;left:165.60px;top:522.96px" class="cls_024"><span class="cls_024">Status: Downloaded newer image for centos:7</span></div>
<div style="position:absolute;left:165.60px;top:538.08px" class="cls_024"><span class="cls_024">---> ff426288ea90</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 72 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:72180px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background096.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">The first line tells us which step of the Dockerfile the builder is currently</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">executing. Here, we only have two statements in the Dockerfile, and we are</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">on step 1 of 2. We can also see what the content of that section is. Here is the</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">declaration of the base image, on top of which we want to build our custom</span></div>
<div style="position:absolute;left:144.00px;top:164.89px" class="cls_008"><span class="cls_008">image. What the builder then does is pull this image from Docker Hub if it is</span></div>
<div style="position:absolute;left:144.00px;top:177.49px" class="cls_008"><span class="cls_008">not already available in the local cache. The last line of the preceding snippet</span></div>
<div style="position:absolute;left:144.00px;top:190.09px" class="cls_008"><span class="cls_008">indicates which ID the just-built layer gets assigned by the builder.</span></div>
<div style="position:absolute;left:126.00px;top:211.34px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:211.34px" class="cls_008"><span class="cls_008">Here's the next step. I have shortened it even more than the preceding one to</span></div>
<div style="position:absolute;left:144.00px;top:223.94px" class="cls_008"><span class="cls_008">concentrate on the essential part:</span></div>
<div style="position:absolute;left:165.60px;top:240.55px" class="cls_024"><span class="cls_024">Step 2/2 : RUN yum install -y wget</span></div>
<div style="position:absolute;left:165.60px;top:255.67px" class="cls_024"><span class="cls_024">---> Running in bb726903820c</span></div>
<div style="position:absolute;left:165.60px;top:301.03px" class="cls_024"><span class="cls_024">Removing intermediate container bb726903820c</span></div>
<div style="position:absolute;left:165.60px;top:316.15px" class="cls_024"><span class="cls_024">---> bc070cc81b87</span></div>
<div style="position:absolute;left:144.00px;top:335.89px" class="cls_008"><span class="cls_008">Here, again, the first line indicates to us that we are in step 2 of 2. It also</span></div>
<div style="position:absolute;left:144.00px;top:348.49px" class="cls_008"><span class="cls_008">shows us the respective entry from the Dockerfile. On line two, we can see</span></div>
<div style="position:absolute;left:144.00px;top:361.09px" class="cls_010"><span class="cls_010">Running in bb726903820c</span><span class="cls_008">, which tells us that the builder has created a</span></div>
<div style="position:absolute;left:143.99px;top:373.69px" class="cls_008"><span class="cls_008">container with </span><span class="cls_010">ID bb726903820c</span><span class="cls_008"> inside, which it executes the </span><span class="cls_010">RUN</span><span class="cls_008"> command.</span></div>
<div style="position:absolute;left:144.00px;top:386.29px" class="cls_008"><span class="cls_008">We have omitted the output of the </span><span class="cls_010">yum install -y wget</span><span class="cls_008"> command in</span></div>
<div style="position:absolute;left:144.00px;top:398.89px" class="cls_008"><span class="cls_008">the snippet since it is not important in this section. When the command</span></div>
<div style="position:absolute;left:144.00px;top:411.49px" class="cls_008"><span class="cls_008">is finished, the builder stops the container, commits it to a new layer, and</span></div>
<div style="position:absolute;left:144.00px;top:424.09px" class="cls_008"><span class="cls_008">then removes the container. The new layer has </span><span class="cls_010">ID bc070cc81b87</span><span class="cls_008">, in this</span></div>
<div style="position:absolute;left:144.00px;top:436.69px" class="cls_008"><span class="cls_008">particular case.</span></div>
<div style="position:absolute;left:126.00px;top:457.94px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:457.94px" class="cls_008"><span class="cls_008">At the very end of the output, we encounter the following two lines:</span></div>
<div style="position:absolute;left:165.60px;top:474.55px" class="cls_024"><span class="cls_024">Successfully built bc070cc81b87</span></div>
<div style="position:absolute;left:165.60px;top:489.67px" class="cls_024"><span class="cls_024">Successfully tagged my-centos:latest</span></div>
<div style="position:absolute;left:144.00px;top:509.41px" class="cls_008"><span class="cls_008">This tells us that the resulting custom image has been given the ID</span></div>
<div style="position:absolute;left:144.00px;top:522.01px" class="cls_010"><span class="cls_010">bc070cc81b87</span><span class="cls_008">, and has been tagged with the name </span><span class="cls_010">my-centos:latest</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 73 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:72982px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background097.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_021"><span class="cls_021">So, how does the builder work, exactly?</span><span class="cls_008"> It starts with the base image. From this base</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">image, once downloaded into the local cache, it creates a container and runs the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">first statement of the Dockerfile inside this container. Then, it stops the container</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">and persists the changes made in the container into a new image layer. The builder</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">then creates a new container from the base image and the new layer, and runs the</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">second statement inside this new container. Once again, the result is committed to</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">a new layer. This process is repeated until the very last statement in the Dockerfile</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">is encountered. After having committed the last layer of the new image, the builder</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">creates an ID for this image and tags the image with the name we provided in the</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_010"><span class="cls_010">build</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:243.60px;top:582.57px" class="cls_026"><span class="cls_026">The image build process visualized</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 74 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:73784px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background098.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">Multistep builds</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">To demonstrate why a Dockerfile with multiple build steps is useful, let's make an</span></div>
<div style="position:absolute;left:108.00px;top:146.59px" class="cls_008"><span class="cls_008">example Dockerfile. Let's take a </span><span class="cls_010">Hello World</span><span class="cls_008"> application written in C. Here is the</span></div>
<div style="position:absolute;left:108.00px;top:159.19px" class="cls_008"><span class="cls_008">code found inside the </span><span class="cls_010">hello.c</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:126.00px;top:180.13px" class="cls_023"><span class="cls_023">#include &lt;stdio.h></span></div>
<div style="position:absolute;left:126.00px;top:192.37px" class="cls_023"><span class="cls_023">int main (void)</span></div>
<div style="position:absolute;left:126.00px;top:204.61px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:136.80px;top:216.85px" class="cls_023"><span class="cls_023">printf ("Hello, world!\n");</span></div>
<div style="position:absolute;left:136.80px;top:229.09px" class="cls_023"><span class="cls_023">return 0;</span></div>
<div style="position:absolute;left:126.00px;top:241.33px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:108.00px;top:261.07px" class="cls_008"><span class="cls_008">Now, we want to containerize this application and write this Dockerfile:</span></div>
<div style="position:absolute;left:126.00px;top:282.01px" class="cls_023"><span class="cls_023">FROM alpine:3.7</span></div>
<div style="position:absolute;left:126.00px;top:294.25px" class="cls_023"><span class="cls_023">RUN apk update &&</span></div>
<div style="position:absolute;left:126.00px;top:306.49px" class="cls_023"><span class="cls_023">apk add --update alpine-sdk</span></div>
<div style="position:absolute;left:126.00px;top:318.73px" class="cls_023"><span class="cls_023">RUN mkdir /app</span></div>
<div style="position:absolute;left:126.00px;top:330.97px" class="cls_023"><span class="cls_023">WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:343.21px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:126.00px;top:355.45px" class="cls_023"><span class="cls_023">RUN mkdir bin</span></div>
<div style="position:absolute;left:126.00px;top:367.69px" class="cls_023"><span class="cls_023">RUN gcc -Wall hello.c -o bin/hello</span></div>
<div style="position:absolute;left:126.00px;top:379.93px" class="cls_023"><span class="cls_023">CMD /app/bin/hello</span></div>
<div style="position:absolute;left:108.00px;top:399.67px" class="cls_008"><span class="cls_008">Now, let's build this image:</span></div>
<div style="position:absolute;left:126.00px;top:420.61px" class="cls_024"><span class="cls_024">$ docker image build -t hello-world .</span></div>
<div style="position:absolute;left:108.00px;top:440.35px" class="cls_008"><span class="cls_008">This gives us a fairly long output, since the builder has to install the Alpine</span></div>
<div style="position:absolute;left:108.00px;top:452.95px" class="cls_008"><span class="cls_008">SDK, which, among other tools, contains the C++ compiler we need to build the</span></div>
<div style="position:absolute;left:108.00px;top:465.55px" class="cls_008"><span class="cls_008">application.</span></div>
<div style="position:absolute;left:108.00px;top:486.79px" class="cls_008"><span class="cls_008">Once the build is done we can list the image and see its size shown as follows:</span></div>
<div style="position:absolute;left:126.00px;top:507.73px" class="cls_024"><span class="cls_024">$ docker image ls | grep hello-world</span></div>
<div style="position:absolute;left:126.00px;top:519.97px" class="cls_024"><span class="cls_024">hello-world</span></div>
<div style="position:absolute;left:217.80px;top:519.97px" class="cls_024"><span class="cls_024">latest</span></div>
<div style="position:absolute;left:282.60px;top:519.97px" class="cls_024"><span class="cls_024">e9b...</span></div>
<div style="position:absolute;left:342.00px;top:519.97px" class="cls_024"><span class="cls_024">2 minutes ago</span></div>
<div style="position:absolute;left:439.20px;top:519.97px" class="cls_024"><span class="cls_024">176MB</span></div>
<div style="position:absolute;left:108.00px;top:539.71px" class="cls_008"><span class="cls_008">With a size of 176 MB, the resulting image is way too big. In the end, it is just a </span><span class="cls_010">Hello</span></div>
<div style="position:absolute;left:108.00px;top:552.31px" class="cls_010"><span class="cls_010">World</span><span class="cls_008"> application. The reason for it being so big is that the image not only contains</span></div>
<div style="position:absolute;left:108.00px;top:564.91px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">Hello World</span><span class="cls_008"> binary, but also all the tools to compile and link the application</span></div>
<div style="position:absolute;left:108.00px;top:577.51px" class="cls_008"><span class="cls_008">from the source code. But this is really not desirable when running the application,</span></div>
<div style="position:absolute;left:108.00px;top:590.11px" class="cls_008"><span class="cls_008">say, in production. Ideally, we only want to have the resulting binary in the image</span></div>
<div style="position:absolute;left:108.00px;top:602.71px" class="cls_008"><span class="cls_008">and not a whole SDK.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 75 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:74586px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background099.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">It is precisely for this reason that we should define Dockerfiles as multistage. We</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">have some stages that are used to build the final artifacts and then a final stage where</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">we use the minimal necessary base image and copy the artifacts into it. This results</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">in very small images. Have a look at this revised Dockerfile:</span></div>
<div style="position:absolute;left:126.00px;top:173.23px" class="cls_023"><span class="cls_023">FROM alpine:3.7 AS build</span></div>
<div style="position:absolute;left:126.00px;top:185.47px" class="cls_023"><span class="cls_023">RUN apk update && \</span></div>
<div style="position:absolute;left:147.60px;top:197.71px" class="cls_023"><span class="cls_023">apk add --update alpine-sdk</span></div>
<div style="position:absolute;left:126.00px;top:209.95px" class="cls_023"><span class="cls_023">RUN mkdir /app</span></div>
<div style="position:absolute;left:126.00px;top:222.19px" class="cls_023"><span class="cls_023">WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:234.43px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:126.00px;top:246.67px" class="cls_023"><span class="cls_023">RUN mkdir bin</span></div>
<div style="position:absolute;left:126.00px;top:258.91px" class="cls_023"><span class="cls_023">RUN gcc hello.c -o bin/hello</span></div>
<div style="position:absolute;left:126.00px;top:271.15px" class="cls_023"><span class="cls_023">FROM alpine:3.7</span></div>
<div style="position:absolute;left:126.00px;top:283.39px" class="cls_023"><span class="cls_023">COPY --from=build /app/bin/hello /app/hello</span></div>
<div style="position:absolute;left:126.00px;top:295.63px" class="cls_023"><span class="cls_023">CMD /app/hello</span></div>
<div style="position:absolute;left:108.00px;top:315.37px" class="cls_008"><span class="cls_008">Here, we have a first stage with an alias build that is used to compile the application,</span></div>
<div style="position:absolute;left:108.00px;top:327.97px" class="cls_008"><span class="cls_008">and then the second stage uses the same base image </span><span class="cls_010">alpine:3.7</span><span class="cls_008">, but does not</span></div>
<div style="position:absolute;left:108.00px;top:340.57px" class="cls_008"><span class="cls_008">install the SDK, and only copies the binary from the build stage, using the </span><span class="cls_010">--from</span></div>
<div style="position:absolute;left:108.00px;top:353.17px" class="cls_008"><span class="cls_008">parameter, into this final image.</span></div>
<div style="position:absolute;left:108.00px;top:374.42px" class="cls_008"><span class="cls_008">Let's build the image again as follows:</span></div>
<div style="position:absolute;left:126.00px;top:395.35px" class="cls_024"><span class="cls_024">$ docker image build -t hello-world-small .</span></div>
<div style="position:absolute;left:108.00px;top:415.09px" class="cls_008"><span class="cls_008">When we compare the sizes of the images, we get the following output:</span></div>
<div style="position:absolute;left:126.00px;top:436.03px" class="cls_024"><span class="cls_024">$ docker image ls | grep hello-world</span></div>
<div style="position:absolute;left:126.00px;top:448.27px" class="cls_024"><span class="cls_024">hello-world-small</span></div>
<div style="position:absolute;left:234.00px;top:448.27px" class="cls_024"><span class="cls_024">latest</span></div>
<div style="position:absolute;left:288.00px;top:448.27px" class="cls_024"><span class="cls_024">f98...</span></div>
<div style="position:absolute;left:342.00px;top:448.27px" class="cls_024"><span class="cls_024">20 seconds ago</span></div>
<div style="position:absolute;left:444.60px;top:448.27px" class="cls_024"><span class="cls_024">4.16MB</span></div>
<div style="position:absolute;left:126.00px;top:460.51px" class="cls_024"><span class="cls_024">hello-world</span></div>
<div style="position:absolute;left:234.00px;top:460.51px" class="cls_024"><span class="cls_024">latest</span></div>
<div style="position:absolute;left:288.00px;top:460.51px" class="cls_024"><span class="cls_024">469...</span></div>
<div style="position:absolute;left:342.00px;top:460.51px" class="cls_024"><span class="cls_024">10 minutes ago</span></div>
<div style="position:absolute;left:444.60px;top:460.51px" class="cls_024"><span class="cls_024">176MB</span></div>
<div style="position:absolute;left:108.00px;top:480.25px" class="cls_008"><span class="cls_008">We have been able to reduce the size from 176 MB down to 4 MB. This is reduction</span></div>
<div style="position:absolute;left:108.00px;top:492.85px" class="cls_008"><span class="cls_008">in size by a factor of 40. A smaller image size has many advantages, such as a smaller</span></div>
<div style="position:absolute;left:108.00px;top:505.45px" class="cls_008"><span class="cls_008">attack surface area for hackers, reduced memory and disk consumption, faster</span></div>
<div style="position:absolute;left:108.00px;top:518.05px" class="cls_008"><span class="cls_008">startup times of the corresponding containers, and a reduction of the bandwidth</span></div>
<div style="position:absolute;left:108.00px;top:530.65px" class="cls_008"><span class="cls_008">needed to download the image from a registry, such as Docker Hub.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 76 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:75388px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background100.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">Dockerfile best practices</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">There are a few recommended best practices to consider when authoring</span></div>
<div style="position:absolute;left:108.00px;top:146.59px" class="cls_008"><span class="cls_008">a Dockerfile, which are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:167.83px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:143.99px;top:167.83px" class="cls_009"><span class="cls_009">Remember that containers are meant to be ephemeral</span><span class="cls_008">. By ephemeral, we</span></div>
<div style="position:absolute;left:143.99px;top:180.43px" class="cls_008"><span class="cls_008">mean that a container can be stopped and destroyed and a new one built and</span></div>
<div style="position:absolute;left:143.99px;top:193.03px" class="cls_008"><span class="cls_008">put in place with absolute minimum setup and configuration needed. That</span></div>
<div style="position:absolute;left:143.99px;top:205.63px" class="cls_008"><span class="cls_008">means that we should try hard to keep the time that is needed to initialize the</span></div>
<div style="position:absolute;left:143.99px;top:218.23px" class="cls_008"><span class="cls_008">application running inside the container to a minimum, as well as the time</span></div>
<div style="position:absolute;left:143.99px;top:230.83px" class="cls_008"><span class="cls_008">needed to terminate or clean up the application.</span></div>
<div style="position:absolute;left:126.00px;top:247.75px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:143.99px;top:247.75px" class="cls_009"><span class="cls_009">Order the individual commands in the Dockerfile so that we leverage</span></div>
<div style="position:absolute;left:143.99px;top:260.35px" class="cls_009"><span class="cls_009">caching as much as possible</span><span class="cls_008">. Building a layer of an image can take a</span></div>
<div style="position:absolute;left:143.99px;top:272.95px" class="cls_008"><span class="cls_008">considerable amount of time, sometimes a number of minutes. While</span></div>
<div style="position:absolute;left:143.99px;top:285.55px" class="cls_008"><span class="cls_008">developing an application, we will have to build the container image for our</span></div>
<div style="position:absolute;left:143.99px;top:298.15px" class="cls_008"><span class="cls_008">application multiple times. We want to keep the build times to a minimum.</span></div>
<div style="position:absolute;left:143.99px;top:315.06px" class="cls_008"><span class="cls_008">When we're rebuilding a previously built image, the only layers that are</span></div>
<div style="position:absolute;left:143.99px;top:327.66px" class="cls_008"><span class="cls_008">rebuilt are the ones that have changed, but if one layer needs to be rebuilt,</span></div>
<div style="position:absolute;left:143.99px;top:340.26px" class="cls_008"><span class="cls_008">all subsequent layers also need to be rebuilt. This is very important to</span></div>
<div style="position:absolute;left:143.99px;top:352.86px" class="cls_008"><span class="cls_008">remember. Consider the following example:</span></div>
<div style="position:absolute;left:165.60px;top:373.81px" class="cls_023"><span class="cls_023">FROM node:9.4</span></div>
<div style="position:absolute;left:165.60px;top:388.93px" class="cls_023"><span class="cls_023">RUN mkdir -p /app</span></div>
<div style="position:absolute;left:165.60px;top:404.05px" class="cls_023"><span class="cls_023">WORKIR /app</span></div>
<div style="position:absolute;left:165.60px;top:419.17px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:165.60px;top:434.29px" class="cls_023"><span class="cls_023">RUN npm install</span></div>
<div style="position:absolute;left:165.60px;top:449.41px" class="cls_023"><span class="cls_023">CMD ["npm", "start"]</span></div>
<div style="position:absolute;left:144.00px;top:469.15px" class="cls_008"><span class="cls_008">In this example, the </span><span class="cls_010">npm install</span><span class="cls_008"> command on line five of the Dockerfile</span></div>
<div style="position:absolute;left:144.00px;top:481.75px" class="cls_008"><span class="cls_008">usually takes the longest. A classical Node.js application has many external</span></div>
<div style="position:absolute;left:144.00px;top:494.35px" class="cls_008"><span class="cls_008">dependencies, and those are all downloaded and installed in this step. This</span></div>
<div style="position:absolute;left:144.00px;top:506.95px" class="cls_008"><span class="cls_008">can take minutes until it is done. Therefore, we want to avoid running </span><span class="cls_010">npm</span></div>
<div style="position:absolute;left:144.00px;top:519.55px" class="cls_010"><span class="cls_010">install</span><span class="cls_008"> each time we rebuild the image, but a developer changes their</span></div>
<div style="position:absolute;left:144.00px;top:532.15px" class="cls_008"><span class="cls_008">source code all the time during development of the application. That means</span></div>
<div style="position:absolute;left:144.00px;top:544.75px" class="cls_008"><span class="cls_008">that line four, the result of the </span><span class="cls_010">COPY</span><span class="cls_008"> command, changes all the time and</span></div>
<div style="position:absolute;left:144.00px;top:557.35px" class="cls_008"><span class="cls_008">this layer has to be rebuilt each time. But as we discussed previously, that</span></div>
<div style="position:absolute;left:144.00px;top:569.95px" class="cls_008"><span class="cls_008">also means that all subsequent layers have to be rebuilt, which in this case</span></div>
<div style="position:absolute;left:144.00px;top:582.55px" class="cls_008"><span class="cls_008">includes the </span><span class="cls_010">npm install</span><span class="cls_008"> command. To avoid this, we can slightly modify</span></div>
<div style="position:absolute;left:144.00px;top:595.15px" class="cls_008"><span class="cls_008">the Dockerfile and have the following:</span></div>
<div style="position:absolute;left:165.60px;top:616.09px" class="cls_023"><span class="cls_023">FROM node:9.4</span></div>
<div style="position:absolute;left:165.60px;top:631.21px" class="cls_023"><span class="cls_023">RUN mkdir -p /app</span></div>
<div style="position:absolute;left:165.60px;top:646.33px" class="cls_023"><span class="cls_023">WORKIR /app</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 77 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:76190px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background101.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:165.60px;top:114.01px" class="cls_023"><span class="cls_023">COPY package.json /app/</span></div>
<div style="position:absolute;left:165.60px;top:129.13px" class="cls_023"><span class="cls_023">RUN npm install</span></div>
<div style="position:absolute;left:165.60px;top:144.25px" class="cls_023"><span class="cls_023">COPY . /app</span></div>
<div style="position:absolute;left:165.60px;top:159.37px" class="cls_023"><span class="cls_023">CMD ["npm", "start"]</span></div>
<div style="position:absolute;left:144.00px;top:179.10px" class="cls_008"><span class="cls_008">What we have done here is, on line four, we've only copied the single file</span></div>
<div style="position:absolute;left:144.00px;top:191.70px" class="cls_008"><span class="cls_008">that the </span><span class="cls_010">npm install</span><span class="cls_008"> command needs as a source, which is the </span><span class="cls_010">package.</span></div>
<div style="position:absolute;left:144.00px;top:204.30px" class="cls_010"><span class="cls_010">json</span><span class="cls_008"> file. This file rarely changes in a typical development process. As a</span></div>
<div style="position:absolute;left:144.00px;top:216.90px" class="cls_008"><span class="cls_008">consequence, the </span><span class="cls_010">npm install</span><span class="cls_008"> command also has to be executed only when</span></div>
<div style="position:absolute;left:144.00px;top:229.50px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">package.json</span><span class="cls_008"> file changes. All the remaining, frequently changed</span></div>
<div style="position:absolute;left:144.00px;top:242.10px" class="cls_008"><span class="cls_008">content is added to the image after the </span><span class="cls_010">npm install</span><span class="cls_008"> command.</span></div>
<div style="position:absolute;left:126.00px;top:263.34px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:143.99px;top:263.34px" class="cls_009"><span class="cls_009">Keep the number of layers that make up your image relatively small.</span></div>
<div style="position:absolute;left:143.99px;top:275.94px" class="cls_008"><span class="cls_008">The more layers an image has, the more the graph driver needs to work to</span></div>
<div style="position:absolute;left:143.99px;top:288.54px" class="cls_008"><span class="cls_008">consolidate the layers into a single root filesystem for the corresponding</span></div>
<div style="position:absolute;left:143.99px;top:301.14px" class="cls_008"><span class="cls_008">container. Of course, this takes time, and thus the fewer layers an image has,</span></div>
<div style="position:absolute;left:143.99px;top:313.74px" class="cls_008"><span class="cls_008">the faster the startup time for the container can be.</span></div>
<div style="position:absolute;left:143.99px;top:330.66px" class="cls_008"><span class="cls_008">But </span><span class="cls_021">how can we keep our number of layers low?</span><span class="cls_008"> Remember that in a Dockerfile,</span></div>
<div style="position:absolute;left:143.99px;top:343.26px" class="cls_008"><span class="cls_008">each line that starts with a keyword, such as FROM, COPY, or RUN, creates</span></div>
<div style="position:absolute;left:143.99px;top:355.86px" class="cls_008"><span class="cls_008">a new layer. The easiest way to reduce the number of layers is to combine</span></div>
<div style="position:absolute;left:143.99px;top:368.46px" class="cls_008"><span class="cls_008">multiple individual </span><span class="cls_010">RUN</span><span class="cls_008"> commands into a single one—for example, say that</span></div>
<div style="position:absolute;left:144.00px;top:381.06px" class="cls_008"><span class="cls_008">we had the following in a Dockerfile:</span></div>
<div style="position:absolute;left:158.40px;top:402.00px" class="cls_024"><span class="cls_024">RUN apt-get update</span></div>
<div style="position:absolute;left:158.40px;top:414.24px" class="cls_024"><span class="cls_024">RUN apt-get install -y ca-certificates</span></div>
<div style="position:absolute;left:158.40px;top:426.48px" class="cls_024"><span class="cls_024">RUN rm -rf /var/lib/apt/lists/*</span></div>
<div style="position:absolute;left:144.00px;top:446.22px" class="cls_008"><span class="cls_008">We could combine these into a single concatenated expression, as follows:</span></div>
<div style="position:absolute;left:165.60px;top:467.16px" class="cls_024"><span class="cls_024">RUN apt-get update \</span></div>
<div style="position:absolute;left:187.20px;top:479.40px" class="cls_024"><span class="cls_024">&& apt-get install -y ca-certificates \</span></div>
<div style="position:absolute;left:187.20px;top:491.64px" class="cls_024"><span class="cls_024">&& rm -rf /var/lib/apt/lists/*</span></div>
<div style="position:absolute;left:144.00px;top:511.38px" class="cls_008"><span class="cls_008">The former will generate three layers in the resulting image, while the latter</span></div>
<div style="position:absolute;left:144.00px;top:523.98px" class="cls_008"><span class="cls_008">only creates a single layer.</span></div>
<div style="position:absolute;left:108.00px;top:545.22px" class="cls_008"><span class="cls_008">The next three best practices all result in smaller images. Why is this important?</span></div>
<div style="position:absolute;left:108.00px;top:557.82px" class="cls_008"><span class="cls_008">Smaller images reduce the time and bandwidth needed to download the image from</span></div>
<div style="position:absolute;left:108.00px;top:570.42px" class="cls_008"><span class="cls_008">a registry. They also reduce the amount of disk space needed to store a copy locally</span></div>
<div style="position:absolute;left:108.00px;top:583.02px" class="cls_008"><span class="cls_008">on the Docker host and the memory needed to load the image. Finally, smaller</span></div>
<div style="position:absolute;left:108.00px;top:595.62px" class="cls_008"><span class="cls_008">images also means a smaller attack surface for hackers. Here are the best practices</span></div>
<div style="position:absolute;left:108.00px;top:608.22px" class="cls_008"><span class="cls_008">for reducing image size:</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 78 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:76992px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background102.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•  Use a </span><span class="cls_010">.dockerignore</span><span class="cls_008"> file. We want to avoid copying unnecessary files</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">and folders into an image to keep it as lean as possible. A </span><span class="cls_010">.dockerignore</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">file works in exactly the same way as a </span><span class="cls_010">.gitignore</span><span class="cls_008"> file, for those who are</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">familiar with Git. In a </span><span class="cls_010">.dockerignore</span><span class="cls_008"> file, we can configure patterns to</span></div>
<div style="position:absolute;left:144.00px;top:164.89px" class="cls_008"><span class="cls_008">exclude certain files or folders from being included in the context when</span></div>
<div style="position:absolute;left:144.00px;top:177.49px" class="cls_008"><span class="cls_008">building the image.</span></div>
<div style="position:absolute;left:126.01px;top:194.41px" class="cls_008"><span class="cls_008">•  Avoid installing unnecessary packages into the filesystem of the image. Once</span></div>
<div style="position:absolute;left:144.00px;top:207.01px" class="cls_008"><span class="cls_008">again, this is to keep the image as lean as possible.</span></div>
<div style="position:absolute;left:126.01px;top:223.93px" class="cls_008"><span class="cls_008">•  Use multistage builds so that the resulting image is as small as possible</span></div>
<div style="position:absolute;left:144.00px;top:236.52px" class="cls_008"><span class="cls_008">and only contains the absolute minimum needed to run your application or</span></div>
<div style="position:absolute;left:144.00px;top:249.13px" class="cls_008"><span class="cls_008">application service.</span></div>
<div style="position:absolute;left:108.00px;top:279.07px" class="cls_022"><span class="cls_022">Saving and loading images</span></div>
<div style="position:absolute;left:108.00px;top:302.05px" class="cls_008"><span class="cls_008">The third way to create a new container image is by importing or loading it from a</span></div>
<div style="position:absolute;left:108.00px;top:314.65px" class="cls_008"><span class="cls_008">file. A container image is nothing more than a tarball. To demonstrate this, we can</span></div>
<div style="position:absolute;left:108.00px;top:327.25px" class="cls_008"><span class="cls_008">use the </span><span class="cls_010">docker image save</span><span class="cls_008"> command to export an existing image to a tarball:</span></div>
<div style="position:absolute;left:126.00px;top:348.19px" class="cls_024"><span class="cls_024">$ docker image save -o ./backup/my-alpine.tar my-alpine</span></div>
<div style="position:absolute;left:108.00px;top:367.93px" class="cls_008"><span class="cls_008">The preceding command takes our </span><span class="cls_010">my-alpine</span><span class="cls_008"> image that we previously built and</span></div>
<div style="position:absolute;left:108.00px;top:380.53px" class="cls_008"><span class="cls_008">exports it into a </span><span class="cls_010">./backup/my-alpine.tar</span><span class="cls_008"> file.</span></div>
<div style="position:absolute;left:108.00px;top:401.78px" class="cls_008"><span class="cls_008">If, on the other hand, we have an existing tarball and want to import it as an image</span></div>
<div style="position:absolute;left:108.00px;top:414.37px" class="cls_008"><span class="cls_008">into our system, we can use the </span><span class="cls_010">docker image load</span><span class="cls_008"> command as follows:</span></div>
<div style="position:absolute;left:126.00px;top:435.31px" class="cls_024"><span class="cls_024">$ docker image load -i ./backup/my-alpine.tar</span></div>
<div style="position:absolute;left:108.00px;top:466.31px" class="cls_011"><span class="cls_011">Sharing or shipping images</span></div>
<div style="position:absolute;left:108.00px;top:491.29px" class="cls_008"><span class="cls_008">To be able to ship our custom image to other environments, we need to first give it a</span></div>
<div style="position:absolute;left:108.00px;top:503.89px" class="cls_008"><span class="cls_008">globally unique name. This action is often called tagging an image. We then need to</span></div>
<div style="position:absolute;left:108.00px;top:516.49px" class="cls_008"><span class="cls_008">publish the image to a central location from which other interested or entitled parties</span></div>
<div style="position:absolute;left:108.00px;top:529.09px" class="cls_008"><span class="cls_008">can pull it. These central locations are called </span><span class="cls_009">image registries</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 79 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:77794px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background103.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Tagging an image</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Each image has a so-called </span><span class="cls_009">tag</span><span class="cls_008">. A tag is often used to version images, but it has a</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">broader reach than just being a version number. If we do not explicitly specify a tag</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">when working with images, then Docker automatically assumes we're referring to</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">the </span><span class="cls_021">latest</span><span class="cls_008"> tag. This is relevant when pulling an image from Docker Hub, for example:</span></div>
<div style="position:absolute;left:126.00px;top:194.18px" class="cls_024"><span class="cls_024">$ docker image pull alpine</span></div>
<div style="position:absolute;left:108.00px;top:213.92px" class="cls_008"><span class="cls_008">The preceding command will pull the </span><span class="cls_010">alpine:latest</span><span class="cls_008"> image from the Hub. If we</span></div>
<div style="position:absolute;left:108.00px;top:226.52px" class="cls_008"><span class="cls_008">want to explicitly specify a tag, we do so like this:</span></div>
<div style="position:absolute;left:126.00px;top:247.46px" class="cls_024"><span class="cls_024">$ docker image pull alpine:3.5</span></div>
<div style="position:absolute;left:108.00px;top:267.20px" class="cls_008"><span class="cls_008">This will now pull the </span><span class="cls_010">alpine</span><span class="cls_008"> image that has been tagged with </span><span class="cls_010">3.5</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:297.14px" class="cls_022"><span class="cls_022">Image namespaces</span></div>
<div style="position:absolute;left:108.00px;top:320.12px" class="cls_008"><span class="cls_008">So far, you have been pulling various images and haven't worried so much about</span></div>
<div style="position:absolute;left:108.00px;top:332.72px" class="cls_008"><span class="cls_008">where those images originated from. Your Docker environment is configured so that,</span></div>
<div style="position:absolute;left:108.00px;top:345.32px" class="cls_008"><span class="cls_008">by default, all images are pulled from Docker Hub. We also only pulled so-called</span></div>
<div style="position:absolute;left:108.00px;top:357.92px" class="cls_008"><span class="cls_008">official images from the Docker Hub, such as </span><span class="cls_010">alpine</span><span class="cls_008"> or </span><span class="cls_010">busybox</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:379.17px" class="cls_008"><span class="cls_008">Now it is time to widen our horizon a bit and learn about how images are</span></div>
<div style="position:absolute;left:108.00px;top:391.77px" class="cls_008"><span class="cls_008">namespaced. The most generic way to define an image is by its fully qualified name,</span></div>
<div style="position:absolute;left:108.00px;top:404.37px" class="cls_008"><span class="cls_008">which looks as follows:</span></div>
<div style="position:absolute;left:126.00px;top:425.30px" class="cls_023"><span class="cls_023">&lt;registry URL>/&lt;User or Org>/&lt;name>:&lt;tag></span></div>
<div style="position:absolute;left:108.00px;top:445.04px" class="cls_008"><span class="cls_008">Let's look at this in a bit more detail:</span></div>
<div style="position:absolute;left:126.00px;top:466.29px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:146.63px;top:466.28px" class="cls_010"><span class="cls_010">&lt;registry URL></span><span class="cls_008">: This is the URL to the registry from which we want to</span></div>
<div style="position:absolute;left:144.00px;top:478.88px" class="cls_008"><span class="cls_008">pull </span><A HREF="https://registry.acme.com">the image. By default, t</A>his is <span class="cls_010">docker.io</span><span class="cls_008">. More generally, this could be</span></div>
<div style="position:absolute;left:144.00px;top:491.48px" class="cls_010"><span class="cls_010"> </span><A HREF="https://registry.acme.com">https://registry.acme.com</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:144.00px;top:508.40px" class="cls_008"><span class="cls_008">Other than Docker Hub, there are quite a few public registries out there that</span></div>
<div style="position:absolute;left:144.00px;top:521.00px" class="cls_008"><span class="cls_008">you could pull images from. The following is a list of some of them, in no</span></div>
<div style="position:absolute;left:144.00px;top:533.60px" class="cls_008"><span class="cls_008">particular order:</span></div>
<div style="position:absolute;left:162.00px;top:554.84px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:554.84px" class="cls_008"><span class="cls_008">Google at </span><A HREF="https://cloud.google.com/container-registry">https://cloud.google.com/container-registry</A> </span></div>
<div style="position:absolute;left:162.00px;top:571.76px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:571.76px" class="cls_008"><span class="cls_008">Amazon AWS at </span><A HREF="https://aws.amazon.com/ecr/">https://aws.amazon.com/ecr/</A> </span></div>
<div style="position:absolute;left:162.00px;top:588.68px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:588.68px" class="cls_008"><span class="cls_008">Microsoft Azure at</span></div>
<div style="position:absolute;left:180.00px;top:602.28px" class="cls_010"><span class="cls_010"> </span><A HREF="https://azure.microsoft.com/services/container-registry/">https://azure.micros</A>oft.com/services/container-registry/</div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 80 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:78596px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background104.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:162.00px;top:114.49px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:114.49px" class="cls_008"><span class="cls_008">Red Hat at </span><A HREF="https://access.redhat.com/containers/">https://access.redhat.com/containers/</A> </span></div>
<div style="position:absolute;left:162.00px;top:131.41px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:131.41px" class="cls_008"><span class="cls_008">Artifactory at </span><A HREF="https://jfrog.com/integration/artifactory-docker-registry/">https://jfrog.com/integration/artifactory-</A> </span></div>
<div style="position:absolute;left:180.00px;top:145.01px" class="cls_010"><span class="cls_010"> </span><A HREF="https://jfrog.com/integration/artifactory-docker-registry/">docker-registry/</A> </div>
<div style="position:absolute;left:126.00px;top:165.25px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:144.00px;top:165.25px" class="cls_010"><span class="cls_010">&lt;User or Org></span><span class="cls_008">: This is the private Docker ID of either an individual or an</span></div>
<div style="position:absolute;left:144.00px;top:177.85px" class="cls_008"><span class="cls_008">organization defined on Docker Hub, or any other registry for that matter,</span></div>
<div style="position:absolute;left:144.00px;top:190.45px" class="cls_008"><span class="cls_008">such as </span><span class="cls_010">microsoft</span><span class="cls_008"> or </span><span class="cls_010">oracle</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.01px;top:207.37px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:144.00px;top:207.37px" class="cls_010"><span class="cls_010">&lt;name></span><span class="cls_008">: This is the name of the image that is often also called a repository.</span></div>
<div style="position:absolute;left:126.00px;top:224.29px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:144.00px;top:224.29px" class="cls_010"><span class="cls_010">&lt;tag></span><span class="cls_008">: This is the tag of the image.</span></div>
<div style="position:absolute;left:108.00px;top:245.54px" class="cls_008"><span class="cls_008">Let's look at an example:</span></div>
<div style="position:absolute;left:126.00px;top:266.47px" class="cls_023"><span class="cls_023"> </span><A HREF="https://registry.acme.com/engineering/web-app:1.0/">https://registry.acme.com/engineering/web-app:1.0</A> </div>
<div style="position:absolute;left:108.00px;top:286.21px" class="cls_008"><span class="cls_008">Here, we have an image, </span><span class="cls_010">web-app</span><span class="cls_008">, that is tagged with version </span><span class="cls_010">1.0</span><span class="cls_008"> and belongs to the</span></div>
<div style="position:absolute;left:108.00px;top:298.81px" class="cls_010"><span class="cls_010">engineering</span><span class="cls_008"> organization on the private registry at </span><span class="cls_010">https://registry.acme.com</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:320.06px" class="cls_008"><span class="cls_008">Now, there are some special conventions:</span></div>
<div style="position:absolute;left:125.99px;top:341.30px" class="cls_008"><span class="cls_008">•   If we omit the registry URL, then Docker Hub is automatically taken</span></div>
<div style="position:absolute;left:125.99px;top:358.21px" class="cls_008"><span class="cls_008">•  If we omit the tag, then </span><span class="cls_010">latest</span><span class="cls_008"> is taken</span></div>
<div style="position:absolute;left:126.00px;top:375.13px" class="cls_008"><span class="cls_008">•  If it is an official image on Docker Hub, then no user or organization</span></div>
<div style="position:absolute;left:144.00px;top:387.73px" class="cls_008"><span class="cls_008">namespace is needed</span></div>
<div style="position:absolute;left:107.99px;top:408.97px" class="cls_008"><span class="cls_008">A few samples in tabular form are as follows:</span></div>
<div style="position:absolute;left:120.89px;top:438.08px" class="cls_027"><span class="cls_027">Image</span></div>
<div style="position:absolute;left:251.68px;top:438.08px" class="cls_027"><span class="cls_027">Description</span></div>
<div style="position:absolute;left:251.68px;top:452.99px" class="cls_025"><span class="cls_025">Official </span><span class="cls_010">alpine</span><span class="cls_025"> image on Docker Hub with the </span><span class="cls_010">latest</span></div>
<div style="position:absolute;left:120.89px;top:458.21px" class="cls_010"><span class="cls_010">alpine</span></div>
<div style="position:absolute;left:251.68px;top:464.39px" class="cls_025"><span class="cls_025">tag.</span></div>
<div style="position:absolute;left:251.68px;top:479.29px" class="cls_025"><span class="cls_025">Official </span><span class="cls_010">ubuntu</span><span class="cls_025"> image on Docker Hub with the </span><span class="cls_010">16.04</span></div>
<div style="position:absolute;left:120.89px;top:484.52px" class="cls_010"><span class="cls_010">ubuntu:16.04</span></div>
<div style="position:absolute;left:251.68px;top:490.69px" class="cls_025"><span class="cls_025">tag or version.</span></div>
<div style="position:absolute;left:251.68px;top:505.60px" class="cls_010"><span class="cls_010">nanoserver</span><span class="cls_025"> image of Microsoft on Docker Hub with</span></div>
<div style="position:absolute;left:120.89px;top:510.82px" class="cls_010"><span class="cls_010">microsoft/nanoserver</span></div>
<div style="position:absolute;left:251.68px;top:517.00px" class="cls_025"><span class="cls_025">the </span><span class="cls_010">latest</span><span class="cls_025"> tag.</span></div>
<div style="position:absolute;left:251.68px;top:531.90px" class="cls_010"><span class="cls_010">web-api</span><span class="cls_025"> image version </span><span class="cls_010">12.0</span><span class="cls_025"> associated with the </span><span class="cls_010">acme</span></div>
<div style="position:absolute;left:120.89px;top:537.13px" class="cls_010"><span class="cls_010">acme/web-api:12.0</span></div>
<div style="position:absolute;left:251.68px;top:543.30px" class="cls_025"><span class="cls_025">org. The image is on Docker Hub.</span></div>
<div style="position:absolute;left:251.68px;top:558.21px" class="cls_010"><span class="cls_010">sample-app</span><span class="cls_025"> image with the </span><span class="cls_010">1.1</span><span class="cls_025"> tag belonging to</span></div>
<div style="position:absolute;left:120.89px;top:563.43px" class="cls_010"><span class="cls_010">gcr.io/gnschenker/</span></div>
<div style="position:absolute;left:251.68px;top:569.61px" class="cls_025"><span class="cls_025">an individual with the </span><span class="cls_010">gnschenker</span><span class="cls_025"> ID on Google's</span></div>
<div style="position:absolute;left:120.89px;top:574.83px" class="cls_010"><span class="cls_010">sample-app:1.1</span></div>
<div style="position:absolute;left:251.68px;top:581.01px" class="cls_025"><span class="cls_025">container registry.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 81 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:79398px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background105.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Official images</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">In the preceding table, we mentioned </span><span class="cls_021">official image</span><span class="cls_008"> a few times. This needs an</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">explanation. Images are stored in repositories on the Docker Hub registry. Official</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">repositories are a set of repositories that are hosted on Docker Hub and are curated</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">by individuals or organizations that are also responsible for the software that is</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">packaged inside the image. Let's look at an example of what that means. There is an</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">official organization behind the Ubuntu Linux distro. This team also provides official</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">versions of Docker images that contain their Ubuntu distros.</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">Official images are meant to provide essential base OS repositories, images for</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">popular programming language runtimes, frequently used data storage, and other</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">important services.</span></div>
<div style="position:absolute;left:108.00px;top:278.73px" class="cls_008"><span class="cls_008">Docker sponsors a team whose task it is to review and publish all those curated</span></div>
<div style="position:absolute;left:108.00px;top:291.33px" class="cls_008"><span class="cls_008">images in public repositories on Docker Hub. Furthermore, Docker scans all official</span></div>
<div style="position:absolute;left:108.00px;top:303.93px" class="cls_008"><span class="cls_008">images for vulnerabilities.</span></div>
<div style="position:absolute;left:108.00px;top:333.86px" class="cls_022"><span class="cls_022">Pushing images to a registry</span></div>
<div style="position:absolute;left:108.00px;top:356.84px" class="cls_008"><span class="cls_008">Creating custom images is all well and good, but at some point, we want to actually</span></div>
<div style="position:absolute;left:108.00px;top:369.44px" class="cls_008"><span class="cls_008">share or ship our images to a target environment, such as a test, QA, or production</span></div>
<div style="position:absolute;left:108.00px;top:382.04px" class="cls_008"><span class="cls_008">system. For this, we typically use a container registry. One of the most popular and</span></div>
<div style="position:absolute;left:108.00px;top:394.64px" class="cls_008"><span class="cls_008">public registries out there is Docker Hub. It is configured as a default registry in your</span></div>
<div style="position:absolute;left:108.00px;top:407.24px" class="cls_008"><span class="cls_008">Docker environment, and it is the registry from which we have pulled all our images</span></div>
<div style="position:absolute;left:108.00px;top:419.84px" class="cls_008"><span class="cls_008">so far.</span></div>
<div style="position:absolute;left:108.00px;top:441.09px" class="cls_008"><span class="cls_008">On a registry, one can usually create personal or organizational accounts. For</span></div>
<div style="position:absolute;left:108.00px;top:453.68px" class="cls_008"><span class="cls_008">example, my personal account at Docker Hub is </span><span class="cls_010">gnschenker</span><span class="cls_008">. Personal accounts</span></div>
<div style="position:absolute;left:108.00px;top:466.28px" class="cls_008"><span class="cls_008">are good for personal use. If we want to use the registry professionally, then we</span></div>
<div style="position:absolute;left:108.00px;top:478.88px" class="cls_008"><span class="cls_008">probably want to create an organizational account, such as </span><span class="cls_010">acme</span><span class="cls_008">, on Docker Hub.</span></div>
<div style="position:absolute;left:108.00px;top:491.48px" class="cls_008"><span class="cls_008">The advantage of the latter is that organizations can have multiple teams. Teams can</span></div>
<div style="position:absolute;left:108.00px;top:504.08px" class="cls_008"><span class="cls_008">have differing permissions.</span></div>
<div style="position:absolute;left:108.00px;top:525.33px" class="cls_008"><span class="cls_008">To be able to push an image to my personal account on Docker Hub, I need to tag it</span></div>
<div style="position:absolute;left:108.00px;top:537.92px" class="cls_008"><span class="cls_008">accordingly. Let's say I want to push the latest version of </span><span class="cls_010">alpine</span><span class="cls_008"> to my account and</span></div>
<div style="position:absolute;left:108.00px;top:550.52px" class="cls_008"><span class="cls_008">give it a tag of </span><span class="cls_010">1.0</span><span class="cls_008">. I can do this in the following way:</span></div>
<div style="position:absolute;left:126.00px;top:571.46px" class="cls_024"><span class="cls_024">$ docker image tag alpine:latest gnschenker/alpine:1.0</span></div>
<div style="position:absolute;left:108.00px;top:591.20px" class="cls_008"><span class="cls_008">Now, to be able to push the image, I have to log in to my account:</span></div>
<div style="position:absolute;left:126.00px;top:612.14px" class="cls_024"><span class="cls_024">$ docker login -u gnschenker -p &lt;my secret password></span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 82 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:80200px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background106.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 4</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After a successful login, I can then push the image:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">$ docker image push gnschenker/alpine:1.0</span></div>
<div style="position:absolute;left:108.00px;top:155.17px" class="cls_008"><span class="cls_008">I will see something similar to this in the terminal:</span></div>
<div style="position:absolute;left:126.00px;top:176.11px" class="cls_024"><span class="cls_024">The push refers to repository [docker.io/gnschenker/alpine]</span></div>
<div style="position:absolute;left:126.00px;top:188.35px" class="cls_024"><span class="cls_024">04a094fe844e: Mounted from library/alpine</span></div>
<div style="position:absolute;left:126.00px;top:200.59px" class="cls_024"><span class="cls_024">1.0: digest: sha256:5cb04fce... size: 528</span></div>
<div style="position:absolute;left:108.00px;top:220.33px" class="cls_008"><span class="cls_008">For each image that we push to Docker Hub, we automatically create a repository.</span></div>
<div style="position:absolute;left:108.00px;top:232.93px" class="cls_008"><span class="cls_008">A repository can be private or public. Everyone can pull an image from a public</span></div>
<div style="position:absolute;left:108.00px;top:245.53px" class="cls_008"><span class="cls_008">repository. From a private repository, one can only pull an image if one is logged in</span></div>
<div style="position:absolute;left:108.00px;top:258.13px" class="cls_008"><span class="cls_008">to the registry and has the necessary permissions configured.</span></div>
<div style="position:absolute;left:108.00px;top:290.63px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:315.61px" class="cls_008"><span class="cls_008">In this chapter, we have discussed in detail what container images are and how</span></div>
<div style="position:absolute;left:108.00px;top:328.21px" class="cls_008"><span class="cls_008">we can build and ship them. As we have seen, there are three different ways that</span></div>
<div style="position:absolute;left:108.00px;top:340.81px" class="cls_008"><span class="cls_008">an image can be created—either manually, automatically, or by importing a tarball</span></div>
<div style="position:absolute;left:108.00px;top:353.41px" class="cls_008"><span class="cls_008">into the system. We also learned some of the best practices commonly used when</span></div>
<div style="position:absolute;left:108.00px;top:366.01px" class="cls_008"><span class="cls_008">building custom images.</span></div>
<div style="position:absolute;left:108.00px;top:387.26px" class="cls_008"><span class="cls_008">In the next chapter, we're going to introduce Docker volumes that can be used to</span></div>
<div style="position:absolute;left:108.00px;top:399.86px" class="cls_008"><span class="cls_008">persist the state of a container, and we will also introduce some helpful system</span></div>
<div style="position:absolute;left:108.00px;top:412.46px" class="cls_008"><span class="cls_008">commands that can be used to inspect the Docker host more deeply, work with</span></div>
<div style="position:absolute;left:108.00px;top:425.06px" class="cls_008"><span class="cls_008">events generated by the Docker daemon, and clean up unused resources.</span></div>
<div style="position:absolute;left:108.00px;top:457.55px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:482.53px" class="cls_008"><span class="cls_008">Please try to answer the following questions to assess your learning progress:</span></div>
<div style="position:absolute;left:126.00px;top:503.78px" class="cls_008"><span class="cls_008">1.  How will you create a Dockerfile that inherits from Ubuntu version 17.04,</span></div>
<div style="position:absolute;left:143.99px;top:516.37px" class="cls_008"><span class="cls_008">and that installs </span><span class="cls_010">ping</span><span class="cls_008"> and runs </span><span class="cls_010">ping</span><span class="cls_008"> when a container starts. The default</span></div>
<div style="position:absolute;left:144.00px;top:528.97px" class="cls_008"><span class="cls_008">address to ping will be </span><span class="cls_010">127.0.0.1</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:545.89px" class="cls_008"><span class="cls_008">2.  How will you create a new container image that uses </span><span class="cls_010">alpine:latest</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:144.00px;top:558.49px" class="cls_008"><span class="cls_008">installs </span><span class="cls_010">curl</span><span class="cls_008">. Name the new image </span><span class="cls_010">my-alpine:1.0</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:575.41px" class="cls_008"><span class="cls_008">3.  Create a Dockerfile that uses multiple steps to create an image  of a </span><span class="cls_010">Hello</span></div>
<div style="position:absolute;left:144.00px;top:588.01px" class="cls_010"><span class="cls_010">World</span><span class="cls_008"> app of minimal size, written in C or Go.</span></div>
<div style="position:absolute;left:126.00px;top:604.93px" class="cls_008"><span class="cls_008">4.  Name three essential characteristics of a Docker container image.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 83 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:81002px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background107.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Creating and Managing Container Images</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">5.  You want to push an image named </span><span class="cls_010">foo:1.0</span><span class="cls_008"> to your </span><span class="cls_010">jdoe</span><span class="cls_008"> personal account</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">on Docker Hub. Which of the following is the right solution?</span></div>
<div style="position:absolute;left:162.00px;top:147.14px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:180.00px;top:148.13px" class="cls_010"><span class="cls_010">$ docker container push foo:1.0</span></div>
<div style="position:absolute;left:162.00px;top:162.85px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:180.00px;top:163.85px" class="cls_010"><span class="cls_010">$ docker image tag foo:1.0 jdoe/foo:1.0</span></div>
<div style="position:absolute;left:180.00px;top:179.58px" class="cls_010"><span class="cls_010">$ docker image push jdoe/foo:1.0</span></div>
<div style="position:absolute;left:162.00px;top:198.61px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:180.00px;top:199.61px" class="cls_010"><span class="cls_010">$ docker login -u jdoe -p &lt;your password></span></div>
<div style="position:absolute;left:180.00px;top:215.34px" class="cls_010"><span class="cls_010">$ docker image tag foo:1.0 jdoe/foo:1.0</span></div>
<div style="position:absolute;left:180.00px;top:231.06px" class="cls_010"><span class="cls_010">$ docker image push jdoe/foo:1.0</span></div>
<div style="position:absolute;left:162.00px;top:250.09px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:180.00px;top:251.09px" class="cls_010"><span class="cls_010">$ docker login -u jdoe -p &lt;your password></span></div>
<div style="position:absolute;left:180.00px;top:266.82px" class="cls_010"><span class="cls_010">$ docker container tag foo:1.0 jdoe/foo:1.0</span></div>
<div style="position:absolute;left:180.00px;top:282.54px" class="cls_010"><span class="cls_010">$ docker container push jdoe/foo:1.0</span></div>
<div style="position:absolute;left:162.00px;top:301.57px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:180.00px;top:302.57px" class="cls_010"><span class="cls_010">$ docker login -u jdoe -p &lt;your password></span></div>
<div style="position:absolute;left:180.00px;top:318.30px" class="cls_010"><span class="cls_010">$ docker image push foo:1.0 jdoe/foo:1.0</span></div>
<div style="position:absolute;left:108.00px;top:349.79px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:374.77px" class="cls_008"><span class="cls_008">The following list of references gives you some material that dives more deeply into</span></div>
<div style="position:absolute;left:108.00px;top:387.37px" class="cls_008"><span class="cls_008">the topic of authoring and building container images:</span></div>
<div style="position:absolute;left:126.00px;top:408.62px" class="cls_008"><span class="cls_008">•  Best practices for writing Dockerfiles at </span><A HREF="http://dockr.ly/22WiJiO">http://dockr.ly/22WiJiO</A> </span></div>
<div style="position:absolute;left:126.00px;top:425.53px" class="cls_008"><span class="cls_008">•  Using multistage builds at </span><A HREF="http://dockr.ly/2ewcUY3">http://dockr.ly/2ewcUY3</A> </span></div>
<div style="position:absolute;left:126.00px;top:442.45px" class="cls_008"><span class="cls_008">•  About Storage drivers at </span><A HREF="http://dockr.ly/1TuWndC">http://dockr.ly/1TuWndC</A> </span></div>
<div style="position:absolute;left:126.00px;top:459.37px" class="cls_008"><span class="cls_008">•  Graphdriver plugins at  </span><A HREF="http://dockr.ly/2eIVCab">http://dockr.ly/2eIVCab</A> </span></div>
<div style="position:absolute;left:126.00px;top:476.29px" class="cls_008"><span class="cls_008">•  User-guided caching in Docker for MAC at </span><A HREF="http://dockr.ly/2xKafPf">http://dockr.ly/2xKafPf</A> </span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 84 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:81804px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background108.jpg" width=612 height=792></div>
<div style="position:absolute;left:150.49px;top:218.71px" class="cls_015"><span class="cls_015">Data Volumes and System</span></div>
<div style="position:absolute;left:328.90px;top:254.71px" class="cls_015"><span class="cls_015">Management</span></div>
<div style="position:absolute;left:108.00px;top:308.41px" class="cls_008"><span class="cls_008">In the last chapter, we learned how to build and share our own container images.</span></div>
<div style="position:absolute;left:108.00px;top:321.01px" class="cls_008"><span class="cls_008">Particular focus was put on how to build images that are as small as possible by only</span></div>
<div style="position:absolute;left:108.00px;top:333.61px" class="cls_008"><span class="cls_008">containing artifacts that are really needed by the containerized application.</span></div>
<div style="position:absolute;left:108.00px;top:354.86px" class="cls_008"><span class="cls_008">In this chapter, we are going to learn how we can work with stateful containers, that</span></div>
<div style="position:absolute;left:108.00px;top:367.46px" class="cls_008"><span class="cls_008">is containers that consume and produce data. We will also learn how to keep our</span></div>
<div style="position:absolute;left:108.00px;top:380.06px" class="cls_008"><span class="cls_008">Docker environment clean and free from unused resources. Last but not least, we</span></div>
<div style="position:absolute;left:108.00px;top:392.66px" class="cls_008"><span class="cls_008">will be looking into the stream of events that a Docker engine is producing.</span></div>
<div style="position:absolute;left:108.00px;top:413.90px" class="cls_008"><span class="cls_008">Here is a list of the topics we're going to discuss:</span></div>
<div style="position:absolute;left:126.00px;top:435.14px" class="cls_008"><span class="cls_008">•  Creating and mounting data volumes</span></div>
<div style="position:absolute;left:126.00px;top:452.05px" class="cls_008"><span class="cls_008">•  Sharing data between containers</span></div>
<div style="position:absolute;left:126.00px;top:468.97px" class="cls_008"><span class="cls_008">•  Using host volumes</span></div>
<div style="position:absolute;left:126.00px;top:485.89px" class="cls_008"><span class="cls_008">•  Defining volumes in images</span></div>
<div style="position:absolute;left:126.00px;top:502.80px" class="cls_008"><span class="cls_008">•  Obtaining exhaustive Docker system information</span></div>
<div style="position:absolute;left:126.00px;top:519.72px" class="cls_008"><span class="cls_008">•  Listing resource consumption</span></div>
<div style="position:absolute;left:126.00px;top:536.63px" class="cls_008"><span class="cls_008">•  Pruning unused resources</span></div>
<div style="position:absolute;left:126.00px;top:553.55px" class="cls_008"><span class="cls_008">•  Consuming Docker system events</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 85 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:82606px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background109.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After working through this chapter, you will be able to:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  Create, delete, and list data volumes</span></div>
<div style="position:absolute;left:126.00px;top:152.65px" class="cls_008"><span class="cls_008">•  Mount an existing data volume into a container</span></div>
<div style="position:absolute;left:126.00px;top:169.57px" class="cls_008"><span class="cls_008">•  Create durable data from within a container using a data volume</span></div>
<div style="position:absolute;left:126.00px;top:186.48px" class="cls_008"><span class="cls_008">•  Share data between multiple containers using data volumes</span></div>
<div style="position:absolute;left:126.00px;top:203.40px" class="cls_008"><span class="cls_008">•  Mount any host folder into a container using data volumes</span></div>
<div style="position:absolute;left:126.00px;top:220.31px" class="cls_008"><span class="cls_008">•  Define the access mode (read/write or read-only) for a container when</span></div>
<div style="position:absolute;left:143.99px;top:232.91px" class="cls_008"><span class="cls_008">accessing data in a data volume</span></div>
<div style="position:absolute;left:126.00px;top:249.83px" class="cls_008"><span class="cls_008">•  List the amount of space consumed by Docker resources on a given host,</span></div>
<div style="position:absolute;left:143.99px;top:262.43px" class="cls_008"><span class="cls_008">such as images, containers, and volumes</span></div>
<div style="position:absolute;left:126.00px;top:279.34px" class="cls_008"><span class="cls_008">•  Free your system from unused Docker resources, such as containers, images,</span></div>
<div style="position:absolute;left:143.99px;top:291.94px" class="cls_008"><span class="cls_008">and volumes</span></div>
<div style="position:absolute;left:126.00px;top:308.86px" class="cls_008"><span class="cls_008">•  Display Docker system events in a console in real time</span></div>
<div style="position:absolute;left:108.00px;top:341.39px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:366.37px" class="cls_008"><span class="cls_008">For this chapter, you need either Docker Toolbox installed on your machine or access</span></div>
<div style="position:absolute;left:108.00px;top:378.97px" class="cls_008"><span class="cls_008">to a Linux VM running Docker on your laptop or in the cloud. There is no code</span></div>
<div style="position:absolute;left:108.00px;top:391.57px" class="cls_008"><span class="cls_008">accompanying this chapter.</span></div>
<div style="position:absolute;left:108.00px;top:424.07px" class="cls_011"><span class="cls_011">Creating and mounting data volumes</span></div>
<div style="position:absolute;left:108.00px;top:449.05px" class="cls_008"><span class="cls_008">All meaningful applications consume or produce data. Yet containers are preferably</span></div>
<div style="position:absolute;left:108.00px;top:461.65px" class="cls_008"><span class="cls_008">meant to be stateless. How are we going to deal with this? One way is to use Docker</span></div>
<div style="position:absolute;left:108.00px;top:474.25px" class="cls_008"><span class="cls_008">volumes. Volumes allow containers to consume, produce, and modify state. Volumes</span></div>
<div style="position:absolute;left:108.00px;top:486.85px" class="cls_008"><span class="cls_008">have a life cycle that goes beyond the life cycle of containers. When a container that</span></div>
<div style="position:absolute;left:108.00px;top:499.45px" class="cls_008"><span class="cls_008">uses a volume dies, the volume continues to exist. This is great for the durability</span></div>
<div style="position:absolute;left:108.00px;top:512.05px" class="cls_008"><span class="cls_008">of state.</span></div>
<div style="position:absolute;left:108.00px;top:541.99px" class="cls_022"><span class="cls_022">Modifying the container layer</span></div>
<div style="position:absolute;left:108.00px;top:564.97px" class="cls_008"><span class="cls_008">Before we dive into volumes, let's first discuss what's happening if an application</span></div>
<div style="position:absolute;left:108.00px;top:577.57px" class="cls_008"><span class="cls_008">in a container changes something in the filesystem of the container. In this case, the</span></div>
<div style="position:absolute;left:108.00px;top:590.17px" class="cls_008"><span class="cls_008">changes are all happening in the writable container layer. Let's quickly demonstrate</span></div>
<div style="position:absolute;left:108.00px;top:602.77px" class="cls_008"><span class="cls_008">this by running a container and execute a script in it that is creating a new file:</span></div>
<div style="position:absolute;left:144.00px;top:623.71px" class="cls_024"><span class="cls_024">$ docker container run --name demo \</span></div>
<div style="position:absolute;left:165.60px;top:638.83px" class="cls_024"><span class="cls_024">alpine /bin/sh -c 'echo "This is a test" > sample.txt'</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 86 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:83408px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background110.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The preceding command creates a container named </span><span class="cls_010">demo</span><span class="cls_008"> and inside this container</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">creates a file called </span><span class="cls_010">sample.txt</span><span class="cls_008"> with the content </span><span class="cls_010">This is a test</span><span class="cls_008">. The container</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">exits after this but remains in memory available for us to do our investigations. Let's</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">use the </span><span class="cls_010">diff</span><span class="cls_008"> command to find out what has changed in the container's filesystem in</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">relation to the filesystem of the image:</span></div>
<div style="position:absolute;left:144.00px;top:185.83px" class="cls_024"><span class="cls_024">$ docker container diff demo</span></div>
<div style="position:absolute;left:108.00px;top:205.57px" class="cls_008"><span class="cls_008">The output should look like this:</span></div>
<div style="position:absolute;left:144.00px;top:226.51px" class="cls_024"><span class="cls_024">A /sample.txt</span></div>
<div style="position:absolute;left:108.00px;top:246.25px" class="cls_008"><span class="cls_008">Evidently a new file, </span><span class="cls_010">A</span><span class="cls_008">, has been added to the filesystem of the container as expected.</span></div>
<div style="position:absolute;left:108.00px;top:258.85px" class="cls_008"><span class="cls_008">Since all layers that stem from the underlying image (</span><span class="cls_010">alpine</span><span class="cls_008"> in this case) are</span></div>
<div style="position:absolute;left:108.00px;top:271.45px" class="cls_008"><span class="cls_008">immutable, the change could only happen in the writeable container layer.</span></div>
<div style="position:absolute;left:108.00px;top:292.70px" class="cls_008"><span class="cls_008">If we now remove the container from memory, its container layer will also be</span></div>
<div style="position:absolute;left:108.00px;top:305.30px" class="cls_008"><span class="cls_008">removed and with it all the changes will be irreversibly deleted. If we need our</span></div>
<div style="position:absolute;left:108.00px;top:317.90px" class="cls_008"><span class="cls_008">changes to persist even beyond the lifetime of the container, this is not a solution.</span></div>
<div style="position:absolute;left:108.00px;top:330.50px" class="cls_008"><span class="cls_008">Luckily, we have better options in the form of Docker volumes. Let's get to know</span></div>
<div style="position:absolute;left:108.00px;top:343.10px" class="cls_008"><span class="cls_008">them.</span></div>
<div style="position:absolute;left:108.00px;top:373.03px" class="cls_022"><span class="cls_022">Creating volumes</span></div>
<div style="position:absolute;left:108.00px;top:396.01px" class="cls_008"><span class="cls_008">Since, at this time, when using Docker for Mac or Windows containers are not running</span></div>
<div style="position:absolute;left:108.00px;top:408.61px" class="cls_008"><span class="cls_008">natively on OS X or Windows but rather in a (hidden) VM created by Docker for Mac</span></div>
<div style="position:absolute;left:108.00px;top:421.21px" class="cls_008"><span class="cls_008">and Windows, it is best we use </span><span class="cls_010">docker-machine</span><span class="cls_008"> to create and use an explicit VM</span></div>
<div style="position:absolute;left:108.00px;top:433.81px" class="cls_008"><span class="cls_008">running Docker. At this point, we assume that you have Docker Toolbox installed</span></div>
<div style="position:absolute;left:108.00px;top:446.41px" class="cls_008"><span class="cls_008">on your system. If not, then please go back to </span><span class="cls_021">Chapter 2</span><span class="cls_008">, Setting up a Working</span></div>
<div style="position:absolute;left:108.00px;top:459.01px" class="cls_008"><span class="cls_008">Environment, where we provide detailed instructions on how to install Toolbox.</span></div>
<div style="position:absolute;left:108.00px;top:480.25px" class="cls_008"><span class="cls_008">Use </span><span class="cls_010">docker-machine</span><span class="cls_008"> to list all VMs currently running in VirtualBox:</span></div>
<div style="position:absolute;left:144.00px;top:501.19px" class="cls_024"><span class="cls_024">$ docker-machine ls</span></div>
<div style="position:absolute;left:108.00px;top:520.93px" class="cls_008"><span class="cls_008">If you do not have a VM called </span><span class="cls_010">node-1</span><span class="cls_008"> listed then create one:</span></div>
<div style="position:absolute;left:144.00px;top:541.87px" class="cls_024"><span class="cls_024">$ docker-machine create --driver virtualbox node-1</span></div>
<div style="position:absolute;left:108.00px;top:561.61px" class="cls_008"><span class="cls_008">If you have a VM called </span><span class="cls_010">node-1</span><span class="cls_008"> but it is not running then please start it:</span></div>
<div style="position:absolute;left:144.00px;top:582.55px" class="cls_024"><span class="cls_024">$ docker-machine start node-1</span></div>
<div style="position:absolute;left:108.00px;top:602.29px" class="cls_008"><span class="cls_008">Now that everything is ready, SSH into this VM called </span><span class="cls_010">node-1</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:144.00px;top:623.23px" class="cls_024"><span class="cls_024">$ docker-machine ssh node-1</span></div>
<div style="position:absolute;left:108.00px;top:642.97px" class="cls_008"><span class="cls_008">You should be greeted by a </span><span class="cls_010">boot2docker</span><span class="cls_008"> welcome image.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 87 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:84210px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background111.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To create a new data volume, we can use the </span><span class="cls_010">docker volume create</span><span class="cls_008"> command.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">This will create a named volume which can then be mounted into a container and be</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">used for persistent data access or storage. The following command creates a volume,</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_010"><span class="cls_010">my-data</span><span class="cls_008"> using the default volume driver:</span></div>
<div style="position:absolute;left:144.00px;top:173.23px" class="cls_024"><span class="cls_024">$ docker volume create my-data</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">The default volume driver is the so-called local driver which stores the data locally in</span></div>
<div style="position:absolute;left:108.00px;top:205.57px" class="cls_008"><span class="cls_008">the host filesystem. The easiest way to find out where the data is stored on the host</span></div>
<div style="position:absolute;left:108.00px;top:218.17px" class="cls_008"><span class="cls_008">is by using the </span><span class="cls_010">inspect</span><span class="cls_008"> command on the volume we just created. The actual location</span></div>
<div style="position:absolute;left:108.00px;top:230.77px" class="cls_008"><span class="cls_008">can differ from system to system and so, this is the safest way to find the target</span></div>
<div style="position:absolute;left:108.00px;top:243.37px" class="cls_008"><span class="cls_008">folder:</span></div>
<div style="position:absolute;left:144.00px;top:264.31px" class="cls_024"><span class="cls_024">$ docker volume inspect my-data</span></div>
<div style="position:absolute;left:144.00px;top:276.55px" class="cls_024"><span class="cls_024">[</span></div>
<div style="position:absolute;left:165.60px;top:288.79px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:187.20px;top:301.03px" class="cls_024"><span class="cls_024">"CreatedAt": "2018-01-28T21:55:41Z",</span></div>
<div style="position:absolute;left:187.20px;top:313.27px" class="cls_024"><span class="cls_024">"Driver": "local",</span></div>
<div style="position:absolute;left:187.20px;top:325.51px" class="cls_024"><span class="cls_024">"Labels": {},</span></div>
<div style="position:absolute;left:187.20px;top:337.75px" class="cls_024"><span class="cls_024">"Mountpoint": "/mnt/sda1/var/lib/docker/volumes/my-data/_</span></div>
<div style="position:absolute;left:144.00px;top:348.55px" class="cls_024"><span class="cls_024">data",</span></div>
<div style="position:absolute;left:187.20px;top:360.79px" class="cls_024"><span class="cls_024">"Name": "my-data",</span></div>
<div style="position:absolute;left:187.20px;top:373.03px" class="cls_024"><span class="cls_024">"Options": {},</span></div>
<div style="position:absolute;left:187.20px;top:385.27px" class="cls_024"><span class="cls_024">"Scope": "local"</span></div>
<div style="position:absolute;left:165.60px;top:397.51px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:144.00px;top:409.75px" class="cls_024"><span class="cls_024">]</span></div>
<div style="position:absolute;left:108.00px;top:429.49px" class="cls_008"><span class="cls_008">The host folder can be found in the output under </span><span class="cls_010">Mountpoint</span><span class="cls_008">. In our case, when</span></div>
<div style="position:absolute;left:108.01px;top:442.09px" class="cls_008"><span class="cls_008">using </span><span class="cls_010">docker-machine</span><span class="cls_008"> with a LinuxKit-based VM running in VirtualBox, the folder</span></div>
<div style="position:absolute;left:108.00px;top:454.69px" class="cls_008"><span class="cls_008">is </span><span class="cls_010">/mnt/sda1/var/lib/docker/volumes/my-data/_data</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:475.93px" class="cls_008"><span class="cls_008">The target folder often is a protected folder and we thus might need to use </span><span class="cls_010">sudo</span><span class="cls_008"> to</span></div>
<div style="position:absolute;left:108.00px;top:488.53px" class="cls_008"><span class="cls_008">navigate to this folder and execute any operations in it. In our case, we do not need</span></div>
<div style="position:absolute;left:108.00px;top:501.13px" class="cls_008"><span class="cls_008">to use </span><span class="cls_010">sudo</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:144.00px;top:522.07px" class="cls_024"><span class="cls_024">$ cd /mnt/sda1/var/lib/docker/volumes/my-data/_data</span></div>
<div style="position:absolute;left:167.30px;top:549.33px" class="cls_025"><span class="cls_025">If you are using Docker for Mac to create a volume on your laptop and</span></div>
<div style="position:absolute;left:167.30px;top:560.73px" class="cls_025"><span class="cls_025">then do a </span><span class="cls_010">docker volume inspect</span><span class="cls_025"> on the volume you just created, the</span></div>
<div style="position:absolute;left:167.30px;top:572.13px" class="cls_010"><span class="cls_010">Mountpoint</span><span class="cls_025"> is shown as </span><span class="cls_010">/var/lib/docker/volumes/my-data/_</span></div>
<div style="position:absolute;left:167.30px;top:583.53px" class="cls_010"><span class="cls_010">data</span><span class="cls_025">. But you will discover that there is no such folder on the Mac. The</span></div>
<div style="position:absolute;left:167.30px;top:594.93px" class="cls_025"><span class="cls_025">reason is that the path is in relation to the hidden VM that Docker for Mac</span></div>
<div style="position:absolute;left:167.30px;top:606.33px" class="cls_025"><span class="cls_025">uses to run containers. At this time, containers cannot run natively on OS</span></div>
<div style="position:absolute;left:167.30px;top:617.73px" class="cls_025"><span class="cls_025">X. The same applies to volumes created with Docker for Windows.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 88 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:85012px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background112.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">There are other volume drivers available from third parties in the form of plugins.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">We can use the </span><span class="cls_010">--driver</span><span class="cls_008"> parameter in the </span><span class="cls_010">create</span><span class="cls_008"> command to select a different</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">volume driver. Other volume drivers use different types of storage systems to back</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">a volume, such as cloud storage, NFS drives, software-defined storage and more.</span></div>
<div style="position:absolute;left:108.00px;top:182.23px" class="cls_022"><span class="cls_022">Mounting a volume</span></div>
<div style="position:absolute;left:108.00px;top:205.21px" class="cls_008"><span class="cls_008">Once we have created a named volume, we can mount it into a container. For this,</span></div>
<div style="position:absolute;left:108.00px;top:217.81px" class="cls_008"><span class="cls_008">we can use the </span><span class="cls_010">-v</span><span class="cls_008"> parameter in the </span><span class="cls_010">docker container run</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:144.00px;top:238.75px" class="cls_024"><span class="cls_024">$ docker container run --name test -it \</span></div>
<div style="position:absolute;left:171.00px;top:253.87px" class="cls_024"><span class="cls_024">-v my-data:/data alpine /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:273.61px" class="cls_008"><span class="cls_008">The preceding command mounts the  </span><span class="cls_010">my-data</span><span class="cls_008"> volume to the </span><span class="cls_010">/data</span><span class="cls_008"> folder inside</span></div>
<div style="position:absolute;left:108.00px;top:286.21px" class="cls_008"><span class="cls_008">the container. Inside the container, we can now create files in the </span><span class="cls_010">/data</span><span class="cls_008"> folder and</span></div>
<div style="position:absolute;left:108.00px;top:298.81px" class="cls_008"><span class="cls_008">then exit:</span></div>
<div style="position:absolute;left:144.00px;top:319.75px" class="cls_024"><span class="cls_024"># / cd /data</span></div>
<div style="position:absolute;left:144.00px;top:334.87px" class="cls_024"><span class="cls_024"># / echo "Some data" > data.txt</span></div>
<div style="position:absolute;left:144.00px;top:349.99px" class="cls_024"><span class="cls_024"># / echo "Some more data" > data2.txt</span></div>
<div style="position:absolute;left:144.00px;top:365.11px" class="cls_024"><span class="cls_024"># / exit</span></div>
<div style="position:absolute;left:108.00px;top:384.85px" class="cls_008"><span class="cls_008">If we navigate to the host folder that contains the volume data and list its content, we</span></div>
<div style="position:absolute;left:108.00px;top:397.45px" class="cls_008"><span class="cls_008">should see the two files we just created inside the container:</span></div>
<div style="position:absolute;left:144.00px;top:418.39px" class="cls_024"><span class="cls_024">$ cd /mnt/sda1/var/lib/docker/volumes/my-data/_data</span></div>
<div style="position:absolute;left:144.00px;top:433.51px" class="cls_024"><span class="cls_024">$ ls -l</span></div>
<div style="position:absolute;left:144.00px;top:448.63px" class="cls_024"><span class="cls_024">total 8</span></div>
<div style="position:absolute;left:144.00px;top:463.75px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 10 Jan 28 22:23 data.txt</span></div>
<div style="position:absolute;left:144.00px;top:478.87px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 15 Jan 28 22:23 data2.txt</span></div>
<div style="position:absolute;left:108.00px;top:498.61px" class="cls_008"><span class="cls_008">We can even try to output the content of say, the second file:</span></div>
<div style="position:absolute;left:144.00px;top:519.55px" class="cls_024"><span class="cls_024">$ cat data2.txt</span></div>
<div style="position:absolute;left:108.00px;top:539.29px" class="cls_008"><span class="cls_008">Let's try to create a file in this folder from the host and then use the volume with</span></div>
<div style="position:absolute;left:108.00px;top:551.89px" class="cls_008"><span class="cls_008">another container:</span></div>
<div style="position:absolute;left:144.00px;top:572.83px" class="cls_024"><span class="cls_024">$ echo "This file we create on the host" > host-data.txt</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 89 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:85814px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background113.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, let's delete the </span><span class="cls_010">test</span><span class="cls_008"> container and run another one based on CentOS. This time</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">we are even mounting our volume to a different container folder, </span><span class="cls_010">/app/data</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker container rm test</span></div>
<div style="position:absolute;left:144.00px;top:163.15px" class="cls_024"><span class="cls_024">$ docker container run --name test2 -it \</span></div>
<div style="position:absolute;left:165.60px;top:178.27px" class="cls_024"><span class="cls_024">-v my-data:/app/data \</span></div>
<div style="position:absolute;left:165.60px;top:193.39px" class="cls_024"><span class="cls_024">Centos:7 /bin/bash</span></div>
<div style="position:absolute;left:108.00px;top:213.13px" class="cls_008"><span class="cls_008">Once inside the CentOS container, we can navigate to the folder </span><span class="cls_010">/app/data</span><span class="cls_008"> where</span></div>
<div style="position:absolute;left:108.00px;top:225.73px" class="cls_008"><span class="cls_008">we have mounted the volume to and list its content:</span></div>
<div style="position:absolute;left:144.00px;top:246.67px" class="cls_024"><span class="cls_024"># / cd /app/data</span></div>
<div style="position:absolute;left:144.00px;top:261.79px" class="cls_024"><span class="cls_024"># / ls -l</span></div>
<div style="position:absolute;left:108.00px;top:281.53px" class="cls_008"><span class="cls_008">As expected, we should see these three files:</span></div>
<div style="position:absolute;left:144.00px;top:302.47px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 10 Jan 28 22:23 data.txt</span></div>
<div style="position:absolute;left:144.00px;top:317.59px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 15 Jan 28 22:23 data2.txt</span></div>
<div style="position:absolute;left:144.00px;top:332.71px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 32 Jan 28 22:31 host-data.txt</span></div>
<div style="position:absolute;left:108.00px;top:352.45px" class="cls_008"><span class="cls_008">This is the definitive proof that data in a Docker volume persists beyond the</span></div>
<div style="position:absolute;left:108.00px;top:365.05px" class="cls_008"><span class="cls_008">lifetime of a container, and also that volumes can be reused by other, even different</span></div>
<div style="position:absolute;left:108.00px;top:377.65px" class="cls_008"><span class="cls_008">containers from the one that used it first.</span></div>
<div style="position:absolute;left:108.00px;top:398.90px" class="cls_008"><span class="cls_008">It is important to note that the folder inside the container to which we mount a</span></div>
<div style="position:absolute;left:108.00px;top:411.50px" class="cls_008"><span class="cls_008">Docker volume is excluded from the union filesystem. That is, each change inside</span></div>
<div style="position:absolute;left:108.00px;top:424.10px" class="cls_008"><span class="cls_008">this folder and any of its subfolders will not be part of the container layer, but</span></div>
<div style="position:absolute;left:108.00px;top:436.70px" class="cls_008"><span class="cls_008">persisted in the backing storage provided by the volume driver. This fact is really</span></div>
<div style="position:absolute;left:108.00px;top:449.30px" class="cls_008"><span class="cls_008">important since the container layer is deleted when the corresponding container is</span></div>
<div style="position:absolute;left:108.00px;top:461.90px" class="cls_008"><span class="cls_008">stopped and removed from the system.</span></div>
<div style="position:absolute;left:108.00px;top:491.83px" class="cls_022"><span class="cls_022">Removing volumes</span></div>
<div style="position:absolute;left:108.00px;top:514.81px" class="cls_008"><span class="cls_008">Volumes can be removed using the </span><span class="cls_010">docker volume rm</span><span class="cls_008"> command. It is important to</span></div>
<div style="position:absolute;left:108.00px;top:527.41px" class="cls_008"><span class="cls_008">remember that removing a volume destroys the containing data irreversibly and thus</span></div>
<div style="position:absolute;left:108.00px;top:540.01px" class="cls_008"><span class="cls_008">is to be considered a dangerous command. Docker helps us a bit in this regard as it</span></div>
<div style="position:absolute;left:108.00px;top:552.61px" class="cls_008"><span class="cls_008">does not allow us to delete a volume that is still in use by a container. Always make</span></div>
<div style="position:absolute;left:108.00px;top:565.21px" class="cls_008"><span class="cls_008">sure before you remove or delete a volume that you either have a backup of its data</span></div>
<div style="position:absolute;left:108.00px;top:577.81px" class="cls_008"><span class="cls_008">or you really don't need this data anymore.</span></div>
<div style="position:absolute;left:108.00px;top:599.05px" class="cls_008"><span class="cls_008">The following command deletes our </span><span class="cls_010">my-data</span><span class="cls_008"> volume that we created earlier:</span></div>
<div style="position:absolute;left:144.00px;top:619.99px" class="cls_024"><span class="cls_024">$ docker volume rm my-data</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 90 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:86616px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background114.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After executing the preceding command, double-check that the folder on the host has</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">been deleted.</span></div>
<div style="position:absolute;left:108.00px;top:148.34px" class="cls_008"><span class="cls_008">To remove all running containers to clean up the system, run the following</span></div>
<div style="position:absolute;left:108.00px;top:160.94px" class="cls_008"><span class="cls_008">command:</span></div>
<div style="position:absolute;left:144.00px;top:181.87px" class="cls_024"><span class="cls_024">$ docker container rm -f $(docker container ls -aq)</span></div>
<div style="position:absolute;left:108.00px;top:212.87px" class="cls_011"><span class="cls_011">Sharing data between containers</span></div>
<div style="position:absolute;left:108.00px;top:237.85px" class="cls_008"><span class="cls_008">Containers are like sandboxes for the applications running inside them. This is</span></div>
<div style="position:absolute;left:108.00px;top:250.45px" class="cls_008"><span class="cls_008">mostly beneficial and wanted in order to protect applications running in different</span></div>
<div style="position:absolute;left:108.00px;top:263.05px" class="cls_008"><span class="cls_008">containers from each other. That also means that the whole filesystem visible to an</span></div>
<div style="position:absolute;left:108.00px;top:275.65px" class="cls_008"><span class="cls_008">application running inside a container is private to this application and no other</span></div>
<div style="position:absolute;left:108.00px;top:288.25px" class="cls_008"><span class="cls_008">application running in a different container can interfere with it.</span></div>
<div style="position:absolute;left:108.00px;top:309.50px" class="cls_008"><span class="cls_008">At times though, we want to share data between containers. Say an application</span></div>
<div style="position:absolute;left:108.00px;top:322.10px" class="cls_008"><span class="cls_008">running in container A produces some data that will be consumed by another</span></div>
<div style="position:absolute;left:108.00px;top:334.70px" class="cls_008"><span class="cls_008">application running in container B. </span><span class="cls_021">How can we achieve this?</span><span class="cls_008"> Well I'm sure you've</span></div>
<div style="position:absolute;left:108.00px;top:347.30px" class="cls_008"><span class="cls_008">already guessed it—we can use Docker volumes for this purpose. We can create</span></div>
<div style="position:absolute;left:108.00px;top:359.90px" class="cls_008"><span class="cls_008">a volume and mount it to container A as well as to container B. In this way, both</span></div>
<div style="position:absolute;left:108.00px;top:372.50px" class="cls_008"><span class="cls_008">applications A and B have access to the same data.</span></div>
<div style="position:absolute;left:108.00px;top:393.74px" class="cls_008"><span class="cls_008">Now, as always when multiple applications or processes concurrently access data,</span></div>
<div style="position:absolute;left:108.00px;top:406.34px" class="cls_008"><span class="cls_008">we have to be very careful to avoid inconsistencies. To avoid concurrency problems,</span></div>
<div style="position:absolute;left:108.00px;top:418.94px" class="cls_008"><span class="cls_008">such as race conditions, we ideally have only one application or process that is</span></div>
<div style="position:absolute;left:108.00px;top:431.54px" class="cls_008"><span class="cls_008">creating or modifying data, while all other processes concurrently accessing this</span></div>
<div style="position:absolute;left:108.00px;top:444.14px" class="cls_008"><span class="cls_008">data only read it. We can enforce a process running in a container to only be able to</span></div>
<div style="position:absolute;left:108.00px;top:456.74px" class="cls_008"><span class="cls_008">read the data in a volume by mounting this volume as read only. Have a look at the</span></div>
<div style="position:absolute;left:108.00px;top:469.34px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:144.00px;top:490.27px" class="cls_024"><span class="cls_024">$ docker container run -it --name writer \</span></div>
<div style="position:absolute;left:165.60px;top:505.39px" class="cls_024"><span class="cls_024">-v shared-data:/data \</span></div>
<div style="position:absolute;left:165.60px;top:520.51px" class="cls_024"><span class="cls_024">alpine /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:540.25px" class="cls_008"><span class="cls_008">Here we create a container called </span><span class="cls_010">writer</span><span class="cls_008"> which has a volume, </span><span class="cls_010">shared-data</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:552.85px" class="cls_008"><span class="cls_008">mounted in default read/write mode. Try to create a file inside this container:</span></div>
<div style="position:absolute;left:144.00px;top:573.79px" class="cls_024"><span class="cls_024"># / echo "I can create a file" > /data/sample.txt</span></div>
<div style="position:absolute;left:108.00px;top:593.53px" class="cls_008"><span class="cls_008">It should succeed. Exit this container and then execute the following command:</span></div>
<div style="position:absolute;left:144.00px;top:614.47px" class="cls_024"><span class="cls_024">$ docker container run -it --name reader \</span></div>
<div style="position:absolute;left:165.60px;top:629.59px" class="cls_024"><span class="cls_024">-v shared-data:/app/data:ro \</span></div>
<div style="position:absolute;left:165.60px;top:644.71px" class="cls_024"><span class="cls_024">ubuntu:17.04 /bin/bash</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 91 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:87418px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background115.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">And we have a container called </span><span class="cls_010">reader</span><span class="cls_008"> that has the same volume mounted as</span></div>
<div style="position:absolute;left:107.99px;top:127.09px" class="cls_008"><span class="cls_008">read-only (ro). Firstly, make sure you can see the file created in the first container:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ ls -l /app/data</span></div>
<div style="position:absolute;left:144.00px;top:163.15px" class="cls_024"><span class="cls_024">total 4</span></div>
<div style="position:absolute;left:144.00px;top:178.27px" class="cls_024"><span class="cls_024">-rw-r--r-- 1 root root 20 Jan 28 22:55 sample.txt</span></div>
<div style="position:absolute;left:108.00px;top:198.01px" class="cls_008"><span class="cls_008">And then try to create a file:</span></div>
<div style="position:absolute;left:144.00px;top:218.95px" class="cls_024"><span class="cls_024"># / echo "Try to break read/only" > /app/data/data.txt</span></div>
<div style="position:absolute;left:108.00px;top:238.69px" class="cls_008"><span class="cls_008">It will fail with the following message:</span></div>
<div style="position:absolute;left:144.00px;top:259.63px" class="cls_024"><span class="cls_024">bash: /app/data/data.txt: Read-only file system</span></div>
<div style="position:absolute;left:108.00px;top:279.37px" class="cls_008"><span class="cls_008">Let's exit the container by typing </span><span class="cls_010">exit</span><span class="cls_008"> at the Command Prompt. Back on the host,</span></div>
<div style="position:absolute;left:108.00px;top:291.97px" class="cls_008"><span class="cls_008">let's clean up all containers and volumes:</span></div>
<div style="position:absolute;left:144.00px;top:312.91px" class="cls_024"><span class="cls_024">$ docker container rm -f $(docker container ls -aq)</span></div>
<div style="position:absolute;left:144.00px;top:328.03px" class="cls_024"><span class="cls_024">$ docker volume rm $(docker volume ls -q)</span></div>
<div style="position:absolute;left:108.00px;top:347.77px" class="cls_008"><span class="cls_008">Once this is done, exit the </span><span class="cls_010">docker-machine</span><span class="cls_008"> VM by also typing </span><span class="cls_010">exit</span><span class="cls_008"> at the</span></div>
<div style="position:absolute;left:108.00px;top:360.37px" class="cls_008"><span class="cls_008">Command Prompt. You should be back on your Docker for Mac or Windows.</span></div>
<div style="position:absolute;left:108.00px;top:372.97px" class="cls_008"><span class="cls_008">Use </span><span class="cls_010">docker-machine</span><span class="cls_008"> to stop the VM:</span></div>
<div style="position:absolute;left:144.00px;top:393.91px" class="cls_024"><span class="cls_024">$ docker-machine stop node-1</span></div>
<div style="position:absolute;left:108.00px;top:424.91px" class="cls_011"><span class="cls_011">Using host volumes</span></div>
<div style="position:absolute;left:108.00px;top:449.89px" class="cls_008"><span class="cls_008">In certain scenarios, such as when developing new containerized applications or</span></div>
<div style="position:absolute;left:108.00px;top:462.49px" class="cls_008"><span class="cls_008">when a containerized application needs to consume data from a certain folder</span></div>
<div style="position:absolute;left:108.00px;top:475.09px" class="cls_008"><span class="cls_008">produced, say, by a legacy application, it is very useful to use volumes that mount</span></div>
<div style="position:absolute;left:108.00px;top:487.69px" class="cls_008"><span class="cls_008">a specific host folder. Let's look at the following example:</span></div>
<div style="position:absolute;left:144.00px;top:508.63px" class="cls_024"><span class="cls_024">$ docker container run --rm -it \</span></div>
<div style="position:absolute;left:165.60px;top:523.75px" class="cls_024"><span class="cls_024">-v $(pwd)/src:/app/src \</span></div>
<div style="position:absolute;left:165.60px;top:538.87px" class="cls_024"><span class="cls_024">alpine:latest /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:558.61px" class="cls_008"><span class="cls_008">The preceding expression interactively starts an </span><span class="cls_010">alpine</span><span class="cls_008"> container with a shell and</span></div>
<div style="position:absolute;left:108.00px;top:571.21px" class="cls_008"><span class="cls_008">mounts the subfolder </span><span class="cls_010">src</span><span class="cls_008"> of the current directory into the container at </span><span class="cls_010">/app/src</span><span class="cls_008">. We</span></div>
<div style="position:absolute;left:108.00px;top:583.81px" class="cls_008"><span class="cls_008">need to use </span><span class="cls_010">$(pwd)</span><span class="cls_008"> (or </span><span class="cls_010">'pwd'</span><span class="cls_008"> for that matter) which is the current directory, as when</span></div>
<div style="position:absolute;left:108.00px;top:596.41px" class="cls_008"><span class="cls_008">working with volumes we always need to use absolute paths.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 92 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:88220px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background116.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Developers use these techniques all the time when they are working on their</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">application that runs in a container, and want to make sure that the container always</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">contains the latest changes they make to the code, without the need to rebuild the</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">image and rerun the container after each change.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">Let's make a sample to demonstrate how that works. Let's say we want to create a</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">simple static website using Nginx as our web server. First, let's create a new folder</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">on the host where we will put our web assets, such as HTML, CSS, and JavaScript</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">files and navigate to it:</span></div>
<div style="position:absolute;left:144.00px;top:232.27px" class="cls_024"><span class="cls_024">$ mkdir ~/my-web</span></div>
<div style="position:absolute;left:144.00px;top:247.39px" class="cls_024"><span class="cls_024">$ cd ~/my-web</span></div>
<div style="position:absolute;left:108.00px;top:267.13px" class="cls_008"><span class="cls_008">Then we create a simple web page like this:</span></div>
<div style="position:absolute;left:144.00px;top:288.07px" class="cls_024"><span class="cls_024">$ echo "&lt;h1>Personal Website&lt;/h1>" > index.html</span></div>
<div style="position:absolute;left:108.00px;top:307.81px" class="cls_008"><span class="cls_008">Now, we add a Dockerfile which will contain the instructions on how to build the</span></div>
<div style="position:absolute;left:108.00px;top:320.41px" class="cls_008"><span class="cls_008">image containing our sample website. Add a file called Dockerfile to the folder with</span></div>
<div style="position:absolute;left:108.00px;top:333.01px" class="cls_008"><span class="cls_008">this content:</span></div>
<div style="position:absolute;left:144.00px;top:353.95px" class="cls_023"><span class="cls_023">FROM nginx:alpine</span></div>
<div style="position:absolute;left:144.00px;top:366.19px" class="cls_023"><span class="cls_023">COPY . /usr/share/nginx/html</span></div>
<div style="position:absolute;left:108.00px;top:385.93px" class="cls_008"><span class="cls_008">The Dockerfile starts with the latest Alpine version of Nginx and then copies all files</span></div>
<div style="position:absolute;left:108.00px;top:398.53px" class="cls_008"><span class="cls_008">from the current host directory into the containers folder, </span><span class="cls_010">/usr/share/nginx/html</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:411.13px" class="cls_008"><span class="cls_008">This is where Nginx expects web assets to be located. Now let's build the image with</span></div>
<div style="position:absolute;left:108.00px;top:423.73px" class="cls_008"><span class="cls_008">the following command:</span></div>
<div style="position:absolute;left:144.00px;top:444.67px" class="cls_024"><span class="cls_024">$ docker image build -t my-website:1.0 .</span></div>
<div style="position:absolute;left:108.00px;top:464.41px" class="cls_008"><span class="cls_008">And finally, we run a container from this image. We will run the container in</span></div>
<div style="position:absolute;left:108.00px;top:477.01px" class="cls_008"><span class="cls_008">detached mode:</span></div>
<div style="position:absolute;left:144.00px;top:497.95px" class="cls_024"><span class="cls_024">$ docker container run -d \</span></div>
<div style="position:absolute;left:160.20px;top:513.07px" class="cls_024"><span class="cls_024">-p 8080:80 --name my-site\</span></div>
<div style="position:absolute;left:160.20px;top:528.19px" class="cls_024"><span class="cls_024">my-website:1.0</span></div>
<div style="position:absolute;left:108.00px;top:547.93px" class="cls_008"><span class="cls_008">Note the </span><span class="cls_010">-p 8080:80</span><span class="cls_008"> parameter. We haven't discussed this yet but we will do it</span></div>
<div style="position:absolute;left:108.00px;top:560.53px" class="cls_008"><span class="cls_008">in detail in </span><span class="cls_021">Chapter 7</span><span class="cls_008">, Single-Host Networking. At the moment, just know that this</span></div>
<div style="position:absolute;left:108.00px;top:573.13px" class="cls_008"><span class="cls_008">maps the container port </span><span class="cls_010">80</span><span class="cls_008"> on which Nginx is listening for incoming requests to port</span></div>
<div style="position:absolute;left:108.00px;top:585.73px" class="cls_010"><span class="cls_010">8080</span><span class="cls_008"> of your laptop where you can then access the application. Now, open a browser</span></div>
<div style="position:absolute;left:108.00px;top:598.33px" class="cls_008"><span class="cls_008">tab and navigate to </span><A HREF="http://localhost:8080/index.html">http://localhost:8080/index.html</A> </span><span class="cls_008"> and you should see your</span></div>
<div style="position:absolute;left:108.00px;top:610.93px" class="cls_008"><span class="cls_008">website which currently consists only of a title, </span><span class="cls_010">Personal Website</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 93 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:89022px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background117.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, edit the file </span><span class="cls_010">index.html</span><span class="cls_008"> in your favorite editor to look like this:</span></div>
<div style="position:absolute;left:144.00px;top:135.43px" class="cls_023"><span class="cls_023">&lt;h1>Personal Website&lt;/h1></span></div>
<div style="position:absolute;left:144.00px;top:147.67px" class="cls_023"><span class="cls_023">&lt;p>This is some text&lt;/p></span></div>
<div style="position:absolute;left:108.00px;top:167.41px" class="cls_008"><span class="cls_008">And save it. Then refresh the browser. OK, that didn't work. The browser still</span></div>
<div style="position:absolute;left:108.00px;top:180.01px" class="cls_008"><span class="cls_008">displays the previous version of the </span><span class="cls_010">index.html</span><span class="cls_008"> which consists only of the title.</span></div>
<div style="position:absolute;left:108.00px;top:192.61px" class="cls_008"><span class="cls_008">So let's stop and remove the current container, then rebuild the image, and rerun</span></div>
<div style="position:absolute;left:108.00px;top:205.21px" class="cls_008"><span class="cls_008">the container:</span></div>
<div style="position:absolute;left:144.00px;top:226.15px" class="cls_024"><span class="cls_024">$ docker container rm -f my-site</span></div>
<div style="position:absolute;left:144.00px;top:241.27px" class="cls_024"><span class="cls_024">$ docker image build -t my-website:1.0 .</span></div>
<div style="position:absolute;left:144.00px;top:256.39px" class="cls_024"><span class="cls_024">$ docker container run -d \</span></div>
<div style="position:absolute;left:160.20px;top:271.51px" class="cls_024"><span class="cls_024">-p 8080:80 --name my-site\</span></div>
<div style="position:absolute;left:160.20px;top:286.63px" class="cls_024"><span class="cls_024">my-website:1.0</span></div>
<div style="position:absolute;left:108.00px;top:306.37px" class="cls_008"><span class="cls_008">This time when you refresh the browser the new content should be shown. Well, it</span></div>
<div style="position:absolute;left:108.00px;top:318.97px" class="cls_008"><span class="cls_008">worked, but there is way too much friction involved. Imagine you have to do this</span></div>
<div style="position:absolute;left:108.00px;top:331.57px" class="cls_008"><span class="cls_008">each and every time that you make a simple change in your website. That's not</span></div>
<div style="position:absolute;left:108.00px;top:344.17px" class="cls_008"><span class="cls_008">sustainable.</span></div>
<div style="position:absolute;left:108.00px;top:365.42px" class="cls_008"><span class="cls_008">Now is the time to use host-mounted volumes. Once again, remove the current</span></div>
<div style="position:absolute;left:108.00px;top:378.02px" class="cls_008"><span class="cls_008">container and rerun it with the volume mount:</span></div>
<div style="position:absolute;left:144.00px;top:398.95px" class="cls_024"><span class="cls_024">$ docker container rm -f my-site</span></div>
<div style="position:absolute;left:144.00px;top:414.07px" class="cls_024"><span class="cls_024">$ docker container run -d \</span></div>
<div style="position:absolute;left:160.20px;top:429.19px" class="cls_024"><span class="cls_024">-v $(pwd):/usr/share/nginx/html \</span></div>
<div style="position:absolute;left:160.20px;top:444.31px" class="cls_024"><span class="cls_024">-p 8080:80 --name my-site\</span></div>
<div style="position:absolute;left:160.20px;top:459.43px" class="cls_024"><span class="cls_024">my-website:1.0</span></div>
<div style="position:absolute;left:108.00px;top:479.17px" class="cls_008"><span class="cls_008">Now, append some more content to the </span><span class="cls_010">index.html</span><span class="cls_008"> and save it. Then refresh your</span></div>
<div style="position:absolute;left:108.00px;top:491.77px" class="cls_008"><span class="cls_008">browser. You should see the changes. And this is exactly what we wanted to achieve;</span></div>
<div style="position:absolute;left:108.00px;top:504.37px" class="cls_008"><span class="cls_008">we also call this an edit-and-continue experience. You can make as many changes in</span></div>
<div style="position:absolute;left:108.00px;top:516.97px" class="cls_008"><span class="cls_008">your web files and always immediately see the result in the browser without having</span></div>
<div style="position:absolute;left:108.00px;top:529.57px" class="cls_008"><span class="cls_008">to rebuild the image and restart the container containing your website.</span></div>
<div style="position:absolute;left:108.00px;top:550.82px" class="cls_008"><span class="cls_008">It is important to note that the updates are now propagated bi-directionally. If you</span></div>
<div style="position:absolute;left:108.00px;top:563.42px" class="cls_008"><span class="cls_008">make changes on the host they will be propagated to the container and vice versa.</span></div>
<div style="position:absolute;left:108.00px;top:576.02px" class="cls_008"><span class="cls_008">Also important is the fact that when you mount the current folder into the container</span></div>
<div style="position:absolute;left:108.00px;top:588.61px" class="cls_008"><span class="cls_008">target folder, </span><span class="cls_010">/usr/share/nginx/html</span><span class="cls_008">, the content that is already there is replaced</span></div>
<div style="position:absolute;left:108.00px;top:601.21px" class="cls_008"><span class="cls_008">by the content of the host folder.</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 94 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:89824px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background118.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Defining volumes in images</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">If we go for a moment back to what we have learned about containers in </span><span class="cls_021">Chapter 3</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_021"><span class="cls_021">Working with Containers</span><span class="cls_008">, then we have this: the filesystem of each container when</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">started is made up of the immutable layers of the underlying image plus a writable</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">container layer specific to this very container. All changes that the processes running</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">inside the container make to the filesystem will be persisted in this container layer.</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">Once the container is stopped and removed from the system, the corresponding</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">container layer is deleted from the system and irreversibly lost.</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_008"><span class="cls_008">Some applications, such as databases running in containers, need to persist their</span></div>
<div style="position:absolute;left:108.00px;top:246.34px" class="cls_008"><span class="cls_008">data beyond the lifetime of the container. In this case they can use volumes. To make</span></div>
<div style="position:absolute;left:108.00px;top:258.94px" class="cls_008"><span class="cls_008">things a bit more explicit let's look at a concrete sample. MongoDB is a popular open</span></div>
<div style="position:absolute;left:108.00px;top:271.54px" class="cls_008"><span class="cls_008">source document database. Many developers use MongoDB as a storage service</span></div>
<div style="position:absolute;left:108.00px;top:284.14px" class="cls_008"><span class="cls_008">for their applications. The maintainers of MongoDB have created an image and</span></div>
<div style="position:absolute;left:108.00px;top:296.74px" class="cls_008"><span class="cls_008">published it on Docker Hub which can be used to run an instance of the database in a</span></div>
<div style="position:absolute;left:108.00px;top:309.34px" class="cls_008"><span class="cls_008">container. This database will be producing data that needs to be persisted long term.</span></div>
<div style="position:absolute;left:108.00px;top:321.94px" class="cls_008"><span class="cls_008">But the MongoDB maintainers do not know who uses this image and how it is used.</span></div>
<div style="position:absolute;left:108.00px;top:334.54px" class="cls_008"><span class="cls_008">So they have no influence over the </span><span class="cls_010">docker container run</span><span class="cls_008"> command with which</span></div>
<div style="position:absolute;left:108.00px;top:347.14px" class="cls_008"><span class="cls_008">the users of the database will start this container. How can they now define volumes?</span></div>
<div style="position:absolute;left:108.00px;top:368.38px" class="cls_008"><span class="cls_008">Luckily,  there is a way of defining volumes in the Dockerfile. The keyword to do</span></div>
<div style="position:absolute;left:108.00px;top:380.98px" class="cls_008"><span class="cls_008">so is </span><span class="cls_010">VOLUME</span><span class="cls_008"> and we can either add the absolute path to a single folder or a comma-</span></div>
<div style="position:absolute;left:108.00px;top:393.58px" class="cls_008"><span class="cls_008">separated list of paths. These paths represent folders of the container's filesystem.</span></div>
<div style="position:absolute;left:108.00px;top:406.18px" class="cls_008"><span class="cls_008">Let's look at a few samples of such volume definitions:</span></div>
<div style="position:absolute;left:144.00px;top:427.12px" class="cls_023"><span class="cls_023">VOLUME /app/data</span></div>
<div style="position:absolute;left:144.00px;top:439.36px" class="cls_023"><span class="cls_023">VOLUME /app/data, /app/profiles, /app/config</span></div>
<div style="position:absolute;left:144.00px;top:451.60px" class="cls_023"><span class="cls_023">VOLUME ["/app/data", "/app/profiles", "/app/config"]</span></div>
<div style="position:absolute;left:108.00px;top:471.34px" class="cls_008"><span class="cls_008">The first line defines a single volume to be mounted at </span><span class="cls_010">/app/data</span><span class="cls_008">. The second line</span></div>
<div style="position:absolute;left:108.00px;top:483.94px" class="cls_008"><span class="cls_008">defines three volumes as a comma-separated list and the last one defines the same as</span></div>
<div style="position:absolute;left:108.00px;top:496.54px" class="cls_008"><span class="cls_008">the second line, but this time the value is formatted as a JSON array.</span></div>
<div style="position:absolute;left:108.00px;top:517.78px" class="cls_008"><span class="cls_008">When a container is started, Docker automatically creates a volume and mounts</span></div>
<div style="position:absolute;left:108.00px;top:530.38px" class="cls_008"><span class="cls_008">it to the corresponding target folder of the container for each path defined in the</span></div>
<div style="position:absolute;left:108.00px;top:542.98px" class="cls_008"><span class="cls_008">Dockerfile. Since each volume is created automatically by Docker, it will have an</span></div>
<div style="position:absolute;left:108.00px;top:555.58px" class="cls_008"><span class="cls_008">SHA-256 as ID.</span></div>
<div style="position:absolute;left:108.00px;top:576.82px" class="cls_008"><span class="cls_008">At container runtime, the folders defined as volumes in the Dockerfile are excluded</span></div>
<div style="position:absolute;left:108.00px;top:589.42px" class="cls_008"><span class="cls_008">from the union filesystem and thus any changes in those folders do not change the</span></div>
<div style="position:absolute;left:108.00px;top:602.02px" class="cls_008"><span class="cls_008">container layer but are persisted to the respective volume. It is now the responsibility</span></div>
<div style="position:absolute;left:108.00px;top:614.62px" class="cls_008"><span class="cls_008">of the operations engineers to make sure that the backing storage of the volumes is</span></div>
<div style="position:absolute;left:108.00px;top:627.22px" class="cls_008"><span class="cls_008">properly backed up.</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 95 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:90626px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background119.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can use the </span><span class="cls_010">docker image inspect</span><span class="cls_008"> command to get information about the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">volumes defined in the Dockerfile. Let's see what MongoDB gives us. First, we pull</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the image with the following command:</span></div>
<div style="position:absolute;left:144.00px;top:160.63px" class="cls_024"><span class="cls_024">$ docker image pull mongo:3.7</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">Then we inspect this image and use the </span><span class="cls_010">--format</span><span class="cls_008"> parameter to only extract the</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">essential part from the massive amount of data:</span></div>
<div style="position:absolute;left:144.00px;top:213.91px" class="cls_024"><span class="cls_024">$ docker image inspect \</span></div>
<div style="position:absolute;left:160.20px;top:229.03px" class="cls_024"><span class="cls_024">--format='{{json .ContainerConfig.Volumes}}' \</span></div>
<div style="position:absolute;left:165.60px;top:244.15px" class="cls_024"><span class="cls_024">mongo:3.7 | jq</span></div>
<div style="position:absolute;left:108.00px;top:263.89px" class="cls_008"><span class="cls_008">Which will return the following result:</span></div>
<div style="position:absolute;left:144.00px;top:284.83px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:144.00px;top:297.07px" class="cls_023"><span class="cls_023">"/data/configdb": {},</span></div>
<div style="position:absolute;left:144.00px;top:309.31px" class="cls_023"><span class="cls_023">"/data/db": {}</span></div>
<div style="position:absolute;left:144.00px;top:321.55px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:108.00px;top:341.29px" class="cls_008"><span class="cls_008">Evidently, the Dockerfile for MongoDB defines two volumes at </span><span class="cls_010">/data/configdb</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:108.00px;top:353.89px" class="cls_010"><span class="cls_010">/data/db</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:375.14px" class="cls_008"><span class="cls_008">Now, let's run an instance of MongoDB as follows:</span></div>
<div style="position:absolute;left:144.00px;top:396.07px" class="cls_024"><span class="cls_024">$ docker run --name my-mongo -d mongo:3.7</span></div>
<div style="position:absolute;left:108.00px;top:415.81px" class="cls_008"><span class="cls_008">We can now use the </span><span class="cls_010">docker container inspect</span><span class="cls_008"> command to get information</span></div>
<div style="position:absolute;left:108.00px;top:428.41px" class="cls_008"><span class="cls_008">about the volumes that have been created, among other things. Use this command to</span></div>
<div style="position:absolute;left:108.00px;top:441.01px" class="cls_008"><span class="cls_008">just get the volume information:</span></div>
<div style="position:absolute;left:144.00px;top:461.95px" class="cls_024"><span class="cls_024">$ docker inspect --format '{{json .Mounts}}' my-mongo | jq</span></div>
<div style="position:absolute;left:108.00px;top:481.69px" class="cls_008"><span class="cls_008">The expression should output something like this:</span></div>
<div style="position:absolute;left:144.00px;top:502.63px" class="cls_023"><span class="cls_023">[</span></div>
<div style="position:absolute;left:154.80px;top:514.87px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:165.60px;top:527.11px" class="cls_023"><span class="cls_023">"Type": "volume",</span></div>
<div style="position:absolute;left:165.60px;top:539.35px" class="cls_023"><span class="cls_023">"Name": "b9ea0158b5...",</span></div>
<div style="position:absolute;left:165.60px;top:551.59px" class="cls_023"><span class="cls_023">"Source": "/var/lib/docker/volumes/b9ea0158b.../_data",</span></div>
<div style="position:absolute;left:165.60px;top:563.83px" class="cls_023"><span class="cls_023">"Destination": "/data/configdb",</span></div>
<div style="position:absolute;left:165.60px;top:576.07px" class="cls_023"><span class="cls_023">"Driver": "local",</span></div>
<div style="position:absolute;left:165.60px;top:588.31px" class="cls_023"><span class="cls_023">"Mode": "",</span></div>
<div style="position:absolute;left:165.60px;top:600.55px" class="cls_023"><span class="cls_023">"RW": true,</span></div>
<div style="position:absolute;left:165.60px;top:612.79px" class="cls_023"><span class="cls_023">"Propagation": ""</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 96 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:91428px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background120.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:154.80px;top:114.01px" class="cls_023"><span class="cls_023">},</span></div>
<div style="position:absolute;left:154.80px;top:126.25px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:165.60px;top:138.49px" class="cls_023"><span class="cls_023">"Type": "volume",</span></div>
<div style="position:absolute;left:165.60px;top:150.73px" class="cls_023"><span class="cls_023">"Name": "5becf84b1e...",</span></div>
<div style="position:absolute;left:165.60px;top:162.97px" class="cls_023"><span class="cls_023">"Source": "/var/lib/docker/volumes/5becf84b1.../_data",</span></div>
<div style="position:absolute;left:144.00px;top:173.77px" class="cls_023"><span class="cls_023">"Destination": "/data/db",</span></div>
<div style="position:absolute;left:165.60px;top:186.01px" class="cls_023"><span class="cls_023">"Driver": "local",</span></div>
<div style="position:absolute;left:165.60px;top:198.25px" class="cls_023"><span class="cls_023">"Mode": "",</span></div>
<div style="position:absolute;left:165.60px;top:210.49px" class="cls_023"><span class="cls_023">"RW": true,</span></div>
<div style="position:absolute;left:165.60px;top:222.73px" class="cls_023"><span class="cls_023">"Propagation": ""</span></div>
<div style="position:absolute;left:154.80px;top:234.97px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:144.00px;top:247.21px" class="cls_023"><span class="cls_023">]</span></div>
<div style="position:absolute;left:108.00px;top:266.94px" class="cls_008"><span class="cls_008">Note that the values of the </span><span class="cls_010">Name</span><span class="cls_008"> and </span><span class="cls_010">Source</span><span class="cls_008"> fields have been trimmed for</span></div>
<div style="position:absolute;left:108.00px;top:279.54px" class="cls_008"><span class="cls_008">readability. The </span><span class="cls_010">Source</span><span class="cls_008"> field gives us the path to the host directory where</span></div>
<div style="position:absolute;left:108.00px;top:292.14px" class="cls_008"><span class="cls_008">the data produced by the MongoDB inside the container will be stored.</span></div>
<div style="position:absolute;left:108.00px;top:324.64px" class="cls_011"><span class="cls_011">Obtaining Docker system information</span></div>
<div style="position:absolute;left:108.00px;top:349.62px" class="cls_008"><span class="cls_008">Whenever we need to troubleshoot our system, the commands presented in this</span></div>
<div style="position:absolute;left:108.00px;top:362.22px" class="cls_008"><span class="cls_008">section are essential. They provide us with a lot about the Docker engine installed</span></div>
<div style="position:absolute;left:108.00px;top:374.82px" class="cls_008"><span class="cls_008">on the host and about the host operating system. Let's first introduce the </span><span class="cls_010">docker</span></div>
<div style="position:absolute;left:108.00px;top:387.42px" class="cls_010"><span class="cls_010">version</span><span class="cls_008"> command. It provides abundant information about the Docker client and</span></div>
<div style="position:absolute;left:108.00px;top:400.02px" class="cls_008"><span class="cls_008">server that your current configuration is using. If you enter the command in the CLI,</span></div>
<div style="position:absolute;left:108.00px;top:412.62px" class="cls_008"><span class="cls_008">you should see something similar to this:</span></div>
<div style="position:absolute;left:245.07px;top:616.03px" class="cls_026"><span class="cls_026">Version Information about Docker</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 97 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:92230px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background121.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In my case, I can see that on both client and server, I am using version </span><span class="cls_010">18.04.0-ce-</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">rc2</span><span class="cls_008"> of the Docker engine. I can also see that my orchestrator is Swarm and more.</span></div>
<div style="position:absolute;left:108.00px;top:148.34px" class="cls_008"><span class="cls_008">Now to clarify what the client and what the server is, let's look at the following</span></div>
<div style="position:absolute;left:108.00px;top:160.94px" class="cls_008"><span class="cls_008">diagram:</span></div>
<div style="position:absolute;left:240.50px;top:280.82px" class="cls_026"><span class="cls_026">CLI accessing different Docker Hosts</span></div>
<div style="position:absolute;left:108.00px;top:299.56px" class="cls_008"><span class="cls_008">You can see that the client is the little CLI through which we send Docker commands</span></div>
<div style="position:absolute;left:108.00px;top:312.16px" class="cls_008"><span class="cls_008">to the remote API of the Docker host. The Docker host is the container runtime which</span></div>
<div style="position:absolute;left:108.00px;top:324.76px" class="cls_008"><span class="cls_008">hosts the containers and might run on the same machine as the CLI, or it might</span></div>
<div style="position:absolute;left:108.00px;top:337.36px" class="cls_008"><span class="cls_008">run on a remote server, on-premise or in the cloud. We can use the CLI to manage</span></div>
<div style="position:absolute;left:108.00px;top:349.96px" class="cls_008"><span class="cls_008">different servers. We do this by setting a bunch of environment variables such as</span></div>
<div style="position:absolute;left:108.00px;top:362.56px" class="cls_010"><span class="cls_010">DOCKER_HOST</span><span class="cls_008">, </span><span class="cls_010">DOCKER_TLS_VERIFY</span><span class="cls_008">, and </span><span class="cls_010">DOCKER_CERT_PATH</span><span class="cls_008">. If these environment</span></div>
<div style="position:absolute;left:108.00px;top:375.16px" class="cls_008"><span class="cls_008">variables are not set on your working machine and you're using Docker for Mac or</span></div>
<div style="position:absolute;left:108.00px;top:387.76px" class="cls_008"><span class="cls_008">Windows then that means that you are using the Docker engine that runs on your</span></div>
<div style="position:absolute;left:108.00px;top:400.36px" class="cls_008"><span class="cls_008">machine.</span></div>
<div style="position:absolute;left:108.00px;top:421.60px" class="cls_008"><span class="cls_008">The next important command is the </span><span class="cls_010">docker system info</span><span class="cls_008"> command. This command</span></div>
<div style="position:absolute;left:108.00px;top:434.20px" class="cls_008"><span class="cls_008">provides information about what mode the Docker engine is operating in (swarm</span></div>
<div style="position:absolute;left:108.00px;top:446.80px" class="cls_008"><span class="cls_008">mode or not), what storage driver is used for the union filesystem, what version of</span></div>
<div style="position:absolute;left:108.00px;top:459.40px" class="cls_008"><span class="cls_008">the Linux kernel we have on our host, and much more. Please have a careful look at</span></div>
<div style="position:absolute;left:108.00px;top:472.00px" class="cls_008"><span class="cls_008">the output generated by your system when running the command. Analyze what</span></div>
<div style="position:absolute;left:108.00px;top:484.60px" class="cls_008"><span class="cls_008">kind of information is shown:</span></div>
<div style="position:absolute;left:295.37px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 98 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:93032px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background122.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:227.60px;top:634.19px" class="cls_026"><span class="cls_026">Output of the Command docker system info</span></div>
<div style="position:absolute;left:295.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 99 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:93834px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background123.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Listing resource consumption</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Over time, a Docker host can accumulate quite a bit of resources such as images,</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">containers, and volumes in memory and on disk. As in every good household, we</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">should keep our environment clean and free unused resources to reclaim space.</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">Otherwise, there will come the moment when Docker does not allow us to add any</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">more new resources, meaning actions such as pulling an image can fail due to lack of</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">available space on disk or in memory.</span></div>
<div style="position:absolute;left:108.00px;top:221.14px" class="cls_008"><span class="cls_008">The Docker CLI provides a handy little </span><span class="cls_010">system</span><span class="cls_008"> command that lists how much</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_008"><span class="cls_008">resources currently are used on our system and how much of this space can possibly</span></div>
<div style="position:absolute;left:108.00px;top:246.34px" class="cls_008"><span class="cls_008">be reclaimed. The command is:</span></div>
<div style="position:absolute;left:144.00px;top:267.28px" class="cls_024"><span class="cls_024">$ docker system df</span></div>
<div style="position:absolute;left:108.00px;top:287.02px" class="cls_008"><span class="cls_008">If you execute this command on your system, you should see an output similar to</span></div>
<div style="position:absolute;left:108.00px;top:299.62px" class="cls_008"><span class="cls_008">this:</span></div>
<div style="position:absolute;left:144.00px;top:320.56px" class="cls_024"><span class="cls_024">TYPE</span></div>
<div style="position:absolute;left:219.60px;top:320.56px" class="cls_024"><span class="cls_024">TOTAL</span></div>
<div style="position:absolute;left:262.80px;top:320.56px" class="cls_024"><span class="cls_024">ACTIVE</span></div>
<div style="position:absolute;left:311.40px;top:320.56px" class="cls_024"><span class="cls_024">SIZE</span></div>
<div style="position:absolute;left:365.40px;top:320.56px" class="cls_024"><span class="cls_024">RECLAIMABLE</span></div>
<div style="position:absolute;left:144.00px;top:335.68px" class="cls_024"><span class="cls_024">Images</span></div>
<div style="position:absolute;left:219.60px;top:335.68px" class="cls_024"><span class="cls_024">21</span></div>
<div style="position:absolute;left:262.80px;top:335.68px" class="cls_024"><span class="cls_024">9</span></div>
<div style="position:absolute;left:311.40px;top:335.68px" class="cls_024"><span class="cls_024">1.103GB</span></div>
<div style="position:absolute;left:365.40px;top:335.68px" class="cls_024"><span class="cls_024">845.3MB (76%)</span></div>
<div style="position:absolute;left:144.00px;top:350.80px" class="cls_024"><span class="cls_024">Containers</span></div>
<div style="position:absolute;left:219.60px;top:350.80px" class="cls_024"><span class="cls_024">14</span></div>
<div style="position:absolute;left:262.80px;top:350.80px" class="cls_024"><span class="cls_024">11</span></div>
<div style="position:absolute;left:311.40px;top:350.80px" class="cls_024"><span class="cls_024">9.144kB</span></div>
<div style="position:absolute;left:365.40px;top:350.80px" class="cls_024"><span class="cls_024">4.4kB (48%)</span></div>
<div style="position:absolute;left:144.00px;top:365.92px" class="cls_024"><span class="cls_024">Local Volumes 14</span></div>
<div style="position:absolute;left:262.80px;top:365.92px" class="cls_024"><span class="cls_024">14</span></div>
<div style="position:absolute;left:311.40px;top:365.92px" class="cls_024"><span class="cls_024">340.3MB</span></div>
<div style="position:absolute;left:365.40px;top:365.92px" class="cls_024"><span class="cls_024">0B (0%)</span></div>
<div style="position:absolute;left:144.00px;top:381.04px" class="cls_024"><span class="cls_024">Build Cache</span></div>
<div style="position:absolute;left:311.40px;top:381.04px" class="cls_024"><span class="cls_024">0B</span></div>
<div style="position:absolute;left:365.40px;top:381.04px" class="cls_024"><span class="cls_024">0B</span></div>
<div style="position:absolute;left:108.00px;top:400.78px" class="cls_008"><span class="cls_008">The last line in the output, the </span><span class="cls_010">Build Cache</span><span class="cls_008">, is only displayed on newer versions</span></div>
<div style="position:absolute;left:108.00px;top:413.38px" class="cls_008"><span class="cls_008">of Docker. This information has been added recently. The preceding output is</span></div>
<div style="position:absolute;left:108.00px;top:425.98px" class="cls_008"><span class="cls_008">explained as follows:</span></div>
<div style="position:absolute;left:126.00px;top:447.22px" class="cls_008"><span class="cls_008">•  In my case, the output tells me that on my system I am currently having </span><span class="cls_010">21</span></div>
<div style="position:absolute;left:144.00px;top:459.82px" class="cls_008"><span class="cls_008">images locally cached of which </span><span class="cls_010">9</span><span class="cls_008"> are in active use. An image is considered</span></div>
<div style="position:absolute;left:144.00px;top:472.42px" class="cls_008"><span class="cls_008">to be in active use if currently at least one running or stopped container is</span></div>
<div style="position:absolute;left:144.00px;top:485.02px" class="cls_008"><span class="cls_008">based on it. These images occupy </span><span class="cls_010">1.1</span><span class="cls_008"> GB disk space. Close to </span><span class="cls_010">845</span><span class="cls_008"> MB can</span></div>
<div style="position:absolute;left:144.00px;top:497.62px" class="cls_008"><span class="cls_008">technically be reclaimed since the corresponding images are not currently</span></div>
<div style="position:absolute;left:144.00px;top:510.22px" class="cls_008"><span class="cls_008">used.</span></div>
<div style="position:absolute;left:126.00px;top:527.14px" class="cls_008"><span class="cls_008">•  Further, I have </span><span class="cls_010">11</span><span class="cls_008"> running containers on my system and three stopped ones</span></div>
<div style="position:absolute;left:144.00px;top:539.74px" class="cls_008"><span class="cls_008">for a total of </span><span class="cls_010">14</span><span class="cls_008"> containers. I can reclaim the space occupied by the stopped</span></div>
<div style="position:absolute;left:144.00px;top:552.34px" class="cls_008"><span class="cls_008">containers which is </span><span class="cls_010">4.4 kB</span><span class="cls_008"> in my case.</span></div>
<div style="position:absolute;left:126.00px;top:569.26px" class="cls_008"><span class="cls_008">•  I also have </span><span class="cls_010">14</span><span class="cls_008"> active volumes on my host that together consume about </span><span class="cls_010">340</span></div>
<div style="position:absolute;left:144.00px;top:581.86px" class="cls_008"><span class="cls_008">MB of disk space. Since all volumes are in use, I cannot reclaim any space at</span></div>
<div style="position:absolute;left:144.00px;top:594.46px" class="cls_008"><span class="cls_008">this time.</span></div>
<div style="position:absolute;left:126.00px;top:611.38px" class="cls_008"><span class="cls_008">•  Finally, my </span><span class="cls_010">Build Cache</span><span class="cls_008"> is currently empty and thus of course I cannot</span></div>
<div style="position:absolute;left:144.00px;top:623.98px" class="cls_008"><span class="cls_008">reclaim any space there too.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 100 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:94636px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background124.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If I want even more detailed information about the resource consumption on my</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">system, I can run the same command in verbose mode using the </span><span class="cls_010">-v</span><span class="cls_008"> flag:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker system df -v</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">This will give me a detailed list of all images, containers, and volumes with their</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">respective size. A possible output could look like this:</span></div>
<div style="position:absolute;left:197.90px;top:394.83px" class="cls_026"><span class="cls_026">Verbose output of the system resources consumed by Docker</span></div>
<div style="position:absolute;left:108.00px;top:413.57px" class="cls_008"><span class="cls_008">This verbose output should give us enough detailed information to make an</span></div>
<div style="position:absolute;left:108.00px;top:426.17px" class="cls_008"><span class="cls_008">informed decision as to whether or not we need to start cleaning up our system,</span></div>
<div style="position:absolute;left:108.00px;top:438.77px" class="cls_008"><span class="cls_008">and which parts we might need to clean up.</span></div>
<div style="position:absolute;left:108.00px;top:471.27px" class="cls_011"><span class="cls_011">Pruning unused resources</span></div>
<div style="position:absolute;left:108.00px;top:496.25px" class="cls_008"><span class="cls_008">Once we have concluded that some clean up is needed Docker provides us with</span></div>
<div style="position:absolute;left:108.00px;top:508.85px" class="cls_008"><span class="cls_008">so-called pruning commands. For each resource, such as images, containers,</span></div>
<div style="position:absolute;left:108.00px;top:521.45px" class="cls_008"><span class="cls_008">volumes, and networks there exists a </span><span class="cls_010">prune</span><span class="cls_008"> command.</span></div>
<div style="position:absolute;left:108.00px;top:551.39px" class="cls_022"><span class="cls_022">Pruning containers</span></div>
<div style="position:absolute;left:108.00px;top:574.37px" class="cls_008"><span class="cls_008">In this section we want to regain unused system resources by pruning containers.</span></div>
<div style="position:absolute;left:108.00px;top:586.97px" class="cls_008"><span class="cls_008">Let's start with this command:</span></div>
<div style="position:absolute;left:144.00px;top:607.91px" class="cls_024"><span class="cls_024">$ docker container prune</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 101 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:95438px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background125.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The preceding command will remove all containers from the system that are not in</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">running</span><span class="cls_008"> status. Docker will ask for confirmation before deleting the containers that</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">are currently in  </span><span class="cls_010">exited</span><span class="cls_008"> or </span><span class="cls_010">created</span><span class="cls_008"> status. If you want to skip this confirmation step</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">you can use the </span><span class="cls_010">-f</span><span class="cls_008"> (or </span><span class="cls_010">--force</span><span class="cls_008">) flag:</span></div>
<div style="position:absolute;left:144.00px;top:173.23px" class="cls_024"><span class="cls_024">$ docker container prune -f</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">Under certain circumstances, we might want to remove all containers from our</span></div>
<div style="position:absolute;left:108.00px;top:205.57px" class="cls_008"><span class="cls_008">system, even the running ones. We cannot use the </span><span class="cls_010">prune</span><span class="cls_008"> command for this. Instead</span></div>
<div style="position:absolute;left:108.00px;top:218.17px" class="cls_008"><span class="cls_008">we should use a command, such as the following combined expression:</span></div>
<div style="position:absolute;left:144.00px;top:239.11px" class="cls_024"><span class="cls_024">$ docker container rm -f $(docker container ls -aq)</span></div>
<div style="position:absolute;left:108.00px;top:258.85px" class="cls_008"><span class="cls_008">Please be careful with the preceding command. It removes all containers without</span></div>
<div style="position:absolute;left:108.00px;top:271.45px" class="cls_008"><span class="cls_008">warning, even the running ones! Please, before you proceed look at the preceding</span></div>
<div style="position:absolute;left:108.00px;top:284.05px" class="cls_008"><span class="cls_008">command again in detail and try to explain what exactly happens and why.</span></div>
<div style="position:absolute;left:108.00px;top:313.99px" class="cls_022"><span class="cls_022">Pruning images</span></div>
<div style="position:absolute;left:108.00px;top:336.97px" class="cls_008"><span class="cls_008">Next in line are images. If we want to free all space occupied by unused image layers</span></div>
<div style="position:absolute;left:108.00px;top:349.57px" class="cls_008"><span class="cls_008">we can use the following command:</span></div>
<div style="position:absolute;left:144.00px;top:370.51px" class="cls_024"><span class="cls_024">$ docker image prune</span></div>
<div style="position:absolute;left:108.00px;top:390.25px" class="cls_008"><span class="cls_008">After we reconfirm to Docker that we indeed want to free space occupied by unused</span></div>
<div style="position:absolute;left:108.00px;top:402.85px" class="cls_008"><span class="cls_008">image layers, those get removed. Now I have to specify what we mean when talking</span></div>
<div style="position:absolute;left:108.00px;top:415.45px" class="cls_008"><span class="cls_008">about unused image layers. As you recall from the previous chapter, an image</span></div>
<div style="position:absolute;left:108.00px;top:428.05px" class="cls_008"><span class="cls_008">is made up of a stack of immutable layers. Now, when we are building a custom</span></div>
<div style="position:absolute;left:108.00px;top:440.65px" class="cls_008"><span class="cls_008">image multiple times, each time making some changes in, say, the source code of</span></div>
<div style="position:absolute;left:108.00px;top:453.25px" class="cls_008"><span class="cls_008">the application for which we're building the image, then we are recreating layers</span></div>
<div style="position:absolute;left:108.00px;top:465.85px" class="cls_008"><span class="cls_008">and previous versions of the same layer become orphaned. Why is this the case? The</span></div>
<div style="position:absolute;left:108.00px;top:478.45px" class="cls_008"><span class="cls_008">reason is that layers are immutable, as discussed in detail in the previous chapter.</span></div>
<div style="position:absolute;left:108.00px;top:491.05px" class="cls_008"><span class="cls_008">Thus, when something in the source that is used to build a layer is changed, the very</span></div>
<div style="position:absolute;left:108.00px;top:503.65px" class="cls_008"><span class="cls_008">layer has to be rebuilt and the previous version will be abandoned.</span></div>
<div style="position:absolute;left:108.00px;top:524.90px" class="cls_008"><span class="cls_008">On a system where we often build images, the number of orphaned image layers</span></div>
<div style="position:absolute;left:108.00px;top:537.50px" class="cls_008"><span class="cls_008">can increase substantially over time. All these orphaned layers are removed with the</span></div>
<div style="position:absolute;left:108.00px;top:550.09px" class="cls_008"><span class="cls_008">preceding </span><span class="cls_010">prune</span><span class="cls_008"> command.</span></div>
<div style="position:absolute;left:108.00px;top:571.33px" class="cls_008"><span class="cls_008">Similar to the </span><span class="cls_010">prune</span><span class="cls_008"> command for containers, we can avoid Docker asking us for a</span></div>
<div style="position:absolute;left:108.00px;top:583.93px" class="cls_008"><span class="cls_008">confirmation by using the force flag:</span></div>
<div style="position:absolute;left:144.00px;top:604.87px" class="cls_024"><span class="cls_024">$ docker image prune -f</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 102 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:96240px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background126.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">There is an even more radical version of the image </span><span class="cls_010">prune</span><span class="cls_008"> command. Sometimes</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">we do not just want to remove orphaned image layers but all images that are not</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">currently in use on our system. For this, we can use the </span><span class="cls_010">-a</span><span class="cls_008"> (or </span><span class="cls_010">--all</span><span class="cls_008">) flag:</span></div>
<div style="position:absolute;left:144.00px;top:160.63px" class="cls_024"><span class="cls_024">$ docker image prune --force --all</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">After execution of the preceding command, only images that are currently used by</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_008"><span class="cls_008">one or more containers will remain in our local image cache.</span></div>
<div style="position:absolute;left:108.00px;top:222.91px" class="cls_022"><span class="cls_022">Pruning volumes</span></div>
<div style="position:absolute;left:108.00px;top:245.89px" class="cls_008"><span class="cls_008">Docker volumes are used to allow for persistent access of data by containers. This</span></div>
<div style="position:absolute;left:108.00px;top:258.49px" class="cls_008"><span class="cls_008">data can be important and thus the commands discussed in this section should be</span></div>
<div style="position:absolute;left:108.00px;top:271.09px" class="cls_008"><span class="cls_008">applied with special care.</span></div>
<div style="position:absolute;left:108.00px;top:292.34px" class="cls_008"><span class="cls_008">If you know that you want to reclaim space occupied by volumes and with it</span></div>
<div style="position:absolute;left:108.00px;top:304.94px" class="cls_008"><span class="cls_008">irreversibly destroy the underlying data, you can use the following command:</span></div>
<div style="position:absolute;left:144.00px;top:325.87px" class="cls_024"><span class="cls_024">$ docker volume prune</span></div>
<div style="position:absolute;left:108.00px;top:345.61px" class="cls_008"><span class="cls_008">This command will remove all volumes that are not currently in use by at least one</span></div>
<div style="position:absolute;left:108.00px;top:358.21px" class="cls_008"><span class="cls_008">container.</span></div>
<div style="position:absolute;left:182.88px;top:389.57px" class="cls_025"><span class="cls_025">This is a destructive command and cannot be undone. You should</span></div>
<div style="position:absolute;left:182.88px;top:400.97px" class="cls_025"><span class="cls_025">always create a backup of the data associated with the volumes</span></div>
<div style="position:absolute;left:182.88px;top:412.37px" class="cls_025"><span class="cls_025">before you delete them except when you're sure that the data has</span></div>
<div style="position:absolute;left:182.88px;top:423.77px" class="cls_025"><span class="cls_025">no further value.</span></div>
<div style="position:absolute;left:108.00px;top:450.81px" class="cls_008"><span class="cls_008">To avoid system corruption or malfunctioning applications, Docker does not allow</span></div>
<div style="position:absolute;left:108.00px;top:463.41px" class="cls_008"><span class="cls_008">you to remove volumes that are currently in use by at least one container. This</span></div>
<div style="position:absolute;left:108.00px;top:476.01px" class="cls_008"><span class="cls_008">applies even to the situation where a volume is used by a stopped container. You</span></div>
<div style="position:absolute;left:108.00px;top:488.61px" class="cls_008"><span class="cls_008">always have to remove the containers that use a volume first.</span></div>
<div style="position:absolute;left:108.00px;top:509.85px" class="cls_008"><span class="cls_008">A useful flag when pruning volumes is the </span><span class="cls_010">-f</span><span class="cls_008"> or </span><span class="cls_010">--filter</span><span class="cls_008"> flag which allows us</span></div>
<div style="position:absolute;left:108.00px;top:522.45px" class="cls_008"><span class="cls_008">to specify the set of volumes which we're considering for pruning. Look at the</span></div>
<div style="position:absolute;left:108.00px;top:535.05px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:144.00px;top:555.99px" class="cls_024"><span class="cls_024">$ docker volume prune --filter 'label=demo'</span></div>
<div style="position:absolute;left:108.00px;top:575.73px" class="cls_008"><span class="cls_008">This will only apply the command to volumes that have a </span><span class="cls_010">label</span><span class="cls_008"> with the  </span><span class="cls_010">demo</span></div>
<div style="position:absolute;left:108.00px;top:588.33px" class="cls_008"><span class="cls_008">value. The filtering flag format is </span><span class="cls_010">key=value</span><span class="cls_008">. If there is more than one filter needed,</span></div>
<div style="position:absolute;left:108.00px;top:600.93px" class="cls_008"><span class="cls_008">then we can use multiple flags:</span></div>
<div style="position:absolute;left:144.00px;top:621.87px" class="cls_024"><span class="cls_024">$ docker volume prune --filter 'label=demo' --filter 'label=test'</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 103 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:97042px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background127.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.74px" class="cls_008"><span class="cls_008">The filter flag can also be used when pruning other resources such as containers</span></div>
<div style="position:absolute;left:108.00px;top:127.34px" class="cls_008"><span class="cls_008">and images.</span></div>
<div style="position:absolute;left:108.00px;top:157.28px" class="cls_022"><span class="cls_022">Pruning networks</span></div>
<div style="position:absolute;left:108.00px;top:180.26px" class="cls_008"><span class="cls_008">The last resource that can be pruned are networks. We will discuss networks in detail</span></div>
<div style="position:absolute;left:108.00px;top:192.86px" class="cls_008"><span class="cls_008">in </span><span class="cls_021">Chapter 7</span><span class="cls_008">, </span><span class="cls_021">Single-Host Networking</span><span class="cls_008">. To remove all unused networks, we use the</span></div>
<div style="position:absolute;left:108.00px;top:205.46px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:144.00px;top:226.40px" class="cls_024"><span class="cls_024">$ docker network prune</span></div>
<div style="position:absolute;left:108.00px;top:246.14px" class="cls_008"><span class="cls_008">This will remove the networks on which currently no container or service is attached.</span></div>
<div style="position:absolute;left:108.00px;top:258.74px" class="cls_008"><span class="cls_008">Please don't worry about networks too much at this time. We will come back to them</span></div>
<div style="position:absolute;left:108.00px;top:271.34px" class="cls_008"><span class="cls_008">and all this will make much more sense to you.</span></div>
<div style="position:absolute;left:108.00px;top:301.28px" class="cls_022"><span class="cls_022">Pruning everything</span></div>
<div style="position:absolute;left:108.00px;top:324.26px" class="cls_008"><span class="cls_008">If we just want to prune everything at once without having to enter multiple</span></div>
<div style="position:absolute;left:108.00px;top:336.86px" class="cls_008"><span class="cls_008">commands, we can use the following command:</span></div>
<div style="position:absolute;left:144.00px;top:357.80px" class="cls_024"><span class="cls_024">$ docker system prune</span></div>
<div style="position:absolute;left:108.00px;top:377.54px" class="cls_008"><span class="cls_008">The Docker CLI will ask us for a confirmation and then remove all unused</span></div>
<div style="position:absolute;left:108.00px;top:390.14px" class="cls_008"><span class="cls_008">containers, images, volumes, and networks in one go and in the right order.</span></div>
<div style="position:absolute;left:108.00px;top:411.38px" class="cls_008"><span class="cls_008">Once again, to avoid Docker asking us for a confirmation, we can just use the force</span></div>
<div style="position:absolute;left:108.00px;top:423.98px" class="cls_008"><span class="cls_008">flag with the command.</span></div>
<div style="position:absolute;left:108.00px;top:456.48px" class="cls_011"><span class="cls_011">Consuming Docker system events</span></div>
<div style="position:absolute;left:108.00px;top:481.46px" class="cls_008"><span class="cls_008">The Docker engine, when creating, running, stopping, and removing containers and</span></div>
<div style="position:absolute;left:108.00px;top:494.06px" class="cls_008"><span class="cls_008">other resources such as volumes or networks, produces a log of events. These events</span></div>
<div style="position:absolute;left:108.00px;top:506.66px" class="cls_008"><span class="cls_008">can be consumed by external systems, such as some infrastructure services that use</span></div>
<div style="position:absolute;left:108.00px;top:519.26px" class="cls_008"><span class="cls_008">them to make informed decisions. An example of such a service could be a tool that</span></div>
<div style="position:absolute;left:108.00px;top:531.86px" class="cls_008"><span class="cls_008">creates an inventory of all containers that are currently running on the system.</span></div>
<div style="position:absolute;left:108.00px;top:553.10px" class="cls_008"><span class="cls_008">We can hook ourselves into this stream of system events and output them, for</span></div>
<div style="position:absolute;left:108.00px;top:565.70px" class="cls_008"><span class="cls_008">example in a terminal, by using the following command:</span></div>
<div style="position:absolute;left:144.00px;top:586.64px" class="cls_024"><span class="cls_024">$ docker system events</span></div>
<div style="position:absolute;left:108.00px;top:606.38px" class="cls_008"><span class="cls_008">This command is a blocking command. Thus, when you execute it in your terminal</span></div>
<div style="position:absolute;left:108.00px;top:618.98px" class="cls_008"><span class="cls_008">session the according session is blocked. Therefore, we recommend that you always</span></div>
<div style="position:absolute;left:108.00px;top:631.58px" class="cls_008"><span class="cls_008">open an extra window when you want to use this command.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 104 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:97844px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background128.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Assuming we have executed the preceding command in an extra terminal window,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">we can now test it and run a container like this:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker container run --rm alpine echo "Hello World"</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">The output produced should look like this:</span></div>
<div style="position:absolute;left:144.00px;top:188.71px" class="cls_024"><span class="cls_024">2018-01-28T15:08:57.318341118-06:00 container create</span></div>
<div style="position:absolute;left:144.00px;top:199.51px" class="cls_024"><span class="cls_024">8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf166c6ecf3</span></div>
<div style="position:absolute;left:144.00px;top:210.31px" class="cls_024"><span class="cls_024">(image=alpine,</span></div>
<div style="position:absolute;left:144.00px;top:225.43px" class="cls_024"><span class="cls_024">name=confident_hopper)</span></div>
<div style="position:absolute;left:144.00px;top:255.67px" class="cls_024"><span class="cls_024">2018-01-28T15:08:57.320934314-06:00 container attach</span></div>
<div style="position:absolute;left:144.00px;top:266.47px" class="cls_024"><span class="cls_024">8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf166c6ecf3</span></div>
<div style="position:absolute;left:144.00px;top:277.27px" class="cls_024"><span class="cls_024">(image=alpine, name=confident_hopper)</span></div>
<div style="position:absolute;left:144.00px;top:307.51px" class="cls_024"><span class="cls_024">2018-01-28T15:08:57.354869473-06:00 network connect</span></div>
<div style="position:absolute;left:144.00px;top:318.31px" class="cls_024"><span class="cls_024">c8fd270e1a776c5851c9fa1e79927141a1e1be228880c0aace4d0daebccd190f</span></div>
<div style="position:absolute;left:144.00px;top:329.11px" class="cls_024"><span class="cls_024">(container=8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf</span></div>
<div style="position:absolute;left:144.00px;top:339.91px" class="cls_024"><span class="cls_024">166c6ecf3, name=bridge, type=bridge)</span></div>
<div style="position:absolute;left:144.00px;top:370.15px" class="cls_024"><span class="cls_024">2018-01-28T15:08:57.818494970-06:00 container start</span></div>
<div style="position:absolute;left:144.00px;top:380.95px" class="cls_024"><span class="cls_024">8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf166c6ecf3</span></div>
<div style="position:absolute;left:144.00px;top:391.75px" class="cls_024"><span class="cls_024">(image=alpine, name=confident_hopper)</span></div>
<div style="position:absolute;left:144.00px;top:421.99px" class="cls_024"><span class="cls_024">2018-01-28T15:08:57.998941548-06:00 container die</span></div>
<div style="position:absolute;left:144.00px;top:432.79px" class="cls_024"><span class="cls_024">8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf166c6ecf3</span></div>
<div style="position:absolute;left:144.00px;top:443.59px" class="cls_024"><span class="cls_024">(exitCode=0, image=alpine, name=confident_hopper)</span></div>
<div style="position:absolute;left:144.00px;top:458.71px" class="cls_024"><span class="cls_024">2018-01-28T15:08:58.304784993-06:00 network disconnect</span></div>
<div style="position:absolute;left:144.00px;top:469.51px" class="cls_024"><span class="cls_024">c8fd270e1a776c5851c9fa1e79927141a1e1be228880c0aace4d0daebccd190f</span></div>
<div style="position:absolute;left:144.00px;top:480.31px" class="cls_024"><span class="cls_024">(container=8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf</span></div>
<div style="position:absolute;left:144.00px;top:491.11px" class="cls_024"><span class="cls_024">166c6ecf3, name=bridge, type=bridge)</span></div>
<div style="position:absolute;left:144.00px;top:521.35px" class="cls_024"><span class="cls_024">2018-01-28T15:08:58.412513530-06:00 container destroy</span></div>
<div style="position:absolute;left:144.00px;top:532.15px" class="cls_024"><span class="cls_024">8e074342ef3b20cfa73d17e4ef7796d424aa8801661765ab5024acf166c6ecf3</span></div>
<div style="position:absolute;left:144.00px;top:542.95px" class="cls_024"><span class="cls_024">(image=alpine, name=confident_hopper)</span></div>
<div style="position:absolute;left:108.00px;top:562.69px" class="cls_008"><span class="cls_008">In this output, we can follow the exact life cycle of the container. The container is</span></div>
<div style="position:absolute;left:108.00px;top:575.29px" class="cls_008"><span class="cls_008">created, started, and then destroyed. If the output generated by this command is not</span></div>
<div style="position:absolute;left:108.00px;top:587.89px" class="cls_008"><span class="cls_008">to your liking you can always change it by using the </span><span class="cls_010">--format</span><span class="cls_008"> parameter. The value</span></div>
<div style="position:absolute;left:108.00px;top:600.49px" class="cls_008"><span class="cls_008">of the format has to be written using the Go template syntax. The following sample</span></div>
<div style="position:absolute;left:108.00px;top:613.09px" class="cls_008"><span class="cls_008">outputs the type, image, and action of the event:</span></div>
<div style="position:absolute;left:144.00px;top:634.03px" class="cls_024"><span class="cls_024">$ docker system events --format 'Type={{.Type}} Image={{.Actor.</span></div>
<div style="position:absolute;left:144.00px;top:644.83px" class="cls_024"><span class="cls_024">Attributes.image}} Action={{.Action}}'</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 105 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:98646px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background129.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we run the exact same container </span><span class="cls_010">run</span><span class="cls_008"> command as before, the output generated</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">now looks like this:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">Type=container  Image=alpine</span></div>
<div style="position:absolute;left:322.20px;top:148.03px" class="cls_024"><span class="cls_024">Action=create</span></div>
<div style="position:absolute;left:144.00px;top:163.15px" class="cls_024"><span class="cls_024">Type=container  Image=alpine</span></div>
<div style="position:absolute;left:322.20px;top:163.15px" class="cls_024"><span class="cls_024">Action=attach</span></div>
<div style="position:absolute;left:144.00px;top:178.27px" class="cls_024"><span class="cls_024">Type=network</span></div>
<div style="position:absolute;left:230.40px;top:178.27px" class="cls_024"><span class="cls_024">Image=&lt;no value> Action=connect</span></div>
<div style="position:absolute;left:144.00px;top:193.39px" class="cls_024"><span class="cls_024">Type=container  Image=alpine</span></div>
<div style="position:absolute;left:322.20px;top:193.39px" class="cls_024"><span class="cls_024">Action=start</span></div>
<div style="position:absolute;left:144.00px;top:208.51px" class="cls_024"><span class="cls_024">Type=container  Image=alpine</span></div>
<div style="position:absolute;left:322.20px;top:208.51px" class="cls_024"><span class="cls_024">Action=die</span></div>
<div style="position:absolute;left:144.00px;top:223.63px" class="cls_024"><span class="cls_024">Type=network</span></div>
<div style="position:absolute;left:230.40px;top:223.63px" class="cls_024"><span class="cls_024">Image=&lt;no value> Action=disconnect</span></div>
<div style="position:absolute;left:144.00px;top:238.75px" class="cls_024"><span class="cls_024">Type=container  Image=alpine</span></div>
<div style="position:absolute;left:322.20px;top:238.75px" class="cls_024"><span class="cls_024">Action=destroy</span></div>
<div style="position:absolute;left:108.00px;top:278.39px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:303.37px" class="cls_008"><span class="cls_008">In this chapter, we have introduced Docker volumes that can be used to persist states</span></div>
<div style="position:absolute;left:108.00px;top:315.97px" class="cls_008"><span class="cls_008">produced by containers and make it durable. We can also use volumes to provide</span></div>
<div style="position:absolute;left:108.00px;top:328.57px" class="cls_008"><span class="cls_008">containers with data originating from various sources. We have learned how to</span></div>
<div style="position:absolute;left:108.00px;top:341.17px" class="cls_008"><span class="cls_008">create, mount and use volumes. We have learned various techniques of defining</span></div>
<div style="position:absolute;left:108.00px;top:353.77px" class="cls_008"><span class="cls_008">volumes such as by name, by mounting a host directory, or by defining volumes in a</span></div>
<div style="position:absolute;left:108.00px;top:366.37px" class="cls_008"><span class="cls_008">container image.</span></div>
<div style="position:absolute;left:108.00px;top:387.62px" class="cls_008"><span class="cls_008">In this chapter, we have also discussed various system-level commands that either</span></div>
<div style="position:absolute;left:108.00px;top:400.22px" class="cls_008"><span class="cls_008">provide us with abundant information to troubleshoot a system, or to manage and</span></div>
<div style="position:absolute;left:108.00px;top:412.82px" class="cls_008"><span class="cls_008">prune resources used by Docker. Lastly, we have learned how we can visualize and</span></div>
<div style="position:absolute;left:108.00px;top:425.42px" class="cls_008"><span class="cls_008">potentially consume the event stream generated by the container runtime.</span></div>
<div style="position:absolute;left:108.00px;top:446.66px" class="cls_008"><span class="cls_008">In the next chapter, we are going to get an introduction into the fundamentals of</span></div>
<div style="position:absolute;left:108.00px;top:459.26px" class="cls_008"><span class="cls_008">container orchestration. There we're going to discuss what's needed when we have to</span></div>
<div style="position:absolute;left:108.00px;top:471.86px" class="cls_008"><span class="cls_008">manage and run not just one or a few containers but potentially hundreds of them on</span></div>
<div style="position:absolute;left:108.00px;top:484.46px" class="cls_008"><span class="cls_008">many nodes in a cluster. We will see that there are a lot of challenges to solve. This is</span></div>
<div style="position:absolute;left:108.00px;top:497.06px" class="cls_008"><span class="cls_008">where orchestration engines come into play.</span></div>
<div style="position:absolute;left:108.00px;top:529.55px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:554.53px" class="cls_008"><span class="cls_008">Please try to answer the following questions to assess your learning progress:</span></div>
<div style="position:absolute;left:126.00px;top:575.78px" class="cls_008"><span class="cls_008">1.  How will you create a named data volume with a name, for example </span><span class="cls_010">my-</span></div>
<div style="position:absolute;left:144.00px;top:588.37px" class="cls_010"><span class="cls_010">products</span><span class="cls_008">, using the default driver?</span></div>
<div style="position:absolute;left:126.00px;top:605.29px" class="cls_008"><span class="cls_008">2.  How will you run a container using the image </span><span class="cls_010">alpine</span><span class="cls_008"> and mount the volume</span></div>
<div style="position:absolute;left:144.00px;top:617.89px" class="cls_010"><span class="cls_010">my-products</span><span class="cls_008"> in read-only mode into the /data container folder?</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 106 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:99448px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background130.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 5</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.  How will you locate the folder which is associated with the volume </span><span class="cls_010">my-</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_010"><span class="cls_010">products</span><span class="cls_008"> and navigate to it?  Also, how will you create a file, </span><span class="cls_010">sample.txt</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">with some content?</span></div>
<div style="position:absolute;left:126.01px;top:156.61px" class="cls_008"><span class="cls_008">4.  How will you run another </span><span class="cls_010">alpine</span><span class="cls_008"> container to which you mount the </span><span class="cls_010">my-</span></div>
<div style="position:absolute;left:144.00px;top:169.21px" class="cls_010"><span class="cls_010">products</span><span class="cls_008"> volume to the </span><span class="cls_010">/app-data</span><span class="cls_008"> folder, in read/write mode? Inside this</span></div>
<div style="position:absolute;left:144.00px;top:181.81px" class="cls_008"><span class="cls_008">container, navigate to the </span><span class="cls_010">/app-data</span><span class="cls_008"> folder and create a </span><span class="cls_010">hello.txt </span><span class="cls_008">file with</span></div>
<div style="position:absolute;left:144.00px;top:194.41px" class="cls_008"><span class="cls_008">some content.</span></div>
<div style="position:absolute;left:126.01px;top:211.33px" class="cls_008"><span class="cls_008">5.  How will you mount a host volume, for example </span><span class="cls_010">~/my-project</span><span class="cls_008">, into a</span></div>
<div style="position:absolute;left:144.00px;top:223.93px" class="cls_008"><span class="cls_008">container?</span></div>
<div style="position:absolute;left:126.00px;top:240.85px" class="cls_008"><span class="cls_008">6.  How will you remove all unused volumes from your system?</span></div>
<div style="position:absolute;left:126.00px;top:257.77px" class="cls_008"><span class="cls_008">7.  How will you determine the exact version of the Linux kernel and of Docker</span></div>
<div style="position:absolute;left:144.00px;top:270.36px" class="cls_008"><span class="cls_008">running on your system?</span></div>
<div style="position:absolute;left:108.00px;top:302.87px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:327.85px" class="cls_008"><span class="cls_008">The following articles provide more in</span><A HREF="http://dockr.ly/2EUjTml">-depth information:</A> </div>
<div style="position:absolute;left:126.00px;top:349.10px" class="cls_008"><span class="cls_008">•  </span><A HREF="http://dockr.ly/2EUjTml">Use</A><span class="cls_010">http://dockr.l<A HREF="http://dockr.ly/2EhBpzD">y/2EUjTml</A> </span></div>
<div style="position:absolute;left:126.00px;top:366.01px" class="cls_008"><span class="cls_008">•  </span><A HREF="http://dockr.ly/2EhBpzD">Manage data i</A><span class="cls_010">http://dockr.l<A HREF="http://bit.ly/2sjIfDj">y/2EhBpzD</A> </span></div>
<div style="position:absolute;left:126.00px;top:382.93px" class="cls_008"><span class="cls_008">•  </span><A HREF="http://bit.ly/2sjIfDj">Docker volu</A><A HREF="http://bit.ly/2sjIfDj">http://bit.ly/2sjIfDj</A> </span></div>
<div style="position:absolute;left:126.00px;top:399.85px" class="cls_008"><span class="cls_008">•  </span><A HREF="http://bit.ly/2bVrCBn">Containers—clean up</A><span class="cls_010">http://bit.<A HREF="http://dockr.ly/2BlZmXY">ly/2bVrCBn</A> </span></div>
<div style="position:absolute;left:126.00px;top:416.77px" class="cls_008"><span class="cls_008">•  </span><A HREF="http://dockr.ly/2BlZmXY">Docker syste</A><A HREF="http://dockr.ly/2BlZmXY">http://dockr.ly/2BlZmXY</A> </span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 107 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:100250px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background131.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:100250px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background132.jpg" width=612 height=792></div>
<div style="position:absolute;left:207.16px;top:218.71px" class="cls_015"><span class="cls_015">Distributed Application</span></div>
<div style="position:absolute;left:343.93px;top:254.71px" class="cls_015"><span class="cls_015">Architecture</span></div>
<div style="position:absolute;left:108.00px;top:308.41px" class="cls_008"><span class="cls_008">In the previous chapter, we learned how we can use Docker volumes to persist</span></div>
<div style="position:absolute;left:108.00px;top:321.01px" class="cls_008"><span class="cls_008">created or modified state, as well as share data between applications running in</span></div>
<div style="position:absolute;left:108.00px;top:333.61px" class="cls_008"><span class="cls_008">containers. We also learned how to work with events generated by the Docker</span></div>
<div style="position:absolute;left:108.00px;top:346.21px" class="cls_008"><span class="cls_008">daemon and clean up unused resources.</span></div>
<div style="position:absolute;left:108.00px;top:367.46px" class="cls_008"><span class="cls_008">In this chapter, we introduce the concept of a distributed application architecture and</span></div>
<div style="position:absolute;left:108.00px;top:380.06px" class="cls_008"><span class="cls_008">discuss the various patterns and best practices that are required to run a distributed</span></div>
<div style="position:absolute;left:108.00px;top:392.66px" class="cls_008"><span class="cls_008">application successfully. Finally, we will discuss the additional requirements that</span></div>
<div style="position:absolute;left:108.00px;top:405.26px" class="cls_008"><span class="cls_008">need to be fulfilled to run such an application in production.</span></div>
<div style="position:absolute;left:108.00px;top:426.50px" class="cls_008"><span class="cls_008">In this chapter, we will cover the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:447.74px" class="cls_008"><span class="cls_008">•  What is a distributed application architecture?</span></div>
<div style="position:absolute;left:126.00px;top:464.65px" class="cls_008"><span class="cls_008">•  Patterns and best practices</span></div>
<div style="position:absolute;left:126.00px;top:481.57px" class="cls_008"><span class="cls_008">•  Running in production</span></div>
<div style="position:absolute;left:107.99px;top:502.81px" class="cls_008"><span class="cls_008">After finishing this chapter, you will be able to do the following:</span></div>
<div style="position:absolute;left:125.99px;top:524.05px" class="cls_008"><span class="cls_008">•  Name at least four characteristics of a distributed application architecture</span></div>
<div style="position:absolute;left:125.99px;top:540.97px" class="cls_008"><span class="cls_008">•  Name at least four patterns that need to be implemented for a production-</span></div>
<div style="position:absolute;left:143.98px;top:553.57px" class="cls_008"><span class="cls_008">ready distributed application</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 109 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:101052px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background133.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">What is a distributed application</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">architecture?</span></div>
<div style="position:absolute;left:108.00px;top:160.90px" class="cls_008"><span class="cls_008">In this section, we are going to explain in detail what we mean when we talk about</span></div>
<div style="position:absolute;left:108.00px;top:173.50px" class="cls_008"><span class="cls_008">a distributed application architecture. First, we need to make sure that all words or</span></div>
<div style="position:absolute;left:108.00px;top:186.10px" class="cls_008"><span class="cls_008">acronyms we use have a meaning and that we are all talking the same language.</span></div>
<div style="position:absolute;left:108.00px;top:216.04px" class="cls_022"><span class="cls_022">Defining the terminology</span></div>
<div style="position:absolute;left:108.00px;top:239.02px" class="cls_008"><span class="cls_008">In this and the subsequent chapters, we will talk a lot about concepts that might not</span></div>
<div style="position:absolute;left:108.00px;top:251.62px" class="cls_008"><span class="cls_008">be familiar to everyone. To make sure we all talk the same language, let's briefly</span></div>
<div style="position:absolute;left:108.00px;top:264.22px" class="cls_008"><span class="cls_008">introduce and describe the most important of these concepts or words:</span></div>
<div style="position:absolute;left:113.78px;top:293.34px" class="cls_027"><span class="cls_027">VM</span></div>
<div style="position:absolute;left:172.44px;top:293.34px" class="cls_025"><span class="cls_025">Acronym for virtual machine. This is a virtual computer.</span></div>
<div style="position:absolute;left:172.44px;top:308.24px" class="cls_025"><span class="cls_025">Individual server used to run applications. This can be a physical server,</span></div>
<div style="position:absolute;left:172.44px;top:319.64px" class="cls_025"><span class="cls_025">often called bare metal, or a VM. A node can be a mainframe, supercomputer,</span></div>
<div style="position:absolute;left:113.78px;top:331.04px" class="cls_027"><span class="cls_027">Node</span></div>
<div style="position:absolute;left:172.44px;top:331.04px" class="cls_025"><span class="cls_025">standard business server, or even a Raspberry Pi. Nodes can be computers</span></div>
<div style="position:absolute;left:172.44px;top:342.44px" class="cls_025"><span class="cls_025">in a company's own data center or in the cloud. Normally, a node is part of a</span></div>
<div style="position:absolute;left:172.44px;top:353.84px" class="cls_025"><span class="cls_025">cluster.</span></div>
<div style="position:absolute;left:113.78px;top:368.75px" class="cls_027"><span class="cls_027">Cluster</span></div>
<div style="position:absolute;left:172.44px;top:368.75px" class="cls_025"><span class="cls_025">Group of nodes connected by a network used to run distributed applications.</span></div>
<div style="position:absolute;left:172.44px;top:383.65px" class="cls_025"><span class="cls_025">Physical and software-defined communication paths between individual</span></div>
<div style="position:absolute;left:113.78px;top:389.35px" class="cls_027"><span class="cls_027">Network</span></div>
<div style="position:absolute;left:172.44px;top:395.05px" class="cls_025"><span class="cls_025">nodes of a cluster and programs running on those nodes.</span></div>
<div style="position:absolute;left:172.44px;top:409.96px" class="cls_025"><span class="cls_025">Channel on which an application such a web server listens for incoming</span></div>
<div style="position:absolute;left:113.78px;top:415.66px" class="cls_027"><span class="cls_027">Port</span></div>
<div style="position:absolute;left:172.44px;top:421.36px" class="cls_025"><span class="cls_025">requests.</span></div>
<div style="position:absolute;left:172.44px;top:436.26px" class="cls_025"><span class="cls_025">This, unfortunately, is a very overloaded term and its real meaning depends</span></div>
<div style="position:absolute;left:172.44px;top:447.66px" class="cls_025"><span class="cls_025">on the context in which it is used. If we use the term service in the context of</span></div>
<div style="position:absolute;left:172.44px;top:459.06px" class="cls_025"><span class="cls_025">an application such as an application service, then it usually means that this</span></div>
<div style="position:absolute;left:113.78px;top:470.46px" class="cls_027"><span class="cls_027">Service</span></div>
<div style="position:absolute;left:172.44px;top:470.46px" class="cls_025"><span class="cls_025">is a piece of software that implements a limited set of functionality which</span></div>
<div style="position:absolute;left:172.44px;top:481.86px" class="cls_025"><span class="cls_025">is then used by other parts of the application. As we progress through this</span></div>
<div style="position:absolute;left:172.44px;top:493.26px" class="cls_025"><span class="cls_025">book, other types of services that have a slightly different definition will be</span></div>
<div style="position:absolute;left:172.44px;top:504.66px" class="cls_025"><span class="cls_025">discussed.</span></div>
<div style="position:absolute;left:293.36px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 110 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:101854px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background134.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Naively said, a distributed application architecture is the opposite of a monolithic</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">application architecture, but it's not unreasonable to look at this monolithic</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">architecture first. Traditionally, most business applications have been written in</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">such a way that the result can be seen as one single, tightly coupled program that</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">runs on a named server somewhere in a data center. All its code is compiled into</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">a single binary or a few very tightly coupled binaries that need to be co-located</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">when running the application. The fact that the server, or more general host, on</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">which the application is running has a well-defined name or static IP address is also</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">important in this context. Let's look at the following diagram to illustrate this type of</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_008"><span class="cls_008">application architecture a bit more clearly:</span></div>
<div style="position:absolute;left:243.67px;top:488.51px" class="cls_026"><span class="cls_026">Monolithic application architecture</span></div>
<div style="position:absolute;left:108.00px;top:507.25px" class="cls_008"><span class="cls_008">In the preceding diagram, we see a server named </span><span class="cls_009">blue-box-12a</span><span class="cls_008"> with an IP address</span></div>
<div style="position:absolute;left:108.00px;top:519.85px" class="cls_008"><span class="cls_008">of </span><span class="cls_010">172.52.13.44</span><span class="cls_008"> running an application called </span><span class="cls_009">pet-shop</span><span class="cls_008">, which is a monolith</span></div>
<div style="position:absolute;left:108.00px;top:532.45px" class="cls_008"><span class="cls_008">consisting of a main module and a few tightly coupled libraries.</span></div>
<div style="position:absolute;left:294.21px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 111 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:102656px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background135.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, let's look at the following diagram:</span></div>
<div style="position:absolute;left:242.76px;top:433.65px" class="cls_026"><span class="cls_026">Distributed application architecture</span></div>
<div style="position:absolute;left:108.00px;top:452.39px" class="cls_008"><span class="cls_008">Here, all of a sudden, we don't have only a single named server anymore, but we</span></div>
<div style="position:absolute;left:108.00px;top:464.99px" class="cls_008"><span class="cls_008">have a lot of them and they don't have human-friendly names, but rather some</span></div>
<div style="position:absolute;left:108.00px;top:477.59px" class="cls_008"><span class="cls_008">unique IDs that can be something like a </span><span class="cls_009">universal unique identifier</span><span class="cls_008"> (</span><span class="cls_009">UUID</span><span class="cls_008">). The</span></div>
<div style="position:absolute;left:108.00px;top:490.19px" class="cls_009"><span class="cls_009">pet-shop</span><span class="cls_008"> application, all of a sudden, also does not consist of a single monolithic</span></div>
<div style="position:absolute;left:108.00px;top:502.79px" class="cls_008"><span class="cls_008">block anymore but rather of a plethora of interacting yet loosely coupled services</span></div>
<div style="position:absolute;left:108.00px;top:515.39px" class="cls_008"><span class="cls_008">such as </span><span class="cls_009">pet-api</span><span class="cls_008">, </span><span class="cls_009">pet-web</span><span class="cls_008">, and </span><span class="cls_009">pet-inventory</span><span class="cls_008">. Furthermore, each service runs in</span></div>
<div style="position:absolute;left:108.00px;top:527.99px" class="cls_008"><span class="cls_008">multiple instances in this cluster of servers or hosts.</span></div>
<div style="position:absolute;left:108.00px;top:549.23px" class="cls_008"><span class="cls_008">You might be wondering why we are discussing this in a book about Docker</span></div>
<div style="position:absolute;left:108.00px;top:561.83px" class="cls_008"><span class="cls_008">containers, and you are right to ask. While all the topics we're going to investigate</span></div>
<div style="position:absolute;left:108.00px;top:574.43px" class="cls_008"><span class="cls_008">apply equally to a world where containers do not (yet) exist, it is important to realize</span></div>
<div style="position:absolute;left:108.00px;top:587.03px" class="cls_008"><span class="cls_008">that containers and container orchestration engines help to address all the problems</span></div>
<div style="position:absolute;left:108.00px;top:599.63px" class="cls_008"><span class="cls_008">in a much more efficient and straightforward way. Most of the problems that used to</span></div>
<div style="position:absolute;left:108.00px;top:612.23px" class="cls_008"><span class="cls_008">be very hard to solve in a distributed application architecture become quite simple in</span></div>
<div style="position:absolute;left:108.00px;top:624.83px" class="cls_008"><span class="cls_008">a containerized world.</span></div>
<div style="position:absolute;left:293.36px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 112 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:103458px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background136.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Patterns and best practices</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">A distributed application architecture has many compelling benefits, but it has also</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">one very significant drawback compared to a monolithic application architecture—</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">the former is way more complex. To tame this complexity, the industry has come up</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">with some important best practices and patterns. In the following sections, we are</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">going to look into some of the most important ones in more detail.</span></div>
<div style="position:absolute;left:108.00px;top:217.24px" class="cls_022"><span class="cls_022">Loosely coupled components</span></div>
<div style="position:absolute;left:108.00px;top:240.22px" class="cls_008"><span class="cls_008">The best way to address a complex subject has always been to divide it into smaller</span></div>
<div style="position:absolute;left:108.00px;top:252.82px" class="cls_008"><span class="cls_008">sub problems that are more manageable. As an example, it would be insanely</span></div>
<div style="position:absolute;left:108.00px;top:265.42px" class="cls_008"><span class="cls_008">complex to build a house in one single step. It is much easier to build the house up</span></div>
<div style="position:absolute;left:108.00px;top:278.02px" class="cls_008"><span class="cls_008">from simple parts that are then combined into the final result.</span></div>
<div style="position:absolute;left:108.00px;top:299.26px" class="cls_008"><span class="cls_008">The same also applies to software development. It is much easier to develop a very</span></div>
<div style="position:absolute;left:108.00px;top:311.86px" class="cls_008"><span class="cls_008">complex application if we divide this application into smaller components that</span></div>
<div style="position:absolute;left:108.00px;top:324.46px" class="cls_008"><span class="cls_008">interoperate and together make up the overall application. Now, it is much easier to</span></div>
<div style="position:absolute;left:108.00px;top:337.06px" class="cls_008"><span class="cls_008">develop these components individually if they are only loosely coupled to each other.</span></div>
<div style="position:absolute;left:108.00px;top:349.66px" class="cls_008"><span class="cls_008">What this means is that component A makes no assumptions about the inner workings</span></div>
<div style="position:absolute;left:108.00px;top:362.26px" class="cls_008"><span class="cls_008">of, say, components B and C,  but is only interested in how it can communicate</span></div>
<div style="position:absolute;left:108.00px;top:374.86px" class="cls_008"><span class="cls_008">with those two components across a well-defined interface. If each component has</span></div>
<div style="position:absolute;left:108.00px;top:387.46px" class="cls_008"><span class="cls_008">a well-defined and simple public interface through which communication with the</span></div>
<div style="position:absolute;left:108.00px;top:400.06px" class="cls_008"><span class="cls_008">other components in the system and the outside world happens, then this enables</span></div>
<div style="position:absolute;left:108.00px;top:412.66px" class="cls_008"><span class="cls_008">us to develop each component individually, without implicit dependencies to other</span></div>
<div style="position:absolute;left:108.00px;top:425.26px" class="cls_008"><span class="cls_008">components. During the development process, other components in the system can be</span></div>
<div style="position:absolute;left:108.00px;top:437.86px" class="cls_008"><span class="cls_008">replaced by stubs or mocks to allow us to test our component.</span></div>
<div style="position:absolute;left:108.00px;top:467.80px" class="cls_022"><span class="cls_022">Stateful versus stateless</span></div>
<div style="position:absolute;left:108.00px;top:490.78px" class="cls_008"><span class="cls_008">Every meaningful business application creates, modifies, or uses data. Data is also</span></div>
<div style="position:absolute;left:108.00px;top:503.38px" class="cls_008"><span class="cls_008">called state. An application service that creates or modifies persistent data is called</span></div>
<div style="position:absolute;left:108.00px;top:515.98px" class="cls_008"><span class="cls_008">a stateful component. Typical stateful components are database services or services</span></div>
<div style="position:absolute;left:108.00px;top:528.58px" class="cls_008"><span class="cls_008">that create files.  On the other hand, application components that do not create or</span></div>
<div style="position:absolute;left:108.00px;top:541.18px" class="cls_008"><span class="cls_008">modify persistent data are called stateless components.</span></div>
<div style="position:absolute;left:108.00px;top:562.42px" class="cls_008"><span class="cls_008">In a distributed application architecture, stateless components are much simpler to</span></div>
<div style="position:absolute;left:108.00px;top:575.02px" class="cls_008"><span class="cls_008">handle than stateful components. Stateless components can be easily scaled up and</span></div>
<div style="position:absolute;left:108.00px;top:587.62px" class="cls_008"><span class="cls_008">scaled down. They can also be quickly and painlessly torn down and restarted on</span></div>
<div style="position:absolute;left:108.00px;top:600.22px" class="cls_008"><span class="cls_008">a completely different node of the cluster—all this because they have no persistent</span></div>
<div style="position:absolute;left:108.00px;top:612.82px" class="cls_008"><span class="cls_008">data associated with them.</span></div>
<div style="position:absolute;left:293.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 113 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:104260px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background137.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Given that fact, it is helpful to design a system in a way that most of the application</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">services are stateless. It is best to push all the stateful components to the boundary of</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the application and limit their number. Managing stateful components is hard.</span></div>
<div style="position:absolute;left:108.00px;top:169.63px" class="cls_022"><span class="cls_022">Service discovery</span></div>
<div style="position:absolute;left:108.00px;top:192.61px" class="cls_008"><span class="cls_008">As we build applications that consist of many individual components or services</span></div>
<div style="position:absolute;left:108.00px;top:205.21px" class="cls_008"><span class="cls_008">that communicate with each other, we need a mechanism that allows the individual</span></div>
<div style="position:absolute;left:108.00px;top:217.81px" class="cls_008"><span class="cls_008">components to find each other in the cluster. Finding each other usually means that</span></div>
<div style="position:absolute;left:108.00px;top:230.41px" class="cls_008"><span class="cls_008">one needs to know on which node the target component is running and on which</span></div>
<div style="position:absolute;left:108.00px;top:243.01px" class="cls_008"><span class="cls_008">port it is listening for communication. Most often, nodes are identified by an IP</span></div>
<div style="position:absolute;left:108.00px;top:255.61px" class="cls_008"><span class="cls_008">address and a port, which is just a number in a well-defined range.</span></div>
<div style="position:absolute;left:108.00px;top:276.86px" class="cls_008"><span class="cls_008">Technically, we could tell Service A, which wants to communicate with a target,</span></div>
<div style="position:absolute;left:108.00px;top:289.46px" class="cls_008"><span class="cls_008">Service B, what the IP address and port of the target are. This could happen, for</span></div>
<div style="position:absolute;left:108.00px;top:302.06px" class="cls_008"><span class="cls_008">example, through an entry in a configuration file:</span></div>
<div style="position:absolute;left:257.00px;top:489.21px" class="cls_026"><span class="cls_026">Components are hardwired</span></div>
<div style="position:absolute;left:293.36px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 114 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:105062px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background138.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">While this might work very well in the context of a monolithic application that</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">runs on one or only a few well-known and curated servers, it totally falls apart in</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">a distributed application architecture. First of all, in this scenario, we have many</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">components, and keeping track of them manually becomes a nightmare. It is</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">definitely not scalable. Furthermore, Service A typically should or will never know</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">on which node of the cluster the other components run. Their location may not even</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">be stable as component B could be moved from node X to another node Y, due to</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">various reasons external to the application. Thus, we need another way in which</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">Service A can locate Service B, or any other service for that matter. What is most</span></div>
<div style="position:absolute;left:108.00px;top:227.89px" class="cls_008"><span class="cls_008">commonly used is an external authority that is aware of the topology of the system</span></div>
<div style="position:absolute;left:108.00px;top:240.49px" class="cls_008"><span class="cls_008">at any given time. This external authority or service knows all the nodes and their IP</span></div>
<div style="position:absolute;left:108.00px;top:253.09px" class="cls_008"><span class="cls_008">addresses that currently pertain to the cluster; it knows all services that are running</span></div>
<div style="position:absolute;left:108.00px;top:265.69px" class="cls_008"><span class="cls_008">and where they are running. Often, this kind of service is called a </span><span class="cls_009">DNS service</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:278.29px" class="cls_008"><span class="cls_008">where </span><span class="cls_009">DNS</span><span class="cls_008"> stands for </span><span class="cls_009">Domain Name System</span><span class="cls_008">. As we will see, Docker has a DNS</span></div>
<div style="position:absolute;left:108.00px;top:290.89px" class="cls_008"><span class="cls_008">service implemented as part of the underlying engine. Kubernetes also uses a DNS</span></div>
<div style="position:absolute;left:108.00px;top:303.49px" class="cls_008"><span class="cls_008">service to facilitate communication between components running in the cluster:</span></div>
<div style="position:absolute;left:222.33px;top:460.94px" class="cls_026"><span class="cls_026">Components consult an external locator service</span></div>
<div style="position:absolute;left:108.00px;top:479.68px" class="cls_008"><span class="cls_008">In the preceding diagram, we see how Service A wants to communicate with Service</span></div>
<div style="position:absolute;left:108.00px;top:492.28px" class="cls_008"><span class="cls_008">B. But it can't do this directly; it has to first query the external authority, a registry</span></div>
<div style="position:absolute;left:108.00px;top:504.88px" class="cls_008"><span class="cls_008">service, here called a </span><span class="cls_009">DNS Service</span><span class="cls_008">, about the whereabouts of Service B. The registry</span></div>
<div style="position:absolute;left:108.00px;top:517.48px" class="cls_008"><span class="cls_008">service will answer with the requested information and hand out the IP address</span></div>
<div style="position:absolute;left:108.00px;top:530.08px" class="cls_008"><span class="cls_008">and port number with which Service A can reach Service B. Service A then uses</span></div>
<div style="position:absolute;left:108.00px;top:542.68px" class="cls_008"><span class="cls_008">this information and establishes communication with Service B. Of course, this is a</span></div>
<div style="position:absolute;left:108.00px;top:555.28px" class="cls_008"><span class="cls_008">naive picture of what's really happening on a low level, but it is a good picture to</span></div>
<div style="position:absolute;left:108.00px;top:567.88px" class="cls_008"><span class="cls_008">understand the architectural pattern of service discovery.</span></div>
<div style="position:absolute;left:293.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 115 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:105864px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background139.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Routing</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Routing is the mechanism of sending packets of data from a source component</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">to a target component. Routing is categorized into different types. One uses the</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">so-called OSI model (see reference in the </span><span class="cls_021">Further reading</span><span class="cls_008"> section of this chapter)</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">to distinguish between different types of routing. In the context of containers and</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">container orchestration, routing at layers 2, 3, 4, and 7 is relevant. We will dive into</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">more detail about routing in the subsequent chapters. Here, let's just say that layer</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">2 routing is the most low-level type of routing, which connects a MAC address to a</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">MAC address, while layer 7 routing, which is also called application-level routing,</span></div>
<div style="position:absolute;left:108.00px;top:236.24px" class="cls_008"><span class="cls_008">is the most high-level one. The latter is, for example, used to route requests having</span></div>
<div style="position:absolute;left:108.00px;top:248.84px" class="cls_008"><span class="cls_008">a target identifier that is a URL such as </span><span class="cls_010">example.com/pets</span><span class="cls_008"> to the appropriate target</span></div>
<div style="position:absolute;left:108.01px;top:261.44px" class="cls_008"><span class="cls_008">component in our system.</span></div>
<div style="position:absolute;left:108.00px;top:291.38px" class="cls_022"><span class="cls_022">Load balancing</span></div>
<div style="position:absolute;left:108.00px;top:314.36px" class="cls_008"><span class="cls_008">Load balancing is used whenever Service A requests a service from Service B, but the</span></div>
<div style="position:absolute;left:108.00px;top:326.96px" class="cls_008"><span class="cls_008">latter is running in more than one instance, as shown in the following diagram:</span></div>
<div style="position:absolute;left:222.23px;top:489.60px" class="cls_026"><span class="cls_026">Request of Service A load balanced to Service B</span></div>
<div style="position:absolute;left:108.00px;top:508.34px" class="cls_008"><span class="cls_008">If we have multiple instances of a service such as Service B running in our system,</span></div>
<div style="position:absolute;left:108.00px;top:520.94px" class="cls_008"><span class="cls_008">we want to make sure that every, of those instances gets an equal amount of</span></div>
<div style="position:absolute;left:108.00px;top:533.54px" class="cls_008"><span class="cls_008">workload assigned to it. This task is a generic one, which means that we don't</span></div>
<div style="position:absolute;left:108.00px;top:546.14px" class="cls_008"><span class="cls_008">want the caller to have to do the load balancing, but rather an external service that</span></div>
<div style="position:absolute;left:108.00px;top:558.74px" class="cls_008"><span class="cls_008">intercepts the call and takes over the part of deciding to which of the target service</span></div>
<div style="position:absolute;left:108.00px;top:571.34px" class="cls_008"><span class="cls_008">instances to forward the call. This external service is called a </span><span class="cls_009">load balancer</span><span class="cls_008">. Load</span></div>
<div style="position:absolute;left:108.00px;top:583.94px" class="cls_008"><span class="cls_008">balancers can use different algorithms to decide how to distribute the incoming calls</span></div>
<div style="position:absolute;left:108.00px;top:596.54px" class="cls_008"><span class="cls_008">to the target service instances. The most common algorithm used is called round</span></div>
<div style="position:absolute;left:108.00px;top:609.14px" class="cls_008"><span class="cls_008">robin. This algorithm just assigns requests in a repetitive way, starting with instance</span></div>
<div style="position:absolute;left:108.00px;top:621.74px" class="cls_008"><span class="cls_008">1 then 2 until instance </span><span class="cls_021">n</span><span class="cls_008">. After the last instance has been served, the load balancer</span></div>
<div style="position:absolute;left:108.00px;top:634.34px" class="cls_008"><span class="cls_008">starts over with instance number 1.</span></div>
<div style="position:absolute;left:293.36px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 116 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:106666px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background140.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Defensive programming</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">When developing a service for a distributed application, it is important to remember</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">that this service is not going to be standalone, but is dependent on other application</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">services or even on external services provided by third parties, such as credit card</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">validation services or stock information services, to just name two. All these other</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">services are external to the service we are developing. We have no control over their</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">correctness or their availability at any given time. Thus, when coding, we always</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">need to assume the worst and hope for the best. Assuming the worst means that we</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">have to deal with potential failures explicitly.</span></div>
<div style="position:absolute;left:108.00px;top:251.74px" class="cls_028"><span class="cls_028">Retries</span></div>
<div style="position:absolute;left:108.00px;top:272.72px" class="cls_008"><span class="cls_008">When there is a possibility that an external service might be temporarily unavailable</span></div>
<div style="position:absolute;left:108.00px;top:285.32px" class="cls_008"><span class="cls_008">or not responsive enough, then the following procedure can be used. When the call</span></div>
<div style="position:absolute;left:108.00px;top:297.92px" class="cls_008"><span class="cls_008">to the other service fails or times out, the calling code should be structured in such</span></div>
<div style="position:absolute;left:108.00px;top:310.52px" class="cls_008"><span class="cls_008">a way that the same call is repeated after a short wait time. If the call fails again,</span></div>
<div style="position:absolute;left:108.00px;top:323.12px" class="cls_008"><span class="cls_008">the wait should be a bit longer before the next trial. The calls should be repeated up</span></div>
<div style="position:absolute;left:108.00px;top:335.72px" class="cls_008"><span class="cls_008">until a maximum number of times, each time increasing the wait time. After that, the</span></div>
<div style="position:absolute;left:108.00px;top:348.32px" class="cls_008"><span class="cls_008">service should give up and provide a degraded service, which could mean to return</span></div>
<div style="position:absolute;left:108.00px;top:360.92px" class="cls_008"><span class="cls_008">some stale cached data or no data at all, depending on the situation.</span></div>
<div style="position:absolute;left:108.00px;top:389.02px" class="cls_028"><span class="cls_028">Logging</span></div>
<div style="position:absolute;left:108.00px;top:410.00px" class="cls_008"><span class="cls_008">Important operations in a service should always be logged. Logging information</span></div>
<div style="position:absolute;left:108.00px;top:422.60px" class="cls_008"><span class="cls_008">needs to be categorized to be of a real value. A common list of categories is debug,</span></div>
<div style="position:absolute;left:108.00px;top:435.20px" class="cls_008"><span class="cls_008">info, warning, error, and fatal. Logging information should be collected by a central</span></div>
<div style="position:absolute;left:108.00px;top:447.80px" class="cls_008"><span class="cls_008">log aggregation service and not be stored on an individual node of the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:460.40px" class="cls_008"><span class="cls_008">Aggregated logs are easy to parse and filter for relevant information.</span></div>
<div style="position:absolute;left:108.00px;top:488.50px" class="cls_028"><span class="cls_028">Error handling</span></div>
<div style="position:absolute;left:108.00px;top:509.48px" class="cls_008"><span class="cls_008">As mentioned earlier, each application service in a distributed application is</span></div>
<div style="position:absolute;left:108.00px;top:522.08px" class="cls_008"><span class="cls_008">dependent on other services. As developers, we should always expect the worst</span></div>
<div style="position:absolute;left:108.00px;top:534.68px" class="cls_008"><span class="cls_008">and have appropriate error handling in place. One of the most important best</span></div>
<div style="position:absolute;left:108.00px;top:547.28px" class="cls_008"><span class="cls_008">practices is to fail fast. Code the service in such a way that unrecoverable errors are</span></div>
<div style="position:absolute;left:108.00px;top:559.88px" class="cls_008"><span class="cls_008">discovered as early as possible and, if such an error is detected, have the service fail</span></div>
<div style="position:absolute;left:108.00px;top:572.48px" class="cls_008"><span class="cls_008">immediately. But don't forget to log meaningful information to STDERR or STDOUT,</span></div>
<div style="position:absolute;left:108.00px;top:585.08px" class="cls_008"><span class="cls_008">which can be used by developers or system operators later to track malfunctions</span></div>
<div style="position:absolute;left:108.00px;top:597.68px" class="cls_008"><span class="cls_008">of the system. Also, return a helpful error to the caller, indicating as precisely as</span></div>
<div style="position:absolute;left:108.00px;top:610.28px" class="cls_008"><span class="cls_008">possible why the call failed.</span></div>
<div style="position:absolute;left:293.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 117 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:107468px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background141.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">One sample of fail fast is to always check the input values provided by the caller.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_021"><span class="cls_021">Are the values in the expected ranges and complete?</span><span class="cls_008"> If not, then do not try to continue</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">processing, but immediately abort the operation.</span></div>
<div style="position:absolute;left:108.00px;top:169.63px" class="cls_022"><span class="cls_022">Redundancy</span></div>
<div style="position:absolute;left:108.00px;top:192.61px" class="cls_008"><span class="cls_008">A mission-critical system has to be available all the time, around the clock, 365 days a</span></div>
<div style="position:absolute;left:108.00px;top:205.21px" class="cls_008"><span class="cls_008">year. Downtime is not acceptable, since it might result in a huge loss of opportunities</span></div>
<div style="position:absolute;left:108.00px;top:217.81px" class="cls_008"><span class="cls_008">or reputation for the company. In a highly distributed application, the likelihood of a</span></div>
<div style="position:absolute;left:108.00px;top:230.41px" class="cls_008"><span class="cls_008">failure of at least one of the many involved components is non-neglectable.  One can</span></div>
<div style="position:absolute;left:108.00px;top:243.01px" class="cls_008"><span class="cls_008">say that the question is not whether a component will fail, but rather when a failure</span></div>
<div style="position:absolute;left:108.00px;top:255.61px" class="cls_008"><span class="cls_008">will occur.</span></div>
<div style="position:absolute;left:108.00px;top:276.86px" class="cls_008"><span class="cls_008">To avoid downtime when one of the many components in the system fails, each</span></div>
<div style="position:absolute;left:108.00px;top:289.46px" class="cls_008"><span class="cls_008">individual part of the system needs to be redundant. This includes the application</span></div>
<div style="position:absolute;left:108.00px;top:302.06px" class="cls_008"><span class="cls_008">components as well as all infrastructure parts. What that means is that if we, say,</span></div>
<div style="position:absolute;left:108.00px;top:314.66px" class="cls_008"><span class="cls_008">have a payment service as part of our application, then we need to run this service</span></div>
<div style="position:absolute;left:108.00px;top:327.26px" class="cls_008"><span class="cls_008">redundantly. The easiest way to do that is to run multiple instances of this very</span></div>
<div style="position:absolute;left:108.00px;top:339.86px" class="cls_008"><span class="cls_008">service on different nodes of our cluster. The same applies, say, for an edge router or</span></div>
<div style="position:absolute;left:108.00px;top:352.46px" class="cls_008"><span class="cls_008">a load balancer. We cannot afford for this to ever go down. Thus the router or load</span></div>
<div style="position:absolute;left:108.00px;top:365.06px" class="cls_008"><span class="cls_008">balancer must be redundant.</span></div>
<div style="position:absolute;left:108.00px;top:394.99px" class="cls_022"><span class="cls_022">Health checks</span></div>
<div style="position:absolute;left:108.00px;top:417.97px" class="cls_008"><span class="cls_008">We have mentioned various times that in a distributed application architecture,</span></div>
<div style="position:absolute;left:108.00px;top:430.57px" class="cls_008"><span class="cls_008">with its many parts, failure of an individual component is highly likely and it is only</span></div>
<div style="position:absolute;left:108.00px;top:443.17px" class="cls_008"><span class="cls_008">a matter of time until it happens. For that reason, we run every single component</span></div>
<div style="position:absolute;left:108.00px;top:455.77px" class="cls_008"><span class="cls_008">of the system redundantly. Proxy services then load balance the traffic across the</span></div>
<div style="position:absolute;left:108.00px;top:468.37px" class="cls_008"><span class="cls_008">individual instances of a service.</span></div>
<div style="position:absolute;left:108.00px;top:489.62px" class="cls_008"><span class="cls_008">But now there is another problem. </span><span class="cls_021">How does the proxy or router know whether a certain</span></div>
<div style="position:absolute;left:108.00px;top:502.22px" class="cls_021"><span class="cls_021">service instance is available or not?</span><span class="cls_008"> It could have crashed or it could be unresponsive.</span></div>
<div style="position:absolute;left:108.00px;top:514.82px" class="cls_008"><span class="cls_008">To solve this problem, one uses so-called health checks. The proxy, or some other</span></div>
<div style="position:absolute;left:108.00px;top:527.42px" class="cls_008"><span class="cls_008">system service on behalf of the proxy, periodically polls all the service instances and</span></div>
<div style="position:absolute;left:108.00px;top:540.02px" class="cls_008"><span class="cls_008">checks their health. The questions are basically </span><span class="cls_021">Are you still there? Are you healthy?</span></div>
<div style="position:absolute;left:108.00px;top:552.62px" class="cls_008"><span class="cls_008">The answer of each service is either </span><span class="cls_021">Yes</span><span class="cls_008"> or </span><span class="cls_021">No</span><span class="cls_008">, or the health check times out if the</span></div>
<div style="position:absolute;left:108.00px;top:565.22px" class="cls_008"><span class="cls_008">instance is not responsive anymore.</span></div>
<div style="position:absolute;left:108.00px;top:586.46px" class="cls_008"><span class="cls_008">If the component answers with </span><span class="cls_021">No</span><span class="cls_008"> or a timeout occurs, then the system kills the</span></div>
<div style="position:absolute;left:108.00px;top:599.06px" class="cls_008"><span class="cls_008">corresponding instance and spins up a new instance in its place. If all this happens in</span></div>
<div style="position:absolute;left:108.00px;top:611.66px" class="cls_008"><span class="cls_008">a fully automated way, then we say that we have an auto-healing system in place.</span></div>
<div style="position:absolute;left:293.36px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 118 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:108270px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background142.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Circuit breaker pattern</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">A </span><span class="cls_009">circuit breaker</span><span class="cls_008"> is a mechanism that is used to avoid a distributed application</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">going down due to a cascading failure of many essential components. Circuit</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">breakers help to avoid one failing component tearing down other dependent services</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">in a domino effect. Like circuit breakers in an electrical system, which protect a house</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">from burning down due to the failure of a malfunctioning plugged-in appliance by</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">interrupting the power line, circuit breakers in a distributed application interrupt</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">the connection from Service A to Service B if the latter is not responding or is</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">malfunctioning.</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">This can be achieved by wrapping a protected service call in a circuit breaker object.</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">This object monitors for failures. Once the number of failures reaches a certain</span></div>
<div style="position:absolute;left:108.00px;top:270.09px" class="cls_008"><span class="cls_008">threshold, the circuit breaker trips. All subsequent calls to the circuit breaker will</span></div>
<div style="position:absolute;left:108.00px;top:282.69px" class="cls_008"><span class="cls_008">return with an error, without the protected call being made at all:</span></div>
<div style="position:absolute;left:265.50px;top:580.51px" class="cls_026"><span class="cls_026">Circuit breaker pattern</span></div>
<div style="position:absolute;left:293.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 119 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:109072px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background143.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Running in production</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">To successfully run a distributed application in production, we need to consider a</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">few more aspects beyond the best practices and patterns presented in the preceding</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">sections. One specific area that comes to mind is introspection and monitoring. Let's</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">go through the most important aspects in detail.</span></div>
<div style="position:absolute;left:108.00px;top:204.64px" class="cls_022"><span class="cls_022">Logging</span></div>
<div style="position:absolute;left:108.00px;top:227.62px" class="cls_008"><span class="cls_008">Once a distributed application is in production, it is not possible to debug it. But how</span></div>
<div style="position:absolute;left:108.00px;top:240.22px" class="cls_008"><span class="cls_008">can we then find out </span><span class="cls_021">what exactly is the root cause of a malfunction of the application that</span></div>
<div style="position:absolute;left:108.00px;top:252.82px" class="cls_021"><span class="cls_021">has been reported by a user?</span><span class="cls_008"> The solution to this problem is to produce abundant and</span></div>
<div style="position:absolute;left:108.00px;top:265.42px" class="cls_008"><span class="cls_008">meaningful logging information. Developers need to instrument their application</span></div>
<div style="position:absolute;left:108.00px;top:278.02px" class="cls_008"><span class="cls_008">services in such a way that they output helpful information, such as when an error</span></div>
<div style="position:absolute;left:108.00px;top:290.62px" class="cls_008"><span class="cls_008">happens or a potentially unexpected or unwanted situation is encountered. Often,</span></div>
<div style="position:absolute;left:108.00px;top:303.22px" class="cls_008"><span class="cls_008">this information is output to STDOUT and STDERR, from where it is then collected</span></div>
<div style="position:absolute;left:108.00px;top:315.82px" class="cls_008"><span class="cls_008">by system daemons that write the information to local files or forward it to a central</span></div>
<div style="position:absolute;left:108.00px;top:328.42px" class="cls_008"><span class="cls_008">log aggregation service.</span></div>
<div style="position:absolute;left:108.00px;top:349.66px" class="cls_008"><span class="cls_008">If there is sufficient information in the logs, developers can use those logs to track</span></div>
<div style="position:absolute;left:108.00px;top:362.26px" class="cls_008"><span class="cls_008">down the root cause of errors in the system that have been reported.</span></div>
<div style="position:absolute;left:108.00px;top:383.50px" class="cls_008"><span class="cls_008">In a distributed application architecture, with its many components, logging is even</span></div>
<div style="position:absolute;left:108.00px;top:396.10px" class="cls_008"><span class="cls_008">more important than in a monolithic application. The paths of execution of a single</span></div>
<div style="position:absolute;left:108.00px;top:408.70px" class="cls_008"><span class="cls_008">request through all the components of the application can be very complex. Also,</span></div>
<div style="position:absolute;left:108.00px;top:421.30px" class="cls_008"><span class="cls_008">remember that the components are distributed across a cluster of nodes. Thus, it</span></div>
<div style="position:absolute;left:108.00px;top:433.90px" class="cls_008"><span class="cls_008">makes sense to log everything of importance and to each log entry add things such</span></div>
<div style="position:absolute;left:108.00px;top:446.50px" class="cls_008"><span class="cls_008">as the exact time when it happened, the component in which it happened, and the</span></div>
<div style="position:absolute;left:108.00px;top:459.10px" class="cls_008"><span class="cls_008">node on which the component ran, to name just a few. Furthermore, the logging</span></div>
<div style="position:absolute;left:108.00px;top:471.70px" class="cls_008"><span class="cls_008">information should be aggregated in a central location so that it is readily available</span></div>
<div style="position:absolute;left:108.00px;top:484.30px" class="cls_008"><span class="cls_008">for developers and system operators to analyze.</span></div>
<div style="position:absolute;left:108.00px;top:514.24px" class="cls_022"><span class="cls_022">Tracing</span></div>
<div style="position:absolute;left:108.00px;top:537.22px" class="cls_008"><span class="cls_008">Tracing is used to find out how an individual request is funneled through a</span></div>
<div style="position:absolute;left:108.00px;top:549.82px" class="cls_008"><span class="cls_008">distributed application and how much time is spent overall for the request and in</span></div>
<div style="position:absolute;left:108.00px;top:562.42px" class="cls_008"><span class="cls_008">every individual component. This information, if collected, can be used as one of</span></div>
<div style="position:absolute;left:108.00px;top:575.02px" class="cls_008"><span class="cls_008">the sources for dashboards that show the behavior and health of the system.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 120 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:109874px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background144.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Monitoring</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Operators like to have dashboards showing live key metrics of the system, which</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">show them the overall health of the application in one glance. These metrics can</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">be non-functional metrics such as memory and CPU usage, number of crashes of a</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">system or application component, health of a node, and so on, as well as functional</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">and thus application-specific metrics such as the number of checkouts in an ordering</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">system or the number of items out of stock in an inventory service.</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">Most often, the base data used to aggregate the numbers that are used for a</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">dashboard are extracted from logging information. This can either be system logs,</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">which will mostly be used for non-functional metrics, and application-level logs, for</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">functional metrics.</span></div>
<div style="position:absolute;left:108.00px;top:287.42px" class="cls_022"><span class="cls_022">Application updates</span></div>
<div style="position:absolute;left:108.00px;top:310.40px" class="cls_008"><span class="cls_008">One of the competitive advantages for a company is to be able to react in a timely</span></div>
<div style="position:absolute;left:108.00px;top:323.00px" class="cls_008"><span class="cls_008">manner to changing market situations. Part of this is to be able to quickly adjust an</span></div>
<div style="position:absolute;left:108.00px;top:335.60px" class="cls_008"><span class="cls_008">application to fulfill new and changed needs or to add new functionality. The faster</span></div>
<div style="position:absolute;left:108.00px;top:348.20px" class="cls_008"><span class="cls_008">we can update our applications, the better. Many companies these days roll out new</span></div>
<div style="position:absolute;left:108.00px;top:360.80px" class="cls_008"><span class="cls_008">or changed features multiple times per day.</span></div>
<div style="position:absolute;left:108.00px;top:382.05px" class="cls_008"><span class="cls_008">Since application updates are so frequent, these updates have to be non-disruptive.</span></div>
<div style="position:absolute;left:108.00px;top:394.65px" class="cls_008"><span class="cls_008">We cannot allow the system to go down for maintenance when upgrading. It all has</span></div>
<div style="position:absolute;left:108.00px;top:407.25px" class="cls_008"><span class="cls_008">to happen seamlessly and transparently.</span></div>
<div style="position:absolute;left:108.00px;top:437.18px" class="cls_022"><span class="cls_022">Rolling updates</span></div>
<div style="position:absolute;left:108.00px;top:460.16px" class="cls_008"><span class="cls_008">One way of updating an application or an application service is to use rolling</span></div>
<div style="position:absolute;left:108.00px;top:472.76px" class="cls_008"><span class="cls_008">updates. The assumption here is that the particular piece of software that has to be</span></div>
<div style="position:absolute;left:108.00px;top:485.36px" class="cls_008"><span class="cls_008">updated runs in multiple instances. Only then can we use this type of update.</span></div>
<div style="position:absolute;left:108.00px;top:506.61px" class="cls_008"><span class="cls_008">What happens is that the system stops one instance of the current service and</span></div>
<div style="position:absolute;left:108.00px;top:519.21px" class="cls_008"><span class="cls_008">replaces it with an instance of the new service. As soon as the new instance is ready,</span></div>
<div style="position:absolute;left:108.00px;top:531.81px" class="cls_008"><span class="cls_008">it will be served traffic. Usually, the new instance is monitored for some time to see</span></div>
<div style="position:absolute;left:108.00px;top:544.41px" class="cls_008"><span class="cls_008">whether or not it works as expected and, if it does, the next instance of the current</span></div>
<div style="position:absolute;left:108.00px;top:557.01px" class="cls_008"><span class="cls_008">service is taken down and replaced by a new instance. This pattern is repeated until</span></div>
<div style="position:absolute;left:108.00px;top:569.61px" class="cls_008"><span class="cls_008">all service instances have been replaced.</span></div>
<div style="position:absolute;left:108.00px;top:590.85px" class="cls_008"><span class="cls_008">Since there are always a few instances running at any given time, current or new, the</span></div>
<div style="position:absolute;left:108.00px;top:603.45px" class="cls_008"><span class="cls_008">application is operational all the time. No downtime is needed.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 121 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:110676px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background145.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">Blue-green deployments</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">In blue-green deployments, the current version of the application service, called blue,</span></div>
<div style="position:absolute;left:108.00px;top:146.59px" class="cls_008"><span class="cls_008">handles all the application traffic. We then install the new version of the application</span></div>
<div style="position:absolute;left:108.00px;top:159.19px" class="cls_008"><span class="cls_008">service, called green, on the production system. The new service is not yet wired</span></div>
<div style="position:absolute;left:108.00px;top:171.79px" class="cls_008"><span class="cls_008">with the rest of the application.</span></div>
<div style="position:absolute;left:108.00px;top:193.03px" class="cls_008"><span class="cls_008">Once green is installed, one can execute smoke tests against this new service and,</span></div>
<div style="position:absolute;left:108.00px;top:205.63px" class="cls_008"><span class="cls_008">if those succeed, the router can be configured to funnel all traffic that previously</span></div>
<div style="position:absolute;left:108.00px;top:218.23px" class="cls_008"><span class="cls_008">went to blue to the new service, green. The behavior of green is then observed</span></div>
<div style="position:absolute;left:108.00px;top:230.83px" class="cls_008"><span class="cls_008">closely and, if all success criteria are met, blue can be decommissioned. But if, for</span></div>
<div style="position:absolute;left:108.00px;top:243.43px" class="cls_008"><span class="cls_008">some reason, green shows some unexpected or unwanted behavior, the router can be</span></div>
<div style="position:absolute;left:108.00px;top:256.03px" class="cls_008"><span class="cls_008">reconfigured to return all traffic to blue. Green can then be removed and fixed, and a</span></div>
<div style="position:absolute;left:108.00px;top:268.63px" class="cls_008"><span class="cls_008">new blue-green deployment can be executed with the corrected version:</span></div>
<div style="position:absolute;left:264.35px;top:469.46px" class="cls_026"><span class="cls_026">Blue-green deployment</span></div>
<div style="position:absolute;left:108.00px;top:495.06px" class="cls_028"><span class="cls_028">Canary releases</span></div>
<div style="position:absolute;left:108.00px;top:516.04px" class="cls_008"><span class="cls_008">Canary releases are releases where we have the current version of the application</span></div>
<div style="position:absolute;left:108.00px;top:528.64px" class="cls_008"><span class="cls_008">service and the new version installed on the system in parallel. As such, they</span></div>
<div style="position:absolute;left:108.00px;top:541.24px" class="cls_008"><span class="cls_008">resemble blue-green deployments. At first, all traffic is still routed through the</span></div>
<div style="position:absolute;left:108.00px;top:553.84px" class="cls_008"><span class="cls_008">current version. We then configure a router so that it funnels a small percentage, say</span></div>
<div style="position:absolute;left:108.00px;top:566.44px" class="cls_008"><span class="cls_008">1%, of the overall traffic to the new version of the application service. The behavior</span></div>
<div style="position:absolute;left:108.00px;top:579.04px" class="cls_008"><span class="cls_008">of the new service is then monitored closely to find out whether or not it works as</span></div>
<div style="position:absolute;left:108.00px;top:591.64px" class="cls_008"><span class="cls_008">expected. If all the criteria for success are met, then the router is configured to funnel</span></div>
<div style="position:absolute;left:108.00px;top:604.24px" class="cls_008"><span class="cls_008">more traffic, say 5% this time, through the new service. Again, the behavior of the</span></div>
<div style="position:absolute;left:108.00px;top:616.84px" class="cls_008"><span class="cls_008">new service is closely monitored and, if it is successful, more and more traffic is</span></div>
<div style="position:absolute;left:108.00px;top:629.44px" class="cls_008"><span class="cls_008">routed to it until we reach 100%. Once all traffic is routed to the new service and it</span></div>
<div style="position:absolute;left:108.00px;top:642.04px" class="cls_008"><span class="cls_008">has been stable for some time, the old version of the service can be decommissioned.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 122 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:111478px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background146.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_021"><span class="cls_021">Why do we call this a canary release?</span><span class="cls_008"> It is named after the coal miners who would use</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">canary birds as an early warning system in the mines. Canary birds are particularly</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">sensitive to toxic gas and if such a canary bird died, the miners knew they had to</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">abandon the mine immediately.</span></div>
<div style="position:absolute;left:108.00px;top:180.39px" class="cls_028"><span class="cls_028">Irreversible data changes</span></div>
<div style="position:absolute;left:108.00px;top:201.37px" class="cls_008"><span class="cls_008">If part of our update process is to execute an irreversible change in our state, such</span></div>
<div style="position:absolute;left:108.00px;top:213.97px" class="cls_008"><span class="cls_008">as an irreversible schema change in a backing relational database, then we need</span></div>
<div style="position:absolute;left:108.00px;top:226.57px" class="cls_008"><span class="cls_008">to address this with special care. It is possible to execute such changes without</span></div>
<div style="position:absolute;left:108.00px;top:239.17px" class="cls_008"><span class="cls_008">downtime if one uses the right approach. It is important to recognize that, in such</span></div>
<div style="position:absolute;left:108.00px;top:251.77px" class="cls_008"><span class="cls_008">a situation, one cannot deploy the code changes that require the new data structure</span></div>
<div style="position:absolute;left:108.00px;top:264.37px" class="cls_008"><span class="cls_008">in the data store at the same time as the changes to the data. Rather, the whole</span></div>
<div style="position:absolute;left:108.00px;top:276.97px" class="cls_008"><span class="cls_008">update has to be separated into three distinct steps. In the first step, one rolls out a</span></div>
<div style="position:absolute;left:108.00px;top:289.57px" class="cls_008"><span class="cls_008">backward-compatible schema and data change. If this is successful, then one rolls</span></div>
<div style="position:absolute;left:108.00px;top:302.17px" class="cls_008"><span class="cls_008">out the new code in the second step. Again, if that is successful, one cleans up the</span></div>
<div style="position:absolute;left:108.00px;top:314.77px" class="cls_008"><span class="cls_008">schema in the third step and removes the backwards-compatibility:</span></div>
<div style="position:absolute;left:218.39px;top:498.36px" class="cls_026"><span class="cls_026">Rolling out an irreversible data or schema change</span></div>
<div style="position:absolute;left:108.00px;top:532.60px" class="cls_028"><span class="cls_028">Rollback</span></div>
<div style="position:absolute;left:108.00px;top:553.58px" class="cls_008"><span class="cls_008">If we have frequent updates to our application services that run in production,</span></div>
<div style="position:absolute;left:108.00px;top:566.18px" class="cls_008"><span class="cls_008">sooner or later there will be a problem with one of those updates. Maybe a</span></div>
<div style="position:absolute;left:108.00px;top:578.78px" class="cls_008"><span class="cls_008">developer, while fixing a bug, introduced a new one, which was not caught by all</span></div>
<div style="position:absolute;left:108.00px;top:591.38px" class="cls_008"><span class="cls_008">the automated, and maybe manual, tests, so the application is misbehaving and it is</span></div>
<div style="position:absolute;left:108.00px;top:603.98px" class="cls_008"><span class="cls_008">imperative that we roll back the service to the previous good version. In this regard,</span></div>
<div style="position:absolute;left:108.00px;top:616.58px" class="cls_008"><span class="cls_008">a rollback is a recovery from a disaster.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 123 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:112280px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background147.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Distributed Application Architecture</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Again, in a distributed application architecture, it is not a question of whether a</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">rollback will ever be needed, but rather when a rollback will have to occur. Thus we</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">need to absolutely be sure that we can always roll back to a previous version of any</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">service that makes up our application. Rollbacks cannot be an afterthought but have</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">to be a tested and proven part of our deployment process.</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">If we are using blue-green deployments to update our services, then rollbacks should</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">be fairly simple. All we need to do is switch the router from the new green version of</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">the service back to the previous blue version.</span></div>
<div style="position:absolute;left:108.00px;top:243.83px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:268.81px" class="cls_008"><span class="cls_008">In this chapter, we learned what a distributed application architecture is and what</span></div>
<div style="position:absolute;left:108.00px;top:281.41px" class="cls_008"><span class="cls_008">patterns and best practices are helpful or needed to successfully run a distributed</span></div>
<div style="position:absolute;left:108.00px;top:294.01px" class="cls_008"><span class="cls_008">application. Lastly, we discussed what is needed in addition to run such an</span></div>
<div style="position:absolute;left:108.00px;top:306.61px" class="cls_008"><span class="cls_008">application in production.</span></div>
<div style="position:absolute;left:108.00px;top:327.86px" class="cls_008"><span class="cls_008">In the next chapter, we will dive into networking limited to a single host. We're</span></div>
<div style="position:absolute;left:108.00px;top:340.46px" class="cls_008"><span class="cls_008">going to discuss in detail how containers living on the same host can communicate</span></div>
<div style="position:absolute;left:108.00px;top:353.06px" class="cls_008"><span class="cls_008">with each other and how external clients can access containerized applications if</span></div>
<div style="position:absolute;left:108.00px;top:365.66px" class="cls_008"><span class="cls_008">necessary.</span></div>
<div style="position:absolute;left:108.00px;top:398.15px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:423.13px" class="cls_008"><span class="cls_008">Please answer the following questions to assess your understanding of this</span></div>
<div style="position:absolute;left:108.00px;top:435.73px" class="cls_008"><span class="cls_008">chapter's content.</span></div>
<div style="position:absolute;left:126.00px;top:456.98px" class="cls_008"><span class="cls_008">1.  When and why does every part in a distributed application architecture have</span></div>
<div style="position:absolute;left:143.99px;top:469.58px" class="cls_008"><span class="cls_008">to be redundant? Explain in a few short sentences.</span></div>
<div style="position:absolute;left:126.00px;top:486.49px" class="cls_008"><span class="cls_008">2.  Why do we need DNS services? Explain in 3 to 5 sentences.</span></div>
<div style="position:absolute;left:126.00px;top:503.41px" class="cls_008"><span class="cls_008">3.  What is a circuit breaker and why is it needed?</span></div>
<div style="position:absolute;left:126.00px;top:520.32px" class="cls_008"><span class="cls_008">4.  What are some important differences between a monolithic application and a</span></div>
<div style="position:absolute;left:143.99px;top:532.92px" class="cls_008"><span class="cls_008">distributed or multi-service application?</span></div>
<div style="position:absolute;left:126.00px;top:549.84px" class="cls_008"><span class="cls_008">5.  What is a blue-green deployment?</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 124 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:113082px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background148.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 6</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">The following articles provide more in-depth information:</span></div>
<div style="position:absolute;left:126.00px;top:158.14px" class="cls_008"><span class="cls_008">•  CircuitBreaker at </span><A HREF="http://bit.ly/1NU1sgW">http://bit.ly/1NU1sgW</A> </span></div>
<div style="position:absolute;left:126.00px;top:175.06px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  The OSI model explained</span><span class="cls_008"> at </span><A HREF="http://bit.ly/1UCcvMt">http://bit.ly/1UCcvMt</A> </span></div>
<div style="position:absolute;left:126.00px;top:191.98px" class="cls_008"><span class="cls_008">•  BlueGreenDeployment at </span><A HREF="http://bit.ly/2r2IxNJ">http://bit.ly/2r2IxNJ</A> </span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 125 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:113884px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background149.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:113884px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background150.jpg" width=612 height=792></div>
<div style="position:absolute;left:190.54px;top:218.71px" class="cls_015"><span class="cls_015">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:272.41px" class="cls_008"><span class="cls_008">In the last chapter, we learned about the most important architectural patterns and</span></div>
<div style="position:absolute;left:108.00px;top:285.01px" class="cls_008"><span class="cls_008">best practices that are used when dealing with a distributed application architecture.</span></div>
<div style="position:absolute;left:108.00px;top:306.26px" class="cls_008"><span class="cls_008">In this chapter, we will introduce the Docker container networking model and its</span></div>
<div style="position:absolute;left:108.00px;top:318.86px" class="cls_008"><span class="cls_008">single-host implementation in the form of the bridge network. This chapter also</span></div>
<div style="position:absolute;left:108.00px;top:331.46px" class="cls_008"><span class="cls_008">introduces the concept of software-defined networks and how they are used to</span></div>
<div style="position:absolute;left:108.00px;top:344.06px" class="cls_008"><span class="cls_008">secure containerized applications. Finally, it demonstrates how container ports</span></div>
<div style="position:absolute;left:108.00px;top:356.66px" class="cls_008"><span class="cls_008">can be opened to the public and thus make containerized components accessible</span></div>
<div style="position:absolute;left:108.00px;top:369.26px" class="cls_008"><span class="cls_008">to the outside world.</span></div>
<div style="position:absolute;left:108.00px;top:390.50px" class="cls_008"><span class="cls_008">This chapter will contain the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:411.74px" class="cls_008"><span class="cls_008">•  The container network model</span></div>
<div style="position:absolute;left:126.00px;top:428.65px" class="cls_008"><span class="cls_008">•  Network firewalling</span></div>
<div style="position:absolute;left:126.00px;top:445.57px" class="cls_008"><span class="cls_008">•  The bridge network</span></div>
<div style="position:absolute;left:126.00px;top:462.48px" class="cls_008"><span class="cls_008">•  The host network</span></div>
<div style="position:absolute;left:126.00px;top:479.40px" class="cls_008"><span class="cls_008">•  The null network</span></div>
<div style="position:absolute;left:126.00px;top:496.32px" class="cls_008"><span class="cls_008">•  Running in an existing network namespace</span></div>
<div style="position:absolute;left:126.00px;top:513.23px" class="cls_008"><span class="cls_008">•  Port management</span></div>
<div style="position:absolute;left:107.99px;top:534.47px" class="cls_008"><span class="cls_008">After completing this module, you will be able to do the following:</span></div>
<div style="position:absolute;left:125.99px;top:555.71px" class="cls_008"><span class="cls_008">•  Draft the container networking model—along with all the essential</span></div>
<div style="position:absolute;left:143.98px;top:568.31px" class="cls_008"><span class="cls_008">components onto a whiteboard</span></div>
<div style="position:absolute;left:125.99px;top:585.23px" class="cls_008"><span class="cls_008">•  Create and delete a custom bridge network</span></div>
<div style="position:absolute;left:125.99px;top:602.15px" class="cls_008"><span class="cls_008">•  Run a container attached to a custom bridge network</span></div>
<div style="position:absolute;left:125.99px;top:619.06px" class="cls_008"><span class="cls_008">•  Inspect a bridge network</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 127 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:114686px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background151.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•  Isolate containers from each other by running them on different</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">bridge networks</span></div>
<div style="position:absolute;left:126.00px;top:144.01px" class="cls_008"><span class="cls_008">•  Publish a container port to a host port of your choice</span></div>
<div style="position:absolute;left:108.00px;top:176.51px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:201.49px" class="cls_008"><span class="cls_008">For this chapter, the only thing you will need is a Docker host that is able to run</span></div>
<div style="position:absolute;left:108.00px;top:214.09px" class="cls_008"><span class="cls_008">Linux containers. You can use your laptop with either Docker for Mac or Windows</span></div>
<div style="position:absolute;left:108.00px;top:226.69px" class="cls_008"><span class="cls_008">or Docker Toolbox installed.</span></div>
<div style="position:absolute;left:108.00px;top:259.19px" class="cls_011"><span class="cls_011">The container network model</span></div>
<div style="position:absolute;left:108.00px;top:284.17px" class="cls_008"><span class="cls_008">So far, we have worked with single containers. But in reality, a containerized</span></div>
<div style="position:absolute;left:108.00px;top:296.77px" class="cls_008"><span class="cls_008">business application consists of several containers that need to collaborate to achieve</span></div>
<div style="position:absolute;left:108.00px;top:309.37px" class="cls_008"><span class="cls_008">a goal. Therefore, we need a way for individual containers to communicate with each</span></div>
<div style="position:absolute;left:108.00px;top:321.97px" class="cls_008"><span class="cls_008">other. This is achieved by establishing pathways that we can use to send data packets</span></div>
<div style="position:absolute;left:108.00px;top:334.57px" class="cls_008"><span class="cls_008">back and forth between containers. These pathways are called </span><span class="cls_009">networks</span><span class="cls_008">. Docker has</span></div>
<div style="position:absolute;left:108.00px;top:347.17px" class="cls_008"><span class="cls_008">defined a very simple networking model, the so-called </span><span class="cls_009">container network model</span></div>
<div style="position:absolute;left:108.00px;top:359.77px" class="cls_008"><span class="cls_008">(</span><span class="cls_009">CNM</span><span class="cls_008">), to specify the requirements that any software that implements a container</span></div>
<div style="position:absolute;left:108.00px;top:372.37px" class="cls_008"><span class="cls_008">network has to fulfill. The following is a graphical representation of the CNM:</span></div>
<div style="position:absolute;left:239.84px;top:502.59px" class="cls_026"><span class="cls_026">The Docker container network model</span></div>
<div style="position:absolute;left:108.00px;top:521.33px" class="cls_008"><span class="cls_008">The CNM has three elements—sandbox, endpoint, and network:</span></div>
<div style="position:absolute;left:126.00px;top:542.58px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Sandbox</span><span class="cls_008">: The sandbox perfectly isolates a container from the outside world.</span></div>
<div style="position:absolute;left:143.99px;top:555.18px" class="cls_008"><span class="cls_008">No inbound network connection is allowed into the sandboxed container.</span></div>
<div style="position:absolute;left:143.99px;top:567.78px" class="cls_008"><span class="cls_008">Yet, it is very unlikely that a container will be of any value in a system if</span></div>
<div style="position:absolute;left:143.99px;top:580.38px" class="cls_008"><span class="cls_008">absolutely no communication with it is possible. To work around this, we</span></div>
<div style="position:absolute;left:143.99px;top:592.98px" class="cls_008"><span class="cls_008">have element number two, which is the endpoint.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 128 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:115488px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background152.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Endpoint</span><span class="cls_008">: An endpoint is a controlled gateway from the outside world into</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">the network's sandbox that shields the container. The endpoint connects the</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">network sandbox (but not the container) to the third element of the model,</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">which is the network.</span></div>
<div style="position:absolute;left:126.00px;top:169.21px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Network</span><span class="cls_008">: The network is the pathway that transports the data packets of an</span></div>
<div style="position:absolute;left:144.00px;top:181.81px" class="cls_008"><span class="cls_008">instance of communication from endpoint to endpoint, or ultimately from</span></div>
<div style="position:absolute;left:144.00px;top:194.41px" class="cls_008"><span class="cls_008">container to container.</span></div>
<div style="position:absolute;left:107.99px;top:215.65px" class="cls_008"><span class="cls_008">It is important to note that a network sandbox can have zero to many endpoints, or,</span></div>
<div style="position:absolute;left:107.99px;top:228.25px" class="cls_008"><span class="cls_008">said differently, each container living in a network sandbox can either be attached</span></div>
<div style="position:absolute;left:107.99px;top:240.85px" class="cls_008"><span class="cls_008">to no network at all or it can be attached to multiple different networks at the same</span></div>
<div style="position:absolute;left:107.99px;top:253.45px" class="cls_008"><span class="cls_008">time. In the preceding diagram, the middle of the three network sandboxes is</span></div>
<div style="position:absolute;left:107.99px;top:266.05px" class="cls_008"><span class="cls_008">attached to both networks 1 and 2 through a respective endpoint.</span></div>
<div style="position:absolute;left:107.99px;top:287.29px" class="cls_008"><span class="cls_008">This networking model is very generic and does not specify where the individual</span></div>
<div style="position:absolute;left:107.99px;top:299.89px" class="cls_008"><span class="cls_008">containers that communicate with each other run over a network. All containers</span></div>
<div style="position:absolute;left:107.99px;top:312.49px" class="cls_008"><span class="cls_008">could, for example, run on one and the same host (local) or they could be distributed</span></div>
<div style="position:absolute;left:107.99px;top:325.09px" class="cls_008"><span class="cls_008">across a cluster of hosts (global).</span></div>
<div style="position:absolute;left:107.99px;top:346.33px" class="cls_008"><span class="cls_008">Of course, the CNM is just a model describing how networking works among</span></div>
<div style="position:absolute;left:107.99px;top:358.93px" class="cls_008"><span class="cls_008">containers. To be able to use networking with our containers, we need real</span></div>
<div style="position:absolute;left:107.99px;top:371.53px" class="cls_008"><span class="cls_008">implementations of the CNM. For both local and global scope, we have multiple</span></div>
<div style="position:absolute;left:107.99px;top:384.13px" class="cls_008"><span class="cls_008">implementations of the CNM. In the following table, we give a short overview</span></div>
<div style="position:absolute;left:107.99px;top:396.73px" class="cls_008"><span class="cls_008">of the existing implementations and their main characteristics. The list is in no</span></div>
<div style="position:absolute;left:107.99px;top:409.33px" class="cls_008"><span class="cls_008">particular order:</span></div>
<div style="position:absolute;left:113.65px;top:434.12px" class="cls_027"><span class="cls_027">Network</span></div>
<div style="position:absolute;left:200.99px;top:434.12px" class="cls_027"><span class="cls_027">Company</span></div>
<div style="position:absolute;left:275.15px;top:434.12px" class="cls_027"><span class="cls_027">Scope</span></div>
<div style="position:absolute;left:320.15px;top:434.12px" class="cls_027"><span class="cls_027">Description</span></div>
<div style="position:absolute;left:113.65px;top:449.04px" class="cls_025"><span class="cls_025">Bridge</span></div>
<div style="position:absolute;left:200.99px;top:449.04px" class="cls_025"><span class="cls_025">Docker</span></div>
<div style="position:absolute;left:275.15px;top:449.04px" class="cls_025"><span class="cls_025">Local</span></div>
<div style="position:absolute;left:320.15px;top:449.04px" class="cls_025"><span class="cls_025">Simple network based on Linux bridges</span></div>
<div style="position:absolute;left:320.15px;top:460.44px" class="cls_025"><span class="cls_025">allowing networking on</span></div>
<div style="position:absolute;left:320.15px;top:471.84px" class="cls_025"><span class="cls_025">a single host</span></div>
<div style="position:absolute;left:113.65px;top:486.75px" class="cls_025"><span class="cls_025">Macvlan</span></div>
<div style="position:absolute;left:200.99px;top:486.75px" class="cls_025"><span class="cls_025">Docker</span></div>
<div style="position:absolute;left:275.15px;top:486.75px" class="cls_025"><span class="cls_025">Local</span></div>
<div style="position:absolute;left:320.15px;top:486.75px" class="cls_025"><span class="cls_025">Configures multiple layer 2 (that is,</span></div>
<div style="position:absolute;left:320.15px;top:498.15px" class="cls_025"><span class="cls_025">MAC) addresses on a single physical host</span></div>
<div style="position:absolute;left:320.15px;top:509.55px" class="cls_025"><span class="cls_025">interface</span></div>
<div style="position:absolute;left:113.65px;top:524.47px" class="cls_025"><span class="cls_025">Overlay</span></div>
<div style="position:absolute;left:200.99px;top:524.47px" class="cls_025"><span class="cls_025">Docker</span></div>
<div style="position:absolute;left:275.15px;top:524.47px" class="cls_025"><span class="cls_025">Global</span></div>
<div style="position:absolute;left:320.15px;top:524.47px" class="cls_025"><span class="cls_025">Multinode-capable container network</span></div>
<div style="position:absolute;left:320.15px;top:535.87px" class="cls_025"><span class="cls_025">based on </span><span class="cls_027">Virtual Extensible LAN</span></div>
<div style="position:absolute;left:320.15px;top:547.27px" class="cls_025"><span class="cls_025">(</span><span class="cls_027">VXLan</span><span class="cls_025">)</span></div>
<div style="position:absolute;left:113.66px;top:562.18px" class="cls_025"><span class="cls_025">Weave Net</span></div>
<div style="position:absolute;left:201.00px;top:562.18px" class="cls_025"><span class="cls_025">Weaveworks</span></div>
<div style="position:absolute;left:275.16px;top:562.18px" class="cls_025"><span class="cls_025">Global</span></div>
<div style="position:absolute;left:320.16px;top:562.18px" class="cls_025"><span class="cls_025">Simple, resilient, multihost Docker</span></div>
<div style="position:absolute;left:320.16px;top:573.58px" class="cls_025"><span class="cls_025">networking</span></div>
<div style="position:absolute;left:113.66px;top:588.50px" class="cls_025"><span class="cls_025">Contiv Network</span></div>
<div style="position:absolute;left:201.00px;top:588.50px" class="cls_025"><span class="cls_025">Cisco</span></div>
<div style="position:absolute;left:275.16px;top:588.50px" class="cls_025"><span class="cls_025">Global</span></div>
<div style="position:absolute;left:320.16px;top:588.50px" class="cls_025"><span class="cls_025">Open source container networking</span></div>
<div style="position:absolute;left:113.66px;top:599.90px" class="cls_025"><span class="cls_025">Plugin</span></div>
<div style="position:absolute;left:108.00px;top:620.39px" class="cls_008"><span class="cls_008">All network types not directly provided by Docker can be added to a Docker host</span></div>
<div style="position:absolute;left:108.00px;top:632.98px" class="cls_008"><span class="cls_008">as a plugin.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 129 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:116290px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background153.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Network firewalling</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Docker has always had the mantra of security first. This philosophy had a direct</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">influence on how networking in a single and multihost Docker environment was</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">designed and implemented. Software-defined networks are easy and cheap to create,</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">yet they perfectly firewall containers that are attached to this network from other</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">non-attached containers, and from the outside world. All containers that belong</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">to the same network can freely communicate with each other, while others have</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">no means to do so:</span></div>
<div style="position:absolute;left:275.66px;top:334.23px" class="cls_026"><span class="cls_026">Docker networks</span></div>
<div style="position:absolute;left:108.00px;top:352.97px" class="cls_008"><span class="cls_008">In the preceding diagram, we have two networks called </span><span class="cls_009">front</span><span class="cls_008"> and </span><span class="cls_009">back</span><span class="cls_008">. Attached to</span></div>
<div style="position:absolute;left:108.00px;top:365.57px" class="cls_008"><span class="cls_008">the front network, we have containers </span><span class="cls_009">c1</span><span class="cls_008"> and </span><span class="cls_009">c2</span><span class="cls_008">, and attached to the back network,</span></div>
<div style="position:absolute;left:108.00px;top:378.17px" class="cls_008"><span class="cls_008">we have containers </span><span class="cls_009">c3</span><span class="cls_008"> and </span><span class="cls_009">c4</span><span class="cls_008">. </span><span class="cls_009">c1</span><span class="cls_008"> and </span><span class="cls_009">c2</span><span class="cls_008"> can freely communicate with each other, as</span></div>
<div style="position:absolute;left:108.00px;top:390.77px" class="cls_008"><span class="cls_008">can </span><span class="cls_009">c3</span><span class="cls_008"> and </span><span class="cls_009">c4</span><span class="cls_008">. But </span><span class="cls_009">c1</span><span class="cls_008"> and </span><span class="cls_009">c2</span><span class="cls_008"> have no way to communicate with either </span><span class="cls_009">c3</span><span class="cls_008"> or </span><span class="cls_009">c4</span><span class="cls_008">, and</span></div>
<div style="position:absolute;left:108.00px;top:403.37px" class="cls_008"><span class="cls_008">vice versa.</span></div>
<div style="position:absolute;left:108.00px;top:424.61px" class="cls_008"><span class="cls_008">Now what about the situation where we have an application consisting of three</span></div>
<div style="position:absolute;left:108.00px;top:437.21px" class="cls_008"><span class="cls_008">services, </span><span class="cls_009">webAPI</span><span class="cls_008">, </span><span class="cls_009">productCatalog</span><span class="cls_008">, and </span><span class="cls_009">database</span><span class="cls_008">? We want </span><span class="cls_009">webAPI</span><span class="cls_008"> to be able</span></div>
<div style="position:absolute;left:108.00px;top:449.81px" class="cls_008"><span class="cls_008">to communicate with </span><span class="cls_009">productCatalog</span><span class="cls_008">, but not with the database, and we want</span></div>
<div style="position:absolute;left:108.00px;top:462.41px" class="cls_009"><span class="cls_009">productCatalog</span><span class="cls_008"> to be able to communicate with the database service. We can solve</span></div>
<div style="position:absolute;left:108.00px;top:475.01px" class="cls_008"><span class="cls_008">this situation by placing </span><span class="cls_009">webAPI</span><span class="cls_008"> and the database on different networks and attach</span></div>
<div style="position:absolute;left:108.00px;top:487.61px" class="cls_009"><span class="cls_009">productCatalog</span><span class="cls_008"> to both of these networks, as shown in the following diagram:</span></div>
<div style="position:absolute;left:234.17px;top:617.94px" class="cls_026"><span class="cls_026">Container attached to multiple networks</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 130 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:117092px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background154.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Since creating SDNs is cheap, and each network provides added security by isolating</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">resources from unauthorized access, it is highly recommended that you design</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">and run applications so that they use multiple networks and run only services on</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the same network that absolutely need to communicate with each other. In the</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">preceding example, there is absolutely no need for the web API component to ever</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">communicate directly with the database service, so we have put them on different</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">networks. If the worst-case scenario happens and a hacker compromises the web</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">API, they have no ability to access the database from there without first also hacking</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">the product catalog service.</span></div>
<div style="position:absolute;left:108.00px;top:247.79px" class="cls_011"><span class="cls_011">The bridge network</span></div>
<div style="position:absolute;left:108.00px;top:272.77px" class="cls_008"><span class="cls_008">The Docker bridge network is the first implementation of the container network</span></div>
<div style="position:absolute;left:108.00px;top:285.37px" class="cls_008"><span class="cls_008">model that we're going to look at in detail. This network implementation is based</span></div>
<div style="position:absolute;left:108.00px;top:297.97px" class="cls_008"><span class="cls_008">on the Linux bridge. When the Docker daemon runs for the first time, it creates a</span></div>
<div style="position:absolute;left:108.00px;top:310.57px" class="cls_008"><span class="cls_008">Linux bridge and calls it </span><span class="cls_010">docker0</span><span class="cls_008">. This is the default behavior, and can be changed</span></div>
<div style="position:absolute;left:108.00px;top:323.17px" class="cls_008"><span class="cls_008">by changing the configuration. Docker then creates a network with this Linux bridge</span></div>
<div style="position:absolute;left:108.00px;top:335.77px" class="cls_008"><span class="cls_008">and calls the network bridge. All the containers that we create on</span></div>
<div style="position:absolute;left:108.00px;top:348.37px" class="cls_008"><span class="cls_008">a Docker host and that we do not explicitly bind to another network leads to</span></div>
<div style="position:absolute;left:108.00px;top:360.97px" class="cls_008"><span class="cls_008">Docker automatically attaching to this bridge network.</span></div>
<div style="position:absolute;left:108.00px;top:373.57px" class="cls_008"><span class="cls_008">To verify that we indeed have a network called </span><span class="cls_010">bridge</span><span class="cls_008"> of type </span><span class="cls_010">bridge</span><span class="cls_008"> defined</span></div>
<div style="position:absolute;left:108.00px;top:386.17px" class="cls_008"><span class="cls_008">on our host, we can list all networks on the host with the following command:</span></div>
<div style="position:absolute;left:144.00px;top:407.11px" class="cls_024"><span class="cls_024">$ docker network ls</span></div>
<div style="position:absolute;left:108.00px;top:426.85px" class="cls_008"><span class="cls_008">This should provide an output similar to the following:</span></div>
<div style="position:absolute;left:216.60px;top:546.47px" class="cls_026"><span class="cls_026">Listing of all Docker networks available by default</span></div>
<div style="position:absolute;left:108.00px;top:565.21px" class="cls_008"><span class="cls_008">In your case, the IDs will be different, but the rest of the output should look the</span></div>
<div style="position:absolute;left:108.00px;top:577.81px" class="cls_008"><span class="cls_008">same. We do indeed have a first network called </span><span class="cls_010">bridge</span><span class="cls_008"> using the driver </span><span class="cls_010">bridge</span><span class="cls_008">. The</span></div>
<div style="position:absolute;left:108.00px;top:590.41px" class="cls_008"><span class="cls_008">scope being </span><span class="cls_010">local</span><span class="cls_008"> just means that this type of network is restricted to a single host</span></div>
<div style="position:absolute;left:108.00px;top:603.01px" class="cls_008"><span class="cls_008">and cannot span across multiple hosts. In a later chapter, we will also discuss other</span></div>
<div style="position:absolute;left:108.00px;top:615.61px" class="cls_008"><span class="cls_008">types of networks that have a global scope, meaning they can span whole clusters of</span></div>
<div style="position:absolute;left:108.00px;top:628.21px" class="cls_008"><span class="cls_008">hosts.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 131 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:117894px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background155.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, let's look a little bit deeper into what this </span><span class="cls_010">bridge</span><span class="cls_008"> network is all about. For this,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">we are going to use the Docker </span><span class="cls_010">inspect</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker network inspect bridge</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">When executed, this outputs a big chunk of detailed information about the network</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">in question. This information should look like the following:</span></div>
<div style="position:absolute;left:195.44px;top:532.60px" class="cls_026"><span class="cls_026">Output generated when inspecting the Docker bridge network</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 132 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:118696px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background156.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We have already seen the </span><span class="cls_010">ID</span><span class="cls_008">, </span><span class="cls_010">Name</span><span class="cls_008">, </span><span class="cls_010">Driver</span><span class="cls_008">, and </span><span class="cls_010">Scope</span><span class="cls_008"> values when we listed all the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">networks, so that is nothing new. But let's have a look at the </span><span class="cls_009">IP address management</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">(</span><span class="cls_009">IPAM</span><span class="cls_008">) block. IPAM is software that is used to track IP addresses that are used on</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">a computer. The important part in the </span><span class="cls_010">IPAM</span><span class="cls_008"> block is the </span><span class="cls_010">Config</span><span class="cls_008"> node with its values</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">for </span><span class="cls_010">Subnet</span><span class="cls_008"> and </span><span class="cls_010">Gateway</span><span class="cls_008">. The subnet for the bridge network is defined by default as</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_010"><span class="cls_010">172.17.0.0/16</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">This means that all containers attached to this network will get an IP address</span></div>
<div style="position:absolute;left:108.00px;top:211.33px" class="cls_008"><span class="cls_008">assigned by Docker that is taken from the given range, which is </span><span class="cls_010">172.17.0.2</span><span class="cls_008"> to</span></div>
<div style="position:absolute;left:108.00px;top:223.93px" class="cls_010"><span class="cls_010">172.17.255.255</span><span class="cls_008">. The </span><span class="cls_010">172.17.0.1</span><span class="cls_008"> address is reserved for the router of this network</span></div>
<div style="position:absolute;left:108.00px;top:236.53px" class="cls_008"><span class="cls_008">whose role in this type of network is taken by the Linux bridge. One can expect that</span></div>
<div style="position:absolute;left:108.00px;top:249.13px" class="cls_008"><span class="cls_008">the very first container that will be attached to this network by Docker will get the</span></div>
<div style="position:absolute;left:108.00px;top:261.73px" class="cls_010"><span class="cls_010">172.17.0.2</span><span class="cls_008"> address. All subsequent containers</span></div>
<div style="position:absolute;left:107.99px;top:274.33px" class="cls_008"><span class="cls_008">will get a higher number; the following diagram illustrates this fact:</span></div>
<div style="position:absolute;left:270.89px;top:398.76px" class="cls_026"><span class="cls_026">The bridge network</span></div>
<div style="position:absolute;left:108.00px;top:417.50px" class="cls_008"><span class="cls_008">In the preceding diagram, we can see the network namespace of the host, which</span></div>
<div style="position:absolute;left:108.00px;top:430.10px" class="cls_008"><span class="cls_008">includes the host's </span><span class="cls_010">eth0</span><span class="cls_008"> endpoint, which is typically a NIC if the Docker host runs</span></div>
<div style="position:absolute;left:108.00px;top:442.70px" class="cls_008"><span class="cls_008">on bare metal or a virtual NIC if the Docker host is a VM. All traffic to the host comes</span></div>
<div style="position:absolute;left:108.00px;top:455.30px" class="cls_008"><span class="cls_008">through </span><span class="cls_010">eth0</span><span class="cls_008">. The Linux bridge is responsible for the routing of the network traffic</span></div>
<div style="position:absolute;left:108.00px;top:467.90px" class="cls_008"><span class="cls_008">between the host's network and the subnet of the bridge network.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 133 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:119498px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background157.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">By default, only traffic from the egress  is allowed, and all ingress is blocked.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">What this means is that while containerized applications can reach the internet,</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">they cannot be reached by any outside traffic. Each container attached to the network</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">gets its own </span><span class="cls_009">virtual ethernet</span><span class="cls_008"> (</span><span class="cls_009">veth</span><span class="cls_008">) connection with the bridge. This is illustrated</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">in the following diagram:</span></div>
<div style="position:absolute;left:254.18px;top:406.47px" class="cls_026"><span class="cls_026">Details of the bridge network</span></div>
<div style="position:absolute;left:108.00px;top:425.21px" class="cls_008"><span class="cls_008">The preceding diagram shows us the world from the perspective of the host. We will</span></div>
<div style="position:absolute;left:108.00px;top:437.81px" class="cls_008"><span class="cls_008">explore how the situation looks from within a container later on in this section.</span></div>
<div style="position:absolute;left:108.00px;top:459.05px" class="cls_008"><span class="cls_008">We are not limited to just the </span><span class="cls_010">bridge</span><span class="cls_008"> network, as Docker allows us to define our</span></div>
<div style="position:absolute;left:108.00px;top:471.65px" class="cls_008"><span class="cls_008">own custom bridge networks. This is not just a feature that is nice to have, but it is</span></div>
<div style="position:absolute;left:108.00px;top:484.25px" class="cls_008"><span class="cls_008">a recommended best practice to not run all containers on the same network, but to</span></div>
<div style="position:absolute;left:108.00px;top:496.85px" class="cls_008"><span class="cls_008">use additional bridge networks to further isolate containers that have no need to</span></div>
<div style="position:absolute;left:108.00px;top:509.45px" class="cls_008"><span class="cls_008">communicate with each other. To create a custom bridge network called </span><span class="cls_010">sample-</span></div>
<div style="position:absolute;left:108.00px;top:522.05px" class="cls_010"><span class="cls_010">net</span><span class="cls_008">, use the following command:</span></div>
<div style="position:absolute;left:144.00px;top:542.99px" class="cls_024"><span class="cls_024">$ docker network create --driver bridge sample-net</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 134 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:120300px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background158.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we do this, we can then inspect what subnet Docker has created for this new</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">custom network as follows:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker network inspect sample-net | grep Subnet</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">This returns the following value:</span></div>
<div style="position:absolute;left:144.00px;top:188.71px" class="cls_024"><span class="cls_024">"Subnet": "172.18.0.0/16",</span></div>
<div style="position:absolute;left:108.00px;top:208.45px" class="cls_008"><span class="cls_008">Evidently, Docker has just assigned the next free block of IP addresses to our new</span></div>
<div style="position:absolute;left:108.00px;top:221.05px" class="cls_008"><span class="cls_008">custom bridge network. If, for some reason, we want to specify our own subnet</span></div>
<div style="position:absolute;left:108.00px;top:233.65px" class="cls_008"><span class="cls_008">range when creating a network, we can do so by using the </span><span class="cls_010">--subnet</span><span class="cls_008"> parameter:</span></div>
<div style="position:absolute;left:144.00px;top:254.59px" class="cls_024"><span class="cls_024">$ docker network create --driver bridge --subnet "10.1.0.0/16"</span></div>
<div style="position:absolute;left:144.00px;top:265.39px" class="cls_024"><span class="cls_024">test-net</span></div>
<div style="position:absolute;left:108.00px;top:285.13px" class="cls_008"><span class="cls_008">To avoid conflicts due to duplicate IP addresses, make sure you avoid creating</span></div>
<div style="position:absolute;left:108.00px;top:297.73px" class="cls_008"><span class="cls_008">networks with overlapping subnets.</span></div>
<div style="position:absolute;left:108.00px;top:318.98px" class="cls_008"><span class="cls_008">Now that we have discussed what a bridge network is and how one can create a</span></div>
<div style="position:absolute;left:108.00px;top:331.58px" class="cls_008"><span class="cls_008">custom bridge network, we want to understand how we can attach containers to</span></div>
<div style="position:absolute;left:108.00px;top:344.18px" class="cls_008"><span class="cls_008">these networks. First, let's interactively run an Alpine container without specifying</span></div>
<div style="position:absolute;left:108.00px;top:356.78px" class="cls_008"><span class="cls_008">the network to be attached:</span></div>
<div style="position:absolute;left:144.00px;top:377.71px" class="cls_024"><span class="cls_024">$ docker container run --name c1 -it --rm alpine:latest /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:397.45px" class="cls_008"><span class="cls_008">In another Terminal window, let's inspect the </span><span class="cls_010">c1</span><span class="cls_008"> container:</span></div>
<div style="position:absolute;left:144.00px;top:418.39px" class="cls_024"><span class="cls_024">$ docker container inspect c1</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 135 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:121102px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background159.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the vast output, let's concentrate for a moment on the part that provides network-</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">related information. It can be found under the </span><span class="cls_010">NetworkSettings</span><span class="cls_008"> node. I have it</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">listed in the following output:</span></div>
<div style="position:absolute;left:215.99px;top:512.00px" class="cls_026"><span class="cls_026">Network settings section of the container metadata</span></div>
<div style="position:absolute;left:108.00px;top:530.74px" class="cls_008"><span class="cls_008">In the preceding output, we can see that the container is indeed attached to the</span></div>
<div style="position:absolute;left:108.00px;top:543.34px" class="cls_010"><span class="cls_010">bridge</span><span class="cls_008"> network since the </span><span class="cls_010">NetworkID</span><span class="cls_008"> is equal to </span><span class="cls_010">026e65...</span><span class="cls_008">, which we can see</span></div>
<div style="position:absolute;left:108.00px;top:555.94px" class="cls_008"><span class="cls_008">from the preceding code is the ID of the </span><span class="cls_010">bridge</span><span class="cls_008"> network. We can also see that</span></div>
<div style="position:absolute;left:108.00px;top:568.54px" class="cls_008"><span class="cls_008">the container got the IP address of </span><span class="cls_010">172.17.0.4</span><span class="cls_008"> assigned as expected and that the</span></div>
<div style="position:absolute;left:108.00px;top:581.14px" class="cls_008"><span class="cls_008">gateway is at </span><span class="cls_010">172.17.0.1</span><span class="cls_008">. Please note that the container also had a </span><span class="cls_010">MacAddress</span></div>
<div style="position:absolute;left:108.00px;top:593.74px" class="cls_008"><span class="cls_008">associated with it. This is important as the Linux bridge uses the</span></div>
<div style="position:absolute;left:108.00px;top:606.34px" class="cls_008"><span class="cls_008">Mac address for routing.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 136 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:121904px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background160.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">So far, we have approached this from the outside of the container's network</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">namespace. Now, let's see how the situation looks when we're not only inside the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">container, but inside the container's network namespace. Inside the </span><span class="cls_010">c1</span><span class="cls_008"> container, let's</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">use the </span><span class="cls_010">ip</span><span class="cls_008"> tool to inspect what's going on. Run the </span><span class="cls_010">ip addr</span><span class="cls_008"> command and observe</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">the output that is generated as follows:</span></div>
<div style="position:absolute;left:229.66px;top:311.05px" class="cls_026"><span class="cls_026">Container namespace as seen by the IP tool</span></div>
<div style="position:absolute;left:108.00px;top:329.79px" class="cls_008"><span class="cls_008">The interesting part of the preceding output is the number </span><span class="cls_010">19</span><span class="cls_008">, the </span><span class="cls_010">eth0</span><span class="cls_008"> endpoint.</span></div>
<div style="position:absolute;left:108.00px;top:342.39px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">veth0</span><span class="cls_008"> endpoint that the Linux bridge created outside of the container</span></div>
<div style="position:absolute;left:108.00px;top:354.99px" class="cls_008"><span class="cls_008">namespace is mapped to </span><span class="cls_010">eth0</span><span class="cls_008"> inside the container. Docker always maps the</span></div>
<div style="position:absolute;left:108.00px;top:367.59px" class="cls_008"><span class="cls_008">first endpoint of a container network namespace to </span><span class="cls_010">eth0</span><span class="cls_008">, as seen from inside</span></div>
<div style="position:absolute;left:108.00px;top:380.19px" class="cls_008"><span class="cls_008">the namespace. If the network namespace is attached to an additional network,</span></div>
<div style="position:absolute;left:108.00px;top:392.79px" class="cls_008"><span class="cls_008">then that endpoint will be mapped to </span><span class="cls_010">eth1</span><span class="cls_008">, and so on.</span></div>
<div style="position:absolute;left:108.00px;top:414.03px" class="cls_008"><span class="cls_008">Since at this point we're not really interested in any endpoint other than </span><span class="cls_010">eth0</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:426.63px" class="cls_008"><span class="cls_008">we could have used a more specific variant of the command, which would have</span></div>
<div style="position:absolute;left:108.00px;top:439.23px" class="cls_008"><span class="cls_008">given us the following:</span></div>
<div style="position:absolute;left:144.00px;top:460.17px" class="cls_024"><span class="cls_024">/ # ip addr show eth0</span></div>
<div style="position:absolute;left:144.00px;top:475.29px" class="cls_024"><span class="cls_024">195: eth0@if196: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500</span></div>
<div style="position:absolute;left:144.00px;top:486.09px" class="cls_024"><span class="cls_024">qdisc noqueue state UP</span></div>
<div style="position:absolute;left:165.60px;top:501.21px" class="cls_024"><span class="cls_024">link/ether 02:42:ac:11:00:02 brd</span></div>
<div style="position:absolute;left:165.60px;top:516.33px" class="cls_024"><span class="cls_024">ff:ff:ff:ff:ff:ff</span></div>
<div style="position:absolute;left:165.60px;top:531.45px" class="cls_024"><span class="cls_024">inet 172.17.0.2/16 brd 172.17.255.255 scope</span></div>
<div style="position:absolute;left:165.60px;top:546.57px" class="cls_024"><span class="cls_024">global eth0</span></div>
<div style="position:absolute;left:181.80px;top:561.69px" class="cls_024"><span class="cls_024">valid_lft forever preferred_lft forever.</span></div>
<div style="position:absolute;left:108.00px;top:581.43px" class="cls_008"><span class="cls_008">In the output, we can also see what MAC address (</span><span class="cls_010">02:42:ac:11:00:02</span><span class="cls_008">) and</span></div>
<div style="position:absolute;left:108.00px;top:594.03px" class="cls_008"><span class="cls_008">what IP (</span><span class="cls_010">172.17.0.2</span><span class="cls_008">) have been associated with this container network namespace</span></div>
<div style="position:absolute;left:108.00px;top:606.63px" class="cls_008"><span class="cls_008">by Docker.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 137 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:122706px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background161.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can also get some information about how requests are routed by using the </span><span class="cls_010">ip</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">route</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">/ # ip route</span></div>
<div style="position:absolute;left:144.00px;top:163.15px" class="cls_024"><span class="cls_024">default via 172.17.0.1 dev eth0</span></div>
<div style="position:absolute;left:144.00px;top:178.27px" class="cls_024"><span class="cls_024">172.17.0.0/16 dev eth0 scope link src 172.17.0.2</span></div>
<div style="position:absolute;left:108.00px;top:198.01px" class="cls_008"><span class="cls_008">This output tells us that all traffic to the gateway at </span><span class="cls_010">172.17.0.1</span><span class="cls_008"> is routed through</span></div>
<div style="position:absolute;left:108.00px;top:210.61px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">eth0</span><span class="cls_008"> device.</span></div>
<div style="position:absolute;left:108.00px;top:231.85px" class="cls_008"><span class="cls_008">Now, let's run another container called  </span><span class="cls_010">c2</span><span class="cls_008"> on the same network:</span></div>
<div style="position:absolute;left:144.00px;top:252.79px" class="cls_024"><span class="cls_024">$ docker container run --name c2 -d alpine:latest ping 127.0.0.1</span></div>
<div style="position:absolute;left:108.00px;top:272.53px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">c2</span><span class="cls_008"> container will also be attached to the </span><span class="cls_010">bridge</span><span class="cls_008"> network, since we have not</span></div>
<div style="position:absolute;left:108.00px;top:285.13px" class="cls_008"><span class="cls_008">specified any other network. Its IP address will be the next free one from the subnet,</span></div>
<div style="position:absolute;left:108.00px;top:297.73px" class="cls_008"><span class="cls_008">which is </span><span class="cls_010">172.17.0.3</span><span class="cls_008">, as we can readily test:</span></div>
<div style="position:absolute;left:144.00px;top:318.67px" class="cls_024"><span class="cls_024">$ docker container inspect --format "{{.NetworkSettings.</span></div>
<div style="position:absolute;left:144.00px;top:329.47px" class="cls_024"><span class="cls_024">IPAddress}}" c2</span></div>
<div style="position:absolute;left:144.00px;top:344.59px" class="cls_024"><span class="cls_024">172.17.0.3</span></div>
<div style="position:absolute;left:108.00px;top:364.33px" class="cls_008"><span class="cls_008">Now, we have two containers attached to the </span><span class="cls_010">bridge</span><span class="cls_008"> network. We can try to inspect</span></div>
<div style="position:absolute;left:108.00px;top:376.93px" class="cls_008"><span class="cls_008">this network once again to find a list of all containers attached to it in the output.:</span></div>
<div style="position:absolute;left:144.00px;top:397.87px" class="cls_024"><span class="cls_024">$ docker network inspect bridge</span></div>
<div style="position:absolute;left:108.00px;top:417.61px" class="cls_008"><span class="cls_008">The information is found under the </span><span class="cls_010">Containers</span><span class="cls_008"> node:</span></div>
<div style="position:absolute;left:182.94px;top:626.02px" class="cls_026"><span class="cls_026">The containers section of the output of docker network inspect bridge</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 138 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:123508px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background162.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once again, we have shortened the output to the essentials for readability.</span></div>
<div style="position:absolute;left:108.00px;top:135.73px" class="cls_008"><span class="cls_008">Now, let's create two additional containers, </span><span class="cls_010">c3</span><span class="cls_008"> and </span><span class="cls_010">c4</span><span class="cls_008">, and attach them to the </span><span class="cls_010">test-</span></div>
<div style="position:absolute;left:108.00px;top:148.33px" class="cls_010"><span class="cls_010">net</span><span class="cls_008">. For this, we use the </span><span class="cls_010">--network</span><span class="cls_008"> parameter:</span></div>
<div style="position:absolute;left:144.00px;top:169.27px" class="cls_024"><span class="cls_024">$ docker container run --name c3 -d --network test-net \</span></div>
<div style="position:absolute;left:165.60px;top:182.95px" class="cls_024"><span class="cls_024">alpine:latest ping 127.0.0.1</span></div>
<div style="position:absolute;left:144.00px;top:196.63px" class="cls_024"><span class="cls_024">$ docker container run --name c4 -d --network test-net \</span></div>
<div style="position:absolute;left:165.60px;top:210.31px" class="cls_024"><span class="cls_024">alpine:latest ping 127.0.0.1</span></div>
<div style="position:absolute;left:108.00px;top:230.05px" class="cls_008"><span class="cls_008">Let's inspect </span><span class="cls_010">network test-net</span><span class="cls_008"> and confirm that the containers </span><span class="cls_010">c3</span><span class="cls_008"> and </span><span class="cls_010">c4</span><span class="cls_008"> are</span></div>
<div style="position:absolute;left:108.00px;top:242.65px" class="cls_008"><span class="cls_008">indeed attached to it:</span></div>
<div style="position:absolute;left:144.00px;top:263.59px" class="cls_024"><span class="cls_024">$ docker network inspect test-net</span></div>
<div style="position:absolute;left:108.00px;top:283.33px" class="cls_008"><span class="cls_008">This will give us the following output for the </span><span class="cls_010">Containers</span><span class="cls_008"> section:</span></div>
<div style="position:absolute;left:186.75px;top:467.96px" class="cls_026"><span class="cls_026">Containers section of the command docker network inspect test-net</span></div>
<div style="position:absolute;left:108.00px;top:486.70px" class="cls_008"><span class="cls_008">The next question we're going to ask ourselves is whether the two </span><span class="cls_010">c3</span><span class="cls_008"> and </span><span class="cls_010">c4</span></div>
<div style="position:absolute;left:108.00px;top:499.30px" class="cls_008"><span class="cls_008">containers can freely communicate with each other. To demonstrate that this is</span></div>
<div style="position:absolute;left:108.00px;top:511.90px" class="cls_008"><span class="cls_008">indeed the case, we can </span><span class="cls_010">exec</span><span class="cls_008"> into the container </span><span class="cls_010">c3</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:144.00px;top:532.84px" class="cls_024"><span class="cls_024">$ docker container exec -it c3 /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:552.58px" class="cls_008"><span class="cls_008">Once inside the container, we can try to ping container </span><span class="cls_010">c4</span><span class="cls_008"> by name and by</span></div>
<div style="position:absolute;left:108.00px;top:565.18px" class="cls_008"><span class="cls_008">IP address:</span></div>
<div style="position:absolute;left:144.00px;top:586.12px" class="cls_024"><span class="cls_024">/ # ping c4</span></div>
<div style="position:absolute;left:144.00px;top:601.24px" class="cls_024"><span class="cls_024">PING c4 (10.1.0.3): 56 data bytes</span></div>
<div style="position:absolute;left:144.00px;top:616.36px" class="cls_024"><span class="cls_024">64 bytes from 10.1.0.3: seq=0 ttl=64 time=0.192 ms</span></div>
<div style="position:absolute;left:144.00px;top:631.48px" class="cls_024"><span class="cls_024">64 bytes from 10.1.0.3: seq=1 ttl=64 time=0.148 ms</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 139 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:124310px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background163.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The following is the result of the ping using the IP address of the container </span><span class="cls_010">c4</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:144.00px;top:135.43px" class="cls_024"><span class="cls_024">/ # ping 10.1.0.3</span></div>
<div style="position:absolute;left:144.00px;top:150.55px" class="cls_024"><span class="cls_024">PING 10.1.0.3 (10.1.0.3): 56 data bytes</span></div>
<div style="position:absolute;left:144.00px;top:165.67px" class="cls_024"><span class="cls_024">64 bytes from 10.1.0.3: seq=0 ttl=64 time=0.200 ms</span></div>
<div style="position:absolute;left:144.00px;top:180.79px" class="cls_024"><span class="cls_024">64 bytes from 10.1.0.3: seq=1 ttl=64 time=0.172 ms</span></div>
<div style="position:absolute;left:108.00px;top:215.65px" class="cls_008"><span class="cls_008">The answer in both cases confirms to us that the communication between containers</span></div>
<div style="position:absolute;left:108.00px;top:228.25px" class="cls_008"><span class="cls_008">attached to the same network is working as expected. The fact that we can even use</span></div>
<div style="position:absolute;left:108.00px;top:240.85px" class="cls_008"><span class="cls_008">the name of the container we want to connect to shows us that the name resolution</span></div>
<div style="position:absolute;left:108.00px;top:253.45px" class="cls_008"><span class="cls_008">provided by the Docker DNS service works inside this network.</span></div>
<div style="position:absolute;left:108.00px;top:274.69px" class="cls_008"><span class="cls_008">Now we want to make sure that the </span><span class="cls_010">bridge</span><span class="cls_008"> and the </span><span class="cls_010">test-net</span><span class="cls_008"> networks are</span></div>
<div style="position:absolute;left:108.00px;top:287.29px" class="cls_008"><span class="cls_008">firewalled from each other. To demonstrate this, we can try to ping the </span><span class="cls_010">c2</span><span class="cls_008"> container</span></div>
<div style="position:absolute;left:108.00px;top:299.89px" class="cls_008"><span class="cls_008">from the </span><span class="cls_010">c3</span><span class="cls_008"> container, either by its name or by its IP address:</span></div>
<div style="position:absolute;left:144.00px;top:320.83px" class="cls_024"><span class="cls_024">/ # ping c2</span></div>
<div style="position:absolute;left:144.00px;top:335.95px" class="cls_024"><span class="cls_024">ping: bad address 'c2'</span></div>
<div style="position:absolute;left:108.00px;top:355.69px" class="cls_008"><span class="cls_008">The following is the result of the ping using the IP address of the target container </span><span class="cls_010">c2</span></div>
<div style="position:absolute;left:108.00px;top:368.29px" class="cls_008"><span class="cls_008">instead:</span></div>
<div style="position:absolute;left:144.00px;top:389.23px" class="cls_024"><span class="cls_024">/ # ping 172.17.0.3</span></div>
<div style="position:absolute;left:144.00px;top:404.35px" class="cls_024"><span class="cls_024">PING 172.17.0.3 (172.17.0.3): 56 data bytes</span></div>
<div style="position:absolute;left:144.00px;top:419.47px" class="cls_024"><span class="cls_024">^C</span></div>
<div style="position:absolute;left:144.00px;top:434.59px" class="cls_024"><span class="cls_024">--- 172.17.0.3 ping statistics ---</span></div>
<div style="position:absolute;left:144.00px;top:449.71px" class="cls_024"><span class="cls_024">43 packets transmitted, 0 packets received, 100% packet loss</span></div>
<div style="position:absolute;left:108.00px;top:469.45px" class="cls_008"><span class="cls_008">The preceding command remained hanging and I had to terminate the command</span></div>
<div style="position:absolute;left:108.00px;top:482.05px" class="cls_008"><span class="cls_008">with </span><span class="cls_021">Ctrl</span><span class="cls_008">+</span><span class="cls_021">C</span><span class="cls_008">. From the answer to pinging </span><span class="cls_010">c2</span><span class="cls_008">, we can also see that the name resolution</span></div>
<div style="position:absolute;left:108.00px;top:494.65px" class="cls_008"><span class="cls_008">does not work across networks. This is the expected behavior. Networks provide an</span></div>
<div style="position:absolute;left:108.00px;top:507.25px" class="cls_008"><span class="cls_008">extra layer of isolation, and thus security, to containers.</span></div>
<div style="position:absolute;left:108.00px;top:528.50px" class="cls_008"><span class="cls_008">Earlier, we learned that a container can be attached to multiple networks. Let's attach</span></div>
<div style="position:absolute;left:108.00px;top:541.09px" class="cls_008"><span class="cls_008">a </span><span class="cls_010">c5</span><span class="cls_008"> container to the </span><span class="cls_010">sample-net</span><span class="cls_008"> and </span><span class="cls_010">test-net</span><span class="cls_008"> networks at the same time:</span></div>
<div style="position:absolute;left:144.00px;top:562.03px" class="cls_024"><span class="cls_024">$ docker container run --name c5 -d \</span></div>
<div style="position:absolute;left:165.60px;top:577.15px" class="cls_024"><span class="cls_024">--network sample-net \</span></div>
<div style="position:absolute;left:165.60px;top:592.27px" class="cls_024"><span class="cls_024">--network test-net \</span></div>
<div style="position:absolute;left:165.60px;top:607.39px" class="cls_024"><span class="cls_024">alpine:latest ping 127.0.0.1</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 140 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:125112px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background164.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can then test that </span><span class="cls_010">c5</span><span class="cls_008"> is reachable from the </span><span class="cls_010">c2</span><span class="cls_008"> container similar to when we</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">tested the same for containers </span><span class="cls_010">c4</span><span class="cls_008"> and </span><span class="cls_010">c2</span><span class="cls_008">. The result will show that the connection</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">indeed works.</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_008"><span class="cls_008">If we want to remove an existing network, we can use the </span><span class="cls_010">docker network rm</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_008"><span class="cls_008">command, but note that one cannot accidentally delete a network that has containers</span></div>
<div style="position:absolute;left:108.00px;top:186.13px" class="cls_008"><span class="cls_008">attached to it:</span></div>
<div style="position:absolute;left:144.00px;top:207.07px" class="cls_024"><span class="cls_024">$ docker network rm test-net</span></div>
<div style="position:absolute;left:144.00px;top:222.19px" class="cls_024"><span class="cls_024">Error response from daemon: network test-net id 863192... has</span></div>
<div style="position:absolute;left:144.00px;top:232.99px" class="cls_024"><span class="cls_024">active endpoints</span></div>
<div style="position:absolute;left:108.00px;top:252.73px" class="cls_008"><span class="cls_008">Before we continue, let's clean up and remove all containers:</span></div>
<div style="position:absolute;left:144.00px;top:273.67px" class="cls_024"><span class="cls_024">$ docker container rm -f $(docker container ls -aq)</span></div>
<div style="position:absolute;left:108.00px;top:293.41px" class="cls_008"><span class="cls_008">Then we remove the two custom networks that we created:</span></div>
<div style="position:absolute;left:144.00px;top:314.35px" class="cls_024"><span class="cls_024">$ docker network rm sample-net</span></div>
<div style="position:absolute;left:144.00px;top:329.47px" class="cls_024"><span class="cls_024">$ docker network rm test-net</span></div>
<div style="position:absolute;left:108.00px;top:360.47px" class="cls_011"><span class="cls_011">The host network</span></div>
<div style="position:absolute;left:108.00px;top:385.45px" class="cls_008"><span class="cls_008">There exist occasions where we want to run a container in the network namespace</span></div>
<div style="position:absolute;left:108.00px;top:398.05px" class="cls_008"><span class="cls_008">of the host. This can be necessary when we need to run some software in a container</span></div>
<div style="position:absolute;left:108.00px;top:410.65px" class="cls_008"><span class="cls_008">that is used to analyze or debug the host network's traffic. But keep in mind that these</span></div>
<div style="position:absolute;left:108.00px;top:423.25px" class="cls_008"><span class="cls_008">are very specific scenarios. When running business software in containers, there is no</span></div>
<div style="position:absolute;left:108.00px;top:435.85px" class="cls_008"><span class="cls_008">good reason to ever run the respective containers attached to the host's network. For</span></div>
<div style="position:absolute;left:108.00px;top:448.45px" class="cls_008"><span class="cls_008">security reasons, it is strongly recommended that you do not run any such container</span></div>
<div style="position:absolute;left:108.00px;top:461.05px" class="cls_008"><span class="cls_008">attached to the host network on a production or production-like environment.</span></div>
<div style="position:absolute;left:108.00px;top:482.30px" class="cls_008"><span class="cls_008">That said, </span><span class="cls_021">how can we run a container inside the network namespace of the host?</span><span class="cls_008"> Simply by</span></div>
<div style="position:absolute;left:108.00px;top:494.89px" class="cls_008"><span class="cls_008">attaching the container to the </span><span class="cls_010">host</span><span class="cls_008"> network:</span></div>
<div style="position:absolute;left:144.00px;top:515.83px" class="cls_024"><span class="cls_024">$ docker container run --rm -it --network host alpine:latest /bin/</span></div>
<div style="position:absolute;left:144.00px;top:526.63px" class="cls_024"><span class="cls_024">sh</span></div>
<div style="position:absolute;left:108.00px;top:546.37px" class="cls_008"><span class="cls_008">If we now use the </span><span class="cls_010">ip</span><span class="cls_008"> tool to analyze the network namespace from within the</span></div>
<div style="position:absolute;left:108.00px;top:558.97px" class="cls_008"><span class="cls_008">container, we will see that we get exactly the same picture as we would if we were</span></div>
<div style="position:absolute;left:108.00px;top:571.57px" class="cls_008"><span class="cls_008">running the </span><span class="cls_010">ip</span><span class="cls_008"> tool directly on the host. For example, if I inspect the </span><span class="cls_010">eth0</span><span class="cls_008"> device on</span></div>
<div style="position:absolute;left:108.00px;top:584.17px" class="cls_008"><span class="cls_008">my host, I get this:</span></div>
<div style="position:absolute;left:144.00px;top:605.11px" class="cls_024"><span class="cls_024">/ # ip addr show eth0</span></div>
<div style="position:absolute;left:144.00px;top:620.23px" class="cls_024"><span class="cls_024">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_</span></div>
<div style="position:absolute;left:144.00px;top:631.03px" class="cls_024"><span class="cls_024">fast state UP qlen 1000</span></div>
<div style="position:absolute;left:165.60px;top:646.15px" class="cls_024"><span class="cls_024">link/ether 02:50:00:00:00:01 brd</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 141 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:125914px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background165.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:165.60px;top:114.01px" class="cls_024"><span class="cls_024">ff:ff:ff:ff:ff:ff</span></div>
<div style="position:absolute;left:165.60px;top:129.13px" class="cls_024"><span class="cls_024">inet 192.168.65.3/24 brd 192.168.65.255 scope</span></div>
<div style="position:absolute;left:165.60px;top:144.25px" class="cls_024"><span class="cls_024">global eth0</span></div>
<div style="position:absolute;left:181.80px;top:159.37px" class="cls_024"><span class="cls_024">valid_lft forever preferred_lft forever</span></div>
<div style="position:absolute;left:165.60px;top:174.49px" class="cls_024"><span class="cls_024">inet6 fe80::c90b:4219:ddbd:92bf/64 scope link</span></div>
<div style="position:absolute;left:181.80px;top:189.61px" class="cls_024"><span class="cls_024">valid_lft forever preferred_lft forever</span></div>
<div style="position:absolute;left:108.00px;top:209.34px" class="cls_008"><span class="cls_008">Here, I find that </span><span class="cls_010">192.168.65.3</span><span class="cls_008"> is the IP address that the host has been assigned and</span></div>
<div style="position:absolute;left:108.00px;top:221.94px" class="cls_008"><span class="cls_008">that the MAC address shown here also corresponds to that of the host.</span></div>
<div style="position:absolute;left:108.00px;top:243.18px" class="cls_008"><span class="cls_008">We can also inspect the routes to get the following (shortened):</span></div>
<div style="position:absolute;left:144.00px;top:264.12px" class="cls_024"><span class="cls_024">/ # ip route</span></div>
<div style="position:absolute;left:144.00px;top:279.24px" class="cls_024"><span class="cls_024">default via 192.168.65.1 dev eth0 src 192.168.65.3 metric 202</span></div>
<div style="position:absolute;left:144.00px;top:294.36px" class="cls_024"><span class="cls_024">10.1.0.0/16 dev cni0 scope link src 10.1.0.1</span></div>
<div style="position:absolute;left:144.00px;top:309.48px" class="cls_024"><span class="cls_024">127.0.0.0/8 dev lo scope host</span></div>
<div style="position:absolute;left:144.00px;top:324.60px" class="cls_024"><span class="cls_024">172.17.0.0/16 dev docker0 scope link src 172.17.0.1</span></div>
<div style="position:absolute;left:144.00px;top:354.84px" class="cls_024"><span class="cls_024">192.168.65.0/24 dev eth0 scope link src 192.168.65.3 metric 202</span></div>
<div style="position:absolute;left:108.00px;top:374.58px" class="cls_008"><span class="cls_008">Before I let you go on to the next section of this chapter, I want to once more</span></div>
<div style="position:absolute;left:108.00px;top:387.18px" class="cls_008"><span class="cls_008">point out that the use of the </span><span class="cls_010">host</span><span class="cls_008"> network is dangerous and needs to be avoided</span></div>
<div style="position:absolute;left:107.99px;top:399.78px" class="cls_008"><span class="cls_008">if possible.</span></div>
<div style="position:absolute;left:108.00px;top:432.28px" class="cls_011"><span class="cls_011">The null network</span></div>
<div style="position:absolute;left:108.00px;top:457.26px" class="cls_008"><span class="cls_008">Sometimes, we need to run a few application services or jobs that do not need any</span></div>
<div style="position:absolute;left:108.00px;top:469.86px" class="cls_008"><span class="cls_008">network connection at all to execute the task. It is strongly advised that you run</span></div>
<div style="position:absolute;left:108.00px;top:482.46px" class="cls_008"><span class="cls_008">those applications in a container that is attached to the </span><span class="cls_010">none</span><span class="cls_008"> network. This container</span></div>
<div style="position:absolute;left:108.00px;top:495.06px" class="cls_008"><span class="cls_008">will be completely isolated, and thus safe from any outside access. Let's run such</span></div>
<div style="position:absolute;left:108.00px;top:507.66px" class="cls_008"><span class="cls_008">a container:</span></div>
<div style="position:absolute;left:144.00px;top:528.60px" class="cls_024"><span class="cls_024">$ docker container run --rm -it --network none alpine:latest /bin/</span></div>
<div style="position:absolute;left:144.00px;top:539.40px" class="cls_024"><span class="cls_024">sh</span></div>
<div style="position:absolute;left:108.00px;top:559.14px" class="cls_008"><span class="cls_008">Once inside the container, we can verify that there is no </span><span class="cls_010">eth0</span><span class="cls_008"> network endpoint</span></div>
<div style="position:absolute;left:108.00px;top:571.74px" class="cls_008"><span class="cls_008">available:</span></div>
<div style="position:absolute;left:144.00px;top:592.68px" class="cls_024"><span class="cls_024">/ # ip addr show eth0</span></div>
<div style="position:absolute;left:144.00px;top:607.80px" class="cls_024"><span class="cls_024">ip: can't find device 'eth0'</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 142 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:126716px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background166.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">There is also no routing information available, as we can demonstrate by using the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:144.00px;top:148.03px" class="cls_024"><span class="cls_024">/ # ip route</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">This returns nothing.</span></div>
<div style="position:absolute;left:108.00px;top:200.27px" class="cls_011"><span class="cls_011">Running in an existing network</span></div>
<div style="position:absolute;left:108.00px;top:224.27px" class="cls_011"><span class="cls_011">namespace</span></div>
<div style="position:absolute;left:108.00px;top:249.25px" class="cls_008"><span class="cls_008">Normally, Docker creates a new network namespace for each container we run. The</span></div>
<div style="position:absolute;left:108.00px;top:261.85px" class="cls_008"><span class="cls_008">network namespace of the container corresponds to the sandbox of the container</span></div>
<div style="position:absolute;left:108.00px;top:274.45px" class="cls_008"><span class="cls_008">network model we described earlier on. As we attach the container to a network, we</span></div>
<div style="position:absolute;left:108.00px;top:287.05px" class="cls_008"><span class="cls_008">define an endpoint that connects the container network namespace with the actual</span></div>
<div style="position:absolute;left:108.00px;top:299.65px" class="cls_008"><span class="cls_008">network. This way, we have one container per network namespace.</span></div>
<div style="position:absolute;left:108.00px;top:320.90px" class="cls_008"><span class="cls_008">Docker provides an additional way to define the network namespace in which a</span></div>
<div style="position:absolute;left:108.00px;top:333.50px" class="cls_008"><span class="cls_008">container runs. When creating a new container, we can specify that it should be</span></div>
<div style="position:absolute;left:108.00px;top:346.10px" class="cls_008"><span class="cls_008">attached to or maybe we should say included in the network namespace of an</span></div>
<div style="position:absolute;left:108.00px;top:358.70px" class="cls_008"><span class="cls_008">existing container. With this technique, we can run multiple containers in a single</span></div>
<div style="position:absolute;left:108.00px;top:371.30px" class="cls_008"><span class="cls_008">network namespace:</span></div>
<div style="position:absolute;left:200.62px;top:529.57px" class="cls_026"><span class="cls_026">Multiple containers running in a single network namespace</span></div>
<div style="position:absolute;left:108.00px;top:548.31px" class="cls_008"><span class="cls_008">In the preceding diagram, we can see that in the leftmost network namespace, we</span></div>
<div style="position:absolute;left:108.00px;top:560.91px" class="cls_008"><span class="cls_008">have two containers. The two containers, since they share the same namespace, can</span></div>
<div style="position:absolute;left:108.00px;top:573.51px" class="cls_008"><span class="cls_008">communicate on localhost with each other. The network namespace (and not the</span></div>
<div style="position:absolute;left:108.00px;top:586.11px" class="cls_008"><span class="cls_008">individual containers) is then attached to </span><span class="cls_009">Network 1</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 143 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:127518px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background167.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This is useful when we want to debug the network of an existing container without</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">running additional processes inside that container. We can just attach a special utility</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">container to the network namespace of the container to inspect. This feature is also</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">used by Kubernetes when it creates a pod. We will hear more about Kubernetes and</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">pods in subsequent chapters of this book.</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">Now, let's demonstrate how this works.</span></div>
<div style="position:absolute;left:126.00px;top:207.38px" class="cls_008"><span class="cls_008">1.  First, we create a new bridge network:</span></div>
<div style="position:absolute;left:144.00px;top:223.99px" class="cls_024"><span class="cls_024">$ docker network create --driver bridge test-net</span></div>
<div style="position:absolute;left:126.00px;top:243.73px" class="cls_008"><span class="cls_008">2.  Next, we run a container attached to this network:</span></div>
<div style="position:absolute;left:144.00px;top:260.35px" class="cls_024"><span class="cls_024">$ docker container run --name web -d --network test-net</span></div>
<div style="position:absolute;left:144.00px;top:271.15px" class="cls_024"><span class="cls_024">nginx:alpine</span></div>
<div style="position:absolute;left:126.00px;top:290.89px" class="cls_008"><span class="cls_008">3.  Finally, we run another container and attach it to the network of our </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:144.00px;top:303.49px" class="cls_008"><span class="cls_008">container:</span></div>
<div style="position:absolute;left:144.00px;top:320.11px" class="cls_024"><span class="cls_024">$ docker container run -it --rm --network container:web</span></div>
<div style="position:absolute;left:144.00px;top:330.91px" class="cls_024"><span class="cls_024">alpine:latest /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:350.65px" class="cls_008"><span class="cls_008">Specifically, note how we define the network: </span><span class="cls_010">--network container:web</span><span class="cls_008">. This</span></div>
<div style="position:absolute;left:108.00px;top:363.25px" class="cls_008"><span class="cls_008">tells Docker that our new container shall use the same network namespace as the</span></div>
<div style="position:absolute;left:108.00px;top:375.85px" class="cls_008"><span class="cls_008">container called </span><span class="cls_010">web</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:397.10px" class="cls_008"><span class="cls_008">Since the new container is in the same network namespace as the web container</span></div>
<div style="position:absolute;left:108.00px;top:409.70px" class="cls_008"><span class="cls_008">running Nginx, we're now able to access Nginx on localhost! We can prove this by</span></div>
<div style="position:absolute;left:108.00px;top:422.29px" class="cls_008"><span class="cls_008">using the </span><span class="cls_010">wget</span><span class="cls_008"> tool, which is part of the Alpine container, to connect to Nginx. We</span></div>
<div style="position:absolute;left:108.00px;top:434.89px" class="cls_008"><span class="cls_008">should see the following:</span></div>
<div style="position:absolute;left:144.00px;top:455.83px" class="cls_023"><span class="cls_023">/ # wget -qO - localhost</span></div>
<div style="position:absolute;left:144.00px;top:468.07px" class="cls_023"><span class="cls_023">&lt;!DOCTYPE html></span></div>
<div style="position:absolute;left:144.00px;top:480.31px" class="cls_023"><span class="cls_023">&lt;html></span></div>
<div style="position:absolute;left:144.00px;top:492.55px" class="cls_023"><span class="cls_023">&lt;head></span></div>
<div style="position:absolute;left:144.00px;top:504.79px" class="cls_023"><span class="cls_023">&lt;title>Welcome to nginx!&lt;/title></span></div>
<div style="position:absolute;left:144.00px;top:529.27px" class="cls_023"><span class="cls_023">&lt;/html></span></div>
<div style="position:absolute;left:108.00px;top:549.01px" class="cls_008"><span class="cls_008">Note that we have shortened the output for readability. Please also note that there</span></div>
<div style="position:absolute;left:108.00px;top:561.61px" class="cls_008"><span class="cls_008">is an important difference between running two containers attached to the same</span></div>
<div style="position:absolute;left:108.00px;top:574.21px" class="cls_008"><span class="cls_008">network and two containers running in the same network namespace. In both cases,</span></div>
<div style="position:absolute;left:108.00px;top:586.81px" class="cls_008"><span class="cls_008">the containers can freely communicate with each other, but in the latter case, the</span></div>
<div style="position:absolute;left:108.00px;top:599.41px" class="cls_008"><span class="cls_008">communication happens over localhost.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 144 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:128320px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background168.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To clean up the container and network we can use the following command:</span></div>
<div style="position:absolute;left:144.00px;top:135.43px" class="cls_024"><span class="cls_024">$ docker container rm --force web</span></div>
<div style="position:absolute;left:144.00px;top:146.23px" class="cls_024"><span class="cls_024">$ docker network rm test-net</span></div>
<div style="position:absolute;left:108.00px;top:177.23px" class="cls_011"><span class="cls_011">Port management</span></div>
<div style="position:absolute;left:108.00px;top:202.21px" class="cls_008"><span class="cls_008">Now that we know how we can isolate or firewall containers from each other by</span></div>
<div style="position:absolute;left:108.00px;top:214.81px" class="cls_008"><span class="cls_008">placing them on different networks, and that we can have a container attached to</span></div>
<div style="position:absolute;left:108.00px;top:227.41px" class="cls_008"><span class="cls_008">more than one network, we have one problem that remains unsolved. </span><span class="cls_021">How can we</span></div>
<div style="position:absolute;left:108.00px;top:240.01px" class="cls_021"><span class="cls_021">expose an application service to the outside world?</span><span class="cls_008"> Imagine a container running a web</span></div>
<div style="position:absolute;left:108.00px;top:252.61px" class="cls_008"><span class="cls_008">server hosting our webAPI from before. We want customers from the internet to</span></div>
<div style="position:absolute;left:108.00px;top:265.21px" class="cls_008"><span class="cls_008">be able to access this API. We have designed it to be a publicly accessible API. To</span></div>
<div style="position:absolute;left:108.00px;top:277.81px" class="cls_008"><span class="cls_008">achieve this, we have to, figuratively speaking, open a gate in our firewall through</span></div>
<div style="position:absolute;left:108.00px;top:290.41px" class="cls_008"><span class="cls_008">which we can funnel external traffic to our API. For security reasons, we don't just</span></div>
<div style="position:absolute;left:108.00px;top:303.01px" class="cls_008"><span class="cls_008">want to open the doors wide, but to have only a single controlled gate through</span></div>
<div style="position:absolute;left:108.00px;top:315.61px" class="cls_008"><span class="cls_008">which traffic flows.</span></div>
<div style="position:absolute;left:108.00px;top:336.86px" class="cls_008"><span class="cls_008">We can create such a gate by mapping a container port to an available port on the</span></div>
<div style="position:absolute;left:108.00px;top:349.46px" class="cls_008"><span class="cls_008">host. We're also calling this container port to publish a port. Remember, the container</span></div>
<div style="position:absolute;left:108.00px;top:362.06px" class="cls_008"><span class="cls_008">has its own virtual network stack, as does the host. Therefore, container ports and</span></div>
<div style="position:absolute;left:108.00px;top:374.66px" class="cls_008"><span class="cls_008">host ports exist completely independently, and by default have nothing in common</span></div>
<div style="position:absolute;left:108.00px;top:387.26px" class="cls_008"><span class="cls_008">at all. But we can now wire a container port with a free host port and funnel external</span></div>
<div style="position:absolute;left:108.00px;top:399.86px" class="cls_008"><span class="cls_008">traffic through this link, as illustrated in the following screenshot:</span></div>
<div style="position:absolute;left:238.78px;top:601.05px" class="cls_026"><span class="cls_026">Mapping container ports to host ports</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 145 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:129122px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background169.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">But now it is time to demonstrate how one can actually map a container port to</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">a host port. This is done when creating a container. We have different ways of</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">doing so:</span></div>
<div style="position:absolute;left:126.00px;top:160.94px" class="cls_008"><span class="cls_008">•  First, we can let Docker decide which host port our container port shall be</span></div>
<div style="position:absolute;left:143.99px;top:173.54px" class="cls_008"><span class="cls_008">mapped to. Docker will then select one of the free host ports in the range of</span></div>
<div style="position:absolute;left:143.99px;top:186.13px" class="cls_008"><span class="cls_008">32xxx. This automatic mapping is done by using the </span><span class="cls_010">-P</span><span class="cls_008">  parameter:</span></div>
<div style="position:absolute;left:165.60px;top:207.07px" class="cls_024"><span class="cls_024">$ docker container run --name web -P -d nginx:alpine</span></div>
<div style="position:absolute;left:144.00px;top:226.81px" class="cls_008"><span class="cls_008">The preceding command runs an Nginx server in a container. Nginx is</span></div>
<div style="position:absolute;left:144.00px;top:239.41px" class="cls_008"><span class="cls_008">listening at port </span><span class="cls_010">80</span><span class="cls_008"> inside the container. With the </span><span class="cls_010">-P</span><span class="cls_008"> parameter, we're telling</span></div>
<div style="position:absolute;left:144.00px;top:252.01px" class="cls_008"><span class="cls_008">Docker to map all the exposed container ports to a free port in the 32xxx</span></div>
<div style="position:absolute;left:144.00px;top:264.61px" class="cls_008"><span class="cls_008">range. We can find out which host port Docker is using by using the </span><span class="cls_010">docker</span></div>
<div style="position:absolute;left:144.00px;top:277.21px" class="cls_010"><span class="cls_010">container port</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:165.60px;top:293.83px" class="cls_024"><span class="cls_024">$ docker container port web</span></div>
<div style="position:absolute;left:165.60px;top:308.95px" class="cls_024"><span class="cls_024">80/tcp -> 0.0.0.0:32768</span></div>
<div style="position:absolute;left:144.00px;top:328.69px" class="cls_008"><span class="cls_008">The Nginx container only exposes port </span><span class="cls_010">80</span><span class="cls_008">, and we can see that it has been</span></div>
<div style="position:absolute;left:144.00px;top:341.29px" class="cls_008"><span class="cls_008">mapped to the host port </span><span class="cls_010">32768</span><span class="cls_008">. If we open a new browser window and</span></div>
<div style="position:absolute;left:144.00px;top:353.89px" class="cls_008"><span class="cls_008">navigate to </span><span class="cls_010">localhost:32768</span><span class="cls_008">, we should see the following screenshot:</span></div>
<div style="position:absolute;left:256.32px;top:530.52px" class="cls_026"><span class="cls_026">The welcome page of Nginx</span></div>
<div style="position:absolute;left:126.00px;top:549.26px" class="cls_008"><span class="cls_008">•  An alternative way to find out which host port Docker is using for our</span></div>
<div style="position:absolute;left:144.00px;top:561.86px" class="cls_008"><span class="cls_008">container is to inspect it. The host port is part of the </span><span class="cls_010">NetworkSettings</span><span class="cls_008"> node:</span></div>
<div style="position:absolute;left:165.60px;top:578.48px" class="cls_024"><span class="cls_024">$ docker container inspect web | grep HostPort</span></div>
<div style="position:absolute;left:165.60px;top:593.60px" class="cls_024"><span class="cls_024">"HostPort": "32768"</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 146 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:129924px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background170.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 7</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•  Finally, the third way of getting this information is to list the container:</span></div>
<div style="position:absolute;left:165.60px;top:131.11px" class="cls_024"><span class="cls_024">$ docker container ls</span></div>
<div style="position:absolute;left:165.60px;top:146.23px" class="cls_024"><span class="cls_024">CONTAINER ID</span></div>
<div style="position:absolute;left:252.00px;top:146.23px" class="cls_024"><span class="cls_024">IMAGE</span></div>
<div style="position:absolute;left:165.60px;top:161.35px" class="cls_024"><span class="cls_024">PORTS</span></div>
<div style="position:absolute;left:289.80px;top:161.35px" class="cls_024"><span class="cls_024">NAMES</span></div>
<div style="position:absolute;left:165.60px;top:176.47px" class="cls_024"><span class="cls_024">56e46a14b6f7</span></div>
<div style="position:absolute;left:252.00px;top:176.47px" class="cls_024"><span class="cls_024">nginx:alpine  ...</span></div>
<div style="position:absolute;left:360.00px;top:176.47px" class="cls_024"><span class="cls_024">0.0.0.0:32768->80/tcp  web</span></div>
<div style="position:absolute;left:108.00px;top:196.21px" class="cls_008"><span class="cls_008">Please note that in the preceding output, the </span><span class="cls_010">/tcp</span><span class="cls_008"> part tells us that the port has been</span></div>
<div style="position:absolute;left:108.00px;top:208.81px" class="cls_008"><span class="cls_008">opened for communication with the TCP protocol, but not for the UDP protocol. TCP</span></div>
<div style="position:absolute;left:108.00px;top:221.41px" class="cls_008"><span class="cls_008">is the default, and if we want to specify that we want to open the port for UDP, then</span></div>
<div style="position:absolute;left:108.00px;top:234.01px" class="cls_008"><span class="cls_008">we have to specify this explicitly. The </span><span class="cls_010">0.0.0.0</span><span class="cls_008"> in the mapping tells us that traffic</span></div>
<div style="position:absolute;left:108.00px;top:246.61px" class="cls_008"><span class="cls_008">from any host IP address can now reach the container port </span><span class="cls_010">80</span><span class="cls_008"> of the </span><span class="cls_010">web</span><span class="cls_008"> container.</span></div>
<div style="position:absolute;left:108.00px;top:267.86px" class="cls_008"><span class="cls_008">Sometimes, we want to map a container port to a very specific host port. We can do</span></div>
<div style="position:absolute;left:108.00px;top:280.45px" class="cls_008"><span class="cls_008">this by using the  parameter</span><span class="cls_010">-p</span><span class="cls_008"> (or </span><span class="cls_010">--publish</span><span class="cls_008">). Let's look at how this is done with the</span></div>
<div style="position:absolute;left:108.00px;top:293.05px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:144.00px;top:313.99px" class="cls_024"><span class="cls_024">$ docker container run --name web2 -p 8080:80 -d nginx:alpine</span></div>
<div style="position:absolute;left:108.00px;top:333.73px" class="cls_008"><span class="cls_008">The value of the </span><span class="cls_010">-p</span><span class="cls_008"> parameter is in the form of </span><span class="cls_010">&lt;host port>:&lt;container port></span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:346.33px" class="cls_008"><span class="cls_008">Therefore, in the preceding case, we map container port </span><span class="cls_010">80</span><span class="cls_008"> to host port </span><span class="cls_010">8080</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:358.93px" class="cls_008"><span class="cls_008">Once the </span><span class="cls_010">web2</span><span class="cls_008"> container runs, we can test it in the browser by navigating to</span></div>
<div style="position:absolute;left:108.00px;top:371.53px" class="cls_010"><span class="cls_010">localhost:8080</span><span class="cls_008">, and we should be greeted by the same Nginx welcome page</span></div>
<div style="position:absolute;left:108.00px;top:384.13px" class="cls_008"><span class="cls_008">that we saw in the previous example that dealt with automatic port mapping.</span></div>
<div style="position:absolute;left:108.00px;top:405.38px" class="cls_008"><span class="cls_008">When using the UDP protocol for communication over a certain port, then the</span></div>
<div style="position:absolute;left:108.00px;top:417.97px" class="cls_010"><span class="cls_010">publish</span><span class="cls_008"> parameter will look like </span><span class="cls_010">-p 3000:4321/udp</span><span class="cls_008">. Note that if we want to allow</span></div>
<div style="position:absolute;left:108.00px;top:430.57px" class="cls_008"><span class="cls_008">communication with both TCP and UDP protocols over the same port, then we have</span></div>
<div style="position:absolute;left:108.00px;top:443.17px" class="cls_008"><span class="cls_008">to map each protocol separately.</span></div>
<div style="position:absolute;left:108.00px;top:475.67px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:500.65px" class="cls_008"><span class="cls_008">In this chapter, we have learned about how containers running on a single host</span></div>
<div style="position:absolute;left:108.00px;top:513.25px" class="cls_008"><span class="cls_008">can communicate with each other. First, we looked at the CNM that defines the</span></div>
<div style="position:absolute;left:108.00px;top:525.85px" class="cls_008"><span class="cls_008">requirements of a container network and then we looked at several implementations</span></div>
<div style="position:absolute;left:108.00px;top:538.45px" class="cls_008"><span class="cls_008">of the CNM, such as the bridge network. We then looked at how the bridge network</span></div>
<div style="position:absolute;left:108.00px;top:551.05px" class="cls_008"><span class="cls_008">functions in detail and also what kind of information Docker provides us with about</span></div>
<div style="position:absolute;left:108.00px;top:563.65px" class="cls_008"><span class="cls_008">the networks and the containers attached to those networks. We also learned about</span></div>
<div style="position:absolute;left:108.00px;top:576.25px" class="cls_008"><span class="cls_008">adopting two different perspectives, from both outside and inside the container.</span></div>
<div style="position:absolute;left:108.00px;top:597.50px" class="cls_008"><span class="cls_008">In the next chapter, we're going to introduce Docker Compose. We will learn</span></div>
<div style="position:absolute;left:108.00px;top:610.10px" class="cls_008"><span class="cls_008">about creating an application that consists of multiple services, each running in</span></div>
<div style="position:absolute;left:108.00px;top:622.70px" class="cls_008"><span class="cls_008">a container, and how Docker Compose allows us to easily build, run, and scale</span></div>
<div style="position:absolute;left:108.00px;top:635.30px" class="cls_008"><span class="cls_008">such an application using a declarative approach.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 147 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:130726px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background171.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Single-Host Networking</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">To assess your skills, please try to answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:158.14px" class="cls_008"><span class="cls_008">1.  Name the three core elements of the </span><span class="cls_009">container network model</span><span class="cls_008"> (</span><span class="cls_009">CNM</span><span class="cls_008">).</span></div>
<div style="position:absolute;left:126.00px;top:175.06px" class="cls_008"><span class="cls_008">2.  How will you create a custom bridge network called for example, frontend?</span></div>
<div style="position:absolute;left:126.00px;top:191.97px" class="cls_008"><span class="cls_008">3.  How will you run two nginx:alpine containers attached to the frontend</span></div>
<div style="position:absolute;left:143.99px;top:204.57px" class="cls_008"><span class="cls_008">network.</span></div>
<div style="position:absolute;left:126.00px;top:221.49px" class="cls_008"><span class="cls_008">4.  For the frontend network, get the following:</span></div>
<div style="position:absolute;left:161.99px;top:238.40px" class="cls_008"><span class="cls_008">1.  IPs of all attached containers.</span></div>
<div style="position:absolute;left:161.99px;top:255.32px" class="cls_008"><span class="cls_008">2.  The subnet associated with the network.</span></div>
<div style="position:absolute;left:125.99px;top:276.56px" class="cls_008"><span class="cls_008">5.  What is the purpose of the host network?</span></div>
<div style="position:absolute;left:125.99px;top:293.48px" class="cls_008"><span class="cls_008">6.  Name one or two scenarios where the use of the host network is appropriate.</span></div>
<div style="position:absolute;left:125.99px;top:310.39px" class="cls_008"><span class="cls_008">7.  What is the purpose of the none network?</span></div>
<div style="position:absolute;left:125.99px;top:327.31px" class="cls_008"><span class="cls_008">8.  In what scenarios should the none network be used?</span></div>
<div style="position:absolute;left:108.00px;top:359.84px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:384.82px" class="cls_008"><span class="cls_008">Here are some articles that describe the topics presented in this chapter in</span></div>
<div style="position:absolute;left:108.00px;top:397.42px" class="cls_008"><span class="cls_008">more detail:</span></div>
<div style="position:absolute;left:126.00px;top:418.66px" class="cls_008"><span class="cls_008">•  Docker networking overview at </span><A HREF="http://dockr.ly/2sXGzQn">http://dockr.ly/2sXGzQn</A> </span></div>
<div style="position:absolute;left:126.00px;top:435.58px" class="cls_008"><span class="cls_008">•  Container networking at </span><A HREF="http://dockr.ly/2HJfQKn">http://dockr.ly/2HJfQKn</A> </span></div>
<div style="position:absolute;left:126.00px;top:452.50px" class="cls_008"><span class="cls_008">•  What is a Bridge at </span><A HREF="https://bit.ly/2HyC3Od">https://bit.ly/2HyC3Od</A> </span></div>
<div style="position:absolute;left:126.00px;top:469.42px" class="cls_008"><span class="cls_008">•  Use bridge networks at </span><A HREF="http://dockr.ly/2BNxjRr">http://dockr.ly/2BNxjRr</A> </span></div>
<div style="position:absolute;left:126.00px;top:486.34px" class="cls_008"><span class="cls_008">•  Use Macvlan networks at </span><A HREF="http://dockr.ly/2ETjy2x">http://dockr.ly/2ETjy2x</A> </span></div>
<div style="position:absolute;left:126.00px;top:503.26px" class="cls_008"><span class="cls_008">•  Networking using the host network at </span><A HREF="http://dockr.ly/2F4aI59">http://dockr.ly/2F4aI59</A> </span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 148 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:131528px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background172.jpg" width=612 height=792></div>
<div style="position:absolute;left:272.25px;top:218.71px" class="cls_015"><span class="cls_015">Docker Compose</span></div>
<div style="position:absolute;left:108.00px;top:272.41px" class="cls_008"><span class="cls_008">In the previous chapter, we learned a lot about how container networking works on</span></div>
<div style="position:absolute;left:108.00px;top:285.01px" class="cls_008"><span class="cls_008">a single Docker host. We introduced the </span><span class="cls_009">Container Network Model</span><span class="cls_008"> (</span><span class="cls_009">CNM</span><span class="cls_008">), which</span></div>
<div style="position:absolute;left:108.00px;top:297.61px" class="cls_008"><span class="cls_008">forms the basis of all networking between Docker containers, and then we dove deep</span></div>
<div style="position:absolute;left:108.00px;top:310.21px" class="cls_008"><span class="cls_008">into different implementations of the CNM, specifically the bridge network.</span></div>
<div style="position:absolute;left:108.00px;top:331.46px" class="cls_008"><span class="cls_008">This chapter introduces the concept of an application consisting of multiple services,</span></div>
<div style="position:absolute;left:108.00px;top:344.06px" class="cls_008"><span class="cls_008">each running in a container, and how Docker Compose allows us to easily build, run,</span></div>
<div style="position:absolute;left:108.00px;top:356.66px" class="cls_008"><span class="cls_008">and scale such an application using a declarative approach.</span></div>
<div style="position:absolute;left:108.00px;top:377.90px" class="cls_008"><span class="cls_008">The chapter covers the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:399.14px" class="cls_008"><span class="cls_008">•  Demystifying declarative versus imperative</span></div>
<div style="position:absolute;left:126.00px;top:416.05px" class="cls_008"><span class="cls_008">•  Running a multi-service application</span></div>
<div style="position:absolute;left:126.00px;top:432.97px" class="cls_008"><span class="cls_008">•  Scaling a service</span></div>
<div style="position:absolute;left:126.00px;top:449.89px" class="cls_008"><span class="cls_008">•  Building and pushing an application</span></div>
<div style="position:absolute;left:107.99px;top:471.13px" class="cls_008"><span class="cls_008">After completing this chapter, the reader will be able to do the following:</span></div>
<div style="position:absolute;left:125.99px;top:492.37px" class="cls_008"><span class="cls_008">•  Explain in a few short sentences the main differences between an imperative</span></div>
<div style="position:absolute;left:143.98px;top:504.97px" class="cls_008"><span class="cls_008">and declarative approach for defining and running an application</span></div>
<div style="position:absolute;left:125.99px;top:521.88px" class="cls_008"><span class="cls_008">•  Describe in their own words the difference between a container and a Docker</span></div>
<div style="position:absolute;left:143.98px;top:534.48px" class="cls_008"><span class="cls_008">Compose service</span></div>
<div style="position:absolute;left:125.99px;top:551.40px" class="cls_008"><span class="cls_008">•  Author a Docker Compose YAML file for a simple multi-service application</span></div>
<div style="position:absolute;left:125.99px;top:568.31px" class="cls_008"><span class="cls_008">•  Build, push, deploy, and tear down a simple multi-service application using</span></div>
<div style="position:absolute;left:143.98px;top:580.91px" class="cls_008"><span class="cls_008">Docker Compose</span></div>
<div style="position:absolute;left:125.99px;top:597.83px" class="cls_008"><span class="cls_008">•  Use Docker Compose to scale an application service up and down</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 149 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:132330px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background173.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">The code accompanying this chapter can be found at. </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master/ch08">https://github.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_010"><span class="cls_010"> </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master/ch08">appswithdockerandkubernetes/labs/tree/master/ch08</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:182.00px" class="cls_011"><span class="cls_011">Demystifying declarative versus</span></div>
<div style="position:absolute;left:108.00px;top:206.00px" class="cls_011"><span class="cls_011">imperative</span></div>
<div style="position:absolute;left:108.00px;top:230.98px" class="cls_008"><span class="cls_008">Docker Compose is a tool provided by Docker that is mainly used where one needs</span></div>
<div style="position:absolute;left:108.00px;top:243.58px" class="cls_008"><span class="cls_008">to run and orchestrate containers running on a single Docker host. This includes but</span></div>
<div style="position:absolute;left:108.00px;top:256.18px" class="cls_008"><span class="cls_008">is not limited to development, </span><span class="cls_009">continuous integration</span><span class="cls_008"> (</span><span class="cls_009">CI</span><span class="cls_008">), automated testing, and</span></div>
<div style="position:absolute;left:108.00px;top:268.78px" class="cls_008"><span class="cls_008">manual QA.</span></div>
<div style="position:absolute;left:108.00px;top:290.02px" class="cls_008"><span class="cls_008">Docker Compose uses files formatted in YAML as input. By default, Docker</span></div>
<div style="position:absolute;left:108.00px;top:302.62px" class="cls_008"><span class="cls_008">Compose expects these files to be called </span><span class="cls_010">docker-compose.yml</span><span class="cls_008">, but other names are</span></div>
<div style="position:absolute;left:108.00px;top:315.22px" class="cls_008"><span class="cls_008">possible. The content of a </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> is said to be a </span><span class="cls_021">declarative</span><span class="cls_008"> way of</span></div>
<div style="position:absolute;left:108.00px;top:327.82px" class="cls_008"><span class="cls_008">describing and running a containerized application potentially consisting of more</span></div>
<div style="position:absolute;left:108.00px;top:340.42px" class="cls_008"><span class="cls_008">than a single container.</span></div>
<div style="position:absolute;left:108.00px;top:361.66px" class="cls_008"><span class="cls_008">So, </span><span class="cls_021">what is the meaning of declarative?</span></div>
<div style="position:absolute;left:108.00px;top:382.90px" class="cls_008"><span class="cls_008">First of all, </span><span class="cls_021">declarative</span><span class="cls_008"> is the antonym of </span><span class="cls_021">imperative</span><span class="cls_008">. Well, that doesn't help much. Now</span></div>
<div style="position:absolute;left:108.00px;top:395.50px" class="cls_008"><span class="cls_008">that I have introduced another definition, I need to explain both of them:</span></div>
<div style="position:absolute;left:126.00px;top:416.74px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Imperative</span><span class="cls_008">: It's a way in which we can solve problems by specifying the</span></div>
<div style="position:absolute;left:143.99px;top:429.35px" class="cls_008"><span class="cls_008">exact procedure which has to be followed by the system.</span></div>
<div style="position:absolute;left:143.99px;top:450.59px" class="cls_008"><span class="cls_008">If I tell a system such as the Docker daemon imperatively how to run an</span></div>
<div style="position:absolute;left:143.99px;top:463.19px" class="cls_008"><span class="cls_008">application then that means that I have to describe step by step what the</span></div>
<div style="position:absolute;left:143.99px;top:475.79px" class="cls_008"><span class="cls_008">system has to do and how it has to react if some unexpected situation occurs.</span></div>
<div style="position:absolute;left:143.99px;top:488.39px" class="cls_008"><span class="cls_008">I have to be very explicit and precise in my instructions. I need to cover all</span></div>
<div style="position:absolute;left:143.99px;top:500.99px" class="cls_008"><span class="cls_008">edge cases and how they need to be treated.</span></div>
<div style="position:absolute;left:126.00px;top:522.23px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Declarative</span><span class="cls_008">: It's a way in which we can solve problems without requiring the</span></div>
<div style="position:absolute;left:143.99px;top:534.83px" class="cls_008"><span class="cls_008">programmer to specify an exact procedure to be followed.</span></div>
<div style="position:absolute;left:143.99px;top:556.07px" class="cls_008"><span class="cls_008">A declarative approach means that I tell the Docker engine what my desired</span></div>
<div style="position:absolute;left:143.99px;top:568.67px" class="cls_008"><span class="cls_008">state for an application is and it has to figure out on its own how to achieve</span></div>
<div style="position:absolute;left:143.99px;top:581.27px" class="cls_008"><span class="cls_008">this desired state and how to reconcile it if the system deviates from it.</span></div>
<div style="position:absolute;left:107.99px;top:602.51px" class="cls_008"><span class="cls_008">Docker clearly recommends the declarative approach when dealing with</span></div>
<div style="position:absolute;left:107.99px;top:615.11px" class="cls_008"><span class="cls_008">containerized applications. Consequently, the Docker Compose tool uses this</span></div>
<div style="position:absolute;left:107.99px;top:627.71px" class="cls_008"><span class="cls_008">approach.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 150 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:133132px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background174.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 8</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Running a multi-service app</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">In most cases, applications do not consist of only one monolithic block, but rather of</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">several application services that work together. When using Docker containers, each</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">application service runs in its own container. When we want to run such a multi-</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">service application, we could start all the participating containers with the well-</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">known </span><span class="cls_010">docker container</span><span class="cls_008"> run command. But this is inefficient at best. With the</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">Docker Compose tool, we are given a way to define the application in a declarative</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">way in a file that uses the YAML format.</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_008"><span class="cls_008">Let's have a look at the content of a simple </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:126.00px;top:254.68px" class="cls_023"><span class="cls_023">version: "3.5"</span></div>
<div style="position:absolute;left:126.00px;top:266.92px" class="cls_023"><span class="cls_023">services:</span></div>
<div style="position:absolute;left:136.80px;top:279.16px" class="cls_023"><span class="cls_023">web:</span></div>
<div style="position:absolute;left:147.60px;top:291.40px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-</span></div>
<div style="position:absolute;left:147.60px;top:303.64px" class="cls_023"><span class="cls_023">web:1.0</span></div>
<div style="position:absolute;left:147.60px;top:315.88px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:158.40px;top:328.12px" class="cls_023"><span class="cls_023">- 3000:3000</span></div>
<div style="position:absolute;left:136.80px;top:340.36px" class="cls_023"><span class="cls_023">db:</span></div>
<div style="position:absolute;left:147.60px;top:352.60px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-db:1.0</span></div>
<div style="position:absolute;left:147.60px;top:364.84px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:158.40px;top:377.08px" class="cls_023"><span class="cls_023">- pets-data:/var/lib/postgresql/data</span></div>
<div style="position:absolute;left:126.00px;top:401.56px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:136.80px;top:413.80px" class="cls_023"><span class="cls_023">pets-data:</span></div>
<div style="position:absolute;left:108.00px;top:433.54px" class="cls_008"><span class="cls_008">The lines in the file are explained as follows:</span></div>
<div style="position:absolute;left:126.00px;top:454.78px" class="cls_008"><span class="cls_008">•</span><span class="cls_010">  version</span><span class="cls_008">: In this line, we specify the version of the Docker Compose format</span></div>
<div style="position:absolute;left:144.00px;top:467.38px" class="cls_008"><span class="cls_008">we want to use. At the time of writing, this is version 3.5.</span></div>
<div style="position:absolute;left:126.00px;top:484.30px" class="cls_008"><span class="cls_008">•</span><span class="cls_010">  services</span><span class="cls_008">: In this section, we specify the services that make up our</span></div>
<div style="position:absolute;left:144.00px;top:496.90px" class="cls_008"><span class="cls_008">application in the </span><span class="cls_010">services</span><span class="cls_008"> block. In our sample, we have two application</span></div>
<div style="position:absolute;left:144.00px;top:509.50px" class="cls_008"><span class="cls_008">services and we call them </span><span class="cls_010">web</span><span class="cls_008"> and </span><span class="cls_010">db</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:162.00px;top:526.42px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:526.42px" class="cls_010"><span class="cls_010">web</span><span class="cls_008">: The </span><span class="cls_010">web</span><span class="cls_008"> service is using the image</span></div>
<div style="position:absolute;left:180.00px;top:539.02px" class="cls_010"><span class="cls_010">appswithdockerandkubernetes/ch08-web:1.0</span><span class="cls_008"> from the Docker</span></div>
<div style="position:absolute;left:180.00px;top:551.62px" class="cls_008"><span class="cls_008">Hub and is publishing container port </span><span class="cls_010">3000</span><span class="cls_008"> to the host port, also </span><span class="cls_010">3000</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:162.00px;top:568.54px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:568.54px" class="cls_010"><span class="cls_010">db</span><span class="cls_008">: The </span><span class="cls_010">db</span><span class="cls_008"> service, on the other hand, is using the image</span></div>
<div style="position:absolute;left:180.00px;top:581.14px" class="cls_010"><span class="cls_010">appswithdockerandkubernetes/ch08-db:1.0</span><span class="cls_008">, which is a</span></div>
<div style="position:absolute;left:180.00px;top:593.74px" class="cls_008"><span class="cls_008">customized PostgreSQL database. We are mounting a volume called</span></div>
<div style="position:absolute;left:180.00px;top:606.34px" class="cls_010"><span class="cls_010">pets-data</span><span class="cls_008"> into the container of the </span><span class="cls_010">db</span><span class="cls_008"> service.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 151 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:133934px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background175.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•</span><span class="cls_010">  volumes</span><span class="cls_008">: The volumes used by any of the services have to be declared in</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">this section. In our sample, this is the last section of the file. The first time the</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">application is run, a volume called </span><span class="cls_010">pets-data</span><span class="cls_008"> will be created by Docker and</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">then, in subsequent runs, if the volume is still there, it will be reused. This</span></div>
<div style="position:absolute;left:144.00px;top:164.89px" class="cls_008"><span class="cls_008">could be important when the application, for some reason, crashes and has to</span></div>
<div style="position:absolute;left:144.00px;top:177.49px" class="cls_008"><span class="cls_008">be restarted. Then, the previous data is still around and ready to be used by</span></div>
<div style="position:absolute;left:144.00px;top:190.09px" class="cls_008"><span class="cls_008">the restarted database service.</span></div>
<div style="position:absolute;left:108.00px;top:211.33px" class="cls_008"><span class="cls_008">Navigate to the subfolder </span><span class="cls_010">ch08</span><span class="cls_008"> of the </span><span class="cls_010">labs</span><span class="cls_008"> folder and start the application using</span></div>
<div style="position:absolute;left:108.00px;top:223.93px" class="cls_008"><span class="cls_008">Docker Compose:</span></div>
<div style="position:absolute;left:126.00px;top:244.87px" class="cls_024"><span class="cls_024">$ docker-compose up</span></div>
<div style="position:absolute;left:108.00px;top:264.61px" class="cls_008"><span class="cls_008">If we enter the preceding command, then the tool will assume that there must be a</span></div>
<div style="position:absolute;left:108.00px;top:277.21px" class="cls_008"><span class="cls_008">file in the current directory called </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> and it will use that one to</span></div>
<div style="position:absolute;left:108.00px;top:289.81px" class="cls_008"><span class="cls_008">run. In our case, this is indeed the case and the application will start. We should see</span></div>
<div style="position:absolute;left:108.00px;top:302.41px" class="cls_008"><span class="cls_008">the output as follows:</span></div>
<div style="position:absolute;left:237.10px;top:640.49px" class="cls_026"><span class="cls_026">Running the sample application, part 1</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 152 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:134736px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background176.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 8</span></div>
<div style="position:absolute;left:237.10px;top:529.85px" class="cls_026"><span class="cls_026">Running the sample application, part 2</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 153 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:135538px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background177.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The preceding output is explained as follows:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  In the first part of the output, we can see how Docker Compose pulls the two</span></div>
<div style="position:absolute;left:143.99px;top:148.34px" class="cls_008"><span class="cls_008">images that constitute our application. This is followed by the creation of a</span></div>
<div style="position:absolute;left:143.99px;top:160.93px" class="cls_008"><span class="cls_008">network </span><span class="cls_010">ch08_default </span><span class="cls_008">and a volume </span><span class="cls_010">ch08_pets-data</span><span class="cls_008">, followed by the</span></div>
<div style="position:absolute;left:144.00px;top:173.53px" class="cls_008"><span class="cls_008">two containers </span><span class="cls_010">ch08_web_1</span><span class="cls_008"> and </span><span class="cls_010">ch08_db_1</span><span class="cls_008">, one for each service, </span><span class="cls_010">web</span><span class="cls_008"> and </span><span class="cls_010">db</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:144.00px;top:186.13px" class="cls_008"><span class="cls_008">All the names are automatically prefixed by Docker Compose with the name</span></div>
<div style="position:absolute;left:144.00px;top:198.73px" class="cls_008"><span class="cls_008">of the parent directory, which in this case is called </span><span class="cls_010">ch08</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:215.65px" class="cls_008"><span class="cls_008">•  After that, we see the logs produced by the two containers. Each line of</span></div>
<div style="position:absolute;left:144.00px;top:228.25px" class="cls_008"><span class="cls_008">the output is conveniently prefixed with the name of the service, and each</span></div>
<div style="position:absolute;left:144.00px;top:240.85px" class="cls_008"><span class="cls_008">service's output is in a different color. Here, the lion's share is produced by</span></div>
<div style="position:absolute;left:144.00px;top:253.45px" class="cls_008"><span class="cls_008">the database and only one line is from the </span><span class="cls_010">web</span><span class="cls_008"> service.</span></div>
<div style="position:absolute;left:108.00px;top:274.69px" class="cls_008"><span class="cls_008">We can now open a browser tab and navigate to </span><span class="cls_010">localhost:3000/pet</span><span class="cls_008">. We should</span></div>
<div style="position:absolute;left:108.00px;top:287.29px" class="cls_008"><span class="cls_008">be greeted by a nice cat image and some additional information about the container</span></div>
<div style="position:absolute;left:108.00px;top:299.89px" class="cls_008"><span class="cls_008">it came from, as shown in the following screenshot:</span></div>
<div style="position:absolute;left:238.16px;top:636.64px" class="cls_026"><span class="cls_026">The sample application in the browser</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 154 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:136340px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background178.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 8</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Refresh the browser a few times to see other cat images. The application selects</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">the current image randomly from a set of 12 images whose URLs are stored in</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the database.</span></div>
<div style="position:absolute;left:108.00px;top:160.94px" class="cls_008"><span class="cls_008">As the application is running in interactive mode and thus the Terminal where we</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">ran Docker Compose is blocked, we can cancel the application by pressing </span><span class="cls_021">Ctrl</span><span class="cls_008">+</span><span class="cls_021">C</span><span class="cls_008">. If</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">we do so, we will see the following:</span></div>
<div style="position:absolute;left:126.00px;top:207.07px" class="cls_024"><span class="cls_024">^CGracefully stopping... (press Ctrl+C again to force)</span></div>
<div style="position:absolute;left:126.00px;top:219.31px" class="cls_024"><span class="cls_024">Stopping ch08_web_1 ... done</span></div>
<div style="position:absolute;left:126.00px;top:231.55px" class="cls_024"><span class="cls_024">Stopping ch08_db_1 ... done</span></div>
<div style="position:absolute;left:108.00px;top:251.29px" class="cls_008"><span class="cls_008">We will notice that the database service stops immediately while the web service</span></div>
<div style="position:absolute;left:108.00px;top:263.89px" class="cls_008"><span class="cls_008">takes about 10 seconds to do so. The reason for this being that the database service</span></div>
<div style="position:absolute;left:108.00px;top:276.49px" class="cls_008"><span class="cls_008">listens to and reacts to the </span><span class="cls_010">SIGTERM</span><span class="cls_008"> signal sent by Docker while the web service</span></div>
<div style="position:absolute;left:108.00px;top:289.09px" class="cls_008"><span class="cls_008">doesn't, and thus Docker kills it after 10 seconds.</span></div>
<div style="position:absolute;left:108.00px;top:310.34px" class="cls_008"><span class="cls_008">If we run the application again, the output will be much shorter:</span></div>
<div style="position:absolute;left:252.54px;top:446.96px" class="cls_026"><span class="cls_026">Output of docker-compose up</span></div>
<div style="position:absolute;left:108.00px;top:465.70px" class="cls_008"><span class="cls_008">This time, we didn't have to download the images and the database didn't have to</span></div>
<div style="position:absolute;left:108.00px;top:478.30px" class="cls_008"><span class="cls_008">initialize from scratch, but it was just reusing the data that was already present in the</span></div>
<div style="position:absolute;left:108.00px;top:490.90px" class="cls_008"><span class="cls_008">volume </span><span class="cls_010">pets-data</span><span class="cls_008"> from the previous run.</span></div>
<div style="position:absolute;left:108.00px;top:512.14px" class="cls_008"><span class="cls_008">We can also run the application in the background. All containers will run as</span></div>
<div style="position:absolute;left:108.00px;top:524.74px" class="cls_008"><span class="cls_008">daemons. For this, we just need to use the </span><span class="cls_010">-d</span><span class="cls_008"> parameter, as shown in the following</span></div>
<div style="position:absolute;left:108.00px;top:537.34px" class="cls_008"><span class="cls_008">code:</span></div>
<div style="position:absolute;left:126.00px;top:558.28px" class="cls_024"><span class="cls_024">$ docker-compose up -d</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 155 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:137142px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background179.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Docker Compose offers us many more commands than just up. We can use it to list</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">all services that are part of the application:</span></div>
<div style="position:absolute;left:253.26px;top:220.76px" class="cls_026"><span class="cls_026">Output of docker-compose ps</span></div>
<div style="position:absolute;left:108.00px;top:239.50px" class="cls_008"><span class="cls_008">This command is similar to </span><span class="cls_010">docker container ls</span><span class="cls_008">, with the only difference being</span></div>
<div style="position:absolute;left:108.00px;top:252.10px" class="cls_008"><span class="cls_008">that it only lists containers that are part of the application.</span></div>
<div style="position:absolute;left:108.00px;top:273.34px" class="cls_008"><span class="cls_008">To stop and clean up the application, we use the </span><span class="cls_010">docker-compose down</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:126.00px;top:294.28px" class="cls_024"><span class="cls_024">$ docker-compose down</span></div>
<div style="position:absolute;left:126.00px;top:306.52px" class="cls_024"><span class="cls_024">Stopping ch08_web_1 ... done</span></div>
<div style="position:absolute;left:126.00px;top:318.76px" class="cls_024"><span class="cls_024">Stopping ch08_db_1 ... done</span></div>
<div style="position:absolute;left:126.00px;top:331.00px" class="cls_024"><span class="cls_024">Removing ch08_web_1 ... done</span></div>
<div style="position:absolute;left:126.00px;top:343.24px" class="cls_024"><span class="cls_024">Removing ch08_db_1 ... done</span></div>
<div style="position:absolute;left:126.00px;top:355.48px" class="cls_024"><span class="cls_024">Removing network ch08_default</span></div>
<div style="position:absolute;left:108.00px;top:375.22px" class="cls_008"><span class="cls_008">If we also want to remove the volume for the database, then we can use the</span></div>
<div style="position:absolute;left:108.00px;top:387.82px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:408.76px" class="cls_024"><span class="cls_024">$ docker volume rm ch08_pets-data</span></div>
<div style="position:absolute;left:108.00px;top:428.50px" class="cls_021"><span class="cls_021">Why is there a ch08 prefix in the name of the volume?</span><span class="cls_008"> In the </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file,</span></div>
<div style="position:absolute;left:108.00px;top:441.10px" class="cls_008"><span class="cls_008">we have called the volume to use </span><span class="cls_010">pets-data</span><span class="cls_008">. But as we have already mentioned,</span></div>
<div style="position:absolute;left:108.00px;top:453.70px" class="cls_008"><span class="cls_008">Docker Compose prefixes all names with the name of the parent folder of the</span></div>
<div style="position:absolute;left:108.00px;top:466.30px" class="cls_010"><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file plus an underscore. In this case, the parent folder</span></div>
<div style="position:absolute;left:107.99px;top:478.90px" class="cls_008"><span class="cls_008">is called </span><span class="cls_010">ch08</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:511.40px" class="cls_011"><span class="cls_011">Scaling a service</span></div>
<div style="position:absolute;left:108.00px;top:536.38px" class="cls_008"><span class="cls_008">Now, let's, for a moment, assume that our sample application has been live on</span></div>
<div style="position:absolute;left:108.00px;top:548.98px" class="cls_008"><span class="cls_008">the web and become very successful. Loads of people want to see our cute animal</span></div>
<div style="position:absolute;left:108.00px;top:561.58px" class="cls_008"><span class="cls_008">images. So now we're facing a problem since our application has started to slow</span></div>
<div style="position:absolute;left:108.00px;top:574.18px" class="cls_008"><span class="cls_008">down. To counteract this problem, we want to run multiple instances of the web</span></div>
<div style="position:absolute;left:108.00px;top:586.78px" class="cls_008"><span class="cls_008">service. With Docker Compose, this is readily done.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 156 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:137944px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background180.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 8</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Running more instances is also called </span><span class="cls_009">scaling up</span><span class="cls_008">. We can use this tool to scale our</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">web</span><span class="cls_008"> service up to, say, three instances:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker-compose up --scale web=3</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">If we do this, we are in for a surprise. The output will look similar to the following</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">screenshot:</span></div>
<div style="position:absolute;left:246.14px;top:372.78px" class="cls_026"><span class="cls_026">Output of docker-compose --scale</span></div>
<div style="position:absolute;left:108.00px;top:391.52px" class="cls_008"><span class="cls_008">The second and third instances of the web service fail to start. The error message</span></div>
<div style="position:absolute;left:108.00px;top:404.12px" class="cls_008"><span class="cls_008">tells us why: we cannot use the same host port more than once. When instances 2</span></div>
<div style="position:absolute;left:108.00px;top:416.72px" class="cls_008"><span class="cls_008">and 3 try to start, Docker realizes that port </span><span class="cls_010">3000</span><span class="cls_008"> is already taken by the first instance.</span></div>
<div style="position:absolute;left:108.00px;top:429.32px" class="cls_021"><span class="cls_021">What can we do?</span><span class="cls_008"> Well, we can just let Docker decide which host port to use for each</span></div>
<div style="position:absolute;left:108.00px;top:441.92px" class="cls_008"><span class="cls_008">instance.</span></div>
<div style="position:absolute;left:108.00px;top:463.16px" class="cls_008"><span class="cls_008">If, in the </span><span class="cls_010">ports</span><span class="cls_008"> section of the </span><span class="cls_010">compose</span><span class="cls_008"> file, we only specify the container port and</span></div>
<div style="position:absolute;left:108.00px;top:475.76px" class="cls_008"><span class="cls_008">leave out the host port, then Docker automatically selects an ephemeral port. Let's do</span></div>
<div style="position:absolute;left:108.00px;top:488.36px" class="cls_008"><span class="cls_008">exactly this:</span></div>
<div style="position:absolute;left:126.00px;top:509.60px" class="cls_008"><span class="cls_008">1.  First, let's tear down the application:</span></div>
<div style="position:absolute;left:165.60px;top:526.22px" class="cls_024"><span class="cls_024">$ docker-compose down</span></div>
<div style="position:absolute;left:126.00px;top:545.96px" class="cls_008"><span class="cls_008">2.  Then, we modify the </span><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file to look as follows:</span></div>
<div style="position:absolute;left:165.60px;top:562.58px" class="cls_023"><span class="cls_023">version: "3.5"</span></div>
<div style="position:absolute;left:165.60px;top:574.82px" class="cls_023"><span class="cls_023">services:</span></div>
<div style="position:absolute;left:176.40px;top:587.06px" class="cls_023"><span class="cls_023">web:</span></div>
<div style="position:absolute;left:187.20px;top:599.30px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-web:1.0</span></div>
<div style="position:absolute;left:187.20px;top:611.54px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:198.00px;top:623.78px" class="cls_023"><span class="cls_023">- 3000</span></div>
<div style="position:absolute;left:176.40px;top:636.02px" class="cls_023"><span class="cls_023">db:</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 157 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:138746px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background181.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:187.20px;top:114.01px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-db:1.0</span></div>
<div style="position:absolute;left:187.20px;top:126.25px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:198.00px;top:138.49px" class="cls_023"><span class="cls_023">- pets-data:/var/lib/postgresql/data</span></div>
<div style="position:absolute;left:165.60px;top:162.97px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:176.40px;top:175.21px" class="cls_023"><span class="cls_023">pets-data:</span></div>
<div style="position:absolute;left:126.00px;top:194.94px" class="cls_008"><span class="cls_008">3.  Now, we can start the application again and scale it up immediately</span></div>
<div style="position:absolute;left:144.00px;top:207.54px" class="cls_008"><span class="cls_008">after that:</span></div>
<div style="position:absolute;left:165.60px;top:224.16px" class="cls_024"><span class="cls_024">$ docker-compose up -d</span></div>
<div style="position:absolute;left:165.60px;top:239.28px" class="cls_024"><span class="cls_024">$ docker-compose scale web=3</span></div>
<div style="position:absolute;left:165.60px;top:254.40px" class="cls_024"><span class="cls_024">Starting ch08_web_1 ... done</span></div>
<div style="position:absolute;left:165.60px;top:269.52px" class="cls_024"><span class="cls_024">Creating ch08_web_2 ... done</span></div>
<div style="position:absolute;left:165.60px;top:284.64px" class="cls_024"><span class="cls_024">Creating ch08_web_3 ... done</span></div>
<div style="position:absolute;left:126.00px;top:304.38px" class="cls_008"><span class="cls_008">4.  If we now do a </span><span class="cls_010">docker-compose ps</span><span class="cls_008">, we should see the following screenshot:</span></div>
<div style="position:absolute;left:253.26px;top:418.11px" class="cls_026"><span class="cls_026">Output of docker-compose ps</span></div>
<div style="position:absolute;left:126.00px;top:436.85px" class="cls_008"><span class="cls_008">5.  As we can see, each service has been associated to a different host port. We</span></div>
<div style="position:absolute;left:144.00px;top:449.45px" class="cls_008"><span class="cls_008">can try to see whether they work, for example, using curl. Let's test the third</span></div>
<div style="position:absolute;left:144.00px;top:462.05px" class="cls_008"><span class="cls_008">instance, </span><span class="cls_010">ch08_web_3</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:165.60px;top:478.67px" class="cls_024"><span class="cls_024">$ curl -4 localhost:32770</span></div>
<div style="position:absolute;left:165.60px;top:493.79px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:108.00px;top:513.53px" class="cls_008"><span class="cls_008">The answer, </span><span class="cls_010">Pets Demo Application</span><span class="cls_008">, tells us that, indeed, our application is still</span></div>
<div style="position:absolute;left:107.99px;top:526.13px" class="cls_008"><span class="cls_008">working as expected. Try it out for the other two instances to be sure.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 158 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:139548px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background182.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 8</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Building and pushing an application</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">We can also use the </span><span class="cls_010">docker-compose build</span><span class="cls_008"> command to just build the images of an</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">application defined in the underlying </span><span class="cls_010">compose</span><span class="cls_008"> file. But to make this work, we'll have</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">to add the build information to the </span><span class="cls_010">docker-compose</span><span class="cls_008"> file. In the folder, we have a file,</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_010"><span class="cls_010">docker-compose.dev.yml</span><span class="cls_008">, which has those instructions already added:</span></div>
<div style="position:absolute;left:126.00px;top:195.64px" class="cls_023"><span class="cls_023">version: "3.5"</span></div>
<div style="position:absolute;left:126.00px;top:207.88px" class="cls_023"><span class="cls_023">services:</span></div>
<div style="position:absolute;left:136.80px;top:220.12px" class="cls_023"><span class="cls_023">web:</span></div>
<div style="position:absolute;left:147.60px;top:232.36px" class="cls_023"><span class="cls_023">build: web</span></div>
<div style="position:absolute;left:147.60px;top:244.60px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-</span></div>
<div style="position:absolute;left:147.60px;top:256.84px" class="cls_023"><span class="cls_023">web:1.0</span></div>
<div style="position:absolute;left:147.60px;top:269.08px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:158.40px;top:281.32px" class="cls_023"><span class="cls_023">- 3000:3000</span></div>
<div style="position:absolute;left:136.80px;top:293.56px" class="cls_023"><span class="cls_023">db:</span></div>
<div style="position:absolute;left:147.60px;top:305.80px" class="cls_023"><span class="cls_023">build: database</span></div>
<div style="position:absolute;left:147.60px;top:318.04px" class="cls_023"><span class="cls_023">image: appswithdockerandkubernetes/ch08-db:1.0</span></div>
<div style="position:absolute;left:147.60px;top:330.28px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:158.40px;top:342.52px" class="cls_023"><span class="cls_023">- pets-data:/var/lib/postgresql/data</span></div>
<div style="position:absolute;left:126.00px;top:367.00px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:136.80px;top:379.24px" class="cls_023"><span class="cls_023">pets-data:</span></div>
<div style="position:absolute;left:108.00px;top:398.98px" class="cls_008"><span class="cls_008">Please note the </span><span class="cls_010">build</span><span class="cls_008"> key for each service. The value of that key indicates the</span></div>
<div style="position:absolute;left:108.00px;top:411.58px" class="cls_008"><span class="cls_008">context or folder where Docker is expecting to find the Dockerfile to build the</span></div>
<div style="position:absolute;left:108.00px;top:424.18px" class="cls_008"><span class="cls_008">corresponding image.</span></div>
<div style="position:absolute;left:108.00px;top:445.42px" class="cls_008"><span class="cls_008">Let's use that file now:</span></div>
<div style="position:absolute;left:126.00px;top:466.36px" class="cls_024"><span class="cls_024">$ docker-compose -f docker-compose.dev.yml build</span></div>
<div style="position:absolute;left:108.00px;top:486.10px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">-f</span><span class="cls_008"> parameter will tell the Docker Compose application which compose file</span></div>
<div style="position:absolute;left:108.00px;top:498.70px" class="cls_008"><span class="cls_008">to use.</span></div>
<div style="position:absolute;left:108.00px;top:519.94px" class="cls_008"><span class="cls_008">To push all images to Docker Hub, we can use </span><span class="cls_010">docker-compose push</span><span class="cls_008">. We need to</span></div>
<div style="position:absolute;left:108.00px;top:532.54px" class="cls_008"><span class="cls_008">be logged in to Docker Hub so that this succeeds, otherwise we get an authentication</span></div>
<div style="position:absolute;left:108.00px;top:545.14px" class="cls_008"><span class="cls_008">error while pushing. Thus, in my case, I do the following:</span></div>
<div style="position:absolute;left:126.00px;top:566.08px" class="cls_024"><span class="cls_024">$ docker login -u appswithdockerandkubernetes -p &lt;password></span></div>
<div style="position:absolute;left:108.00px;top:585.82px" class="cls_008"><span class="cls_008">Assuming the login succeeds, I can then push the following code:</span></div>
<div style="position:absolute;left:126.00px;top:606.76px" class="cls_024"><span class="cls_024">$ docker-compose -f docker-compose.dev.yml push</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 159 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:140350px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background183.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Docker Compose</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The preceding command pushes the two images to the account</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">appswithdockerandkubernetes</span><span class="cls_008"> on Docker Hub. You can find these two images at</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the URL: </span><A HREF="https://hub.docker.com/u/appswithdockerandkubernetes/">https://hub.docker.com/u/appswithdockerandkubernetes/</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:172.19px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:197.17px" class="cls_008"><span class="cls_008">In this chapter, we introduced the tool </span><span class="cls_010">docker-compose</span><span class="cls_008">. This tool is mostly used</span></div>
<div style="position:absolute;left:108.00px;top:209.77px" class="cls_008"><span class="cls_008">to run and scale multi-service applications on a single Docker host. Typically,</span></div>
<div style="position:absolute;left:108.00px;top:222.37px" class="cls_008"><span class="cls_008">developers and CI servers work with single hosts and those two are the main</span></div>
<div style="position:absolute;left:108.00px;top:234.97px" class="cls_008"><span class="cls_008">users of Docker Compose. The tool is using YAML files as input that contain the</span></div>
<div style="position:absolute;left:108.00px;top:247.57px" class="cls_008"><span class="cls_008">description of the application in a declarative way.</span></div>
<div style="position:absolute;left:108.00px;top:268.82px" class="cls_008"><span class="cls_008">The tool can also be used to build and push images among many other helpful tasks.</span></div>
<div style="position:absolute;left:108.00px;top:281.41px" class="cls_008"><span class="cls_008">The code accompanying this chapter can be found in </span><span class="cls_010">labs/ch08</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:302.66px" class="cls_008"><span class="cls_008">In the next chapter, we are going to introduce orchestrators. An </span><span class="cls_009">orchestrator</span><span class="cls_008"> is an</span></div>
<div style="position:absolute;left:108.00px;top:315.26px" class="cls_008"><span class="cls_008">infrastructure software that is used to run and manage containerized applications</span></div>
<div style="position:absolute;left:108.00px;top:327.86px" class="cls_008"><span class="cls_008">in a cluster and it makes sure that these applications are in their desired state at all</span></div>
<div style="position:absolute;left:108.00px;top:340.46px" class="cls_008"><span class="cls_008">the time.</span></div>
<div style="position:absolute;left:108.00px;top:372.95px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:397.93px" class="cls_008"><span class="cls_008">To assess your learning progress please answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:419.17px" class="cls_008"><span class="cls_008">1.  How will you use </span><span class="cls_010">docker-compose</span><span class="cls_008"> to run an application in daemon mode?</span></div>
<div style="position:absolute;left:126.00px;top:436.09px" class="cls_008"><span class="cls_008">2.  How will you use </span><span class="cls_010">docker-compose</span><span class="cls_008"> to display the details of the running</span></div>
<div style="position:absolute;left:144.00px;top:448.69px" class="cls_008"><span class="cls_008">service?</span></div>
<div style="position:absolute;left:126.00px;top:465.61px" class="cls_008"><span class="cls_008">3.  How will you scale up a particular </span><span class="cls_010">web</span><span class="cls_008"> service to say, three instances?</span></div>
<div style="position:absolute;left:108.00px;top:498.11px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:523.09px" class="cls_008"><span class="cls_008">The following links provide additional information on the topics discussed in this</span></div>
<div style="position:absolute;left:108.00px;top:535.69px" class="cls_008"><span class="cls_008">chapter:</span></div>
<div style="position:absolute;left:126.00px;top:556.94px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  The official YAML website </span><span class="cls_008">at </span><A HREF="http://yaml.org/ ">http://yaml.org/</A> </span></div>
<div style="position:absolute;left:126.00px;top:573.85px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Docker Compose documentation</span><span class="cls_008"> at </span><A HREF="http://dockr.ly/1FL2VQ6">http://dockr.ly/1FL2VQ6</A> </span></div>
<div style="position:absolute;left:126.00px;top:590.77px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Compose file version 3 reference</span><span class="cls_008"> at </span><A HREF="http://dockr.ly/2iHUpeX">http://dockr.ly/2iHUpeX</A> </span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 160 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:141152px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background184.jpg" width=612 height=792></div>
<div style="position:absolute;left:322.29px;top:218.71px" class="cls_015"><span class="cls_015">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:272.41px" class="cls_008"><span class="cls_008">In the previous chapter, we introduced Docker Compose, a tool that allows us</span></div>
<div style="position:absolute;left:108.00px;top:285.01px" class="cls_008"><span class="cls_008">to work with multi-service applications that are defined in a declarative way on</span></div>
<div style="position:absolute;left:108.00px;top:297.61px" class="cls_008"><span class="cls_008">a single Docker host.</span></div>
<div style="position:absolute;left:108.00px;top:318.86px" class="cls_008"><span class="cls_008">This chapter introduces the concept of orchestrators. It teaches why orchestrators are</span></div>
<div style="position:absolute;left:108.00px;top:331.46px" class="cls_008"><span class="cls_008">needed and how they work conceptually. This chapter will also provide an overview</span></div>
<div style="position:absolute;left:108.00px;top:344.06px" class="cls_008"><span class="cls_008">of the most popular orchestrators and names a few of their pros and cons.</span></div>
<div style="position:absolute;left:108.00px;top:365.30px" class="cls_008"><span class="cls_008">In this chapter, we will cover the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:386.54px" class="cls_008"><span class="cls_008">•  What are orchestrators and why do we need them?</span></div>
<div style="position:absolute;left:126.00px;top:403.45px" class="cls_008"><span class="cls_008">•  The tasks of an orchestrator</span></div>
<div style="position:absolute;left:126.00px;top:420.37px" class="cls_008"><span class="cls_008">•  Overview of popular orchestrators</span></div>
<div style="position:absolute;left:107.99px;top:441.61px" class="cls_008"><span class="cls_008">After finishing this chapter, you will be able to:</span></div>
<div style="position:absolute;left:125.99px;top:462.85px" class="cls_008"><span class="cls_008">•  Name three to four tasks an orchestrator is responsible for</span></div>
<div style="position:absolute;left:125.99px;top:479.77px" class="cls_008"><span class="cls_008">•  List two to three of the most popular orchestrators</span></div>
<div style="position:absolute;left:125.99px;top:496.68px" class="cls_008"><span class="cls_008">•  Explain to an interested layman in your own words and with appropriate</span></div>
<div style="position:absolute;left:143.98px;top:509.28px" class="cls_008"><span class="cls_008">analogies why we need container orchestrators</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 161 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:141954px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background185.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">What are orchestrators and why do we</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">need them?</span></div>
<div style="position:absolute;left:108.00px;top:160.90px" class="cls_008"><span class="cls_008">In </span><span class="cls_021">Chapter 6, Distributed Application Architecture</span><span class="cls_008">, we learned which patterns and</span></div>
<div style="position:absolute;left:108.00px;top:173.50px" class="cls_008"><span class="cls_008">best practices are commonly used to successfully build, ship, and run a highly</span></div>
<div style="position:absolute;left:108.00px;top:186.10px" class="cls_008"><span class="cls_008">distributed application. Now, if our highly distributed application is containerized,</span></div>
<div style="position:absolute;left:108.00px;top:198.70px" class="cls_008"><span class="cls_008">then we're facing the exact same problems or challenges that a non-containerized</span></div>
<div style="position:absolute;left:108.00px;top:211.30px" class="cls_008"><span class="cls_008">distributed application faces. Some of these challenges are those discussed in</span></div>
<div style="position:absolute;left:108.00px;top:223.90px" class="cls_021"><span class="cls_021">Chapter 6</span><span class="cls_008">, </span><span class="cls_021">Distributed Application Architecture</span><span class="cls_008">, service discovery, load balancing,</span></div>
<div style="position:absolute;left:108.00px;top:236.50px" class="cls_008"><span class="cls_008">scaling, and so on.</span></div>
<div style="position:absolute;left:108.00px;top:257.74px" class="cls_008"><span class="cls_008">Similar to what Docker did with containers—standardizing the packaging and</span></div>
<div style="position:absolute;left:108.00px;top:270.34px" class="cls_008"><span class="cls_008">shipping of software with the introduction of containers—we would like to have</span></div>
<div style="position:absolute;left:108.00px;top:282.94px" class="cls_008"><span class="cls_008">some tool or infrastructure software that handles all or most of the challenges</span></div>
<div style="position:absolute;left:108.00px;top:295.54px" class="cls_008"><span class="cls_008">mentioned. This software turns out to be what we call orchestrators or, as we</span></div>
<div style="position:absolute;left:108.00px;top:308.14px" class="cls_008"><span class="cls_008">also call them, orchestration engines.</span></div>
<div style="position:absolute;left:108.00px;top:329.38px" class="cls_008"><span class="cls_008">If what I just said doesn't make much sense to you yet, then let's look at it from a</span></div>
<div style="position:absolute;left:108.00px;top:341.98px" class="cls_008"><span class="cls_008">different angle. Take an artist who plays an instrument. They can play wonderful</span></div>
<div style="position:absolute;left:108.00px;top:354.58px" class="cls_008"><span class="cls_008">music to an audience all on their own, just the artist and their instrument. But now</span></div>
<div style="position:absolute;left:108.00px;top:367.18px" class="cls_008"><span class="cls_008">take an orchestra of musicians. Put them all in a room, give them the notes of a</span></div>
<div style="position:absolute;left:108.00px;top:379.78px" class="cls_008"><span class="cls_008">symphony, ask them to play it, and leave the room. Without any director, this group</span></div>
<div style="position:absolute;left:108.00px;top:392.38px" class="cls_008"><span class="cls_008">of very talented musicians would not be able to play this piece in harmony; it would</span></div>
<div style="position:absolute;left:108.00px;top:404.98px" class="cls_008"><span class="cls_008">sound like a cacophony. Only if the orchestra has a conductor who orchestrates the</span></div>
<div style="position:absolute;left:108.00px;top:417.58px" class="cls_008"><span class="cls_008">group of musicians will the resulting music of the orchestra be enjoyable to our ears:</span></div>
<div style="position:absolute;left:198.81px;top:611.19px" class="cls_026"><span class="cls_026">A container orchestrator is like the conductor of an orchestra</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 162 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:142756px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background186.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Instead of musicians, we now have containers, and instead of different instruments,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">we have containers that have different requirements to the container hosts to run.</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">And instead of the music being played in varying tempi, we have containers that</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">communicate with each other in particular ways and have to scale up and scale</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">down. In this regard, a container orchestrator has very much the same role as a</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">conductor of an orchestra. It makes sure that the containers and other resources</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">in a cluster play together in harmony.</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">I hope you can now see more clearly what a container orchestrator is and why we</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">need one. We can now ask ourselves how the orchestrator is going to achieve the</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">expected outcome, namely to make sure all the containers in the cluster play with</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">each other in harmony. Well, the answer is, the orchestrator has to execute very</span></div>
<div style="position:absolute;left:108.00px;top:261.74px" class="cls_008"><span class="cls_008">specific tasks, similar to the way in which the conductor of an orchestra also has a set</span></div>
<div style="position:absolute;left:108.00px;top:274.34px" class="cls_008"><span class="cls_008">of tasks they execute in order to tame and at the same time elevate the orchestra.</span></div>
<div style="position:absolute;left:108.00px;top:306.83px" class="cls_011"><span class="cls_011">The tasks of an orchestrator</span></div>
<div style="position:absolute;left:108.00px;top:331.81px" class="cls_021"><span class="cls_021">So, what are the tasks that we expect an orchestrator worth its money to execute for us?</span><span class="cls_008"> Let's</span></div>
<div style="position:absolute;left:108.00px;top:344.41px" class="cls_008"><span class="cls_008">look at them in detail. The following list shows the most important tasks that, at the</span></div>
<div style="position:absolute;left:108.00px;top:357.01px" class="cls_008"><span class="cls_008">time of writing, enterprise users typically expect from their orchestrator.</span></div>
<div style="position:absolute;left:108.00px;top:386.95px" class="cls_022"><span class="cls_022">Reconciling the desired state</span></div>
<div style="position:absolute;left:108.00px;top:409.93px" class="cls_008"><span class="cls_008">When using an orchestrator, one tells it in a declarative way how one wants it</span></div>
<div style="position:absolute;left:108.00px;top:422.53px" class="cls_008"><span class="cls_008">to run a given application or application service. We learned what </span><span class="cls_021">declarative</span></div>
<div style="position:absolute;left:108.00px;top:435.13px" class="cls_008"><span class="cls_008">versus </span><span class="cls_021">imperative</span><span class="cls_008"> means in </span><span class="cls_021">Chapter 8, Docker Compose</span><span class="cls_008">. Part of this declarative way</span></div>
<div style="position:absolute;left:108.00px;top:447.73px" class="cls_008"><span class="cls_008">of describing the application service we want to run is elements such as which</span></div>
<div style="position:absolute;left:108.00px;top:460.33px" class="cls_008"><span class="cls_008">container image to use, how many instances to run of this service, which ports</span></div>
<div style="position:absolute;left:108.00px;top:472.93px" class="cls_008"><span class="cls_008">to open, and more. This declaration of the properties of our application service</span></div>
<div style="position:absolute;left:108.00px;top:485.53px" class="cls_008"><span class="cls_008">is what we call the </span><span class="cls_021">desired state</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:506.78px" class="cls_008"><span class="cls_008">So,  when we now tell the orchestrator the first time to create such a new application</span></div>
<div style="position:absolute;left:108.00px;top:519.38px" class="cls_008"><span class="cls_008">service based on the declaration, then the orchestrator makes sure to schedule as</span></div>
<div style="position:absolute;left:108.00px;top:531.98px" class="cls_008"><span class="cls_008">many containers in the cluster as requested. If the container image is not yet available</span></div>
<div style="position:absolute;left:108.00px;top:544.58px" class="cls_008"><span class="cls_008">on the target nodes of the cluster where the containers are supposed to run, then the</span></div>
<div style="position:absolute;left:108.00px;top:557.18px" class="cls_008"><span class="cls_008">scheduler makes sure they're downloaded from the image registry first. Next, the</span></div>
<div style="position:absolute;left:108.00px;top:569.78px" class="cls_008"><span class="cls_008">containers are started with all the settings, such as networks to which to attach, or</span></div>
<div style="position:absolute;left:108.00px;top:582.38px" class="cls_008"><span class="cls_008">ports to expose. The orchestrator works as hard as it can to exactly match in reality</span></div>
<div style="position:absolute;left:108.00px;top:594.98px" class="cls_008"><span class="cls_008">in the cluster what it got in our declaration.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 163 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:143558px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background187.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once our service is up and running as requested, that is, it is running in the desired</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">state, then the orchestrator continues to monitor it. Each time the orchestrator</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">discovers a discrepancy between the actual state of the service and its desired</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">state, it again tries its best to reconcile the desired state.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_021"><span class="cls_021">What could such a discrepancy between the actual and desired states of an application service</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_021"><span class="cls_021">be?</span><span class="cls_008"> Well, let's say one of the replicas of the service, that is, one of the containers,</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">crashes due to, say, a bug, then the orchestrator will discover that the actual state</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">differs from the desired state in the number of replicas—there is one replica missing.</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">The orchestrator will immediately schedule a new instance to another cluster node,</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">which replaces the crashed instance. Another discrepancy could be that there are</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">too many instances of the application service running, if the service has been scaled</span></div>
<div style="position:absolute;left:108.00px;top:261.74px" class="cls_008"><span class="cls_008">down. In this case, the orchestrator will just randomly kill as many instances as</span></div>
<div style="position:absolute;left:108.00px;top:274.34px" class="cls_008"><span class="cls_008">needed to achieve parity between the actual and the desired number of instances.</span></div>
<div style="position:absolute;left:108.00px;top:286.94px" class="cls_008"><span class="cls_008">Another discrepancy could be when the orchestrator discovers that there is an</span></div>
<div style="position:absolute;left:108.00px;top:299.54px" class="cls_008"><span class="cls_008">instance of the application service running a wrong (maybe old) version of the</span></div>
<div style="position:absolute;left:108.00px;top:312.14px" class="cls_008"><span class="cls_008">underlying container image. By now, you should get the picture, </span><span class="cls_021">right</span><span class="cls_008">?</span></div>
<div style="position:absolute;left:108.00px;top:333.38px" class="cls_008"><span class="cls_008">Thus, instead of us actively monitoring our application's services running in the</span></div>
<div style="position:absolute;left:108.00px;top:345.98px" class="cls_008"><span class="cls_008">cluster and correcting any deviation from the desired state, we delegate this tedious</span></div>
<div style="position:absolute;left:108.00px;top:358.58px" class="cls_008"><span class="cls_008">task to the orchestrator. This works very well, if we use a declarative and not an</span></div>
<div style="position:absolute;left:108.00px;top:371.18px" class="cls_008"><span class="cls_008">imperative way of describing the desired state of our application services.</span></div>
<div style="position:absolute;left:108.00px;top:401.11px" class="cls_022"><span class="cls_022">Replicated and global services</span></div>
<div style="position:absolute;left:108.00px;top:424.09px" class="cls_008"><span class="cls_008">There are two quite different types of services that we might want to run in a cluster</span></div>
<div style="position:absolute;left:108.00px;top:436.69px" class="cls_008"><span class="cls_008">managed by an orchestrator. They are </span><span class="cls_009">replicated</span><span class="cls_008"> and </span><span class="cls_009">global</span><span class="cls_008"> services. A replicated</span></div>
<div style="position:absolute;left:108.00px;top:449.29px" class="cls_008"><span class="cls_008">service is a service which is required to run in a specific number of instances, say 10.</span></div>
<div style="position:absolute;left:108.00px;top:461.89px" class="cls_008"><span class="cls_008">A global service, in turn, is a service that is required to have an instance running on</span></div>
<div style="position:absolute;left:108.00px;top:474.49px" class="cls_008"><span class="cls_008">every single worker node of the cluster. I have used the term </span><span class="cls_021">worker node</span><span class="cls_008"> here. In a</span></div>
<div style="position:absolute;left:108.00px;top:487.09px" class="cls_008"><span class="cls_008">cluster managed by an orchestrator, we typically have two types of nodes, </span><span class="cls_009">managers</span></div>
<div style="position:absolute;left:108.00px;top:499.69px" class="cls_008"><span class="cls_008">and </span><span class="cls_009">workers</span><span class="cls_008">. A manager node is usually exclusively used by the orchestrator to</span></div>
<div style="position:absolute;left:108.00px;top:512.29px" class="cls_008"><span class="cls_008">manage the cluster and does not run any other workload. Worker nodes, in turn,</span></div>
<div style="position:absolute;left:108.00px;top:524.89px" class="cls_008"><span class="cls_008">run the actual applications.</span></div>
<div style="position:absolute;left:108.00px;top:546.14px" class="cls_008"><span class="cls_008">So, the orchestrator makes sure that, for a global service, an instance of it is running</span></div>
<div style="position:absolute;left:108.00px;top:558.74px" class="cls_008"><span class="cls_008">on every single worker node, no matter how many there are. We do not need to care</span></div>
<div style="position:absolute;left:108.00px;top:571.34px" class="cls_008"><span class="cls_008">about the number of instances, but only that on each node it is guaranteed to run a</span></div>
<div style="position:absolute;left:108.00px;top:583.94px" class="cls_008"><span class="cls_008">single instance of the service.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 164 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:144360px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background188.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once again, we can fully rely on the orchestrator to take care of this feat. In a</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">replicated service, we will always be guaranteed to find the exact desired number of</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">instances, while for a global service, we can be assured that on every worker node,</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">there will always run exactly one instance of the service. The orchestrator will always</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">work as hard as it can to guarantee this desired state.</span></div>
<div style="position:absolute;left:198.97px;top:202.85px" class="cls_025"><span class="cls_025">In Kubernetes, a global service is also called a </span><span class="cls_027">daemon set</span><span class="cls_025">.</span></div>
<div style="position:absolute;left:108.00px;top:244.83px" class="cls_022"><span class="cls_022">Service discovery</span></div>
<div style="position:absolute;left:108.00px;top:267.81px" class="cls_008"><span class="cls_008">When we describe an application service in a declarative way, we are never</span></div>
<div style="position:absolute;left:108.00px;top:280.41px" class="cls_008"><span class="cls_008">supposed to tell the orchestrator on which cluster nodes the different instances of the</span></div>
<div style="position:absolute;left:108.00px;top:293.01px" class="cls_008"><span class="cls_008">service have to run. We leave it up to the orchestrator to decide which nodes best fit</span></div>
<div style="position:absolute;left:108.00px;top:305.61px" class="cls_008"><span class="cls_008">this task.</span></div>
<div style="position:absolute;left:108.00px;top:326.86px" class="cls_008"><span class="cls_008">It is, of course, technically possible to instruct the orchestrator to use very deterministic</span></div>
<div style="position:absolute;left:108.00px;top:339.46px" class="cls_008"><span class="cls_008">placement rules, but this would be an anti-pattern and is not recommended at all.</span></div>
<div style="position:absolute;left:108.00px;top:360.70px" class="cls_008"><span class="cls_008">So, if we now assume that the orchestration engine has complete and free will as</span></div>
<div style="position:absolute;left:108.00px;top:373.30px" class="cls_008"><span class="cls_008">to where to place individual instances of the application service and, furthermore,</span></div>
<div style="position:absolute;left:108.00px;top:385.90px" class="cls_008"><span class="cls_008">that instances can crash and be rescheduled by the orchestrator to different nodes,</span></div>
<div style="position:absolute;left:108.00px;top:398.50px" class="cls_008"><span class="cls_008">then we will realize that it is a futile task for us to keep track of where the individual</span></div>
<div style="position:absolute;left:108.00px;top:411.10px" class="cls_008"><span class="cls_008">instances are running at any given time. Even better, we shouldn't even try to know</span></div>
<div style="position:absolute;left:108.00px;top:423.70px" class="cls_008"><span class="cls_008">this since it is not important.</span></div>
<div style="position:absolute;left:108.00px;top:444.94px" class="cls_008"><span class="cls_008">OK, you might say, but what about if I have two services, A and B, and Service A</span></div>
<div style="position:absolute;left:108.00px;top:457.54px" class="cls_008"><span class="cls_008">relies on Service B; </span><span class="cls_021">shouldn't any given instance of Service A know where it can find an</span></div>
<div style="position:absolute;left:108.00px;top:470.14px" class="cls_021"><span class="cls_021">instance of Service B?</span></div>
<div style="position:absolute;left:108.00px;top:491.38px" class="cls_008"><span class="cls_008">There I have to say loudly and clearly—no, it shouldn't. This kind of knowledge is not</span></div>
<div style="position:absolute;left:108.00px;top:503.98px" class="cls_008"><span class="cls_008">desirable in a highly distributed and scalable application. Rather, we should rely on the</span></div>
<div style="position:absolute;left:108.00px;top:516.58px" class="cls_008"><span class="cls_008">orchestrator to provide us the information we need to reach other service instances we</span></div>
<div style="position:absolute;left:108.00px;top:529.18px" class="cls_008"><span class="cls_008">depend on. It is a bit like in the old days of telephony, when we could not directly call</span></div>
<div style="position:absolute;left:108.00px;top:541.78px" class="cls_008"><span class="cls_008">our friends but had to call the phone company's central office, where some operator</span></div>
<div style="position:absolute;left:108.00px;top:554.38px" class="cls_008"><span class="cls_008">would then route us to the correct destination. In our case, the orchestrator plays the</span></div>
<div style="position:absolute;left:108.00px;top:566.98px" class="cls_008"><span class="cls_008">role of the operator, routing a request coming from an instance of Service A to an</span></div>
<div style="position:absolute;left:108.00px;top:579.58px" class="cls_008"><span class="cls_008">available instance of Service B. This whole process is called </span><span class="cls_009">service discovery</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 165 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:145162px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background189.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Routing</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">We have learned so far that in a distributed application, we have many interacting</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">services. When Service A interacts with Service B, it happens through the exchange</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">of data packets. These data packets need to somehow be funneled from Service A to</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Service B. This process of funneling the data packets from a source to a destination</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">is also called </span><span class="cls_009">routing</span><span class="cls_008">. As authors or operators of an application, we do expect the</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">orchestrator to take over this task of routing. As we will see in later chapters, routing</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">can happen on different levels. It is like in real life. Suppose you're working in a big</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">company in one of their office buildings. Now, you have a document that needs to be</span></div>
<div style="position:absolute;left:108.00px;top:236.24px" class="cls_008"><span class="cls_008">forwarded to another employee of the company. The internal post service will pick</span></div>
<div style="position:absolute;left:108.00px;top:248.84px" class="cls_008"><span class="cls_008">up the document from your outbox and take it to the post office located in the same</span></div>
<div style="position:absolute;left:108.00px;top:261.44px" class="cls_008"><span class="cls_008">building. If the target person works in the same building, the document can then be</span></div>
<div style="position:absolute;left:108.00px;top:274.04px" class="cls_008"><span class="cls_008">directly forwarded to that person. If, on the other hand, the person works in another</span></div>
<div style="position:absolute;left:108.00px;top:286.64px" class="cls_008"><span class="cls_008">building of the same block, the document will be forwarded to the post office in that</span></div>
<div style="position:absolute;left:108.00px;top:299.24px" class="cls_008"><span class="cls_008">target building, from where it is then distributed to the receiver through the internal</span></div>
<div style="position:absolute;left:108.00px;top:311.84px" class="cls_008"><span class="cls_008">post service. Thirdly, if the document is targeted at an employee working in another</span></div>
<div style="position:absolute;left:108.00px;top:324.44px" class="cls_008"><span class="cls_008">branch of the company located in a different city or even country, then the document</span></div>
<div style="position:absolute;left:108.00px;top:337.04px" class="cls_008"><span class="cls_008">is forwarded to an external postal service such as UPS, which will transport it to</span></div>
<div style="position:absolute;left:108.00px;top:349.64px" class="cls_008"><span class="cls_008">the target location, from where, once again, the internal post service takes over and</span></div>
<div style="position:absolute;left:108.00px;top:362.24px" class="cls_008"><span class="cls_008">delivers it to the recipient.</span></div>
<div style="position:absolute;left:108.00px;top:383.49px" class="cls_008"><span class="cls_008">Similar things happen when routing data packets between application services</span></div>
<div style="position:absolute;left:108.00px;top:396.09px" class="cls_008"><span class="cls_008">running in containers. The source and target containers can be located on the same</span></div>
<div style="position:absolute;left:108.00px;top:408.69px" class="cls_008"><span class="cls_008">cluster node, which corresponds to the situation where both employees work in the</span></div>
<div style="position:absolute;left:108.00px;top:421.29px" class="cls_008"><span class="cls_008">same building. The target container can be running on a different cluster node, which</span></div>
<div style="position:absolute;left:108.00px;top:433.89px" class="cls_008"><span class="cls_008">corresponds to the situation where the two employees work in different buildings of</span></div>
<div style="position:absolute;left:108.00px;top:446.49px" class="cls_008"><span class="cls_008">the same block. Finally, the third situation is when a data packet comes from outside</span></div>
<div style="position:absolute;left:108.00px;top:459.09px" class="cls_008"><span class="cls_008">of the cluster and has to be routed to the target container running inside the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:480.33px" class="cls_008"><span class="cls_008">All these situations and more have to be handled by the orchestrator.</span></div>
<div style="position:absolute;left:108.00px;top:510.26px" class="cls_022"><span class="cls_022">Load balancing</span></div>
<div style="position:absolute;left:108.00px;top:533.24px" class="cls_008"><span class="cls_008">In a highly available distributed application, all components have to be redundant.</span></div>
<div style="position:absolute;left:108.00px;top:545.84px" class="cls_008"><span class="cls_008">That means that every application service has to be run in multiple instances so that</span></div>
<div style="position:absolute;left:108.00px;top:558.44px" class="cls_008"><span class="cls_008">if one instance fails, the service as a whole is still operational.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 166 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:145964px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background190.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To make sure that all instances of a service are actually doing work and not just</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">sitting around idle, one has to make sure that the requests for service are distributed</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">equally to all the instances. This process of distributing workload among service</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">instances is called </span><span class="cls_009">load balancing</span><span class="cls_008">. Various algorithms exist for how the workload</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">can be distributed. Usually, a load balancer works using the so-called round robin</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">algorithm, which makes sure that the workload is distributed equally to the instances</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">using a cyclic algorithm.</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">Once again, we expect the orchestrator to take care of load balancing requests from</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">one service to another or from external sources to internal services.</span></div>
<div style="position:absolute;left:108.00px;top:253.87px" class="cls_022"><span class="cls_022">Scaling</span></div>
<div style="position:absolute;left:108.00px;top:276.85px" class="cls_008"><span class="cls_008">When running our containerized, distributed application in a cluster managed by an</span></div>
<div style="position:absolute;left:108.00px;top:289.45px" class="cls_008"><span class="cls_008">orchestrator, we also want an easy way to handle expected or unexpected increases</span></div>
<div style="position:absolute;left:108.00px;top:302.05px" class="cls_008"><span class="cls_008">in workload. To handle an increased workload, we usually just schedule additional</span></div>
<div style="position:absolute;left:108.00px;top:314.65px" class="cls_008"><span class="cls_008">instances of a service that is experiencing this increased load. Load balancers will</span></div>
<div style="position:absolute;left:108.00px;top:327.25px" class="cls_008"><span class="cls_008">then automatically be configured to distribute the workload over more available</span></div>
<div style="position:absolute;left:108.00px;top:339.85px" class="cls_008"><span class="cls_008">target instances.</span></div>
<div style="position:absolute;left:108.00px;top:361.10px" class="cls_008"><span class="cls_008">But in real-life scenarios, the workload varies over time. If we look at a shopping site</span></div>
<div style="position:absolute;left:108.00px;top:373.70px" class="cls_008"><span class="cls_008">such as Amazon, it might have a high load during peak hours in the evening, when</span></div>
<div style="position:absolute;left:108.00px;top:386.30px" class="cls_008"><span class="cls_008">everyone is at home and shopping online; it may experience extreme loads during</span></div>
<div style="position:absolute;left:108.00px;top:398.90px" class="cls_008"><span class="cls_008">special days such as Black Friday; and it may experience very little traffic early in</span></div>
<div style="position:absolute;left:108.00px;top:411.50px" class="cls_008"><span class="cls_008">the morning. Thus, services need to not just be able to scale up, but also to scale</span></div>
<div style="position:absolute;left:108.00px;top:424.10px" class="cls_008"><span class="cls_008">down when the workload goes down.</span></div>
<div style="position:absolute;left:108.00px;top:445.34px" class="cls_008"><span class="cls_008">We also expect orchestrators to distribute the instances of a service in a meaningful</span></div>
<div style="position:absolute;left:108.00px;top:457.94px" class="cls_008"><span class="cls_008">way when scaling up or down. It would not be wise to schedule all instances of the</span></div>
<div style="position:absolute;left:108.00px;top:470.54px" class="cls_008"><span class="cls_008">service on the same cluster node, since if that node goes down, the whole service</span></div>
<div style="position:absolute;left:108.00px;top:483.14px" class="cls_008"><span class="cls_008">goes down. The scheduler of the orchestrator, which is responsible for the placement</span></div>
<div style="position:absolute;left:108.00px;top:495.74px" class="cls_008"><span class="cls_008">of the containers, needs to also consider not placing all instances into the same rack</span></div>
<div style="position:absolute;left:108.00px;top:508.34px" class="cls_008"><span class="cls_008">of computers, since if the power supply of the rack fails, again the whole service is</span></div>
<div style="position:absolute;left:108.00px;top:520.94px" class="cls_008"><span class="cls_008">affected. Furthermore, service instances of critical services should even be distributed</span></div>
<div style="position:absolute;left:108.00px;top:533.54px" class="cls_008"><span class="cls_008">across datacenters to avoid outages. All these decisions and many more are the</span></div>
<div style="position:absolute;left:108.00px;top:546.14px" class="cls_008"><span class="cls_008">responsibility of the orchestrator.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 167 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:146766px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background191.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Self-healing</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">These days, orchestrators are very sophisticated and can do a lot for us to maintain</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">a healthy system. Orchestrators monitor all containers running in the cluster and</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">they automatically replace crashed or unresponsive ones with new instances.</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Orchestrators monitor the health of cluster nodes and take them out of the scheduler</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">loop if a node becomes unhealthy or is down. A workload that was located on those</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">nodes is automatically rescheduled to different available nodes.</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">All these activities where the orchestrator monitors the current state and</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">automatically repairs the damage or reconciles the desired state lead to a so-called</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_009"><span class="cls_009">self-healing</span><span class="cls_008"> system. We do not, in most cases, have to actively engage and repair</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">damage. The orchestrator will do this for us automatically.</span></div>
<div style="position:absolute;left:108.00px;top:278.73px" class="cls_008"><span class="cls_008">But there are a few situations that the orchestrator cannot handle without our help.</span></div>
<div style="position:absolute;left:108.00px;top:291.33px" class="cls_008"><span class="cls_008">Imagine a situation where we have a service instance running in a container. The</span></div>
<div style="position:absolute;left:108.00px;top:303.93px" class="cls_008"><span class="cls_008">container is up and running and, from the outside, looks perfectly healthy. But the</span></div>
<div style="position:absolute;left:108.00px;top:316.53px" class="cls_008"><span class="cls_008">application inside is in an unhealthy state. The application did not crash, it just is</span></div>
<div style="position:absolute;left:108.00px;top:329.13px" class="cls_008"><span class="cls_008">not able to work as designed anymore. </span><span class="cls_021">How could the orchestrator possibly know about</span></div>
<div style="position:absolute;left:108.00px;top:341.73px" class="cls_021"><span class="cls_021">this without us giving it a hint?</span><span class="cls_008"> It can't! Being in an unhealthy or invalid state means</span></div>
<div style="position:absolute;left:108.00px;top:354.33px" class="cls_008"><span class="cls_008">something completely different for each application service. In other words, the</span></div>
<div style="position:absolute;left:108.00px;top:366.93px" class="cls_008"><span class="cls_008">health status is service dependent. Only the authors of the service or its operators</span></div>
<div style="position:absolute;left:108.00px;top:379.53px" class="cls_008"><span class="cls_008">know what health means in the context of a service.</span></div>
<div style="position:absolute;left:108.00px;top:400.77px" class="cls_008"><span class="cls_008">Now, orchestrators define seams or probes, over which an application service</span></div>
<div style="position:absolute;left:108.00px;top:413.37px" class="cls_008"><span class="cls_008">can communicate to the orchestrator in what state it is. Two fundamental types</span></div>
<div style="position:absolute;left:108.00px;top:425.97px" class="cls_008"><span class="cls_008">of probe exist:</span></div>
<div style="position:absolute;left:126.00px;top:447.21px" class="cls_008"><span class="cls_008">•  The service can tell the orchestrator that it is healthy or not</span></div>
<div style="position:absolute;left:126.00px;top:464.13px" class="cls_008"><span class="cls_008">•  The service can tell the orchestrator that it is ready or temporarily unavailable</span></div>
<div style="position:absolute;left:107.99px;top:485.37px" class="cls_008"><span class="cls_008">How the service determines either of the preceding answers is totally up to the</span></div>
<div style="position:absolute;left:107.99px;top:497.97px" class="cls_008"><span class="cls_008">service. The orchestrator only defines how it is going to ask, for example, through</span></div>
<div style="position:absolute;left:107.99px;top:510.57px" class="cls_008"><span class="cls_008">an HTTP GET request, or what type of answers it is expecting, for example, OK or</span></div>
<div style="position:absolute;left:107.99px;top:523.17px" class="cls_008"><span class="cls_008">NOT OK.</span></div>
<div style="position:absolute;left:107.99px;top:544.41px" class="cls_008"><span class="cls_008">If our services implement logic to answer the preceding health or availability</span></div>
<div style="position:absolute;left:107.99px;top:557.01px" class="cls_008"><span class="cls_008">questions, then we have a truly self-healing system, since the orchestrator can kill</span></div>
<div style="position:absolute;left:107.99px;top:569.61px" class="cls_008"><span class="cls_008">unhealthy service instances and replace them with new healthy ones, and it can</span></div>
<div style="position:absolute;left:107.99px;top:582.21px" class="cls_008"><span class="cls_008">take service instances that are temporarily unavailable out of the load balancer's</span></div>
<div style="position:absolute;left:107.99px;top:594.81px" class="cls_008"><span class="cls_008">round robin.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 168 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:147568px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background192.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Zero downtime deployments</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">These days, it gets harder and harder to justify a complete downtime for a mission-</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">critical application that needs to be updated. Not only does that mean missed</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">opportunities, but it can also result in a damaged reputation for the company.</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Customers using the application are just not ready to accept such an inconvenience</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">anymore and will turn away quickly. Furthermore, our release cycles get shorter</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">and shorter. Where, in the past, we would have one or two new releases per year,</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">nowadays, a lot of companies update their applications multiple times a week or</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">even multiple times per day.</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">The solution to that problem is to come up with a zero downtime application update</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">strategy. The orchestrator needs to be able to update individual application services</span></div>
<div style="position:absolute;left:108.00px;top:270.09px" class="cls_008"><span class="cls_008">batch-wise. This is also called </span><span class="cls_009">rolling updates</span><span class="cls_008">. At any given time, only one or a few</span></div>
<div style="position:absolute;left:108.00px;top:282.69px" class="cls_008"><span class="cls_008">of the total number of instances of a given service are taken down and replaced by</span></div>
<div style="position:absolute;left:108.00px;top:295.29px" class="cls_008"><span class="cls_008">the new version of the service. Only if the new instances are operational and do</span></div>
<div style="position:absolute;left:108.00px;top:307.89px" class="cls_008"><span class="cls_008">not produce any unexpected errors or show any misbehavior will the next batch</span></div>
<div style="position:absolute;left:108.00px;top:320.49px" class="cls_008"><span class="cls_008">of instances be updated. This is repeated until all instances are replaced with their</span></div>
<div style="position:absolute;left:108.00px;top:333.09px" class="cls_008"><span class="cls_008">new version. If, for some reason, the update fails, we expect the orchestrator to</span></div>
<div style="position:absolute;left:108.00px;top:345.69px" class="cls_008"><span class="cls_008">automatically roll the updated instances back to their previous version.</span></div>
<div style="position:absolute;left:108.00px;top:366.93px" class="cls_008"><span class="cls_008">Other possible zero downtime deployments are so-called </span><span class="cls_009">canary releases</span><span class="cls_008"> and </span><span class="cls_009">blue-</span></div>
<div style="position:absolute;left:108.00px;top:379.53px" class="cls_009"><span class="cls_009">green deployments</span><span class="cls_008">. In both cases, the new version of a service is installed in parallel</span></div>
<div style="position:absolute;left:108.00px;top:392.13px" class="cls_008"><span class="cls_008">with the current, active version. But initially, the new version is only accessible</span></div>
<div style="position:absolute;left:108.00px;top:404.73px" class="cls_008"><span class="cls_008">internally. Operations can then run smoke tests against the new version and when</span></div>
<div style="position:absolute;left:108.00px;top:417.33px" class="cls_008"><span class="cls_008">the new version seems to be running just fine, then, in the case of blue-green</span></div>
<div style="position:absolute;left:108.00px;top:429.93px" class="cls_008"><span class="cls_008">deployment, the router is switched from the current blue to the new green version.</span></div>
<div style="position:absolute;left:108.00px;top:442.53px" class="cls_008"><span class="cls_008">For some time, the new green version of the service is closely monitored and, if</span></div>
<div style="position:absolute;left:108.00px;top:455.13px" class="cls_008"><span class="cls_008">everything is fine, the old blue version can be decommissioned. If, on the other hand,</span></div>
<div style="position:absolute;left:108.00px;top:467.73px" class="cls_008"><span class="cls_008">the new green version does not work as expected, then it is only a matter of setting</span></div>
<div style="position:absolute;left:108.00px;top:480.33px" class="cls_008"><span class="cls_008">the router back to the old blue version to achieve a complete rollback.</span></div>
<div style="position:absolute;left:108.00px;top:501.57px" class="cls_008"><span class="cls_008">In the case of a canary release, the router is configured in such a way that it funnels a</span></div>
<div style="position:absolute;left:108.00px;top:514.17px" class="cls_008"><span class="cls_008">tiny percentage, say 1%, of the overall traffic through the new version of the service,</span></div>
<div style="position:absolute;left:108.00px;top:526.77px" class="cls_008"><span class="cls_008">while 99% of the traffic is still routed through the old version. The behavior of the</span></div>
<div style="position:absolute;left:108.00px;top:539.37px" class="cls_008"><span class="cls_008">new version is closely monitored and compared to the behavior of the old version. If</span></div>
<div style="position:absolute;left:108.00px;top:551.97px" class="cls_008"><span class="cls_008">everything looks good, then the percentage of the traffic funneled through the new</span></div>
<div style="position:absolute;left:108.00px;top:564.57px" class="cls_008"><span class="cls_008">service is slightly increased. This process is repeated until 100% of the traffic is routed</span></div>
<div style="position:absolute;left:108.00px;top:577.17px" class="cls_008"><span class="cls_008">through the new service. If the new service has run for a while and everything looks</span></div>
<div style="position:absolute;left:108.00px;top:589.77px" class="cls_008"><span class="cls_008">good, then the old service can be decommissioned.</span></div>
<div style="position:absolute;left:108.00px;top:611.01px" class="cls_008"><span class="cls_008">Most orchestrators support at least the rolling update type of zero downtime</span></div>
<div style="position:absolute;left:108.00px;top:623.61px" class="cls_008"><span class="cls_008">deployment out of the box. Blue-green and canary releases are often quite easy</span></div>
<div style="position:absolute;left:108.00px;top:636.21px" class="cls_008"><span class="cls_008">to implement.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 169 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:148370px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background193.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Affinity and location awareness</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Sometimes, certain application services require the availability of dedicated</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">hardware on the nodes they run on. For example I/O-bound services require cluster</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">nodes with an attached high-performance </span><span class="cls_009">solid-state drive</span><span class="cls_008"> (</span><span class="cls_009">SSD</span><span class="cls_008">), or some services</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">require an </span><span class="cls_009">Accelerated Processing Unit</span><span class="cls_008"> (</span><span class="cls_009">APU</span><span class="cls_008">). Orchestrators allow us to define</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">node affinities per application service. The orchestrator will then make sure that its</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">scheduler only schedules containers on cluster nodes that fulfill the required criteria.</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">Defining an affinity to a particular node should be avoided; this would introduce a</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">single point of failure and thus compromise high availability. Always define a set</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">of multiple cluster nodes as the target for an application service.</span></div>
<div style="position:absolute;left:108.00px;top:266.13px" class="cls_008"><span class="cls_008">Some orchestration engines also support what is called </span><span class="cls_009">location awareness</span><span class="cls_008"> or</span></div>
<div style="position:absolute;left:108.00px;top:278.73px" class="cls_009"><span class="cls_009">geo-awareness</span><span class="cls_008">. What this means is that one can request the orchestrator to equally</span></div>
<div style="position:absolute;left:108.00px;top:291.33px" class="cls_008"><span class="cls_008">distribute instances of a service over a set of different locations. One could, for</span></div>
<div style="position:absolute;left:108.00px;top:303.92px" class="cls_008"><span class="cls_008">example, define a label </span><span class="cls_010">datacenter</span><span class="cls_008"> with the possible values </span><span class="cls_010">west</span><span class="cls_008">, </span><span class="cls_010">center</span><span class="cls_008">, and</span></div>
<div style="position:absolute;left:108.00px;top:316.52px" class="cls_010"><span class="cls_010">east</span><span class="cls_008"> and apply the label to all cluster nodes with the value that corresponds to the</span></div>
<div style="position:absolute;left:108.00px;top:329.12px" class="cls_008"><span class="cls_008">geographical region in which the respective node is located. Then, one instructs the</span></div>
<div style="position:absolute;left:108.00px;top:341.72px" class="cls_008"><span class="cls_008">orchestrator to use this label for geo-awareness of a certain application service. In</span></div>
<div style="position:absolute;left:108.00px;top:354.32px" class="cls_008"><span class="cls_008">this case, if one requests nine replicas of the service, the orchestrator would make</span></div>
<div style="position:absolute;left:108.00px;top:366.92px" class="cls_008"><span class="cls_008">sure that three instances are deployed to nodes in each of the three datacenters,</span></div>
<div style="position:absolute;left:108.00px;top:379.52px" class="cls_008"><span class="cls_008">west, center, and east.</span></div>
<div style="position:absolute;left:108.00px;top:400.77px" class="cls_008"><span class="cls_008">Geo-awareness can even be defined hierarchically; for example, one can have a</span></div>
<div style="position:absolute;left:108.00px;top:413.37px" class="cls_008"><span class="cls_008">datacenter as the top-level discriminator, followed by the availability zone and</span></div>
<div style="position:absolute;left:108.00px;top:425.97px" class="cls_008"><span class="cls_008">then the server rack.</span></div>
<div style="position:absolute;left:108.00px;top:447.21px" class="cls_008"><span class="cls_008">Geo-awareness or location awareness is used to decrease the probability of outages</span></div>
<div style="position:absolute;left:108.00px;top:459.81px" class="cls_008"><span class="cls_008">due to power supply failures or datacenter outages. If the application instances are</span></div>
<div style="position:absolute;left:108.00px;top:472.41px" class="cls_008"><span class="cls_008">distributed across server racks, availability zones, or even datacenters, it is extremely</span></div>
<div style="position:absolute;left:108.00px;top:485.01px" class="cls_008"><span class="cls_008">unlikely that everything goes down at once. One region will always be available.</span></div>
<div style="position:absolute;left:108.00px;top:514.94px" class="cls_022"><span class="cls_022">Security</span></div>
<div style="position:absolute;left:108.00px;top:537.92px" class="cls_008"><span class="cls_008">These days, security in IT is a very hot topic. Cyberwarfare is at an all-time high.</span></div>
<div style="position:absolute;left:108.00px;top:550.52px" class="cls_008"><span class="cls_008">Most high-profile companies have been victims of hacker attacks, with very costly</span></div>
<div style="position:absolute;left:108.00px;top:563.12px" class="cls_008"><span class="cls_008">consequences. One of the worst nightmares of each </span><span class="cls_009">chief information officer</span><span class="cls_008"> (</span><span class="cls_009">CIO</span><span class="cls_008">)</span></div>
<div style="position:absolute;left:108.00px;top:575.72px" class="cls_008"><span class="cls_008">or </span><span class="cls_009">chief technology officer</span><span class="cls_008"> (</span><span class="cls_009">CTO</span><span class="cls_008">) is to wake up in the morning and hear in the</span></div>
<div style="position:absolute;left:108.00px;top:588.32px" class="cls_008"><span class="cls_008">news that their company has become a victim of a hacker attack and that sensitive</span></div>
<div style="position:absolute;left:108.00px;top:600.92px" class="cls_008"><span class="cls_008">information has been stolen or compromised.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 170 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:149172px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background194.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To counter most of these security threats, we need to establish a secure software</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">supply chain and enforce security defense in depth. Let's look at some of the tasks</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">one can expect from an enterprise-grade orchestrator.</span></div>
<div style="position:absolute;left:108.00px;top:167.79px" class="cls_028"><span class="cls_028">Secure communication and cryptographic node</span></div>
<div style="position:absolute;left:108.00px;top:186.99px" class="cls_028"><span class="cls_028">identity</span></div>
<div style="position:absolute;left:108.00px;top:207.97px" class="cls_008"><span class="cls_008">First and foremost, we want to make sure that our cluster managed by the</span></div>
<div style="position:absolute;left:108.00px;top:220.57px" class="cls_008"><span class="cls_008">orchestrator is secure. Only trusted nodes can join the cluster. Each node that joins</span></div>
<div style="position:absolute;left:108.00px;top:233.17px" class="cls_008"><span class="cls_008">the cluster gets a cryptographic node identity, and all communication between the</span></div>
<div style="position:absolute;left:108.00px;top:245.77px" class="cls_008"><span class="cls_008">nodes must be encrypted. For this, nodes can use </span><span class="cls_009">mutual transport layer security</span></div>
<div style="position:absolute;left:108.00px;top:258.37px" class="cls_008"><span class="cls_008">(</span><span class="cls_009">MTLS</span><span class="cls_008">). To authenticate nodes of the cluster with each other, certificates are used.</span></div>
<div style="position:absolute;left:108.00px;top:270.97px" class="cls_008"><span class="cls_008">These certificates are automatically rotated periodically or on request to protect the</span></div>
<div style="position:absolute;left:108.00px;top:283.57px" class="cls_008"><span class="cls_008">system in case a certificate is leaked.</span></div>
<div style="position:absolute;left:108.00px;top:304.82px" class="cls_008"><span class="cls_008">The communication that happens in a cluster can be separated into three types. One</span></div>
<div style="position:absolute;left:108.00px;top:317.42px" class="cls_008"><span class="cls_008">talks about communication planes. There are </span><span class="cls_009">management</span><span class="cls_008">, </span><span class="cls_009">control</span><span class="cls_008">, and </span><span class="cls_009">data</span><span class="cls_008"> planes:</span></div>
<div style="position:absolute;left:126.00px;top:338.66px" class="cls_008"><span class="cls_008">•  The management plane is used by the cluster managers or masters to, for</span></div>
<div style="position:absolute;left:143.99px;top:351.26px" class="cls_008"><span class="cls_008">example, schedule service instances, execute health checks, or create and</span></div>
<div style="position:absolute;left:143.99px;top:363.86px" class="cls_008"><span class="cls_008">modify any other resources in the cluster, such as data volumes, secrets,</span></div>
<div style="position:absolute;left:143.99px;top:376.46px" class="cls_008"><span class="cls_008">or networks.</span></div>
<div style="position:absolute;left:126.00px;top:393.37px" class="cls_008"><span class="cls_008">•  The control plane is used to exchange important state information between</span></div>
<div style="position:absolute;left:143.99px;top:405.97px" class="cls_008"><span class="cls_008">all nodes of the cluster. This kind of information is, for example, used to</span></div>
<div style="position:absolute;left:143.99px;top:418.57px" class="cls_008"><span class="cls_008">update the local IP tables on clusters which are used for routing purposes.</span></div>
<div style="position:absolute;left:126.00px;top:435.49px" class="cls_008"><span class="cls_008">•  The data plane is where the application services communicate with each</span></div>
<div style="position:absolute;left:143.99px;top:448.09px" class="cls_008"><span class="cls_008">other and exchange data.</span></div>
<div style="position:absolute;left:107.99px;top:469.33px" class="cls_008"><span class="cls_008">Normally, orchestrators mainly care about securing the management and control</span></div>
<div style="position:absolute;left:107.99px;top:481.93px" class="cls_008"><span class="cls_008">plane. Securing the data plane is left to the user, yet the orchestrator may facilitate</span></div>
<div style="position:absolute;left:107.99px;top:494.53px" class="cls_008"><span class="cls_008">this task.</span></div>
<div style="position:absolute;left:108.00px;top:522.63px" class="cls_028"><span class="cls_028">Secure networks and network policies</span></div>
<div style="position:absolute;left:108.00px;top:543.61px" class="cls_008"><span class="cls_008">When running application services, not every service needs to communicate with</span></div>
<div style="position:absolute;left:108.00px;top:556.21px" class="cls_008"><span class="cls_008">every other service in the cluster. Thus, we want the ability to sandbox services</span></div>
<div style="position:absolute;left:108.00px;top:568.81px" class="cls_008"><span class="cls_008">from each other and only run those services in the same networking sandbox that</span></div>
<div style="position:absolute;left:108.00px;top:581.41px" class="cls_008"><span class="cls_008">absolutely need to communicate with each other. All other services and all network</span></div>
<div style="position:absolute;left:108.00px;top:594.01px" class="cls_008"><span class="cls_008">traffic coming from outside of the cluster should have no possibility of accessing the</span></div>
<div style="position:absolute;left:108.00px;top:606.61px" class="cls_008"><span class="cls_008">sandboxed services.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 171 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:149974px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background195.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">There are at least two ways in which this network-based sandboxing can happen.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">We can either use a </span><span class="cls_009">software-defined network</span><span class="cls_008"> (</span><span class="cls_009">SDN</span><span class="cls_008">) to group application services</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">or we can have one flat network and use network policies to control who does and</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">does not have access to a particular service or group of services.</span></div>
<div style="position:absolute;left:108.00px;top:180.39px" class="cls_028"><span class="cls_028">Role-based access control (RBAC)</span></div>
<div style="position:absolute;left:108.00px;top:201.37px" class="cls_008"><span class="cls_008">One of the most important tasks, next to security, an orchestrator must fulfill to make</span></div>
<div style="position:absolute;left:108.00px;top:213.97px" class="cls_008"><span class="cls_008">it enterprise ready is to provide role-based access to the cluster and its resources.</span></div>
<div style="position:absolute;left:108.00px;top:226.57px" class="cls_008"><span class="cls_008">RBAC defines how subjects, users, or groups of users of the system, organized</span></div>
<div style="position:absolute;left:108.00px;top:239.17px" class="cls_008"><span class="cls_008">into teams and so on, can access and manipulate the system. It makes sure that</span></div>
<div style="position:absolute;left:108.00px;top:251.77px" class="cls_008"><span class="cls_008">unauthorized personnel cannot do any harm to the system nor see any resources</span></div>
<div style="position:absolute;left:108.00px;top:264.37px" class="cls_008"><span class="cls_008">available in the system they're not supposed to know of or see.</span></div>
<div style="position:absolute;left:167.30px;top:300.13px" class="cls_025"><span class="cls_025">A typical enterprise might have user groups such as Development,</span></div>
<div style="position:absolute;left:167.30px;top:311.53px" class="cls_025"><span class="cls_025">QA, and Prod, and each of those groups can have one to many</span></div>
<div style="position:absolute;left:167.30px;top:322.93px" class="cls_025"><span class="cls_025">users associated with it. John Doe, the developer, is a member of the</span></div>
<div style="position:absolute;left:167.30px;top:334.33px" class="cls_025"><span class="cls_025">Development group and, as such, can access resources dedicated to the</span></div>
<div style="position:absolute;left:167.30px;top:345.73px" class="cls_025"><span class="cls_025">development team, but he cannot access, for example, the resources of</span></div>
<div style="position:absolute;left:167.30px;top:357.13px" class="cls_025"><span class="cls_025">the Prod team, of which Ann Harbor is a member. She, in turn, cannot</span></div>
<div style="position:absolute;left:167.30px;top:368.53px" class="cls_025"><span class="cls_025">interfere with the Development team's resources.</span></div>
<div style="position:absolute;left:108.00px;top:399.97px" class="cls_008"><span class="cls_008">One way of implementing RBAC is through the definition of </span><span class="cls_009">grants</span><span class="cls_008">. A grant is</span></div>
<div style="position:absolute;left:108.00px;top:412.57px" class="cls_008"><span class="cls_008">an association between a subject, a role, and a resource collection. Here, a role is</span></div>
<div style="position:absolute;left:108.00px;top:425.17px" class="cls_008"><span class="cls_008">comprised of a set of access permissions to a resource. Such permissions can be to</span></div>
<div style="position:absolute;left:108.00px;top:437.77px" class="cls_008"><span class="cls_008">create, stop, remove, list, or view containers; to deploy a new application service;</span></div>
<div style="position:absolute;left:108.00px;top:450.37px" class="cls_008"><span class="cls_008">to list cluster nodes or view the details of a cluster node; and many more.</span></div>
<div style="position:absolute;left:108.00px;top:471.62px" class="cls_008"><span class="cls_008">A resource collection is a group of logically related resources of the cluster, such as</span></div>
<div style="position:absolute;left:108.00px;top:484.22px" class="cls_008"><span class="cls_008">application services, secrets, data volumes, or containers.</span></div>
<div style="position:absolute;left:108.00px;top:512.31px" class="cls_028"><span class="cls_028">Secrets</span></div>
<div style="position:absolute;left:108.00px;top:533.29px" class="cls_008"><span class="cls_008">In our daily life, we have loads of secrets. Secrets are information that is not meant</span></div>
<div style="position:absolute;left:108.00px;top:545.89px" class="cls_008"><span class="cls_008">to be publicly known, such as the username and password combination you use</span></div>
<div style="position:absolute;left:108.00px;top:558.49px" class="cls_008"><span class="cls_008">to access your online bank account, or the code to your cell phone or your locker</span></div>
<div style="position:absolute;left:108.00px;top:571.09px" class="cls_008"><span class="cls_008">at the gym.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 172 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:150776px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background196.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">When writing software, we often need to use secrets, too. For example, we need</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">some certificate to authenticate our application service with some external service</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">we want to access, or we need a token to authenticate and authorize our service</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">when accessing some other API. In the past, developers, for convenience, have just</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">hardcoded those values or put them in clear text in some external configuration files.</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">There, this very sensitive information has been accessible to a broad audience that in</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">reality should never have had the opportunity to see those secrets.</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">Luckily, these days, orchestrators offer what's called secrets to deal with such</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">sensitive information in a highly secure way. Secrets can be created by authorized</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">or trusted personnel. The values of those secrets are then encrypted and stored in</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">the highly available cluster state database. The secrets, since they are encrypted, are</span></div>
<div style="position:absolute;left:108.00px;top:261.74px" class="cls_008"><span class="cls_008">now secure at rest. Once a secret is requested by an authorized application service,</span></div>
<div style="position:absolute;left:108.00px;top:274.34px" class="cls_008"><span class="cls_008">the secret is only forwarded to the cluster nodes that actually run an instance of that</span></div>
<div style="position:absolute;left:108.00px;top:286.94px" class="cls_008"><span class="cls_008">particular service, and the secret value is never stored on the node but mounted into</span></div>
<div style="position:absolute;left:108.00px;top:299.53px" class="cls_008"><span class="cls_008">the container in a </span><span class="cls_010">tmpfs</span><span class="cls_008"> RAM-based volume. Only inside the respective container is</span></div>
<div style="position:absolute;left:107.99px;top:312.13px" class="cls_008"><span class="cls_008">the secret value available in clear text.</span></div>
<div style="position:absolute;left:107.99px;top:333.38px" class="cls_008"><span class="cls_008">We already mentioned that the secrets are secure at rest. Once they are requested</span></div>
<div style="position:absolute;left:107.99px;top:345.98px" class="cls_008"><span class="cls_008">by a service, the cluster manager or master decrypts the secret and sends it over the</span></div>
<div style="position:absolute;left:107.99px;top:358.58px" class="cls_008"><span class="cls_008">wire to the target nodes. </span><span class="cls_021">So, what about the secrets being secure in transit?</span><span class="cls_008"> Well, we</span></div>
<div style="position:absolute;left:107.99px;top:371.18px" class="cls_008"><span class="cls_008">learned earlier that the cluster nodes use MTLS for their communication, thus the</span></div>
<div style="position:absolute;left:107.99px;top:383.78px" class="cls_008"><span class="cls_008">secret, although transmitted in clear text, is still secure since data packets will be</span></div>
<div style="position:absolute;left:107.99px;top:396.38px" class="cls_008"><span class="cls_008">encrypted by MTLS. Thus, secrets are secure at rest and in transit. Only services</span></div>
<div style="position:absolute;left:107.99px;top:408.98px" class="cls_008"><span class="cls_008">that are authorized to use secrets will ever have access to those secret values.</span></div>
<div style="position:absolute;left:108.00px;top:437.07px" class="cls_028"><span class="cls_028">Content trust</span></div>
<div style="position:absolute;left:108.00px;top:458.05px" class="cls_008"><span class="cls_008">For added security, we want to make sure that only trusted images run in our</span></div>
<div style="position:absolute;left:108.00px;top:470.65px" class="cls_008"><span class="cls_008">production cluster. Some orchestrators allow us to configure a cluster so that it</span></div>
<div style="position:absolute;left:108.00px;top:483.25px" class="cls_008"><span class="cls_008">can only ever run signed images. Content trust and signing images is all about</span></div>
<div style="position:absolute;left:108.00px;top:495.85px" class="cls_008"><span class="cls_008">making sure that the authors of the image are the ones that we expect them to be,</span></div>
<div style="position:absolute;left:108.00px;top:508.45px" class="cls_008"><span class="cls_008">namely our trusted developers or, even better, our trusted CI server. Furthermore,</span></div>
<div style="position:absolute;left:108.00px;top:521.05px" class="cls_008"><span class="cls_008">with content trust, we want to guarantee that the image we get is fresh and not an</span></div>
<div style="position:absolute;left:108.00px;top:533.65px" class="cls_008"><span class="cls_008">old and maybe vulnerable image. And finally, we want to make sure that the image</span></div>
<div style="position:absolute;left:108.00px;top:546.25px" class="cls_008"><span class="cls_008">cannot be compromised by malicious hackers in transit. The latter is often called a</span></div>
<div style="position:absolute;left:108.00px;top:558.85px" class="cls_009"><span class="cls_009">man-in-the-middle</span><span class="cls_008"> (</span><span class="cls_009">MITM</span><span class="cls_008">) attack.</span></div>
<div style="position:absolute;left:108.00px;top:580.10px" class="cls_008"><span class="cls_008">By signing images at the source and validating the signature at the target, we can</span></div>
<div style="position:absolute;left:108.00px;top:592.70px" class="cls_008"><span class="cls_008">guarantee that the images we want to run are not compromised.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 173 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:151578px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background197.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:113.01px" class="cls_028"><span class="cls_028">Reverse uptime</span></div>
<div style="position:absolute;left:108.00px;top:133.99px" class="cls_008"><span class="cls_008">The last point I want to discuss in the context of security is reverse uptime. </span><span class="cls_021">What do</span></div>
<div style="position:absolute;left:108.00px;top:146.59px" class="cls_021"><span class="cls_021">we mean by that?</span><span class="cls_008"> Imagine that you have configured and secured a production cluster.</span></div>
<div style="position:absolute;left:108.00px;top:159.19px" class="cls_008"><span class="cls_008">On this cluster, you're running a few mission-critical applications of your company.</span></div>
<div style="position:absolute;left:108.00px;top:171.79px" class="cls_008"><span class="cls_008">Now, a hacker has managed to find a security hole in one your software stacks and has</span></div>
<div style="position:absolute;left:108.00px;top:184.39px" class="cls_008"><span class="cls_008">gained root access to one of your cluster nodes. That alone is already bad enough but,</span></div>
<div style="position:absolute;left:108.00px;top:196.99px" class="cls_008"><span class="cls_008">even worse, this hacker could now mask their presence on this node they are root on</span></div>
<div style="position:absolute;left:108.00px;top:209.59px" class="cls_008"><span class="cls_008">the machine, after all, and then use it as a base to attack further nodes of your cluster.</span></div>
<div style="position:absolute;left:179.53px;top:240.94px" class="cls_025"><span class="cls_025">Root access in Linux or any Unix-type operating system means that</span></div>
<div style="position:absolute;left:179.53px;top:252.34px" class="cls_025"><span class="cls_025">one can do anything on this system. It is the highest level of access</span></div>
<div style="position:absolute;left:179.53px;top:263.74px" class="cls_025"><span class="cls_025">that someone can have. In Windows, the equivalent role is that of an</span></div>
<div style="position:absolute;left:179.53px;top:275.14px" class="cls_025"><span class="cls_025">Administrator.</span></div>
<div style="position:absolute;left:108.00px;top:302.19px" class="cls_008"><span class="cls_008">But </span><span class="cls_021">what if we leverage the fact that containers are ephemeral and cluster nodes are quickly</span></div>
<div style="position:absolute;left:108.00px;top:314.79px" class="cls_021"><span class="cls_021">provisioned, usually in a matter of minutes if fully automated?</span><span class="cls_008"> We just kill each cluster</span></div>
<div style="position:absolute;left:108.00px;top:327.39px" class="cls_008"><span class="cls_008">node after a certain uptime of, say, 1 day. The orchestrator is instructed to drain the</span></div>
<div style="position:absolute;left:108.00px;top:339.99px" class="cls_008"><span class="cls_008">node and then exclude it from the cluster. Once the node is out of the cluster, it is</span></div>
<div style="position:absolute;left:108.00px;top:352.59px" class="cls_008"><span class="cls_008">torn down and replaced by a freshly provisioned node.</span></div>
<div style="position:absolute;left:108.00px;top:373.83px" class="cls_008"><span class="cls_008">That way, the hacker has lost their base and the problem has been eliminated. This</span></div>
<div style="position:absolute;left:108.00px;top:386.43px" class="cls_008"><span class="cls_008">concept is not yet broadly available, though, but to me it seems to be a huge step</span></div>
<div style="position:absolute;left:108.00px;top:399.03px" class="cls_008"><span class="cls_008">towards increased security and, as far as I have discussed it with engineers working</span></div>
<div style="position:absolute;left:108.00px;top:411.63px" class="cls_008"><span class="cls_008">in this area, it is not difficult to implement.</span></div>
<div style="position:absolute;left:108.00px;top:441.57px" class="cls_022"><span class="cls_022">Introspection</span></div>
<div style="position:absolute;left:108.00px;top:464.55px" class="cls_008"><span class="cls_008">So far, we have discussed a lot of tasks that the orchestrator is responsible for and</span></div>
<div style="position:absolute;left:108.00px;top:477.15px" class="cls_008"><span class="cls_008">that it can execute in a completely autonomous way. But there is also the need</span></div>
<div style="position:absolute;left:108.00px;top:489.75px" class="cls_008"><span class="cls_008">for human operators to be able to see and analyze what's currently running on</span></div>
<div style="position:absolute;left:108.00px;top:502.35px" class="cls_008"><span class="cls_008">the cluster and in what state or health the individual applications are. For all this,</span></div>
<div style="position:absolute;left:108.00px;top:514.95px" class="cls_008"><span class="cls_008">we need the possibility of introspection. The orchestrator needs to surface crucial</span></div>
<div style="position:absolute;left:108.00px;top:527.55px" class="cls_008"><span class="cls_008">information in a way that is easily consumable and understandable.</span></div>
<div style="position:absolute;left:108.00px;top:548.79px" class="cls_008"><span class="cls_008">The orchestrator should collect system metrics from all the cluster nodes and make it</span></div>
<div style="position:absolute;left:108.00px;top:561.39px" class="cls_008"><span class="cls_008">accessible to the operators. Metrics include CPU, memory and disk usage, network</span></div>
<div style="position:absolute;left:108.00px;top:573.99px" class="cls_008"><span class="cls_008">bandwidth consumption, and more. The information should be easily available on</span></div>
<div style="position:absolute;left:108.00px;top:586.59px" class="cls_008"><span class="cls_008">a node-per-node basis, as well in an aggregated form.</span></div>
<div style="position:absolute;left:108.00px;top:607.83px" class="cls_008"><span class="cls_008">We also want the orchestrator to give us access to logs produced by service instances</span></div>
<div style="position:absolute;left:108.00px;top:620.43px" class="cls_008"><span class="cls_008">or containers. Even more, the orchestrator should provide us </span><span class="cls_010">exec</span><span class="cls_008"> access to each and</span></div>
<div style="position:absolute;left:108.00px;top:633.03px" class="cls_008"><span class="cls_008">every container if we have the correct authorization to do so. With </span><span class="cls_010">exec</span><span class="cls_008"> access to</span></div>
<div style="position:absolute;left:108.00px;top:645.63px" class="cls_008"><span class="cls_008">containers, one can then debug misbehaving containers.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 174 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:152380px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background198.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In highly distributed applications, where each request to the application goes</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">through numerous services until it is completely handled, tracing requests is really</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">important task. Ideally, the orchestrator supports us in implementing a tracing</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">strategy or gives us some good guidelines to follow.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">Finally, human operators can best monitor a system when working with a graphical</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">representation of all the collected metrics and logging and tracing information.</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">Here, we are speaking about dashboards. Every decent orchestrator should offer</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">at least some basic dashboard with a graphical representation of the most critical</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">system parameters.</span></div>
<div style="position:absolute;left:108.00px;top:245.18px" class="cls_008"><span class="cls_008">But human operators are not all that concerned about introspection. We also</span></div>
<div style="position:absolute;left:108.00px;top:257.78px" class="cls_008"><span class="cls_008">need to be able to connect external systems with the orchestrator to consume this</span></div>
<div style="position:absolute;left:108.00px;top:270.38px" class="cls_008"><span class="cls_008">information. There needs to be an API available, over which external systems can</span></div>
<div style="position:absolute;left:108.00px;top:282.98px" class="cls_008"><span class="cls_008">access data such as cluster state, metrics, and logs and use this information to  make</span></div>
<div style="position:absolute;left:108.00px;top:295.58px" class="cls_008"><span class="cls_008">automated decisions, such as creating pager or phone alerts, sending out emails,</span></div>
<div style="position:absolute;left:108.00px;top:308.18px" class="cls_008"><span class="cls_008">or triggering an alarm siren if some thresholds are exceeded by the system.</span></div>
<div style="position:absolute;left:108.00px;top:340.67px" class="cls_011"><span class="cls_011">Overview of popular orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:365.65px" class="cls_008"><span class="cls_008">At the time of writing, there are many orchestration engines out there and in use.</span></div>
<div style="position:absolute;left:108.00px;top:378.25px" class="cls_008"><span class="cls_008">But there are a few clear winners. The number one spot is clearly held by Kubernetes,</span></div>
<div style="position:absolute;left:108.00px;top:390.85px" class="cls_008"><span class="cls_008">which reigns supreme. A distant second is Docker's own SwarmKit, followed by</span></div>
<div style="position:absolute;left:108.00px;top:403.45px" class="cls_008"><span class="cls_008">others such as Microsoft </span><span class="cls_009">Azure Kubernetes Service</span><span class="cls_008"> (</span><span class="cls_009">AKS</span><span class="cls_008">), Apache Mesos, or AWS</span></div>
<div style="position:absolute;left:108.00px;top:416.05px" class="cls_009"><span class="cls_009">Elastic Container Service</span><span class="cls_008"> (</span><span class="cls_009">ECS</span><span class="cls_008">).</span></div>
<div style="position:absolute;left:108.00px;top:445.99px" class="cls_022"><span class="cls_022">Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:468.97px" class="cls_008"><span class="cls_008">Kubernetes was originally designed by Google and later donated to the </span><span class="cls_009">Cloud</span></div>
<div style="position:absolute;left:108.00px;top:481.57px" class="cls_009"><span class="cls_009">Native Computing Foundation</span><span class="cls_008"> (</span><span class="cls_009">CNCF</span><span class="cls_008">). Kubernetes was modeled after Google's</span></div>
<div style="position:absolute;left:108.00px;top:494.17px" class="cls_008"><span class="cls_008">proprietary Borg system, which has been running containers on supermassive scale</span></div>
<div style="position:absolute;left:108.00px;top:506.77px" class="cls_008"><span class="cls_008">for years. Kubernetes was Google's attempt to go back to the drawing board and</span></div>
<div style="position:absolute;left:108.00px;top:519.37px" class="cls_008"><span class="cls_008">completely start over and design a system that incorporates all the lessons learned</span></div>
<div style="position:absolute;left:108.00px;top:531.97px" class="cls_008"><span class="cls_008">with Borg.</span></div>
<div style="position:absolute;left:108.00px;top:553.22px" class="cls_008"><span class="cls_008">Contrary to Borg, which is proprietary technology, Kubernetes was open sourced</span></div>
<div style="position:absolute;left:108.00px;top:565.82px" class="cls_008"><span class="cls_008">early on. This was a very wise choice by Google, since it attracted a huge number of</span></div>
<div style="position:absolute;left:108.00px;top:578.42px" class="cls_008"><span class="cls_008">contributors from outside of the company and, over only a couple of years, an even</span></div>
<div style="position:absolute;left:108.00px;top:591.02px" class="cls_008"><span class="cls_008">more massive ecosystem evolved around Kubernetes. One can rightfully say that</span></div>
<div style="position:absolute;left:108.00px;top:603.62px" class="cls_008"><span class="cls_008">Kubernetes is the darling of the community in the container orchestration space.</span></div>
<div style="position:absolute;left:108.00px;top:616.22px" class="cls_008"><span class="cls_008">No other orchestrator has been able to produce so much hype and attract so many</span></div>
<div style="position:absolute;left:108.00px;top:628.82px" class="cls_008"><span class="cls_008">talented people willing to contribute in a meaningful way to the success of the</span></div>
<div style="position:absolute;left:108.00px;top:641.42px" class="cls_008"><span class="cls_008">project as a contributor or an early adopter.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 175 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:153182px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background199.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In that regard, Kubernetes in the container orchestration space to me looks very much</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">like what Linux has become in the server operating system space. Linux has become</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the de facto standard of server operating systems. All relevant companies, such as</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">Microsoft, IBM, Amazon, RedHat, and even Docker, have embraced Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">And there is one thing that cannot be denied: Kubernetes was designed from</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">the very beginning for massive scalability. After all, it was designed with Google</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">Borg in mind.</span></div>
<div style="position:absolute;left:108.00px;top:219.98px" class="cls_008"><span class="cls_008">One negative aspect that one could voice against Kubernetes is that it is complex</span></div>
<div style="position:absolute;left:108.00px;top:232.58px" class="cls_008"><span class="cls_008">to set up and manage, at least at the time of writing. There is a significant hurdle to</span></div>
<div style="position:absolute;left:108.00px;top:245.18px" class="cls_008"><span class="cls_008">overcome for newcomers. The first step is steep. But once one has worked with this</span></div>
<div style="position:absolute;left:108.00px;top:257.78px" class="cls_008"><span class="cls_008">orchestrator for a while, it all makes sense. The overall design is carefully thought</span></div>
<div style="position:absolute;left:108.00px;top:270.38px" class="cls_008"><span class="cls_008">through and executed very well.</span></div>
<div style="position:absolute;left:108.00px;top:291.62px" class="cls_008"><span class="cls_008">In the newest release of Kubernetes, 1.10, whose </span><span class="cls_009">general availability</span><span class="cls_008"> (</span><span class="cls_009">GA</span><span class="cls_008">) was in</span></div>
<div style="position:absolute;left:108.00px;top:304.22px" class="cls_008"><span class="cls_008">March 2018, most of the initial shortcomings  compared to other orchestrators such</span></div>
<div style="position:absolute;left:108.00px;top:316.82px" class="cls_008"><span class="cls_008">as Docker Swarm have been eliminated. For example, security and confidentiality</span></div>
<div style="position:absolute;left:108.00px;top:329.42px" class="cls_008"><span class="cls_008">is now not only an afterthought, but an integral part of the system.</span></div>
<div style="position:absolute;left:108.00px;top:350.66px" class="cls_008"><span class="cls_008">New features are implemented at a tremendous speed. New releases are happening</span></div>
<div style="position:absolute;left:108.00px;top:363.26px" class="cls_008"><span class="cls_008">every 3 months or so, more precisely, about every 100 days. Most of the new features</span></div>
<div style="position:absolute;left:108.00px;top:375.86px" class="cls_008"><span class="cls_008">are demand-driven, that is, companies using Kubernetes to orchestrate their mission-</span></div>
<div style="position:absolute;left:108.00px;top:388.46px" class="cls_008"><span class="cls_008">critical applications can voice their needs. This makes Kubernetes enterprise ready.</span></div>
<div style="position:absolute;left:108.00px;top:401.06px" class="cls_008"><span class="cls_008">It would be wrong to assume that this orchestrator is only for start-ups and not for</span></div>
<div style="position:absolute;left:108.00px;top:413.66px" class="cls_008"><span class="cls_008">risk-averse enterprises. The contrary is the case. </span><span class="cls_021">On what do I base this claim?</span><span class="cls_008"> Well,</span></div>
<div style="position:absolute;left:108.00px;top:426.26px" class="cls_008"><span class="cls_008">my claim is justified by the fact that companies such as Microsoft, Docker, and</span></div>
<div style="position:absolute;left:108.00px;top:438.86px" class="cls_008"><span class="cls_008">RedHat, whose clients are mostly big enterprises, have fully embraced Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:451.46px" class="cls_008"><span class="cls_008">and provide enterprise-grade support for it if it is used and integrated into their</span></div>
<div style="position:absolute;left:108.00px;top:464.06px" class="cls_008"><span class="cls_008">enterprise offerings.</span></div>
<div style="position:absolute;left:108.00px;top:485.30px" class="cls_008"><span class="cls_008">Kubernetes supports both Linux and Windows containers.</span></div>
<div style="position:absolute;left:108.00px;top:515.23px" class="cls_022"><span class="cls_022">Docker Swarm</span></div>
<div style="position:absolute;left:108.00px;top:538.21px" class="cls_008"><span class="cls_008">It is well-known that Docker popularized and commoditized software containers.</span></div>
<div style="position:absolute;left:108.00px;top:550.81px" class="cls_008"><span class="cls_008">Docker did not invent containers, but standardized them and made them broadly</span></div>
<div style="position:absolute;left:108.00px;top:563.41px" class="cls_008"><span class="cls_008">available, not least by offering the free image registry Docker Hub. Initially, Docker</span></div>
<div style="position:absolute;left:108.00px;top:576.01px" class="cls_008"><span class="cls_008">focused mainly on the developer and the development life cycle. But companies</span></div>
<div style="position:absolute;left:108.00px;top:588.61px" class="cls_008"><span class="cls_008">that started to use and love containers soon also wanted to use containers, not just</span></div>
<div style="position:absolute;left:108.00px;top:601.21px" class="cls_008"><span class="cls_008">during development or testing of new applications, but also to run those applications</span></div>
<div style="position:absolute;left:108.00px;top:613.81px" class="cls_008"><span class="cls_008">in production.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 176 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:153984px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background200.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Initially, Docker had nothing to offer in that space, so other companies jumped</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">into that vacuum and offered help to the users. But it didn't take long and Docker</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">recognized that there was a huge demand for a simple yet powerful orchestrator.</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">Docker's first attempt was a product called classic Swarm. It was a standalone</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">product that enabled users to create a cluster of Docker host machines that could</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">be used to run and scale their containerized applications in a highly available and</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">self-healing way.</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">The setup of a classic Docker Swarm, though, was hard. A lot of complicated manual</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">steps were involved. Customers loved the product but struggled with its complexity.</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">So Docker decided it could do better. It went back to the drawing board and came</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">up with SwarmKit. SwarmKit was introduced at DockerCon 2016 in Seattle and was</span></div>
<div style="position:absolute;left:108.00px;top:261.74px" class="cls_008"><span class="cls_008">an integral part of the newest version of the Docker engine. Yes, you got that right,</span></div>
<div style="position:absolute;left:108.00px;top:274.34px" class="cls_008"><span class="cls_008">SwarmKit was and still is to this day an integral part of the Docker engine. Thus, if</span></div>
<div style="position:absolute;left:108.00px;top:286.94px" class="cls_008"><span class="cls_008">you install a Docker host, you automatically have SwarmKit available with it.</span></div>
<div style="position:absolute;left:108.00px;top:308.18px" class="cls_008"><span class="cls_008">SwarmKit was designed with simplicity and security in mind. The mantra was</span></div>
<div style="position:absolute;left:108.01px;top:320.78px" class="cls_008"><span class="cls_008">and still is that it has to be almost trivial to set up a swarm, and the swarm has</span></div>
<div style="position:absolute;left:108.01px;top:333.38px" class="cls_008"><span class="cls_008">to be highly secure out of the box. Docker Swarm operates on the assumption</span></div>
<div style="position:absolute;left:108.01px;top:345.98px" class="cls_008"><span class="cls_008">of least privilege.</span></div>
<div style="position:absolute;left:108.01px;top:367.22px" class="cls_008"><span class="cls_008">Installing a complete, highly available Docker Swarm is literally as simple as</span></div>
<div style="position:absolute;left:108.01px;top:379.81px" class="cls_008"><span class="cls_008">starting with a </span><span class="cls_010">docker swarm init</span><span class="cls_008"> on the first node in the cluster, which becomes</span></div>
<div style="position:absolute;left:108.00px;top:392.41px" class="cls_008"><span class="cls_008">the so-called leader, and then a </span><span class="cls_010">docker swarm join &lt;join-token></span><span class="cls_008"> on all other</span></div>
<div style="position:absolute;left:108.00px;top:405.01px" class="cls_008"><span class="cls_008">nodes. The </span><span class="cls_010">join-token</span><span class="cls_008"> is generated by the leader during initialization. The whole</span></div>
<div style="position:absolute;left:108.00px;top:417.61px" class="cls_008"><span class="cls_008">process takes less than 5 minutes on a Swarm with up to 10 nodes. If it is automated,</span></div>
<div style="position:absolute;left:108.00px;top:430.21px" class="cls_008"><span class="cls_008">it takes even less time.</span></div>
<div style="position:absolute;left:108.00px;top:451.46px" class="cls_008"><span class="cls_008">As I already mentioned, security was top on the list of must-haves when Docker</span></div>
<div style="position:absolute;left:108.00px;top:464.06px" class="cls_008"><span class="cls_008">designed and developed SwarmKit. Containers provide security by relying on Linux</span></div>
<div style="position:absolute;left:108.00px;top:476.66px" class="cls_008"><span class="cls_008">kernel namespaces and cgroups as well as Linux syscall whitelisting (seccomp) and</span></div>
<div style="position:absolute;left:108.00px;top:489.26px" class="cls_008"><span class="cls_008">the support of Linux capabilities and the </span><span class="cls_009">Linux security module</span><span class="cls_008"> (</span><span class="cls_009">LSM</span><span class="cls_008">). Now, on</span></div>
<div style="position:absolute;left:108.00px;top:501.86px" class="cls_008"><span class="cls_008">top of that, SwarmKit adds  MTLS and secrets that are encrypted at rest and in</span></div>
<div style="position:absolute;left:108.00px;top:514.46px" class="cls_008"><span class="cls_008">transit. Furthermore, Swarm defines the so-called </span><span class="cls_009">container network model</span><span class="cls_008"> (</span><span class="cls_009">CNM</span><span class="cls_008">),</span></div>
<div style="position:absolute;left:108.00px;top:527.06px" class="cls_008"><span class="cls_008">which allows for SDNs that provide sandboxing for application services running</span></div>
<div style="position:absolute;left:108.00px;top:539.66px" class="cls_008"><span class="cls_008">on the swarm.</span></div>
<div style="position:absolute;left:108.00px;top:560.90px" class="cls_008"><span class="cls_008">Docker SwarmKit supports both Linux and Windows containers.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 177 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:154786px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background201.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Microsoft Azure Kubernetes Service (AKS)</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">AKS is Microsoft's offering of a fully hosted, highly available, scalable and fault</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">tolerant Kubernetes cluster. It takes the burden of you to provision and manage</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">a Kubernetes cluster and lets you concentrate on deploying and running your</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">containerized applications. With AKS a user can literally provision a production</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">ready cluster in a matter of minutes. Furthermore the applications running on such</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">a cluster can reach out easily into the rich eco-system of services provided by Azure</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">such as Log Analytics or identity management.</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">It is a powerful orchestration service based on the newest versions of Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">that makes sense if you are already heavily invested in the Azure ecosystem. Each</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">AKS cluster can be managed through the Azure portal, via Azure Resource Manager</span></div>
<div style="position:absolute;left:108.00px;top:270.09px" class="cls_008"><span class="cls_008">templates or via the Azure CLI. Applications are deployed and maintained using the</span></div>
<div style="position:absolute;left:108.00px;top:282.68px" class="cls_008"><span class="cls_008">well-known Kubernetes CLI </span><span class="cls_010">kubectl</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:303.93px" class="cls_008"><span class="cls_008">Microsoft, in its own words, claims the following:</span></div>
<div style="position:absolute;left:129.60px;top:325.52px" class="cls_021"><span class="cls_021">AKS makes it quick and easy to deploy and manage containerized applications</span></div>
<div style="position:absolute;left:129.60px;top:338.12px" class="cls_021"><span class="cls_021">without container orchestration expertise. It also eliminates the burden of ongoing</span></div>
<div style="position:absolute;left:129.60px;top:350.72px" class="cls_021"><span class="cls_021">operations and maintenance by provisioning, upgrading, and scaling resources on</span></div>
<div style="position:absolute;left:129.60px;top:363.32px" class="cls_021"><span class="cls_021">demand, without taking your applications offline.</span></div>
<div style="position:absolute;left:108.00px;top:393.26px" class="cls_022"><span class="cls_022">Apache Mesos and Marathon</span></div>
<div style="position:absolute;left:108.00px;top:416.24px" class="cls_008"><span class="cls_008">Apache </span><span class="cls_009">Mesos</span><span class="cls_008"> is an open source project and was originally designed to make a</span></div>
<div style="position:absolute;left:108.00px;top:428.84px" class="cls_008"><span class="cls_008">cluster of servers or nodes look like one single big server from the outside. Mesos is</span></div>
<div style="position:absolute;left:108.00px;top:441.44px" class="cls_008"><span class="cls_008">software that makes the management of computer clusters simple. Users of Mesos</span></div>
<div style="position:absolute;left:108.00px;top:454.04px" class="cls_008"><span class="cls_008">should not have to care about individual servers, but just assume they have a</span></div>
<div style="position:absolute;left:108.00px;top:466.64px" class="cls_008"><span class="cls_008">gigantic pool of resources to their disposal, which corresponds to the aggregate</span></div>
<div style="position:absolute;left:108.00px;top:479.24px" class="cls_008"><span class="cls_008">of all the resources of all the nodes in the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:500.49px" class="cls_008"><span class="cls_008">Mesos, in IT terms, is already pretty old, at least compared to the other orchestrators.</span></div>
<div style="position:absolute;left:108.00px;top:513.09px" class="cls_008"><span class="cls_008">It was first publicly presented in 2009. But at that time, of course, it wasn't designed</span></div>
<div style="position:absolute;left:108.00px;top:525.69px" class="cls_008"><span class="cls_008">to run containers since Docker didn't even exist yet. Similar to what Docker does</span></div>
<div style="position:absolute;left:108.00px;top:538.29px" class="cls_008"><span class="cls_008">with containers, Mesos uses Linux cgroups to isolate resources such as CPU,</span></div>
<div style="position:absolute;left:108.00px;top:550.89px" class="cls_008"><span class="cls_008">memory, or disk I/O for individual applications or services.</span></div>
<div style="position:absolute;left:108.00px;top:572.13px" class="cls_008"><span class="cls_008">Mesos is really the underlying infrastructure for other interesting services built on</span></div>
<div style="position:absolute;left:108.00px;top:584.73px" class="cls_008"><span class="cls_008">top of it. From the perspective of containers specifically, </span><span class="cls_009">Marathon</span><span class="cls_008"> is important.</span></div>
<div style="position:absolute;left:108.00px;top:597.33px" class="cls_008"><span class="cls_008">Marathon is a container orchestrator running on top of Mesos which is able to scale</span></div>
<div style="position:absolute;left:108.00px;top:609.93px" class="cls_008"><span class="cls_008">to thousands of nodes.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 178 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:155588px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background202.jpg" width=612 height=792></div>
<div style="position:absolute;left:468.87px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 9</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Marathon supports multiple container runtimes, such as Docker or its own Mesos</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">containers. It supports not only stateless but also stateful application services, for</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">example, databases such as PostgreSQL or MongoDB. Similar to Kubernetes and</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">Docker SwarmKit, it supports many of the features described earlier in this chapter,</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">such as high availability, health checks, service discovery, load balancing, and</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">location awareness, to just name some of the most important ones.</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">Although Mesos and, to a certain extent, Marathon are rather mature projects, their</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">reach is relatively limited. It seems to be most popular in the area of big data, that is,</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">to run data crunching services such as Spark or Hadoop.</span></div>
<div style="position:absolute;left:108.00px;top:253.87px" class="cls_022"><span class="cls_022">Amazon ECS</span></div>
<div style="position:absolute;left:108.00px;top:276.85px" class="cls_008"><span class="cls_008">If you are looking for a simple orchestrator and have already heavily bought into</span></div>
<div style="position:absolute;left:108.00px;top:289.45px" class="cls_008"><span class="cls_008">the AWS ecosystem, then Amazon's ECS might be the right choice for you. It is</span></div>
<div style="position:absolute;left:108.00px;top:302.05px" class="cls_008"><span class="cls_008">important to point out one very important limitation of ECS: if you buy into this</span></div>
<div style="position:absolute;left:108.00px;top:314.65px" class="cls_008"><span class="cls_008">container orchestrator, then you lock yourself into AWS. You will not be able to</span></div>
<div style="position:absolute;left:108.00px;top:327.25px" class="cls_008"><span class="cls_008">easily port an application running on ECS to another platform or cloud.</span></div>
<div style="position:absolute;left:108.00px;top:348.50px" class="cls_008"><span class="cls_008">Amazon promotes its ECS service as a highly scalable, fast container management</span></div>
<div style="position:absolute;left:108.00px;top:361.10px" class="cls_008"><span class="cls_008">service that makes it easy to run, stop, and manage Docker containers on a cluster.</span></div>
<div style="position:absolute;left:108.00px;top:373.70px" class="cls_008"><span class="cls_008">Next to running containers, ECS gives direct access to many other AWS services</span></div>
<div style="position:absolute;left:108.00px;top:386.30px" class="cls_008"><span class="cls_008">from the application services running inside the containers. This tight and seamless</span></div>
<div style="position:absolute;left:108.00px;top:398.90px" class="cls_008"><span class="cls_008">integration with many popular AWS services is what makes ECS compelling for</span></div>
<div style="position:absolute;left:108.00px;top:411.50px" class="cls_008"><span class="cls_008">users who are looking for an easy way to get their containerized applications up and</span></div>
<div style="position:absolute;left:108.00px;top:424.10px" class="cls_008"><span class="cls_008">running in a robust and highly scalable environment. Amazon also provides its own</span></div>
<div style="position:absolute;left:108.00px;top:436.70px" class="cls_008"><span class="cls_008">private image registry.</span></div>
<div style="position:absolute;left:108.00px;top:457.94px" class="cls_008"><span class="cls_008">With AWS ECS, you can use Fargate to have it fully manage the underlying</span></div>
<div style="position:absolute;left:108.00px;top:470.54px" class="cls_008"><span class="cls_008">infrastructure so that you can concentrate exclusively on deploying containerized</span></div>
<div style="position:absolute;left:108.00px;top:483.14px" class="cls_008"><span class="cls_008">applications and do not have to care about how to create and manage a cluster of</span></div>
<div style="position:absolute;left:108.00px;top:495.74px" class="cls_008"><span class="cls_008">nodes. ECS supports both Linux and Windows containers.</span></div>
<div style="position:absolute;left:108.00px;top:516.98px" class="cls_008"><span class="cls_008">In summary, ECS is simple to use, highly scalable, and well-integrated with other</span></div>
<div style="position:absolute;left:108.00px;top:529.58px" class="cls_008"><span class="cls_008">popular AWS services, but it is not as powerful as, say, Kubernetes or Docker</span></div>
<div style="position:absolute;left:108.00px;top:542.18px" class="cls_008"><span class="cls_008">SwarmKit and it is only available on Amazon AWS.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 179 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:156390px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background203.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">This chapter demonstrated why orchestrators are needed in the first place and how</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">they conceptually work. It pointed out which orchestrators are the most prominent</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">ones at the time of writing and discussed the main commonalities and differences</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">between the various orchestrators.</span></div>
<div style="position:absolute;left:108.00px;top:195.94px" class="cls_008"><span class="cls_008">The next chapter will introduce the currently most popular container orchestrator,</span></div>
<div style="position:absolute;left:108.00px;top:208.54px" class="cls_008"><span class="cls_008">called Kubernetes. It will elaborate on all the concepts and objects Kubernetes uses</span></div>
<div style="position:absolute;left:108.00px;top:221.14px" class="cls_008"><span class="cls_008">to deploy and run a distributed, resilient, robust, and highly available application</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_008"><span class="cls_008">in a cluster on-premises or in the cloud.</span></div>
<div style="position:absolute;left:108.00px;top:266.24px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:291.22px" class="cls_008"><span class="cls_008">Answer the following questions to assess your learning progress:</span></div>
<div style="position:absolute;left:126.00px;top:312.46px" class="cls_008"><span class="cls_008">1.  Why do we need an orchestrator? Name two to three reasons.</span></div>
<div style="position:absolute;left:126.00px;top:329.38px" class="cls_008"><span class="cls_008">2.  Name three to four typical responsibilities of an orchestrator.</span></div>
<div style="position:absolute;left:126.00px;top:346.29px" class="cls_008"><span class="cls_008">3.  Name at least two container orchestrators, as well as the main sponsor</span></div>
<div style="position:absolute;left:143.99px;top:358.89px" class="cls_008"><span class="cls_008">behind them.</span></div>
<div style="position:absolute;left:108.00px;top:391.40px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:416.38px" class="cls_008"><span class="cls_008">The following links provide some deeper insight to orchestration-related topics:</span></div>
<div style="position:absolute;left:126.00px;top:437.62px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Kubernetes - production-grade orchestration</span><span class="cls_008"> at </span><A HREF="https://kubernetes.io/">https://kubernetes.io/</A> </span></div>
<div style="position:absolute;left:126.00px;top:454.54px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Docker Swarm Mode overview</span><span class="cls_008"> at </span><A HREF="https://docs.docker.com/engine/swarm/">https://docs.docker.com/engine/swarm/</A> </span></div>
<div style="position:absolute;left:126.00px;top:471.46px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Mesosphere - container orchestration services</span><span class="cls_008"> at </span><A HREF="http://bit.ly/2GMpko3">http://bit.ly/2GMpko3</A> </span></div>
<div style="position:absolute;left:126.00px;top:488.38px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Containers and orchestration explained</span><span class="cls_008"> at </span><A HREF="http://bit.ly/2DFoQgx">http://bit.ly/2DFoQgx</A> </span></div>
<div style="position:absolute;left:126.00px;top:505.30px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Azure Kubernetes Service (AKS)</span><span class="cls_008"> at </span><A HREF="https://bit.ly/2MECYzY">https://bit.ly/2MECYzY</A> </span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 180 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:157192px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background204.jpg" width=612 height=792></div>
<div style="position:absolute;left:130.48px;top:218.96px" class="cls_015"><span class="cls_015">Orchestrating Containerized</span></div>
<div style="position:absolute;left:118.78px;top:254.96px" class="cls_015"><span class="cls_015">Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:308.66px" class="cls_008"><span class="cls_008">In the last chapter, we introduced orchestrators. Like a conductor in an orchestra, an</span></div>
<div style="position:absolute;left:108.00px;top:321.26px" class="cls_008"><span class="cls_008">orchestrator makes sure that all our containerized application services play together</span></div>
<div style="position:absolute;left:108.00px;top:333.86px" class="cls_008"><span class="cls_008">nicely and contribute harmoniously toward a common goal. Such orchestrators have</span></div>
<div style="position:absolute;left:108.00px;top:346.46px" class="cls_008"><span class="cls_008">quite a few responsibilities, which we have discussed in detail. We also provided</span></div>
<div style="position:absolute;left:108.00px;top:359.06px" class="cls_008"><span class="cls_008">a short overview of the most important container orchestrators on the market.</span></div>
<div style="position:absolute;left:108.00px;top:380.30px" class="cls_008"><span class="cls_008">In this chapter, we're going to introduce </span><span class="cls_009">Kubernetes</span><span class="cls_008">. Kubernetes is currently the</span></div>
<div style="position:absolute;left:108.00px;top:392.90px" class="cls_008"><span class="cls_008">clear leader in the container orchestration space. We are starting with a high-level</span></div>
<div style="position:absolute;left:108.00px;top:405.50px" class="cls_008"><span class="cls_008">overview of the architecture of a Kubernetes cluster, and then we will discuss the</span></div>
<div style="position:absolute;left:108.00px;top:418.10px" class="cls_008"><span class="cls_008">main objects used in Kubernetes to define and run containerized applications.</span></div>
<div style="position:absolute;left:108.00px;top:439.34px" class="cls_008"><span class="cls_008">The topics discussed in this chapter are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:460.59px" class="cls_008"><span class="cls_008">•  Architecture</span></div>
<div style="position:absolute;left:126.00px;top:477.50px" class="cls_008"><span class="cls_008">•  Kubernetes masters</span></div>
<div style="position:absolute;left:126.00px;top:494.42px" class="cls_008"><span class="cls_008">•  Cluster nodes</span></div>
<div style="position:absolute;left:126.00px;top:511.33px" class="cls_008"><span class="cls_008">•  Introduction to MiniKube</span></div>
<div style="position:absolute;left:126.00px;top:528.25px" class="cls_008"><span class="cls_008">•  Kubernetes support in Docker for Mac and Docker for Windows</span></div>
<div style="position:absolute;left:126.00px;top:545.16px" class="cls_008"><span class="cls_008">•  Pods</span></div>
<div style="position:absolute;left:126.00px;top:562.08px" class="cls_008"><span class="cls_008">•  Kubernetes ReplicaSet</span></div>
<div style="position:absolute;left:126.00px;top:578.99px" class="cls_008"><span class="cls_008">•  Kubernetes deployment</span></div>
<div style="position:absolute;left:126.00px;top:595.91px" class="cls_008"><span class="cls_008">•  Kubernetes service</span></div>
<div style="position:absolute;left:126.00px;top:612.83px" class="cls_008"><span class="cls_008">•  Context-based routing</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 181 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:157994px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background205.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After finishing this chapter, you will be able to do the following:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  Draft the high-level architecture of a Kubernetes cluster on a napkin</span></div>
<div style="position:absolute;left:126.00px;top:152.65px" class="cls_008"><span class="cls_008">•  Explain three to four main characteristics of a Kubernetes pod</span></div>
<div style="position:absolute;left:126.00px;top:169.57px" class="cls_008"><span class="cls_008">•  Describe the role of Kubernetes ReplicaSets in two to three short sentences</span></div>
<div style="position:absolute;left:126.00px;top:186.48px" class="cls_008"><span class="cls_008">•  Explain the two to three main responsibilities of a Kubernetes service</span></div>
<div style="position:absolute;left:126.00px;top:203.40px" class="cls_008"><span class="cls_008">•  Create a pod in Minikube</span></div>
<div style="position:absolute;left:126.00px;top:220.31px" class="cls_008"><span class="cls_008">•  Configure Docker for Mac or Windows to use Kubernetes as an orchestrator</span></div>
<div style="position:absolute;left:126.00px;top:237.23px" class="cls_008"><span class="cls_008">•  Create a deployment in Docker for Mac or Windows</span></div>
<div style="position:absolute;left:126.00px;top:254.14px" class="cls_008"><span class="cls_008">•  Create a Kubernetes service to expose an application service internally</span></div>
<div style="position:absolute;left:143.99px;top:266.74px" class="cls_008"><span class="cls_008">(or externally) to the cluster</span></div>
<div style="position:absolute;left:108.00px;top:299.27px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:324.25px" class="cls_008"><span class="cls_008">The link to the code files can be found here at </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master/ch10">https://github.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:336.85px" class="cls_010"><span class="cls_010"> </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master/ch10">appswithdockerandkubernetes/labs/tree/master/ch10</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:369.35px" class="cls_011"><span class="cls_011">Architecture</span></div>
<div style="position:absolute;left:108.00px;top:394.33px" class="cls_008"><span class="cls_008">A Kubernetes cluster consists of a set of servers. These servers can be VMs or</span></div>
<div style="position:absolute;left:108.00px;top:406.93px" class="cls_008"><span class="cls_008">physical servers. The latter are also called </span><span class="cls_009">bare metal</span><span class="cls_008">. Each member of the cluster can</span></div>
<div style="position:absolute;left:108.00px;top:419.53px" class="cls_008"><span class="cls_008">have one of two roles. It is either a Kubernetes master or a (worker) node. The former</span></div>
<div style="position:absolute;left:108.00px;top:432.13px" class="cls_008"><span class="cls_008">is used to manage the cluster, while the latter will run the application's workload.</span></div>
<div style="position:absolute;left:108.00px;top:444.73px" class="cls_008"><span class="cls_008">I have put the worker in parentheses, since in Kubernetes parlance you only talk</span></div>
<div style="position:absolute;left:108.00px;top:457.33px" class="cls_008"><span class="cls_008">about a node when talking about a server that runs an application's workload. But in</span></div>
<div style="position:absolute;left:108.00px;top:469.93px" class="cls_008"><span class="cls_008">Docker parlance and in the Swarm, the equivalent is a worker node. I think that the</span></div>
<div style="position:absolute;left:108.00px;top:482.53px" class="cls_008"><span class="cls_008">notion of a worker node better describes the role of the server than a simple node.</span></div>
<div style="position:absolute;left:108.00px;top:503.78px" class="cls_008"><span class="cls_008">In a cluster, you have a small and odd number of masters and as many worker nodes</span></div>
<div style="position:absolute;left:108.00px;top:516.38px" class="cls_008"><span class="cls_008">as needed. Small clusters might only have a few worker nodes, while more realistic</span></div>
<div style="position:absolute;left:108.00px;top:528.98px" class="cls_008"><span class="cls_008">clusters might have dozens or even hundreds of worker nodes. Technically, there</span></div>
<div style="position:absolute;left:108.00px;top:541.58px" class="cls_008"><span class="cls_008">is no limit on how many worker nodes a cluster can have; in reality, you might</span></div>
<div style="position:absolute;left:108.00px;top:554.18px" class="cls_008"><span class="cls_008">experience a significant slowdown in some management operations when dealing</span></div>
<div style="position:absolute;left:108.00px;top:566.78px" class="cls_008"><span class="cls_008">with thousands of nodes, though. All members of the cluster need to be connected</span></div>
<div style="position:absolute;left:108.00px;top:579.38px" class="cls_008"><span class="cls_008">by a physical network, the so-called </span><span class="cls_009">underlay network</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 182 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:158796px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background206.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Kubernetes defines one flat network for the whole cluster. Kubernetes does not</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">provide any networking implementation out of the box but relies on plugins from</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">third parties. Kubernetes only defines the </span><span class="cls_009">Container Network Interface</span><span class="cls_008"> (</span><span class="cls_009">CNI</span><span class="cls_008">) and</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">leaves the implementation to others. The CNI is pretty simple. It basically states that</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">each pod running in the cluster must be able to reach any other pod also running in</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">the cluster without any </span><span class="cls_009">Network Address Translation</span><span class="cls_008"> (</span><span class="cls_009">NAT</span><span class="cls_008">) happening in between.</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">The same must be true between cluster nodes and pods; that is, applications or</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">daemons running directly on a cluster node must be able to reach each pod in the</span></div>
<div style="position:absolute;left:108.00px;top:215.29px" class="cls_008"><span class="cls_008">cluster, and vice versa.</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">In the following diagram, I try to illustrate the high-level architecture of</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">a Kubernetes cluster:</span></div>
<div style="position:absolute;left:223.50px;top:595.11px" class="cls_026"><span class="cls_026">High-level architecture diagram of Kubernetes</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 183 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:159598px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background207.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The preceding diagram is explained as follows:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:143.99px;top:135.74px" class="cls_008"><span class="cls_008">On the top center, we have a cluster of </span><span class="cls_009">etcd</span><span class="cls_008"> nodes. etcd is a distributed key-</span></div>
<div style="position:absolute;left:144.00px;top:148.34px" class="cls_008"><span class="cls_008">value store that, in a Kubernetes cluster, is used to store all the states of the</span></div>
<div style="position:absolute;left:144.00px;top:160.94px" class="cls_008"><span class="cls_008">cluster. The number of etcd nodes has to be odd as mandated by the </span><span class="cls_009">Raft</span></div>
<div style="position:absolute;left:144.00px;top:173.54px" class="cls_008"><span class="cls_008">consensus protocol, which they use to coordinate among themselves. When</span></div>
<div style="position:absolute;left:144.00px;top:186.14px" class="cls_008"><span class="cls_008">we talk about the cluster state, we do not include data that is produced or</span></div>
<div style="position:absolute;left:144.00px;top:198.74px" class="cls_008"><span class="cls_008">consumed by applications running in the cluster, but rather we're talking</span></div>
<div style="position:absolute;left:144.00px;top:211.34px" class="cls_008"><span class="cls_008">about all the information on the topology of the cluster, what services are</span></div>
<div style="position:absolute;left:144.00px;top:223.94px" class="cls_008"><span class="cls_008">running, network settings, secrets used, and more. That said, this etcd cluster</span></div>
<div style="position:absolute;left:144.00px;top:236.54px" class="cls_008"><span class="cls_008">is really mission critical to the cluster, and, thus, we should never run only</span></div>
<div style="position:absolute;left:144.00px;top:249.14px" class="cls_008"><span class="cls_008">one etcd server in a production environment or any environment that needs</span></div>
<div style="position:absolute;left:144.00px;top:261.74px" class="cls_008"><span class="cls_008">to be highly available.</span></div>
<div style="position:absolute;left:126.01px;top:278.65px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:144.00px;top:278.65px" class="cls_008"><span class="cls_008">We then have a cluster of Kubernetes master nodes that also form</span></div>
<div style="position:absolute;left:144.00px;top:291.25px" class="cls_008"><span class="cls_008">a consensus group among themselves, similar to the etcd nodes. The number</span></div>
<div style="position:absolute;left:144.00px;top:303.85px" class="cls_008"><span class="cls_008">of master nodes also has to be an odd number. We can run the cluster with</span></div>
<div style="position:absolute;left:144.00px;top:316.45px" class="cls_008"><span class="cls_008">a single master, but we should never do that in a production or</span></div>
<div style="position:absolute;left:144.00px;top:329.05px" class="cls_008"><span class="cls_008">mission-critical system. There, we always should have at least three master</span></div>
<div style="position:absolute;left:144.00px;top:341.65px" class="cls_008"><span class="cls_008">nodes. Since the master nodes are used to manage the whole cluster, we are</span></div>
<div style="position:absolute;left:144.00px;top:354.25px" class="cls_008"><span class="cls_008">also talking about the management plane. The master nodes use the etcd</span></div>
<div style="position:absolute;left:144.00px;top:366.85px" class="cls_008"><span class="cls_008">cluster as their backing store. It is a good practice to put a </span><span class="cls_009">Load Balancer</span><span class="cls_008"> (</span><span class="cls_009">LB</span><span class="cls_008">)</span></div>
<div style="position:absolute;left:144.00px;top:379.45px" class="cls_008"><span class="cls_008">in front of the master nodes with a well-known </span><span class="cls_009">Fully Qualified Domain</span></div>
<div style="position:absolute;left:144.00px;top:392.05px" class="cls_009"><span class="cls_009">Name</span><span class="cls_008"> (</span><span class="cls_009">FQDN</span><span class="cls_008">), such as </span><span class="cls_010">https://admin.example.com</span><span class="cls_008">. All tools that are</span></div>
<div style="position:absolute;left:144.00px;top:404.65px" class="cls_008"><span class="cls_008">used to manage the Kubernetes cluster should access it through this LB,</span></div>
<div style="position:absolute;left:144.00px;top:417.25px" class="cls_008"><span class="cls_008">rather than using the public IP address of one of the master nodes.</span></div>
<div style="position:absolute;left:144.00px;top:429.85px" class="cls_008"><span class="cls_008">This is shown in the top left-hand side of the preceding diagram.</span></div>
<div style="position:absolute;left:126.00px;top:446.77px" class="cls_008"><span class="cls_008">•</span></div>
<div style="position:absolute;left:144.00px;top:446.77px" class="cls_008"><span class="cls_008">Towards the bottom of the diagram, we have a cluster of worker nodes.</span></div>
<div style="position:absolute;left:144.00px;top:459.37px" class="cls_008"><span class="cls_008">The number of nodes can be as low as 1 and does not have an upper limit.</span></div>
<div style="position:absolute;left:144.00px;top:471.97px" class="cls_008"><span class="cls_008">Kubernetes master and worker nodes communicate with one another. It</span></div>
<div style="position:absolute;left:144.00px;top:484.57px" class="cls_008"><span class="cls_008">is a bidirectional form of communication, which is different than the one</span></div>
<div style="position:absolute;left:144.00px;top:497.17px" class="cls_008"><span class="cls_008">we know from Docker Swarm. In Docker Swarm, only the manager nodes</span></div>
<div style="position:absolute;left:144.00px;top:509.77px" class="cls_008"><span class="cls_008">communicate with the worker nodes and never the other way around. All</span></div>
<div style="position:absolute;left:144.00px;top:522.37px" class="cls_008"><span class="cls_008">ingress traffic accessing the applications running in the cluster should be</span></div>
<div style="position:absolute;left:144.00px;top:534.97px" class="cls_008"><span class="cls_008">going through another load balancer. This is the application load balancer</span></div>
<div style="position:absolute;left:144.00px;top:547.57px" class="cls_008"><span class="cls_008">or reverse proxy. We never want external traffic to directly access any</span></div>
<div style="position:absolute;left:144.00px;top:560.17px" class="cls_008"><span class="cls_008">of the worker nodes.</span></div>
<div style="position:absolute;left:108.00px;top:581.41px" class="cls_008"><span class="cls_008">Now that we have an idea about the high-level architecture of a Kubernetes cluster,</span></div>
<div style="position:absolute;left:108.00px;top:594.01px" class="cls_008"><span class="cls_008">let's dive a bit deeper and first look at the Kubernetes master and worker nodes.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 184 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:160400px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background208.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Kubernetes master nodes</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Kubernetes master nodes are used to manage a Kubernetes cluster. The following is</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">a high-level diagram of such a master:</span></div>
<div style="position:absolute;left:272.79px;top:328.65px" class="cls_026"><span class="cls_026">Kubernetes master</span></div>
<div style="position:absolute;left:108.00px;top:347.39px" class="cls_008"><span class="cls_008">At the bottom of the preceding diagram, we have the Infrastructure, which can be</span></div>
<div style="position:absolute;left:108.00px;top:359.99px" class="cls_008"><span class="cls_008">a VM on-premise, in the cloud, or on a server (often called </span><span class="cls_009">bare metal</span><span class="cls_008">). Currently,</span></div>
<div style="position:absolute;left:108.00px;top:372.59px" class="cls_008"><span class="cls_008">Kubernetes masters only run on Linux. Most popular Linux distributions, such as</span></div>
<div style="position:absolute;left:108.00px;top:385.19px" class="cls_008"><span class="cls_008">RHEL, CentOS, and Ubuntu, are supported. On this Linux machine, we then have</span></div>
<div style="position:absolute;left:108.00px;top:397.79px" class="cls_008"><span class="cls_008">at least the following four Kubernetes services running:</span></div>
<div style="position:absolute;left:126.00px;top:419.03px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  API server</span><span class="cls_008">: This is the gateway to Kubernetes. All requests to list, create,</span></div>
<div style="position:absolute;left:143.99px;top:431.63px" class="cls_008"><span class="cls_008">modify, or delete any resources in the cluster must go through this service.</span></div>
<div style="position:absolute;left:143.99px;top:444.23px" class="cls_008"><span class="cls_008">It exposes a REST interface that tools such as </span><span class="cls_010">kubectl</span><span class="cls_008"> use to manage the</span></div>
<div style="position:absolute;left:144.00px;top:456.83px" class="cls_008"><span class="cls_008">cluster and applications in the cluster.</span></div>
<div style="position:absolute;left:126.00px;top:473.74px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Controller</span><span class="cls_008">: The controller, or more precisely the controller manager, is</span></div>
<div style="position:absolute;left:144.00px;top:486.34px" class="cls_008"><span class="cls_008">a control loop that observes the state of the cluster through the API server</span></div>
<div style="position:absolute;left:144.00px;top:498.94px" class="cls_008"><span class="cls_008">and makes changes, attempting to move the current or effective state</span></div>
<div style="position:absolute;left:144.00px;top:511.54px" class="cls_008"><span class="cls_008">toward the desired state.</span></div>
<div style="position:absolute;left:126.00px;top:528.46px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Scheduler</span><span class="cls_008">: The scheduler is a service that tries its best to schedule pods on</span></div>
<div style="position:absolute;left:143.99px;top:541.06px" class="cls_008"><span class="cls_008">worker nodes considering various boundary conditions, such as resource</span></div>
<div style="position:absolute;left:143.99px;top:553.66px" class="cls_008"><span class="cls_008">requirements, policies, quality-of-service requirements, and more.</span></div>
<div style="position:absolute;left:125.99px;top:570.57px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Cluster store</span><span class="cls_008">: This is an instance of etcd that is used to store all information</span></div>
<div style="position:absolute;left:143.99px;top:583.17px" class="cls_008"><span class="cls_008">about the state of the cluster.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 185 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:161202px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background209.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To be more precise, etcd, which is used as a cluster store, does not necessarily have</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">to be installed on the same node as the other Kubernetes services. Sometimes,</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">Kubernetes clusters are configured that use standalone clusters of etcd servers, as</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">shown in the architecture diagram in the previous section. But which variant to use</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">is an advanced management decision and is outside of the scope of this book.</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">We need at least one master, but to achieve high availability, we need three or more</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">master nodes. This is very similar to what we have learned about the manager nodes</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">of a Docker Swarm. In this regard, a Kubernetes master is equivalent to a Swarm</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">manager node.</span></div>
<div style="position:absolute;left:108.00px;top:245.18px" class="cls_008"><span class="cls_008">Kubernetes masters never run an application's workload. Their sole purpose is to</span></div>
<div style="position:absolute;left:108.00px;top:257.78px" class="cls_008"><span class="cls_008">manage the cluster. Kubernetes masters build a </span><span class="cls_009">Raft consensus group</span><span class="cls_008">. The Raft</span></div>
<div style="position:absolute;left:108.00px;top:270.38px" class="cls_008"><span class="cls_008">protocol is a standard protocol used in situations where a group of members need to</span></div>
<div style="position:absolute;left:108.00px;top:282.98px" class="cls_008"><span class="cls_008">make decisions. It is used in many well-known software products such as MongoDB,</span></div>
<div style="position:absolute;left:108.00px;top:295.58px" class="cls_008"><span class="cls_008">Docker SwarmKit, and Kubernetes. For a more thorough discussion of the Raft</span></div>
<div style="position:absolute;left:108.00px;top:308.18px" class="cls_008"><span class="cls_008">protocol, see the link in the Further reading section.</span></div>
<div style="position:absolute;left:108.00px;top:329.42px" class="cls_008"><span class="cls_008">As we have mentioned in the previous section, the state of the Kubernetes cluster is</span></div>
<div style="position:absolute;left:108.00px;top:342.02px" class="cls_008"><span class="cls_008">stored in etcd. If the Kubernetes cluster is supposed to be highly available, then etcd</span></div>
<div style="position:absolute;left:108.00px;top:354.62px" class="cls_008"><span class="cls_008">must also be configured in high-availability mode, which normally means that one</span></div>
<div style="position:absolute;left:108.00px;top:367.22px" class="cls_008"><span class="cls_008">has at least three etcd instances running on different nodes.</span></div>
<div style="position:absolute;left:108.00px;top:388.46px" class="cls_008"><span class="cls_008">Let's state once again that the whole cluster state is stored in etcd. This includes all</span></div>
<div style="position:absolute;left:108.00px;top:401.06px" class="cls_008"><span class="cls_008">the information about all the cluster nodes, all the replica sets, deployments, secrets,</span></div>
<div style="position:absolute;left:108.00px;top:413.66px" class="cls_008"><span class="cls_008">network policies, routing information, and so on. It is, therefore, crucial that we have</span></div>
<div style="position:absolute;left:108.00px;top:426.26px" class="cls_008"><span class="cls_008">a robust backup strategy in place for this key-value store.</span></div>
<div style="position:absolute;left:108.00px;top:447.50px" class="cls_008"><span class="cls_008">Now let's look at the nodes that will be running the actual workload of the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:479.99px" class="cls_011"><span class="cls_011">Cluster nodes</span></div>
<div style="position:absolute;left:108.00px;top:504.97px" class="cls_008"><span class="cls_008">Cluster nodes are the nodes on to which Kubernetes schedules an application's</span></div>
<div style="position:absolute;left:108.00px;top:517.57px" class="cls_008"><span class="cls_008">workload. They are the workhorses of the cluster. A Kubernetes cluster can have a</span></div>
<div style="position:absolute;left:108.00px;top:530.17px" class="cls_008"><span class="cls_008">few, dozens, hundreds, or even thousands, of cluster nodes. Kubernetes has been</span></div>
<div style="position:absolute;left:108.00px;top:542.77px" class="cls_008"><span class="cls_008">built from the ground up for high scalability. Don't forget that Kubernetes has been</span></div>
<div style="position:absolute;left:108.00px;top:555.37px" class="cls_008"><span class="cls_008">modeled after Google Borg, which has been running tens of thousands of containers</span></div>
<div style="position:absolute;left:108.00px;top:567.97px" class="cls_008"><span class="cls_008">for years:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 186 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:162004px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background210.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:262.12px;top:281.20px" class="cls_026"><span class="cls_026">Kubernetes worker node</span></div>
<div style="position:absolute;left:108.00px;top:299.94px" class="cls_008"><span class="cls_008">A worker node can run on a VM or on bare metal, on-premise, or in the cloud.</span></div>
<div style="position:absolute;left:108.00px;top:312.54px" class="cls_008"><span class="cls_008">Originally, worker nodes could only be configured on Linux. But since Version 1.10</span></div>
<div style="position:absolute;left:108.00px;top:325.14px" class="cls_008"><span class="cls_008">of Kubernetes, worker nodes can also run on Windows Server 2010. It is perfectly</span></div>
<div style="position:absolute;left:108.00px;top:337.74px" class="cls_008"><span class="cls_008">fine to have a mixed cluster with Linux and Windows worker nodes.</span></div>
<div style="position:absolute;left:108.00px;top:358.98px" class="cls_008"><span class="cls_008">On each node, we have three services that need to run, which are described</span></div>
<div style="position:absolute;left:108.00px;top:371.58px" class="cls_008"><span class="cls_008">as follows:</span></div>
<div style="position:absolute;left:126.00px;top:392.82px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Kubelet</span><span class="cls_008">: This is the first and foremost service. Kubelet is what's called the</span></div>
<div style="position:absolute;left:143.99px;top:405.42px" class="cls_009"><span class="cls_009">primary node agent</span><span class="cls_008">. The Kubelet service uses pod specifications to make</span></div>
<div style="position:absolute;left:143.99px;top:418.02px" class="cls_008"><span class="cls_008">sure all of the containers of the corresponding pods are running and healthy.</span></div>
<div style="position:absolute;left:143.99px;top:430.62px" class="cls_008"><span class="cls_008">Pod specifications are files written in </span><span class="cls_009">YAML</span><span class="cls_008"> or JSON format, and they</span></div>
<div style="position:absolute;left:143.99px;top:443.22px" class="cls_008"><span class="cls_008">declaratively describe a pod. We will get to know what pods are in the next</span></div>
<div style="position:absolute;left:143.99px;top:455.82px" class="cls_008"><span class="cls_008">section. PodSpecs are provided to Kubelet primarily through the API server.</span></div>
<div style="position:absolute;left:126.00px;top:472.74px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Container Runtime</span><span class="cls_008">: The second service that needs to be present on each</span></div>
<div style="position:absolute;left:143.99px;top:485.34px" class="cls_008"><span class="cls_008">worker node is a container runtime. Kubernetes, by default, has used</span></div>
<div style="position:absolute;left:144.00px;top:497.94px" class="cls_010"><span class="cls_010">containerd</span><span class="cls_008"> since Version 1.9 as its container runtime. Before that, it would</span></div>
<div style="position:absolute;left:144.01px;top:510.54px" class="cls_008"><span class="cls_008">have used the Docker daemon. Other container runtimes, such as rkt or</span></div>
<div style="position:absolute;left:144.01px;top:523.14px" class="cls_008"><span class="cls_008">CRI-O, can be used. The container runtime is responsible for managing and</span></div>
<div style="position:absolute;left:144.01px;top:535.74px" class="cls_008"><span class="cls_008">running the individual containers of a pod.</span></div>
<div style="position:absolute;left:126.01px;top:552.66px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  kube-proxy</span><span class="cls_008">: Finally, there is </span><span class="cls_010">kube-proxy</span><span class="cls_008">. It runs as a daemon and is</span></div>
<div style="position:absolute;left:144.00px;top:565.26px" class="cls_008"><span class="cls_008">a simple network proxy and load balancer for all application services</span></div>
<div style="position:absolute;left:144.00px;top:577.86px" class="cls_008"><span class="cls_008">running on that particular node.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 187 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:162806px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background211.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now that we have learned about the architecture of Kubernetes and the master</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">and worker nodes, it is time to introduce the tooling that we can use to develop</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">applications targeted at Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:172.19px" class="cls_011"><span class="cls_011">Introducing Minikube</span></div>
<div style="position:absolute;left:108.00px;top:197.17px" class="cls_009"><span class="cls_009">Minikube</span><span class="cls_008"> is a tool that creates a single node Kubernetes cluster in VirtualBox or</span></div>
<div style="position:absolute;left:108.00px;top:209.77px" class="cls_008"><span class="cls_008">Hyper-V (other hypervisors are supported) ready to be used during development</span></div>
<div style="position:absolute;left:108.00px;top:222.37px" class="cls_008"><span class="cls_008">of a containerized application. We have shown in </span><span class="cls_021">Chapter 2</span><span class="cls_008">, </span><span class="cls_021">Setting up a Working</span></div>
<div style="position:absolute;left:108.00px;top:234.97px" class="cls_021"><span class="cls_021">Environment</span><span class="cls_008">, how Minikube, and with it, the tool  </span><span class="cls_010">kubectl</span><span class="cls_008"> can be installed on your</span></div>
<div style="position:absolute;left:108.00px;top:247.57px" class="cls_008"><span class="cls_008">Mac or Windows laptop. As stated, Minikube is a single node Kubernetes cluster,</span></div>
<div style="position:absolute;left:108.00px;top:260.17px" class="cls_008"><span class="cls_008">and thus the node is, at the same time, a Kubernetes master as well as a worker node.</span></div>
<div style="position:absolute;left:108.00px;top:281.42px" class="cls_008"><span class="cls_008">Let's make sure that Minikube is running with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:302.35px" class="cls_024"><span class="cls_024">$ minikube start</span></div>
<div style="position:absolute;left:108.00px;top:322.09px" class="cls_008"><span class="cls_008">Once Minikube is ready, we can access its single node cluster using </span><span class="cls_010">kubectl</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:334.69px" class="cls_008"><span class="cls_008">And we should see something similar to the following screenshot:</span></div>
<div style="position:absolute;left:254.08px;top:420.17px" class="cls_026"><span class="cls_026">Listing all nodes in Minikube</span></div>
<div style="position:absolute;left:108.00px;top:438.91px" class="cls_008"><span class="cls_008">As mentioned before, we have a single node cluster with a node called </span><span class="cls_010">minikube</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:451.51px" class="cls_008"><span class="cls_008">Don't get confused by the value </span><span class="cls_010">&lt;none></span><span class="cls_008"> in the column </span><span class="cls_010">ROLES</span><span class="cls_008">; the node plays the role</span></div>
<div style="position:absolute;left:108.00px;top:464.11px" class="cls_008"><span class="cls_008">of a worker and a master node at the same time.</span></div>
<div style="position:absolute;left:108.00px;top:485.36px" class="cls_008"><span class="cls_008">Now, let's try to deploy a pod to this cluster. Don't worry about what a pod exactly is</span></div>
<div style="position:absolute;left:108.00px;top:497.96px" class="cls_008"><span class="cls_008">at this time; we will dive into all the details about it further along in this chapter. For</span></div>
<div style="position:absolute;left:108.00px;top:510.56px" class="cls_008"><span class="cls_008">the moment, just take it as is.</span></div>
<div style="position:absolute;left:108.00px;top:531.79px" class="cls_008"><span class="cls_008">We can use the file </span><span class="cls_010">sample-pod.yaml</span><span class="cls_008"> in the subfolder </span><span class="cls_010">ch10</span><span class="cls_008"> of our </span><span class="cls_010">labs</span><span class="cls_008"> folder to</span></div>
<div style="position:absolute;left:108.00px;top:544.39px" class="cls_008"><span class="cls_008">create such a pod. It has the following content:</span></div>
<div style="position:absolute;left:126.00px;top:565.33px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:576.13px" class="cls_023"><span class="cls_023">kind: Pod</span></div>
<div style="position:absolute;left:126.00px;top:586.93px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:597.73px" class="cls_023"><span class="cls_023">name: nginx</span></div>
<div style="position:absolute;left:126.00px;top:608.53px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:619.33px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:136.80px;top:630.13px" class="cls_023"><span class="cls_023">- name: nginx</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 188 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:163608px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background212.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:147.60px;top:114.01px" class="cls_023"><span class="cls_023">image: nginx:alpine</span></div>
<div style="position:absolute;left:147.60px;top:124.81px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:147.60px;top:135.61px" class="cls_023"><span class="cls_023">- containerPort: 80</span></div>
<div style="position:absolute;left:147.60px;top:146.41px" class="cls_023"><span class="cls_023">- containerPort: 443</span></div>
<div style="position:absolute;left:108.00px;top:166.14px" class="cls_008"><span class="cls_008">Let's use the Kubernetes CLI called </span><span class="cls_010">kubectl</span><span class="cls_008"> to deploy this pod:</span></div>
<div style="position:absolute;left:126.00px;top:187.08px" class="cls_024"><span class="cls_024">$ kubectl create -f sample-pod.yaml</span></div>
<div style="position:absolute;left:126.00px;top:197.88px" class="cls_024"><span class="cls_024">pod "nginx" created</span></div>
<div style="position:absolute;left:108.00px;top:217.62px" class="cls_008"><span class="cls_008">If we now list all of the pods, we should see this:</span></div>
<div style="position:absolute;left:126.00px;top:238.56px" class="cls_024"><span class="cls_024">$ kubectl get pods</span></div>
<div style="position:absolute;left:126.00px;top:249.36px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:169.20px;top:249.36px" class="cls_024"><span class="cls_024">READY</span></div>
<div style="position:absolute;left:212.40px;top:249.36px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:266.40px;top:249.36px" class="cls_024"><span class="cls_024">RESTARTS</span></div>
<div style="position:absolute;left:325.80px;top:249.36px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:260.16px" class="cls_024"><span class="cls_024">nginx</span></div>
<div style="position:absolute;left:169.20px;top:260.16px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:212.40px;top:260.16px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:266.40px;top:260.16px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:325.80px;top:260.16px" class="cls_024"><span class="cls_024">51s</span></div>
<div style="position:absolute;left:108.00px;top:279.90px" class="cls_008"><span class="cls_008">To be able to access this pod, we need to create a service. Let's use the</span></div>
<div style="position:absolute;left:108.00px;top:292.50px" class="cls_010"><span class="cls_010">sample-service.yaml</span><span class="cls_008"> file, which has the following content:</span></div>
<div style="position:absolute;left:126.00px;top:313.44px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:324.24px" class="cls_023"><span class="cls_023">kind: Service</span></div>
<div style="position:absolute;left:126.00px;top:335.04px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:345.84px" class="cls_023"><span class="cls_023">name: nginx-service</span></div>
<div style="position:absolute;left:126.00px;top:356.64px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:367.44px" class="cls_023"><span class="cls_023">type: LoadBalancer</span></div>
<div style="position:absolute;left:136.80px;top:378.24px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:136.80px;top:389.04px" class="cls_023"><span class="cls_023">- port: 8080</span></div>
<div style="position:absolute;left:147.60px;top:399.84px" class="cls_023"><span class="cls_023">targetPort: 80</span></div>
<div style="position:absolute;left:147.60px;top:410.64px" class="cls_023"><span class="cls_023">protocol: TCP</span></div>
<div style="position:absolute;left:147.60px;top:421.44px" class="cls_023"><span class="cls_023">name: http</span></div>
<div style="position:absolute;left:136.80px;top:432.24px" class="cls_023"><span class="cls_023">- port: 443</span></div>
<div style="position:absolute;left:147.60px;top:443.04px" class="cls_023"><span class="cls_023">protocol: TCP</span></div>
<div style="position:absolute;left:147.60px;top:453.84px" class="cls_023"><span class="cls_023">name: https</span></div>
<div style="position:absolute;left:136.80px;top:464.64px" class="cls_023"><span class="cls_023">selector:</span></div>
<div style="position:absolute;left:147.60px;top:475.44px" class="cls_023"><span class="cls_023">app: nginx</span></div>
<div style="position:absolute;left:108.00px;top:495.18px" class="cls_008"><span class="cls_008">Again, don't worry about what exactly a service is at this time. We'll explain it all in</span></div>
<div style="position:absolute;left:108.00px;top:507.78px" class="cls_008"><span class="cls_008">detail further down. Let's just create this service:</span></div>
<div style="position:absolute;left:126.00px;top:528.72px" class="cls_024"><span class="cls_024">$ kubectl create -f sample-service.yaml</span></div>
<div style="position:absolute;left:108.00px;top:548.46px" class="cls_008"><span class="cls_008">Now we can use </span><span class="cls_010">curl</span><span class="cls_008"> to access the service:</span></div>
<div style="position:absolute;left:126.00px;top:569.40px" class="cls_024"><span class="cls_024">$ curl -4 </span><A HREF="http://localhost/">http://localhost</A> </div>
<div style="position:absolute;left:108.00px;top:589.14px" class="cls_008"><span class="cls_008">We should be receiving the Nginx welcome page as an answer. Before you continue,</span></div>
<div style="position:absolute;left:108.00px;top:601.74px" class="cls_008"><span class="cls_008">please remove the two objects you just created:</span></div>
<div style="position:absolute;left:126.00px;top:622.68px" class="cls_024"><span class="cls_024">$ kubectl delete po/nginx</span></div>
<div style="position:absolute;left:126.00px;top:633.48px" class="cls_024"><span class="cls_024">$ kubectl delete svc/nginx-service</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 189 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:164410px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background213.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Kubernetes support in Docker</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">for Desktop</span></div>
<div style="position:absolute;left:108.00px;top:160.90px" class="cls_008"><span class="cls_008">Starting from Version 18.01-ce, Docker for Mac and Docker for Windows have</span></div>
<div style="position:absolute;left:108.00px;top:173.50px" class="cls_008"><span class="cls_008">started to support Kubernetes out of the box. Developers that want to deploy</span></div>
<div style="position:absolute;left:108.00px;top:186.10px" class="cls_008"><span class="cls_008">their containerized applications to Kubernetes can use this orchestrator instead of</span></div>
<div style="position:absolute;left:108.00px;top:198.70px" class="cls_008"><span class="cls_008">SwarmKit. Kubernetes support by default is turned off and has to be enabled in</span></div>
<div style="position:absolute;left:108.00px;top:211.30px" class="cls_008"><span class="cls_008">the settings. The first time Kubernetes is enabled, Docker for Mac or Windows will</span></div>
<div style="position:absolute;left:108.00px;top:223.90px" class="cls_008"><span class="cls_008">need a moment to download all components that are needed to create a single-node</span></div>
<div style="position:absolute;left:108.00px;top:236.50px" class="cls_008"><span class="cls_008">Kubernetes cluster. Contrary to Minikube, which is also a single-node cluster, the</span></div>
<div style="position:absolute;left:108.00px;top:249.10px" class="cls_008"><span class="cls_008">version provided by the Docker tools uses containerized versions of all Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:261.70px" class="cls_008"><span class="cls_008">components:</span></div>
<div style="position:absolute;left:211.99px;top:459.68px" class="cls_026"><span class="cls_026">Kubernetes support in Docker for Mac and Windows</span></div>
<div style="position:absolute;left:108.00px;top:478.42px" class="cls_008"><span class="cls_008">The preceding diagram gives a rough overview on how Kubernetes support has</span></div>
<div style="position:absolute;left:108.00px;top:491.02px" class="cls_008"><span class="cls_008">been added to Docker for Mac and Windows. Docker for Mac uses hyperkit to</span></div>
<div style="position:absolute;left:108.00px;top:503.62px" class="cls_008"><span class="cls_008">run a LinuxKit-based VM. Docker for Windows uses Hyper-V to achieve the same.</span></div>
<div style="position:absolute;left:108.00px;top:516.22px" class="cls_008"><span class="cls_008">Inside the VM, the Docker engine is installed. Part of the engine is SwarmKit,</span></div>
<div style="position:absolute;left:108.00px;top:528.82px" class="cls_008"><span class="cls_008">which enables Swarm-Mode. Docker for Mac or Windows uses the kubeadm</span></div>
<div style="position:absolute;left:108.00px;top:541.42px" class="cls_008"><span class="cls_008">tool to set up and configure Kubernetes in that VM. The following three facts</span></div>
<div style="position:absolute;left:108.00px;top:554.02px" class="cls_008"><span class="cls_008">are worth mentioning:</span></div>
<div style="position:absolute;left:126.00px;top:575.26px" class="cls_008"><span class="cls_008">•  Kubernetes stores its cluster state in etcd; thus, we have etcd running</span></div>
<div style="position:absolute;left:143.99px;top:587.86px" class="cls_008"><span class="cls_008">on this VM.</span></div>
<div style="position:absolute;left:126.00px;top:604.78px" class="cls_008"><span class="cls_008">•  Then, we have all the services that make up Kubernetes.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 190 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:165212px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background214.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">•  Finally, some services that support the deployment of Docker stacks from the</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">Docker CLI into Kubernetes. This service is not part of the official Kubernetes</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">distribution, but is Docker specific.</span></div>
<div style="position:absolute;left:107.99px;top:160.94px" class="cls_008"><span class="cls_008">All components of Kubernetes are running in containers in the LinuxKit-based</span></div>
<div style="position:absolute;left:107.99px;top:173.54px" class="cls_008"><span class="cls_008">VM. These containers can be hidden through a setting in Docker for Mac or</span></div>
<div style="position:absolute;left:107.99px;top:186.14px" class="cls_008"><span class="cls_008">Windows. See further down in the section for a complete list of Kubernetes system</span></div>
<div style="position:absolute;left:107.99px;top:198.74px" class="cls_008"><span class="cls_008">containers running on your laptop, if you have Kubernetes support enabled. To</span></div>
<div style="position:absolute;left:107.99px;top:211.34px" class="cls_008"><span class="cls_008">avoid repetition, from now on, I will only talk about </span><span class="cls_009">Docker for Desktop</span><span class="cls_008">, instead of</span></div>
<div style="position:absolute;left:107.99px;top:223.94px" class="cls_008"><span class="cls_008">Docker for Mac and Docker for Windows. Everything that I will be saying applies</span></div>
<div style="position:absolute;left:107.99px;top:236.54px" class="cls_008"><span class="cls_008">equally to both editions.</span></div>
<div style="position:absolute;left:107.99px;top:257.78px" class="cls_008"><span class="cls_008">One big advantage of Docker for Desktop with Kubernetes enabled over Minikube</span></div>
<div style="position:absolute;left:107.99px;top:270.38px" class="cls_008"><span class="cls_008">is that the former allows developers to use a single tool to build, test, and run</span></div>
<div style="position:absolute;left:107.99px;top:282.98px" class="cls_008"><span class="cls_008">a containerized application targeted at Kubernetes. It is even possible to deploy</span></div>
<div style="position:absolute;left:107.99px;top:295.58px" class="cls_008"><span class="cls_008">a multi-service application into Kubernetes, using a Docker Compose file.</span></div>
<div style="position:absolute;left:107.99px;top:316.82px" class="cls_008"><span class="cls_008">Now, let's get our hands dirty:</span></div>
<div style="position:absolute;left:125.99px;top:338.06px" class="cls_008"><span class="cls_008">1.  First, we have to enable Kubernetes.</span></div>
<div style="position:absolute;left:125.99px;top:354.98px" class="cls_008"><span class="cls_008">2.  On the Mac, click on the Docker icon in the menu bar and select </span><span class="cls_009">Preferences</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:125.99px;top:371.89px" class="cls_008"><span class="cls_008">3.  In the dialog box that opens, select the </span><span class="cls_009">Kubernetes </span><span class="cls_008">option, as shown in the</span></div>
<div style="position:absolute;left:143.99px;top:384.49px" class="cls_008"><span class="cls_008">following screenshot:</span></div>
<div style="position:absolute;left:236.03px;top:626.70px" class="cls_026"><span class="cls_026">Enabling Kubernetes in Docker for Mac</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 191 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:166014px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background215.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">4.  Then, select the </span><span class="cls_009">Enable Kubernetes</span><span class="cls_008"> checkbox. Also, tick the other </span><span class="cls_009">Show</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_009"><span class="cls_009">system containers</span><span class="cls_008"> (advanced) checkbox.</span></div>
<div style="position:absolute;left:126.00px;top:144.01px" class="cls_008"><span class="cls_008">5.  Click on the </span><span class="cls_009">Apply</span><span class="cls_008"> button. You will be warned that the installation and</span></div>
<div style="position:absolute;left:144.00px;top:156.61px" class="cls_008"><span class="cls_008">configuration of Kubernetes takes a few minutes:</span></div>
<div style="position:absolute;left:172.59px;top:282.52px" class="cls_026"><span class="cls_026">Warning that the installation and configuration of Kubernetes takes a while</span></div>
<div style="position:absolute;left:126.00px;top:301.26px" class="cls_008"><span class="cls_008">6.  Click the </span><span class="cls_009">Install</span><span class="cls_008"> button to start the installation. Now it's time that you take</span></div>
<div style="position:absolute;left:144.00px;top:313.86px" class="cls_008"><span class="cls_008">a break and enjoy a nice cup of tea.</span></div>
<div style="position:absolute;left:107.99px;top:335.11px" class="cls_008"><span class="cls_008">Once the installation has finished (Docker notifies us of this by showing a green</span></div>
<div style="position:absolute;left:107.99px;top:347.71px" class="cls_008"><span class="cls_008">status icon in the settings dialog), we can test it. Since we now have two Kubernetes</span></div>
<div style="position:absolute;left:107.99px;top:360.31px" class="cls_008"><span class="cls_008">clusters running on our laptop, Minikube and Docker for Mac,</span></div>
<div style="position:absolute;left:107.99px;top:372.90px" class="cls_008"><span class="cls_008">we need to configure </span><span class="cls_010">kubectl</span><span class="cls_008"> to access the latter. First, let's list all contexts that</span></div>
<div style="position:absolute;left:108.00px;top:385.50px" class="cls_008"><span class="cls_008">we have:</span></div>
<div style="position:absolute;left:259.20px;top:472.96px" class="cls_026"><span class="cls_026">List of contexts for kubectl</span></div>
<div style="position:absolute;left:108.00px;top:491.70px" class="cls_008"><span class="cls_008">Here, we can see that, on my laptop, I have the two contexts mentioned previously.</span></div>
<div style="position:absolute;left:108.00px;top:504.30px" class="cls_008"><span class="cls_008">Currently still, the Minikube context is active, visible by the asterisk in the </span><span class="cls_010">CURRENT</span></div>
<div style="position:absolute;left:108.00px;top:516.90px" class="cls_008"><span class="cls_008">column. We can switch to the </span><span class="cls_010">docker-for-desktop</span><span class="cls_008"> context using the following</span></div>
<div style="position:absolute;left:108.00px;top:529.50px" class="cls_008"><span class="cls_008">command:</span></div>
<div style="position:absolute;left:226.68px;top:604.16px" class="cls_026"><span class="cls_026">Changing the context for the Kubernetes CLI</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 192 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:166816px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background216.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now we can use Kubectl to access the cluster that Docker for Mac just created.</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">We should see this:</span></div>
<div style="position:absolute;left:196.11px;top:206.48px" class="cls_026"><span class="cls_026">The single node Kubernetes cluster created by Docker for Mac</span></div>
<div style="position:absolute;left:108.00px;top:225.22px" class="cls_008"><span class="cls_008">OK, this looks very familiar. It is pretty much the same as what we saw when</span></div>
<div style="position:absolute;left:108.00px;top:237.82px" class="cls_008"><span class="cls_008">working with Minikube. The version of Kubernetes that my Docker for Mac is using</span></div>
<div style="position:absolute;left:108.00px;top:250.42px" class="cls_008"><span class="cls_008">is </span><span class="cls_010">1.9.2</span><span class="cls_008">. We can also see that the node is a master node.</span></div>
<div style="position:absolute;left:108.00px;top:271.67px" class="cls_008"><span class="cls_008">If we list all containers that are currently running on our Docker for Mac, we get this</span></div>
<div style="position:absolute;left:108.00px;top:284.27px" class="cls_008"><span class="cls_008">list (note that I use the</span></div>
<div style="position:absolute;left:216.73px;top:284.26px" class="cls_010"><span class="cls_010">--format</span><span class="cls_008"> argument to output only the </span><span class="cls_010">Container ID</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:108.00px;top:296.86px" class="cls_010"><span class="cls_010">Names</span><span class="cls_008"> of the containers), as shown in the following screenshot:</span></div>
<div style="position:absolute;left:253.17px;top:475.01px" class="cls_026"><span class="cls_026">Kubernetes system containers</span></div>
<div style="position:absolute;left:108.00px;top:493.75px" class="cls_008"><span class="cls_008">In the list, we can identify all the now-familiar components that make up Kubernetes,</span></div>
<div style="position:absolute;left:108.00px;top:506.35px" class="cls_008"><span class="cls_008">such as the following:</span></div>
<div style="position:absolute;left:126.00px;top:527.59px" class="cls_008"><span class="cls_008">•  API server</span></div>
<div style="position:absolute;left:126.00px;top:544.50px" class="cls_008"><span class="cls_008">•  etcd</span></div>
<div style="position:absolute;left:126.00px;top:561.42px" class="cls_008"><span class="cls_008">•  Kube proxy</span></div>
<div style="position:absolute;left:126.00px;top:578.33px" class="cls_008"><span class="cls_008">•  DNS service</span></div>
<div style="position:absolute;left:126.00px;top:595.25px" class="cls_008"><span class="cls_008">•  Kube controller</span></div>
<div style="position:absolute;left:126.00px;top:612.16px" class="cls_008"><span class="cls_008">•  Kube scheduler</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 193 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:167618px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background217.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">There are also containers that have the word compose in them. These are Docker-</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">specific services and are used to allow us to deploy Docker Compose applications on</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">to Kubernetes. Docker translates the Docker Compose syntax and implicitly creates</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the necessary Kubernetes objects such as deployments, pods, and services.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">Normally, we wouldn't want to clutter our list of containers with these system</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">containers. We can thus uncheck the </span><span class="cls_009">Show system containers</span><span class="cls_008"> checkbox in the</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">settings for Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:219.98px" class="cls_008"><span class="cls_008">Now let's try to deploy a Docker Compose application to Kubernetes. Navigate</span></div>
<div style="position:absolute;left:108.00px;top:232.57px" class="cls_008"><span class="cls_008">to the subfolder </span><span class="cls_010">ch10</span><span class="cls_008"> of our </span><span class="cls_010">labs</span><span class="cls_008"> folder. We deploy the app as a stack using the</span></div>
<div style="position:absolute;left:108.00px;top:245.17px" class="cls_010"><span class="cls_010">docker-compose.yml</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:126.00px;top:266.11px" class="cls_024"><span class="cls_024">$ docker stack deploy -c docker-compose.yml app</span></div>
<div style="position:absolute;left:108.00px;top:285.85px" class="cls_008"><span class="cls_008">This is what we see:</span></div>
<div style="position:absolute;left:257.34px;top:388.55px" class="cls_026"><span class="cls_026">Deploy stack to Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:407.29px" class="cls_008"><span class="cls_008">We can test the application, for example, using </span><span class="cls_010">curl</span><span class="cls_008">, and we will see that it is</span></div>
<div style="position:absolute;left:108.00px;top:419.89px" class="cls_008"><span class="cls_008">running as expected:</span></div>
<div style="position:absolute;left:202.79px;top:599.22px" class="cls_026"><span class="cls_026">Pets application running in Kubernetes on Docker for Mac</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 194 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:168420px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background218.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now, you should be curious and wonder what exactly Docker did when we executed</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">docker stack deploy</span><span class="cls_008"> command. We can use </span><span class="cls_010">kubectl</span><span class="cls_008"> to find out:</span></div>
<div style="position:absolute;left:170.33px;top:391.83px" class="cls_026"><span class="cls_026">A list of all Kubernetes objects, created by the docker stack deploy command</span></div>
<div style="position:absolute;left:108.00px;top:410.57px" class="cls_008"><span class="cls_008">Docker created a deployment for the </span><span class="cls_010">web</span><span class="cls_008"> service and a stateful set for the </span><span class="cls_010">db</span><span class="cls_008"> service.</span></div>
<div style="position:absolute;left:108.00px;top:423.17px" class="cls_008"><span class="cls_008">It also automatically created Kubernetes services for </span><span class="cls_010">web</span><span class="cls_008"> and </span><span class="cls_010">db</span><span class="cls_008"> so that they</span></div>
<div style="position:absolute;left:108.00px;top:435.77px" class="cls_008"><span class="cls_008">can be accessed inside the cluster. It also created the Kubernetes service</span></div>
<div style="position:absolute;left:108.00px;top:448.37px" class="cls_010"><span class="cls_010">svc/web-published</span><span class="cls_008">, which is used for external access.</span></div>
<div style="position:absolute;left:108.00px;top:469.62px" class="cls_008"><span class="cls_008">This is pretty cool to say the least and decreases friction tremendously in the</span></div>
<div style="position:absolute;left:108.00px;top:482.22px" class="cls_008"><span class="cls_008">development process for teams targeting Kubernetes as the orchestrator.</span></div>
<div style="position:absolute;left:108.00px;top:503.46px" class="cls_008"><span class="cls_008">Before you continue, please remove the stack from the cluster:</span></div>
<div style="position:absolute;left:126.00px;top:524.39px" class="cls_024"><span class="cls_024">$ docker stack rm app</span></div>
<div style="position:absolute;left:108.00px;top:544.13px" class="cls_008"><span class="cls_008">Also make sure you reset the context for </span><span class="cls_010">kubectl</span><span class="cls_008"> back to Minikube, as we will</span></div>
<div style="position:absolute;left:108.00px;top:556.73px" class="cls_008"><span class="cls_008">be using Minikube for all our samples in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:577.67px" class="cls_024"><span class="cls_024">$ kubectl config use-context minikube</span></div>
<div style="position:absolute;left:108.00px;top:597.41px" class="cls_008"><span class="cls_008">Now that we have had an introduction to the tools we can use to develop</span></div>
<div style="position:absolute;left:108.00px;top:610.01px" class="cls_008"><span class="cls_008">applications that will eventually run in a Kubernetes cluster, it is time</span></div>
<div style="position:absolute;left:108.00px;top:622.61px" class="cls_008"><span class="cls_008">to learn about all the important Kubernetes objects that are used to define and</span></div>
<div style="position:absolute;left:108.00px;top:635.21px" class="cls_008"><span class="cls_008">manage such an application. We are starting with the </span><span class="cls_009">pod</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 195 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:169222px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background219.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Pods</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Contrary to what is possible in a Docker Swarm, you cannot run containers directly</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">in a Kubernetes cluster. In a Kubernetes cluster, you can only run pods. Pods are the</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">atomic unit of deployment in Kubernetes. A pod is an abstraction of one or many</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">co-located containers that share the same Kernel namespaces, such as the network</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">namespace. No equivalent exists in the Docker SwarmKit. The fact that more than</span></div>
<div style="position:absolute;left:108.00px;top:199.90px" class="cls_008"><span class="cls_008">one container can be co-located and sharing the same network namespace is a very</span></div>
<div style="position:absolute;left:108.00px;top:212.50px" class="cls_008"><span class="cls_008">powerful concept. The following diagram illustrates two pods:</span></div>
<div style="position:absolute;left:276.09px;top:405.98px" class="cls_026"><span class="cls_026">Kubernetes pods</span></div>
<div style="position:absolute;left:108.00px;top:424.72px" class="cls_008"><span class="cls_008">In the preceding diagram, we have two pods, </span><span class="cls_009">Pod 1</span><span class="cls_008"> and </span><span class="cls_009">Pod 2</span><span class="cls_008">. The first pod contains</span></div>
<div style="position:absolute;left:108.00px;top:437.32px" class="cls_008"><span class="cls_008">two containers, while the second one contains only a single container. Each pod gets</span></div>
<div style="position:absolute;left:108.00px;top:449.92px" class="cls_008"><span class="cls_008">an IP address assigned by Kubernetes that is unique in the whole Kubernetes cluster.</span></div>
<div style="position:absolute;left:108.00px;top:462.52px" class="cls_008"><span class="cls_008">In our case, these are the IP addresses </span><span class="cls_010">10.0.12.3</span><span class="cls_008"> and </span><span class="cls_010">10.0.12.5</span><span class="cls_008">. Both are part of</span></div>
<div style="position:absolute;left:108.00px;top:475.12px" class="cls_008"><span class="cls_008">a private subnet managed by the Kubernetes network driver.</span></div>
<div style="position:absolute;left:108.00px;top:496.36px" class="cls_008"><span class="cls_008">A pod can contain one or many containers. All these containers share the same</span></div>
<div style="position:absolute;left:108.00px;top:508.96px" class="cls_008"><span class="cls_008">kernel namespaces, and in particular they share the network namespace. This is</span></div>
<div style="position:absolute;left:108.00px;top:521.56px" class="cls_008"><span class="cls_008">marked by the dashed rectangle surrounding the containers. Since all containers</span></div>
<div style="position:absolute;left:108.00px;top:534.16px" class="cls_008"><span class="cls_008">running in the same pod share the network namespace, each container needs to</span></div>
<div style="position:absolute;left:108.00px;top:546.76px" class="cls_008"><span class="cls_008">make sure to use its own port, since duplicate ports are not allowed in a single</span></div>
<div style="position:absolute;left:108.00px;top:559.36px" class="cls_008"><span class="cls_008">network namespace. In this case, in </span><span class="cls_009">Pod 1</span><span class="cls_008">, the main container is using port </span><span class="cls_010">80</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:571.96px" class="cls_008"><span class="cls_008">while the supporting container is using port </span><span class="cls_010">3000</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:593.20px" class="cls_008"><span class="cls_008">Requests from other pods or nodes can use the pod's IP address combined with</span></div>
<div style="position:absolute;left:108.00px;top:605.80px" class="cls_008"><span class="cls_008">the corresponding port number to access the individual containers. For example,</span></div>
<div style="position:absolute;left:108.00px;top:618.40px" class="cls_008"><span class="cls_008">you could access the application running in the main container of </span><span class="cls_009">Pod 1</span><span class="cls_008"> through</span></div>
<div style="position:absolute;left:108.00px;top:631.00px" class="cls_010"><span class="cls_010">10.0.12.3:80</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 196 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:170024px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background220.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Comparing Docker Container and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:134.06px" class="cls_022"><span class="cls_022">pod networking</span></div>
<div style="position:absolute;left:108.00px;top:157.04px" class="cls_008"><span class="cls_008">Now let's compare Docker's container networking and the networking of</span></div>
<div style="position:absolute;left:108.00px;top:169.64px" class="cls_008"><span class="cls_008">a Kubernetes pod. In the diagram here, we have the former on the left-hand side</span></div>
<div style="position:absolute;left:108.00px;top:182.24px" class="cls_008"><span class="cls_008">and the latter on the right-hand side:</span></div>
<div style="position:absolute;left:223.38px;top:392.54px" class="cls_026"><span class="cls_026">Containers in pod sharing network namespace</span></div>
<div style="position:absolute;left:108.00px;top:411.28px" class="cls_008"><span class="cls_008">When a Docker container is created and no specific network is specified, the Docker</span></div>
<div style="position:absolute;left:108.00px;top:423.88px" class="cls_008"><span class="cls_008">engine creates a </span><span class="cls_009">virtual ethernet</span><span class="cls_008"> (</span><span class="cls_009">veth</span><span class="cls_008">) endpoint. The first container gets </span><span class="cls_009">veth0</span><span class="cls_008">, and</span></div>
<div style="position:absolute;left:108.00px;top:436.48px" class="cls_008"><span class="cls_008">the next one gets </span><span class="cls_009">veth1</span><span class="cls_008">, and so on. These virtual ethernet endpoints are connected to</span></div>
<div style="position:absolute;left:108.00px;top:449.08px" class="cls_008"><span class="cls_008">the Linux bridge </span><span class="cls_009">docker0</span><span class="cls_008"> that Docker automatically creates upon installation. Traffic</span></div>
<div style="position:absolute;left:108.00px;top:461.68px" class="cls_008"><span class="cls_008">is routed from the bridge docker0 to every connected veth endpoint. Every container</span></div>
<div style="position:absolute;left:108.00px;top:474.28px" class="cls_008"><span class="cls_008">has its own network namespace. No two containers use the same namespace. This is</span></div>
<div style="position:absolute;left:108.00px;top:486.88px" class="cls_008"><span class="cls_008">deliberate, to isolate applications running inside the containers from one another.</span></div>
<div style="position:absolute;left:108.00px;top:508.12px" class="cls_008"><span class="cls_008">For a Kubernetes pod, the situation is different. When creating a new pod,</span></div>
<div style="position:absolute;left:108.00px;top:520.72px" class="cls_008"><span class="cls_008">Kubernetes first creates a so-called </span><span class="cls_009">pause container</span><span class="cls_008">, whose only purpose is to create</span></div>
<div style="position:absolute;left:108.00px;top:533.32px" class="cls_008"><span class="cls_008">and manage the namespaces that the pod will share with all containers. Other than</span></div>
<div style="position:absolute;left:108.00px;top:545.92px" class="cls_008"><span class="cls_008">that, it does nothing useful, but is just sleeping. The pause container is connected to</span></div>
<div style="position:absolute;left:108.00px;top:558.52px" class="cls_008"><span class="cls_008">the bridge docker0 through veth0. Any subsequent container that will be part of the</span></div>
<div style="position:absolute;left:108.00px;top:571.12px" class="cls_008"><span class="cls_008">pod is using a special feature of the Docker engine that allows it to reuse an existing</span></div>
<div style="position:absolute;left:108.00px;top:583.72px" class="cls_008"><span class="cls_008">network namespace. The syntax to do so looks as follows:</span></div>
<div style="position:absolute;left:126.00px;top:604.66px" class="cls_024"><span class="cls_024">$ docker container create --net container:pause ...</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 197 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:170826px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background221.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The important part is the </span><span class="cls_010">--net</span><span class="cls_008"> argument, which uses as a value</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">container:&lt;container name></span><span class="cls_008">. If we create a new container this way, Docker</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">does not create a new veth endpoint, but the container uses the same one as the</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">pause container.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">Another important consequence of multiple containers sharing the same network</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">namespace is the way they communicate with one another. Let's consider the</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">following situation of a pod containing two containers, one listening at port 80</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">and the other at port 3000:</span></div>
<div style="position:absolute;left:224.30px;top:366.56px" class="cls_026"><span class="cls_026">Containers in pods communicate via localhost</span></div>
<div style="position:absolute;left:108.00px;top:385.30px" class="cls_008"><span class="cls_008">When two containers use the same Linux kernel network namespace, they can</span></div>
<div style="position:absolute;left:108.00px;top:397.90px" class="cls_008"><span class="cls_008">communicate with each other through localhost; this is similar to when two</span></div>
<div style="position:absolute;left:108.00px;top:410.50px" class="cls_008"><span class="cls_008">processes are running on the same host, as they can communicate with each other</span></div>
<div style="position:absolute;left:108.00px;top:423.10px" class="cls_008"><span class="cls_008">through localhost too. This is illustrated in the preceding diagram. From the main</span></div>
<div style="position:absolute;left:108.00px;top:435.70px" class="cls_008"><span class="cls_008">container, the containerized application inside it can reach out to the service running</span></div>
<div style="position:absolute;left:108.00px;top:448.30px" class="cls_008"><span class="cls_008">inside the supporting container through </span><span class="cls_010">http://localhost:3000</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:478.24px" class="cls_022"><span class="cls_022">Sharing the network namespace</span></div>
<div style="position:absolute;left:108.00px;top:501.22px" class="cls_008"><span class="cls_008">After all this theory, you might be wondering how a pod is actually created by</span></div>
<div style="position:absolute;left:108.00px;top:513.82px" class="cls_008"><span class="cls_008">Kubernetes. Kubernetes is only using what Docker provides. So, </span><span class="cls_021">how does this network</span></div>
<div style="position:absolute;left:108.00px;top:526.42px" class="cls_021"><span class="cls_021">namespace share work?</span><span class="cls_008"> First, Kubernetes creates the so-called pause container, as</span></div>
<div style="position:absolute;left:108.00px;top:539.02px" class="cls_008"><span class="cls_008">mentioned previously. This container has no other function than to reserve the kernel</span></div>
<div style="position:absolute;left:108.00px;top:551.62px" class="cls_008"><span class="cls_008">namespaces for that pod and keep them alive, even if no other container inside the</span></div>
<div style="position:absolute;left:108.00px;top:564.22px" class="cls_008"><span class="cls_008">pod is running. Let's simulate the creation of a pod, then. We start by creating the</span></div>
<div style="position:absolute;left:108.00px;top:576.82px" class="cls_010"><span class="cls_010">pause</span><span class="cls_008"> container and take Nginx for this purpose:</span></div>
<div style="position:absolute;left:126.00px;top:597.76px" class="cls_024"><span class="cls_024">$ docker container run -d --name pause nginx:alpine</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 198 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:171628px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background222.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">And now we add a second container called </span><span class="cls_010">main</span><span class="cls_008">, attaching it to the same network</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">namespace as the </span><span class="cls_010">pause</span><span class="cls_008"> container:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ docker container run --name main -dit \</span></div>
<div style="position:absolute;left:147.60px;top:158.83px" class="cls_024"><span class="cls_024">--net container:pause \</span></div>
<div style="position:absolute;left:147.60px;top:169.63px" class="cls_024"><span class="cls_024">alpine:latest /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:189.37px" class="cls_008"><span class="cls_008">Since the </span><span class="cls_010">pause</span><span class="cls_008"> and the sample container are both part of the same network</span></div>
<div style="position:absolute;left:108.00px;top:201.97px" class="cls_008"><span class="cls_008">namespace, they can reach each other through </span><span class="cls_010">localhost</span><span class="cls_008">. To show this, we first</span></div>
<div style="position:absolute;left:108.00px;top:214.57px" class="cls_008"><span class="cls_008">have to </span><span class="cls_010">exec</span><span class="cls_008"> into the main container:</span></div>
<div style="position:absolute;left:126.00px;top:235.51px" class="cls_024"><span class="cls_024">$ docker exec -it main /bin/sh</span></div>
<div style="position:absolute;left:108.00px;top:255.25px" class="cls_008"><span class="cls_008">Now we can test the connection to Nginx running in the </span><span class="cls_010">pause</span><span class="cls_008"> container and</span></div>
<div style="position:absolute;left:108.00px;top:267.85px" class="cls_008"><span class="cls_008">listening on port </span><span class="cls_010">80</span><span class="cls_008">. Here is what we get if we use the </span><span class="cls_010">wget</span><span class="cls_008"> utility to do so:</span></div>
<div style="position:absolute;left:211.30px;top:588.83px" class="cls_026"><span class="cls_026">Two containers sharing the same network namespace</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 199 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:172430px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background223.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The output shows that we can indeed access Nginx on </span><span class="cls_010">localhost</span><span class="cls_008">. This is proof that</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">the two containers share the same namespace. If that is not enough, we can use the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_010"><span class="cls_010">ip</span><span class="cls_008"> tool to show </span><span class="cls_010">eth0</span><span class="cls_008"> inside both containers and we will get the exact same result,</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">specifically, the same IP address, which is one of the characteristics of a pod, where</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">all its containers share the same IP address:</span></div>
<div style="position:absolute;left:219.69px;top:243.56px" class="cls_026"><span class="cls_026">Displaying the properties of eth0 with the ip tool</span></div>
<div style="position:absolute;left:108.00px;top:262.30px" class="cls_008"><span class="cls_008">If we inspect the </span><span class="cls_010">bridge</span><span class="cls_008"> network, we can see that only the </span><span class="cls_010">pause</span><span class="cls_008"> container is listed.</span></div>
<div style="position:absolute;left:108.00px;top:274.90px" class="cls_008"><span class="cls_008">The other container didn't get an entry in the </span><span class="cls_010">Containers</span><span class="cls_008"> list, since it is reusing the</span></div>
<div style="position:absolute;left:108.00px;top:287.50px" class="cls_010"><span class="cls_010">pause</span><span class="cls_008"> container's endpoint:</span></div>
<div style="position:absolute;left:225.20px;top:645.86px" class="cls_026"><span class="cls_026">Inspecting the Docker default bridge network</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 200 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:173232px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background224.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Pod life cycle</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">We have learned earlier in this book that containers have a life cycle. A container</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">is initialized, run, and ultimately exited. When a container exits, it can do this</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">gracefully with an exit code zero, or it can terminate with an error, which is</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">equivalent to a non-zero exit code.</span></div>
<div style="position:absolute;left:108.00px;top:194.49px" class="cls_008"><span class="cls_008">Similarly, a pod has a life cycle. Due to the fact that a pod can contain more than</span></div>
<div style="position:absolute;left:108.00px;top:207.09px" class="cls_008"><span class="cls_008">one container, this life cycle is slightly more complicated than the one of a single</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">container. The life cycle of a pod is shown in the following diagram:</span></div>
<div style="position:absolute;left:253.86px;top:392.91px" class="cls_026"><span class="cls_026">Life cycle of Kubernetes pods</span></div>
<div style="position:absolute;left:108.00px;top:411.65px" class="cls_008"><span class="cls_008">When a pod is created on a cluster node, it first enters into </span><span class="cls_009">pending</span><span class="cls_008"> status. Once all</span></div>
<div style="position:absolute;left:108.00px;top:424.25px" class="cls_008"><span class="cls_008">containers of the pod are up and running, the pod enters </span><span class="cls_009">running</span><span class="cls_008"> status. The pod</span></div>
<div style="position:absolute;left:108.00px;top:436.85px" class="cls_008"><span class="cls_008">only enters into this state if all its containers run successfully. If the pod is asked to</span></div>
<div style="position:absolute;left:108.00px;top:449.45px" class="cls_008"><span class="cls_008">terminate, it will request all its containers to terminate. If all containers terminate</span></div>
<div style="position:absolute;left:108.00px;top:462.05px" class="cls_008"><span class="cls_008">with an exit code of zero, then the pod enters into succeeded status. This is the</span></div>
<div style="position:absolute;left:108.00px;top:474.65px" class="cls_008"><span class="cls_008">happy path.</span></div>
<div style="position:absolute;left:108.00px;top:495.89px" class="cls_008"><span class="cls_008">Now let's look at some scenarios that lead to the pod being in </span><span class="cls_010">failed</span><span class="cls_008"> state. There</span></div>
<div style="position:absolute;left:108.00px;top:508.49px" class="cls_008"><span class="cls_008">are three possible scenarios:</span></div>
<div style="position:absolute;left:126.00px;top:529.74px" class="cls_008"><span class="cls_008">•  If, during the startup of the pod, at least one container is not able to run</span></div>
<div style="position:absolute;left:143.99px;top:542.34px" class="cls_008"><span class="cls_008">and fails (that is, it exits with a non-zero exit code), the pod moves from the</span></div>
<div style="position:absolute;left:143.99px;top:554.94px" class="cls_009"><span class="cls_009">pending</span><span class="cls_008"> state to the </span><span class="cls_009">failed</span><span class="cls_008"> state.</span></div>
<div style="position:absolute;left:126.00px;top:571.85px" class="cls_008"><span class="cls_008">•  If the pod is in running status and one of the containers suddenly crashes or</span></div>
<div style="position:absolute;left:143.99px;top:584.45px" class="cls_008"><span class="cls_008">exits with a non-zero exit code, the pod transitions from the </span><span class="cls_009">running</span><span class="cls_008"> state</span></div>
<div style="position:absolute;left:143.99px;top:597.05px" class="cls_008"><span class="cls_008">into the failed state.</span></div>
<div style="position:absolute;left:126.00px;top:613.97px" class="cls_008"><span class="cls_008">•  If the pod is asked to terminate and during the shutdown at least one of</span></div>
<div style="position:absolute;left:143.99px;top:626.57px" class="cls_008"><span class="cls_008">the containers exits with a non-zero exit code, the pod also enters into the</span></div>
<div style="position:absolute;left:143.99px;top:639.17px" class="cls_008"><span class="cls_008">failed state.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 201 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:174034px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background225.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Pod specification</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">When creating a pod in a Kubernetes cluster, we can use either an </span><span class="cls_009">imperative</span><span class="cls_008"> or</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">a </span><span class="cls_009">declarative</span><span class="cls_008"> approach. We have discussed the difference of the two approaches</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">earlier in this book, but to rephrase the important aspect, using a declarative</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">approach signifies that we write a manifest that describes the end state we want</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">to achieve. We leave the details of the how to the orchestrator. The end state that</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">we want to achieve is also called the </span><span class="cls_009">desired state</span><span class="cls_008">. In general, the declarative</span></div>
<div style="position:absolute;left:108.00px;top:211.04px" class="cls_008"><span class="cls_008">approach is strongly preferred in all of the established orchestrators, and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:223.64px" class="cls_008"><span class="cls_008">is no exception.</span></div>
<div style="position:absolute;left:108.00px;top:244.89px" class="cls_008"><span class="cls_008">Thus, in this chapter, we will exclusively concentrate on the declarative approach.</span></div>
<div style="position:absolute;left:108.00px;top:257.49px" class="cls_008"><span class="cls_008">Manifests or specifications for a pod can be written using either YAML or JSON</span></div>
<div style="position:absolute;left:108.00px;top:270.08px" class="cls_008"><span class="cls_008">format. In this chapter, we will concentrate on </span><span class="cls_010">YAML</span><span class="cls_008">, since it is easier to read for us</span></div>
<div style="position:absolute;left:108.00px;top:282.68px" class="cls_008"><span class="cls_008">humans. Let's look at a sample specification. Here is the content of the </span><span class="cls_010">pod.yaml</span></div>
<div style="position:absolute;left:108.00px;top:295.28px" class="cls_008"><span class="cls_008">file that can be found in the </span><span class="cls_010">ch10</span><span class="cls_008"> subfolder of our </span><span class="cls_010">labs</span><span class="cls_008"> folder:</span></div>
<div style="position:absolute;left:126.00px;top:316.22px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:327.02px" class="cls_023"><span class="cls_023">kind: Pod</span></div>
<div style="position:absolute;left:126.00px;top:337.82px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:348.62px" class="cls_023"><span class="cls_023">name: web-pod</span></div>
<div style="position:absolute;left:126.00px;top:359.42px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:370.22px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:136.80px;top:381.02px" class="cls_023"><span class="cls_023">- name: web</span></div>
<div style="position:absolute;left:147.60px;top:391.82px" class="cls_023"><span class="cls_023">image: nginx:alpine</span></div>
<div style="position:absolute;left:147.60px;top:402.62px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:147.60px;top:413.42px" class="cls_023"><span class="cls_023">- containerPort: 80</span></div>
<div style="position:absolute;left:108.00px;top:433.16px" class="cls_008"><span class="cls_008">Each specification in Kubernetes starts with the version information. Pods have</span></div>
<div style="position:absolute;left:108.00px;top:445.76px" class="cls_008"><span class="cls_008">been around for quite some time, and thus the API version is v1. The second line</span></div>
<div style="position:absolute;left:108.00px;top:458.36px" class="cls_008"><span class="cls_008">specifies the type of Kubernetes object or resource we want to define. Obviously, in</span></div>
<div style="position:absolute;left:108.00px;top:470.96px" class="cls_008"><span class="cls_008">this case, we want to specify a pod. Next comes a block with metadata. At the bare</span></div>
<div style="position:absolute;left:108.00px;top:483.56px" class="cls_008"><span class="cls_008">minimum, we need to give the pod a name. Here, we call it </span><span class="cls_010">web-pod</span><span class="cls_008">. The next block</span></div>
<div style="position:absolute;left:108.01px;top:496.16px" class="cls_008"><span class="cls_008">that follows is the spec block, which contains the specification of the pod. The most</span></div>
<div style="position:absolute;left:108.01px;top:508.76px" class="cls_008"><span class="cls_008">important part (and the only one in this simple sample) is the list of all containers</span></div>
<div style="position:absolute;left:108.01px;top:521.36px" class="cls_008"><span class="cls_008">that are part of this pod. We only have one container here, but multiple containers</span></div>
<div style="position:absolute;left:108.01px;top:533.96px" class="cls_008"><span class="cls_008">are possible. The name we choose for our container is web, and the container image</span></div>
<div style="position:absolute;left:108.01px;top:546.56px" class="cls_008"><span class="cls_008">is </span><span class="cls_010">nginx:alpine</span><span class="cls_008">. Finally, we define the list of ports the container is exposing.</span></div>
<div style="position:absolute;left:108.00px;top:567.81px" class="cls_008"><span class="cls_008">Once we have authored such a specification, we can apply it to the cluster using the</span></div>
<div style="position:absolute;left:108.00px;top:580.40px" class="cls_008"><span class="cls_008">Kubernetes CLI </span><span class="cls_010">kubectl</span><span class="cls_008">. In the terminal, navigate to the </span><span class="cls_010">ch10</span><span class="cls_008"> subfolder and execute</span></div>
<div style="position:absolute;left:108.00px;top:593.00px" class="cls_008"><span class="cls_008">the following command:</span></div>
<div style="position:absolute;left:126.00px;top:613.94px" class="cls_024"><span class="cls_024">$ kubectl create -f pod.yaml</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 202 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:174836px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background226.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This will respond with</span><span class="cls_010"> pod "web-pod"</span><span class="cls_008"> created. We can then list all pods in the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">cluster with </span><span class="cls_010">kubectl get pods</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ kubectl get pods</span></div>
<div style="position:absolute;left:126.00px;top:158.83px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:180.00px;top:158.83px" class="cls_024"><span class="cls_024">READY</span></div>
<div style="position:absolute;left:223.20px;top:158.83px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:277.20px;top:158.83px" class="cls_024"><span class="cls_024">RESTARTS</span></div>
<div style="position:absolute;left:336.60px;top:158.83px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:169.63px" class="cls_024"><span class="cls_024">web-pod</span></div>
<div style="position:absolute;left:180.00px;top:169.63px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:223.20px;top:169.63px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:277.20px;top:169.63px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:336.60px;top:169.63px" class="cls_024"><span class="cls_024">2m</span></div>
<div style="position:absolute;left:108.00px;top:189.37px" class="cls_008"><span class="cls_008">As expected, we have one of one pods in running status. The pod is called </span><span class="cls_010">web-pod</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:201.97px" class="cls_008"><span class="cls_008">as defined. We can get more detailed information about the running pod by using</span></div>
<div style="position:absolute;left:108.00px;top:214.57px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">describe</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:236.56px;top:571.84px" class="cls_026"><span class="cls_026">Describing a pod running in the cluster</span></div>
<div style="position:absolute;left:108.00px;top:590.58px" class="cls_008"><span class="cls_008">Please note the notation </span><span class="cls_010">pod/web-pod</span><span class="cls_008"> in the previous </span><span class="cls_010">describe</span><span class="cls_008"> command. Other</span></div>
<div style="position:absolute;left:108.00px;top:603.18px" class="cls_008"><span class="cls_008">variants are possible, for example, </span><span class="cls_010">pods/web-pod</span><span class="cls_008"> or </span><span class="cls_010">po/web-pod</span><span class="cls_008">. </span><span class="cls_010">pod</span><span class="cls_008"> and </span><span class="cls_010">po</span><span class="cls_008"> are</span></div>
<div style="position:absolute;left:108.00px;top:615.78px" class="cls_008"><span class="cls_008">aliases of </span><span class="cls_010">pods</span><span class="cls_008">. The </span><span class="cls_010">kubectl</span><span class="cls_008"> tool defines many aliases, to make our lives a bit easier.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 203 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:175638px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background227.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">describe</span><span class="cls_008"> command gives us a plethora of valuable information about the pod,</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">not least of which is the list of events that happened with this pod affected. The list is</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">shown at the end of the output.</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_008"><span class="cls_008">The information in the </span><span class="cls_010">Containers</span><span class="cls_008"> section is very similar to what we find in a</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_010"><span class="cls_010">docker</span><span class="cls_008"> </span><span class="cls_010">container</span><span class="cls_008"> </span><span class="cls_010">inspect</span><span class="cls_008"> output.</span></div>
<div style="position:absolute;left:108.00px;top:194.77px" class="cls_008"><span class="cls_008">We can also see a </span><span class="cls_010">Volumes</span><span class="cls_008"> section with some entry of type </span><span class="cls_010">Secret</span><span class="cls_008">. We will</span></div>
<div style="position:absolute;left:108.00px;top:207.37px" class="cls_008"><span class="cls_008">discuss Kubernetes secrets in the next chapter. Volumes, on the other hand,</span></div>
<div style="position:absolute;left:108.00px;top:219.97px" class="cls_008"><span class="cls_008">are discussed next.</span></div>
<div style="position:absolute;left:108.00px;top:249.91px" class="cls_022"><span class="cls_022">Pods and volumes</span></div>
<div style="position:absolute;left:108.00px;top:272.89px" class="cls_008"><span class="cls_008">In the chapter about containers, we have learned about volumes and their purpose</span></div>
<div style="position:absolute;left:108.00px;top:285.49px" class="cls_008"><span class="cls_008">to access and store persistent data. As containers can mount volumes, pods can do so</span></div>
<div style="position:absolute;left:108.00px;top:298.09px" class="cls_008"><span class="cls_008">as well. In reality, it is really the containers inside the pod that mount the volumes,</span></div>
<div style="position:absolute;left:108.00px;top:310.69px" class="cls_008"><span class="cls_008">but that is just a semantic detail. Let's first see how we can define a volume in</span></div>
<div style="position:absolute;left:108.00px;top:323.29px" class="cls_008"><span class="cls_008">Kubernetes. Kubernetes supports a plethora of volume types, and we're not diving</span></div>
<div style="position:absolute;left:108.00px;top:335.89px" class="cls_008"><span class="cls_008">into too much detail about this. Let's just create a local volume implicitly by defining</span></div>
<div style="position:absolute;left:108.00px;top:348.49px" class="cls_008"><span class="cls_008">a </span><span class="cls_010">PersistentVolumeClaim</span><span class="cls_008"> called </span><span class="cls_010">my-data-claim</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:369.43px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:380.23px" class="cls_023"><span class="cls_023">kind: PersistentVolumeClaim</span></div>
<div style="position:absolute;left:126.00px;top:391.03px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:401.83px" class="cls_023"><span class="cls_023">name: my-data-claim</span></div>
<div style="position:absolute;left:126.00px;top:412.63px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:423.43px" class="cls_023"><span class="cls_023">accessModes:</span></div>
<div style="position:absolute;left:147.60px;top:434.23px" class="cls_023"><span class="cls_023">- ReadWriteOnce</span></div>
<div style="position:absolute;left:136.80px;top:445.03px" class="cls_023"><span class="cls_023">resources:</span></div>
<div style="position:absolute;left:147.60px;top:455.83px" class="cls_023"><span class="cls_023">requests:</span></div>
<div style="position:absolute;left:158.40px;top:466.63px" class="cls_023"><span class="cls_023">storage: 2Gi</span></div>
<div style="position:absolute;left:108.00px;top:486.37px" class="cls_008"><span class="cls_008">We have defined a claim that requests 2 GB of data. Let's create this claim:</span></div>
<div style="position:absolute;left:126.00px;top:507.31px" class="cls_024"><span class="cls_024">$ kubectl create -f volume-claim.yaml</span></div>
<div style="position:absolute;left:108.00px;top:527.05px" class="cls_008"><span class="cls_008">We can list the claim using </span><span class="cls_010">kubectl</span><span class="cls_008"> (</span><span class="cls_010">pvc</span><span class="cls_008"> is the shortcut for</span></div>
<div style="position:absolute;left:108.00px;top:539.65px" class="cls_010"><span class="cls_010">PersistentVolumeClaim</span><span class="cls_008">):</span></div>
<div style="position:absolute;left:215.64px;top:612.27px" class="cls_026"><span class="cls_026">List of PersistentStorageClaim objects in the cluster</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 204 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:176440px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background228.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the output, we can see that the claim has implicitly created a volume called</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">pvc-&lt;ID></span><span class="cls_008">. We are now ready to use the volume created by the claim in a pod. Let's</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">use a modified version of the pod specification that we used previously. We can find</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">this updated specification in the </span><span class="cls_010">pod-with-vol.yaml</span><span class="cls_008"> file in the </span><span class="cls_010">ch10</span><span class="cls_008"> folder. Let's</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">look at this specification in detail:</span></div>
<div style="position:absolute;left:126.00px;top:185.83px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:196.63px" class="cls_023"><span class="cls_023">kind: Pod</span></div>
<div style="position:absolute;left:126.00px;top:207.43px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:218.23px" class="cls_023"><span class="cls_023">name: web-pod</span></div>
<div style="position:absolute;left:126.00px;top:229.03px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:239.83px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:136.80px;top:250.63px" class="cls_023"><span class="cls_023">- name: web</span></div>
<div style="position:absolute;left:147.60px;top:261.43px" class="cls_023"><span class="cls_023">image: nginx:alpine</span></div>
<div style="position:absolute;left:147.60px;top:272.23px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:147.60px;top:283.03px" class="cls_023"><span class="cls_023">- containerPort: 80</span></div>
<div style="position:absolute;left:147.60px;top:293.83px" class="cls_023"><span class="cls_023">volumeMounts:</span></div>
<div style="position:absolute;left:147.60px;top:304.63px" class="cls_023"><span class="cls_023">- name: my-data</span></div>
<div style="position:absolute;left:158.40px;top:315.43px" class="cls_023"><span class="cls_023">mountPath: /data</span></div>
<div style="position:absolute;left:136.80px;top:326.23px" class="cls_023"><span class="cls_023">volumes:</span></div>
<div style="position:absolute;left:136.80px;top:337.03px" class="cls_023"><span class="cls_023">- name: my-data</span></div>
<div style="position:absolute;left:147.60px;top:347.83px" class="cls_023"><span class="cls_023">persistentVolumeClaim:</span></div>
<div style="position:absolute;left:158.40px;top:358.63px" class="cls_023"><span class="cls_023">claimName: my-data-claim</span></div>
<div style="position:absolute;left:108.00px;top:378.37px" class="cls_008"><span class="cls_008">In the last four lines, in the block </span><span class="cls_010">volumes</span><span class="cls_008">, we define the list of volumes we want to</span></div>
<div style="position:absolute;left:108.00px;top:390.97px" class="cls_008"><span class="cls_008">use for this pod. The volumes that we list here can be used by any of the containers</span></div>
<div style="position:absolute;left:108.00px;top:403.57px" class="cls_008"><span class="cls_008">of the pod. In our particular case, we only have one volume. We define that we have</span></div>
<div style="position:absolute;left:108.00px;top:416.17px" class="cls_008"><span class="cls_008">a volume </span><span class="cls_010">my-data</span><span class="cls_008"> that is a persistent volume claim whose claim name is the one we</span></div>
<div style="position:absolute;left:108.00px;top:428.77px" class="cls_008"><span class="cls_008">just created before. Then, in the container specification, we have the </span><span class="cls_010">volumeMounts</span></div>
<div style="position:absolute;left:108.00px;top:441.37px" class="cls_008"><span class="cls_008">block, where we define the volume we want to use and the (absolute) path inside the</span></div>
<div style="position:absolute;left:108.00px;top:453.97px" class="cls_008"><span class="cls_008">container where the volume will be mounted. In our case, we mount the volume to</span></div>
<div style="position:absolute;left:108.00px;top:466.57px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">/data</span><span class="cls_008"> folder of the container filesystem. Let's create this pod:</span></div>
<div style="position:absolute;left:126.00px;top:487.51px" class="cls_024"><span class="cls_024">$ kubectl create -f pod-with-vol.yaml</span></div>
<div style="position:absolute;left:108.00px;top:507.25px" class="cls_008"><span class="cls_008">Then, we can </span><span class="cls_010">exec</span><span class="cls_008"> into the container to double-check that the volume has mounted</span></div>
<div style="position:absolute;left:108.00px;top:519.85px" class="cls_008"><span class="cls_008">by navigating to the </span><span class="cls_010">/data</span><span class="cls_008"> folder, create a file there, and exit the container:</span></div>
<div style="position:absolute;left:126.00px;top:540.79px" class="cls_024"><span class="cls_024">$ kubectl exec -it web-pod -- /bin/sh</span></div>
<div style="position:absolute;left:126.00px;top:551.59px" class="cls_024"><span class="cls_024">/ # cd /data</span></div>
<div style="position:absolute;left:126.00px;top:562.39px" class="cls_024"><span class="cls_024">/data # echo "Hello world!" > sample.txt</span></div>
<div style="position:absolute;left:126.00px;top:573.19px" class="cls_024"><span class="cls_024">/data # exit</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 205 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:177242px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background229.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we are right, then the data in this container must persist beyond the life cycle of the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">pod. Thus, let's delete the pod and then recreate it and exec into it to make sure the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">data is still there. This is the result:</span></div>
<div style="position:absolute;left:223.76px;top:240.07px" class="cls_026"><span class="cls_026">Data stored in volume survives pod recreation</span></div>
<div style="position:absolute;left:108.00px;top:270.07px" class="cls_011"><span class="cls_011">Kubernetes ReplicaSet</span></div>
<div style="position:absolute;left:108.00px;top:295.05px" class="cls_008"><span class="cls_008">A single pod in an environment with high availability requirements is insufficient.</span></div>
<div style="position:absolute;left:108.00px;top:307.65px" class="cls_021"><span class="cls_021">What if the pod crashes? What if we need to update the application running inside the pod</span></div>
<div style="position:absolute;left:108.00px;top:320.25px" class="cls_021"><span class="cls_021">but cannot afford any service interruption?</span><span class="cls_008"> These questions and more can only indicate</span></div>
<div style="position:absolute;left:108.00px;top:332.85px" class="cls_008"><span class="cls_008">that pods alone are not enough and that we need a higher-level concept that can</span></div>
<div style="position:absolute;left:108.00px;top:345.45px" class="cls_008"><span class="cls_008">manage multiple instances of the same pod. In Kubernetes, the </span><span class="cls_009">ReplicaSet</span><span class="cls_008"> is used to</span></div>
<div style="position:absolute;left:108.00px;top:358.05px" class="cls_008"><span class="cls_008">define and manage such a collection of identical pods that are running on different</span></div>
<div style="position:absolute;left:108.00px;top:370.65px" class="cls_008"><span class="cls_008">cluster nodes. Among other things, a </span><span class="cls_009">ReplicaSet</span><span class="cls_008"> defines which container images are</span></div>
<div style="position:absolute;left:108.00px;top:383.25px" class="cls_008"><span class="cls_008">used by the containers running inside a pod and how many instances of the pod will</span></div>
<div style="position:absolute;left:108.00px;top:395.85px" class="cls_008"><span class="cls_008">run in the cluster. These properties and the many others are called the </span><span class="cls_009">desired state</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:417.10px" class="cls_008"><span class="cls_008">The ReplicaSet is responsible for reconciling the desired state at all times, if the actual</span></div>
<div style="position:absolute;left:108.00px;top:429.70px" class="cls_008"><span class="cls_008">state ever deviates from it. Here is a Kubernetes ReplicaSet:</span></div>
<div style="position:absolute;left:266.40px;top:522.93px" class="cls_026"><span class="cls_026">Kubernetes ReplicaSet</span></div>
<div style="position:absolute;left:108.00px;top:541.67px" class="cls_008"><span class="cls_008">In the preceding diagram, we see such a ReplicaSet called an </span><span class="cls_009">rs-api</span><span class="cls_008">, which governs</span></div>
<div style="position:absolute;left:108.00px;top:554.27px" class="cls_008"><span class="cls_008">a number of pods. The pods are called </span><span class="cls_009">pod-api</span><span class="cls_008">. The ReplicaSet is responsible for</span></div>
<div style="position:absolute;left:108.00px;top:566.87px" class="cls_008"><span class="cls_008">making sure that at any given time there are always the desired number of pods</span></div>
<div style="position:absolute;left:108.00px;top:579.47px" class="cls_008"><span class="cls_008">running. If one of the pods crashes for whatever reason, the ReplicaSet schedules</span></div>
<div style="position:absolute;left:108.00px;top:592.07px" class="cls_008"><span class="cls_008">a new pod on a node with free resources instead. If there are more pods than the</span></div>
<div style="position:absolute;left:108.00px;top:604.67px" class="cls_008"><span class="cls_008">desired number, the ReplicaSet kills the superfluous pods. We can thus say that the</span></div>
<div style="position:absolute;left:108.00px;top:617.27px" class="cls_008"><span class="cls_008">ReplicaSet guarantees a self-healing and scalable set of pods. There is no limit on</span></div>
<div style="position:absolute;left:108.00px;top:629.87px" class="cls_008"><span class="cls_008">how many pods a ReplicaSet can be comprised of.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 206 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:178044px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background230.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">ReplicaSet specification</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Similar to what we have learned about pods, Kubernetes also allows us to either</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">imperatively or declaratively define and create a </span><span class="cls_010">ReplicaSet</span><span class="cls_008">. Since the declarative</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">approach is by far the recommended one in most cases, we're going to concentrate on</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">this approach. Here is a sample specification for a Kubernetes </span><span class="cls_010">ReplicaSet</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:194.18px" class="cls_023"><span class="cls_023">apiVersion: apps/v1</span></div>
<div style="position:absolute;left:126.00px;top:204.98px" class="cls_023"><span class="cls_023">kind: ReplicaSet</span></div>
<div style="position:absolute;left:126.00px;top:215.78px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:226.58px" class="cls_023"><span class="cls_023">name: rs-web</span></div>
<div style="position:absolute;left:126.00px;top:237.38px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:248.18px" class="cls_023"><span class="cls_023">selector:</span></div>
<div style="position:absolute;left:147.60px;top:258.98px" class="cls_023"><span class="cls_023">matchLabels:</span></div>
<div style="position:absolute;left:158.40px;top:269.78px" class="cls_023"><span class="cls_023">app: web</span></div>
<div style="position:absolute;left:136.80px;top:280.58px" class="cls_023"><span class="cls_023">replicas: 3</span></div>
<div style="position:absolute;left:136.80px;top:291.38px" class="cls_023"><span class="cls_023">template:</span></div>
<div style="position:absolute;left:147.60px;top:302.18px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:158.40px;top:312.98px" class="cls_023"><span class="cls_023">labels:</span></div>
<div style="position:absolute;left:169.20px;top:323.78px" class="cls_023"><span class="cls_023">app: web</span></div>
<div style="position:absolute;left:147.60px;top:334.58px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:158.40px;top:345.38px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:158.40px;top:356.18px" class="cls_023"><span class="cls_023">- name: nginx</span></div>
<div style="position:absolute;left:169.20px;top:366.98px" class="cls_023"><span class="cls_023">image: nginx:alpine</span></div>
<div style="position:absolute;left:169.20px;top:377.78px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:169.20px;top:388.58px" class="cls_023"><span class="cls_023">- containerPort: 80</span></div>
<div style="position:absolute;left:108.00px;top:408.32px" class="cls_008"><span class="cls_008">This looks an awful lot like the pod specification we introduced earlier. Let's</span></div>
<div style="position:absolute;left:108.00px;top:420.92px" class="cls_008"><span class="cls_008">concentrate on the differences, then. First, on line 2, we have the kind which was </span><span class="cls_010">Pod</span></div>
<div style="position:absolute;left:108.00px;top:433.52px" class="cls_008"><span class="cls_008">and is now </span><span class="cls_010">ReplicaSet</span><span class="cls_008">. Then, on lines 6-8, we have a selector that determines the</span></div>
<div style="position:absolute;left:108.00px;top:446.12px" class="cls_008"><span class="cls_008">pods that will be part of the </span><span class="cls_010">ReplicaSet</span><span class="cls_008">. In this case, it is all pods that have a label</span></div>
<div style="position:absolute;left:108.00px;top:458.72px" class="cls_010"><span class="cls_010">app</span><span class="cls_008"> with the value </span><span class="cls_010">web</span><span class="cls_008">. Then, on line 9, we define how many replicas of the pod we</span></div>
<div style="position:absolute;left:108.01px;top:471.32px" class="cls_008"><span class="cls_008">want to run, three, in this case. Finally, we have the </span><span class="cls_010">template</span><span class="cls_008"> section, which first</span></div>
<div style="position:absolute;left:108.00px;top:483.92px" class="cls_008"><span class="cls_008">defines the </span><span class="cls_010">metadata</span><span class="cls_008"> and then the </span><span class="cls_010">spec</span><span class="cls_008">, which defines the containers that run inside</span></div>
<div style="position:absolute;left:108.00px;top:496.52px" class="cls_008"><span class="cls_008">the pod. In our case, we have a single container using the </span><span class="cls_010">nginx:alpine</span><span class="cls_008"> image and</span></div>
<div style="position:absolute;left:108.00px;top:509.12px" class="cls_008"><span class="cls_008">exporting port </span><span class="cls_010">80</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:530.37px" class="cls_008"><span class="cls_008">The really important elements are the number of replicas and the selector that</span></div>
<div style="position:absolute;left:108.00px;top:542.96px" class="cls_008"><span class="cls_008">specifies the set of pods governed by the </span><span class="cls_010">ReplicaSet</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:564.20px" class="cls_008"><span class="cls_008">In our </span><span class="cls_010">ch10</span><span class="cls_008"> folder, we have a file called </span><span class="cls_010">replicaset.yaml</span><span class="cls_008"> that contains the</span></div>
<div style="position:absolute;left:108.00px;top:576.80px" class="cls_008"><span class="cls_008">preceding specification exactly. Let's use this file to create the </span><span class="cls_010">ReplicaSet</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:597.74px" class="cls_024"><span class="cls_024">$ kubectl create -f replicaset.yaml</span></div>
<div style="position:absolute;left:126.00px;top:608.54px" class="cls_024"><span class="cls_024">replicaset "rs-web" created</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 207 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:178846px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background231.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we list all the ReplicaSets in the cluster, we get this (</span><span class="cls_010">rs</span><span class="cls_008"> is a shortcut for</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">replicaset</span><span class="cls_008">):</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ kubectl get rs</span></div>
<div style="position:absolute;left:126.00px;top:158.83px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:174.60px;top:158.83px" class="cls_024"><span class="cls_024">DESIRED</span></div>
<div style="position:absolute;left:228.60px;top:158.83px" class="cls_024"><span class="cls_024">CURRENT</span></div>
<div style="position:absolute;left:282.60px;top:158.83px" class="cls_024"><span class="cls_024">READY</span></div>
<div style="position:absolute;left:325.80px;top:158.83px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:169.63px" class="cls_024"><span class="cls_024">rs-web</span></div>
<div style="position:absolute;left:174.60px;top:169.63px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:228.60px;top:169.63px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:282.60px;top:169.63px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:325.80px;top:169.63px" class="cls_024"><span class="cls_024">51s</span></div>
<div style="position:absolute;left:108.00px;top:189.37px" class="cls_008"><span class="cls_008">In the preceding output, we can see that we have a single ReplicaSet called</span></div>
<div style="position:absolute;left:108.00px;top:201.97px" class="cls_010"><span class="cls_010">rs-web</span><span class="cls_008"> whose desired state is three (pods). The current state also shows three pods</span></div>
<div style="position:absolute;left:108.00px;top:214.57px" class="cls_008"><span class="cls_008">and all three pods are ready. We can also list all pods in the system, and we get this:</span></div>
<div style="position:absolute;left:126.00px;top:235.51px" class="cls_024"><span class="cls_024">$ kubectl get pods</span></div>
<div style="position:absolute;left:126.00px;top:246.31px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:207.00px;top:246.31px" class="cls_024"><span class="cls_024">READY</span></div>
<div style="position:absolute;left:250.20px;top:246.31px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:304.20px;top:246.31px" class="cls_024"><span class="cls_024">RESTARTS</span></div>
<div style="position:absolute;left:363.60px;top:246.31px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:257.11px" class="cls_024"><span class="cls_024">rs-web-6qzld</span></div>
<div style="position:absolute;left:207.00px;top:257.11px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:250.20px;top:257.11px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:304.20px;top:257.11px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:363.60px;top:257.11px" class="cls_024"><span class="cls_024">4m</span></div>
<div style="position:absolute;left:126.00px;top:267.91px" class="cls_024"><span class="cls_024">rs-web-frj2m</span></div>
<div style="position:absolute;left:207.00px;top:267.91px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:250.20px;top:267.91px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:304.20px;top:267.91px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:363.60px;top:267.91px" class="cls_024"><span class="cls_024">4m</span></div>
<div style="position:absolute;left:126.00px;top:278.71px" class="cls_024"><span class="cls_024">rs-web-zd2kt</span></div>
<div style="position:absolute;left:207.00px;top:278.71px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:250.20px;top:278.71px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:304.20px;top:278.71px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:363.60px;top:278.71px" class="cls_024"><span class="cls_024">4m</span></div>
<div style="position:absolute;left:108.00px;top:298.45px" class="cls_008"><span class="cls_008">Here, we see our three expected pods. The names of the pods are using the name of</span></div>
<div style="position:absolute;left:108.00px;top:311.05px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> with a unique ID appended to each pod. In the </span><span class="cls_010">READY</span><span class="cls_008"> column, we</span></div>
<div style="position:absolute;left:108.00px;top:323.65px" class="cls_008"><span class="cls_008">see how many containers are defined in the pod and how many of them are ready. In</span></div>
<div style="position:absolute;left:108.00px;top:336.25px" class="cls_008"><span class="cls_008">our case, we have only a single container per pod, and in each case, it is ready. Thus,</span></div>
<div style="position:absolute;left:108.00px;top:348.85px" class="cls_008"><span class="cls_008">the overall status of the pod is </span><span class="cls_010">Running</span><span class="cls_008">. We also see how many times each pod had</span></div>
<div style="position:absolute;left:108.00px;top:361.45px" class="cls_008"><span class="cls_008">to be restarted. In our case, we did not have any restarts yet.</span></div>
<div style="position:absolute;left:108.00px;top:391.39px" class="cls_022"><span class="cls_022">Self-healing</span></div>
<div style="position:absolute;left:108.00px;top:414.37px" class="cls_008"><span class="cls_008">Now let's test the magic powers of the self-healing of the </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> by randomly</span></div>
<div style="position:absolute;left:108.00px;top:426.97px" class="cls_008"><span class="cls_008">killing one of its pods and observing what's going to happen. Let's delete the first</span></div>
<div style="position:absolute;left:108.00px;top:439.57px" class="cls_008"><span class="cls_008">pod from the previous list:</span></div>
<div style="position:absolute;left:126.00px;top:460.51px" class="cls_024"><span class="cls_024">$ kubectl delete po/rs-web-6qzld</span></div>
<div style="position:absolute;left:126.00px;top:471.31px" class="cls_024"><span class="cls_024">pod "rs-web-6qzld" deleted</span></div>
<div style="position:absolute;left:108.00px;top:491.05px" class="cls_008"><span class="cls_008">Then, let's list all pods again. We expect to see only two pods, </span><span class="cls_021">right</span><span class="cls_008">? Wrong:</span></div>
<div style="position:absolute;left:210.13px;top:585.67px" class="cls_026"><span class="cls_026">List of pods after having killed a pod of the ReplicaSet</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 208 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:179648px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background232.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">OK, evidently the second pod in the list has been recreated as we can see from the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">AGE</span><span class="cls_008"> column. This is auto-healing in action. Let's see what we discover if we describe</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the ReplicaSet:</span></div>
<div style="position:absolute;left:260.88px;top:380.71px" class="cls_026"><span class="cls_026">Describing the ReplicaSet</span></div>
<div style="position:absolute;left:108.00px;top:399.45px" class="cls_008"><span class="cls_008">And, indeed, we find an entry under </span><span class="cls_010">Events</span><span class="cls_008"> that tells us that the </span><span class="cls_010">ReplicaSet</span></div>
<div style="position:absolute;left:108.00px;top:412.05px" class="cls_008"><span class="cls_008">created the new pod </span><span class="cls_010">rs-web-q6cr7</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:444.55px" class="cls_011"><span class="cls_011">Kubernetes deployment</span></div>
<div style="position:absolute;left:108.00px;top:469.53px" class="cls_008"><span class="cls_008">Kubernetes takes the single responsibility principle very seriously. All Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:482.13px" class="cls_008"><span class="cls_008">objects are designed to do one thing and one thing only. And they are designed</span></div>
<div style="position:absolute;left:108.00px;top:494.73px" class="cls_008"><span class="cls_008">to do this one thing very well. In this regard, we have to understand Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:507.33px" class="cls_008"><span class="cls_008">ReplicaSets and Deployments. The ReplicaSet, as we have learned, is responsible for</span></div>
<div style="position:absolute;left:108.00px;top:519.93px" class="cls_008"><span class="cls_008">achieving and reconciling the desired state of an application service. This means that</span></div>
<div style="position:absolute;left:108.00px;top:532.53px" class="cls_008"><span class="cls_008">the ReplicaSet manages a set of pods.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 209 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:180450px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background233.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The deployment augments a ReplicaSet by providing rolling update and rollback</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">functionality on top of it. In Docker Swarm, the swarm service would incorporate the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">functionality of both the ReplicaSet and the Deployment. In this regard, SwarmKit</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">is much more monolithic than Kubernetes. The following diagram shows the</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">relationship of a Deployment to a ReplicaSet:</span></div>
<div style="position:absolute;left:263.40px;top:305.41px" class="cls_026"><span class="cls_026">Kubernetes deployment</span></div>
<div style="position:absolute;left:108.00px;top:324.15px" class="cls_008"><span class="cls_008">In the preceding diagram, the </span><span class="cls_009">ReplicaSet</span><span class="cls_008"> is defining and governing a set of identical</span></div>
<div style="position:absolute;left:108.00px;top:336.75px" class="cls_008"><span class="cls_008">pods. The main characteristics of the ReplicaSet are that it is self-healing, scalable,</span></div>
<div style="position:absolute;left:108.00px;top:349.35px" class="cls_008"><span class="cls_008">and always does its best to reconcile the desired state. The Kubernetes deployment in</span></div>
<div style="position:absolute;left:108.00px;top:361.95px" class="cls_008"><span class="cls_008">turn adds rolling update and rollback functionality to the plate. In this regard,</span></div>
<div style="position:absolute;left:108.00px;top:374.55px" class="cls_008"><span class="cls_008">a deployment is really a wrapper object to a ReplicaSet.</span></div>
<div style="position:absolute;left:108.00px;top:395.79px" class="cls_008"><span class="cls_008">We will learn more about rolling updates and rollbacks in the next chapter of</span></div>
<div style="position:absolute;left:108.00px;top:408.39px" class="cls_008"><span class="cls_008">this book.</span></div>
<div style="position:absolute;left:108.00px;top:440.89px" class="cls_011"><span class="cls_011">Kubernetes service</span></div>
<div style="position:absolute;left:108.00px;top:465.87px" class="cls_008"><span class="cls_008">The moment we start to work with applications consisting of more than one</span></div>
<div style="position:absolute;left:108.00px;top:478.47px" class="cls_008"><span class="cls_008">application service, we have a need for service discovery. In the following diagram,</span></div>
<div style="position:absolute;left:108.00px;top:491.07px" class="cls_008"><span class="cls_008">we illustrate this problem:</span></div>
<div style="position:absolute;left:275.05px;top:633.00px" class="cls_026"><span class="cls_026">Service discovery</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 210 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:181252px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background234.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In this diagram, we have a </span><span class="cls_009">Web API</span><span class="cls_008"> service that needs access to three other</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">services—</span><span class="cls_009">payments</span><span class="cls_008">, </span><span class="cls_009">shipping</span><span class="cls_008">, and </span><span class="cls_009">ordering</span><span class="cls_008">. The Web API should at no time have</span></div>
<div style="position:absolute;left:107.99px;top:139.69px" class="cls_008"><span class="cls_008">to care about how and where to find those three services. In the API code, we just</span></div>
<div style="position:absolute;left:107.99px;top:152.29px" class="cls_008"><span class="cls_008">want to use the name of the service we want to reach and its port number. A sample</span></div>
<div style="position:absolute;left:107.99px;top:164.89px" class="cls_008"><span class="cls_008">would be the URL </span><A HREF="http://payments:3000/">http://payments:3000</A> </span><span class="cls_008"> that is used to access an instance of the</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">payments service.</span></div>
<div style="position:absolute;left:108.00px;top:198.74px" class="cls_008"><span class="cls_008">In Kubernetes, the payments application service is represented by a ReplicaSet of</span></div>
<div style="position:absolute;left:108.00px;top:211.34px" class="cls_008"><span class="cls_008">pods. Due to the nature of highly distributed systems, we cannot assume that pods</span></div>
<div style="position:absolute;left:108.00px;top:223.94px" class="cls_008"><span class="cls_008">have stable endpoints. A pod can come and go in the blink of an eye. But that's</span></div>
<div style="position:absolute;left:108.00px;top:236.54px" class="cls_008"><span class="cls_008">a problem if we need to access the corresponding application service from an</span></div>
<div style="position:absolute;left:108.00px;top:249.14px" class="cls_008"><span class="cls_008">internal or external client. If we cannot rely on pod endpoints being stable,</span></div>
<div style="position:absolute;left:108.00px;top:261.74px" class="cls_021"><span class="cls_021">what else can we do?</span></div>
<div style="position:absolute;left:108.00px;top:282.98px" class="cls_008"><span class="cls_008">This is where Kubernetes services come into play. They are meant to provide stable</span></div>
<div style="position:absolute;left:108.00px;top:295.58px" class="cls_008"><span class="cls_008">endpoints to ReplicaSets or Deployments, as shown here:</span></div>
<div style="position:absolute;left:206.86px;top:550.87px" class="cls_026"><span class="cls_026">Kubernetes service providing stable endpoints to clients</span></div>
<div style="position:absolute;left:108.00px;top:569.61px" class="cls_008"><span class="cls_008">In the preceding diagram, in the center, we see such a Kubernetes service. It provides</span></div>
<div style="position:absolute;left:108.00px;top:582.21px" class="cls_008"><span class="cls_008">a reliable cluster-wide IP address also called a </span><span class="cls_009">virtual IP</span><span class="cls_008"> (</span><span class="cls_009">VIP</span><span class="cls_008">), as well as a reliable</span></div>
<div style="position:absolute;left:108.00px;top:594.81px" class="cls_008"><span class="cls_008">port that's unique in the whole cluster. The pods that the Kubernetes service is</span></div>
<div style="position:absolute;left:108.00px;top:607.41px" class="cls_008"><span class="cls_008">proxying are determined by the selector defined in the service specification. Selectors</span></div>
<div style="position:absolute;left:108.00px;top:620.01px" class="cls_008"><span class="cls_008">are always based on labels. Every Kubernetes object can have zero to many labels</span></div>
<div style="position:absolute;left:108.00px;top:632.61px" class="cls_008"><span class="cls_008">assigned. In our case, the selector is </span><span class="cls_009">app=web;</span><span class="cls_008"> that is, all pods that have a label called</span></div>
<div style="position:absolute;left:107.99px;top:645.21px" class="cls_009"><span class="cls_009">app</span><span class="cls_008"> with a value of web are proxied.</span></div>
<div style="position:absolute;left:293.99px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 211 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:182054px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background235.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Context-based routing</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Often, we want to configure context-based routing for our Kubernetes cluster.</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">Kubernetes offers us various ways to do so. The preferred and most scalable way at</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">this time is to use an </span><span class="cls_009">IngressController</span><span class="cls_008"> for this job. The following diagram tries to</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">illustrate how this ingress controller works:</span></div>
<div style="position:absolute;left:200.47px;top:439.43px" class="cls_026"><span class="cls_026">Context-based routing using a Kubernetes ingress controller</span></div>
<div style="position:absolute;left:108.00px;top:458.17px" class="cls_008"><span class="cls_008">In this diagram, we can see how context-based (or layer 7) routing works when using</span></div>
<div style="position:absolute;left:108.00px;top:470.77px" class="cls_008"><span class="cls_008">an ingress controller, such as Nginx. Here, we have a deployment of an application</span></div>
<div style="position:absolute;left:108.00px;top:483.37px" class="cls_008"><span class="cls_008">service called web. All the pods of this application service have a label </span><span class="cls_009">app=web</span><span class="cls_008">. We</span></div>
<div style="position:absolute;left:107.99px;top:495.97px" class="cls_008"><span class="cls_008">then have a Kubernetes service called web that provides a stable endpoint to those</span></div>
<div style="position:absolute;left:107.99px;top:508.57px" class="cls_008"><span class="cls_008">pods. The service has a (virtual) IP of </span><span class="cls_010">52.14.0.13</span><span class="cls_008"> and exposes port </span><span class="cls_010">30044</span><span class="cls_008">. That is,</span></div>
<div style="position:absolute;left:108.00px;top:521.17px" class="cls_008"><span class="cls_008">if a request comes to any node of the Kubernetes cluster for the name web and port</span></div>
<div style="position:absolute;left:108.00px;top:533.77px" class="cls_010"><span class="cls_010">30044</span><span class="cls_008">, then it is forwarded to this service. The service then load balances the request</span></div>
<div style="position:absolute;left:107.99px;top:546.37px" class="cls_008"><span class="cls_008">to one of the pods.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 212 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:182856px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background236.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 10</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">So far, so good, but how is an ingress request from a client to the URL </span><span class="cls_010">http[s]://</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">example.com/web</span><span class="cls_008"> </span><span class="cls_021">routed to our web service?</span><span class="cls_008"> First, we have to define the routing from</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">a context-based request to a corresponding </span><span class="cls_010">&lt;service name>/&lt;port></span><span class="cls_008"> request. This is</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">done through an Ingress object:</span></div>
<div style="position:absolute;left:125.99px;top:173.54px" class="cls_008"><span class="cls_008">1.  In the Ingress object, we define the host and path as the source and the</span></div>
<div style="position:absolute;left:143.99px;top:186.14px" class="cls_008"><span class="cls_008">(service) name, and the port as the target. When this Ingress object is created</span></div>
<div style="position:absolute;left:143.99px;top:198.74px" class="cls_008"><span class="cls_008">by the Kubernetes API server, then a process that runs as sidecar in the</span></div>
<div style="position:absolute;left:143.99px;top:211.34px" class="cls_008"><span class="cls_008">IngressController picks this change up.</span></div>
<div style="position:absolute;left:125.99px;top:228.25px" class="cls_008"><span class="cls_008">2.  Modifies the configuration file of the Nginx reverse proxy.</span></div>
<div style="position:absolute;left:125.99px;top:245.17px" class="cls_008"><span class="cls_008">3.  By adding the new route, Nginx is then asked to reload its configuration</span></div>
<div style="position:absolute;left:143.99px;top:257.77px" class="cls_008"><span class="cls_008">and thus will be able to correctly route any incoming requests to</span></div>
<div style="position:absolute;left:144.00px;top:270.37px" class="cls_010"><span class="cls_010">http[s]://example.com/web</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:302.87px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:327.85px" class="cls_008"><span class="cls_008">In this chapter, we have learned the basics of Kubernetes. We had an overview of</span></div>
<div style="position:absolute;left:108.00px;top:340.45px" class="cls_008"><span class="cls_008">its architecture and an introduction to the main resources used to define and run</span></div>
<div style="position:absolute;left:108.00px;top:353.05px" class="cls_008"><span class="cls_008">applications in a Kubernetes cluster. We also introduced Minikube and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:365.65px" class="cls_008"><span class="cls_008">support for Docker for Mac and Windows.</span></div>
<div style="position:absolute;left:108.00px;top:386.90px" class="cls_008"><span class="cls_008">In the next chapter, we're going to deploy an application into a Kubernetes cluster.</span></div>
<div style="position:absolute;left:108.00px;top:399.50px" class="cls_008"><span class="cls_008">Then, we're going to be updating one of the services of this application using a zero</span></div>
<div style="position:absolute;left:108.00px;top:412.10px" class="cls_008"><span class="cls_008">downtime strategy. Finally, we're going to instrument application services running</span></div>
<div style="position:absolute;left:108.00px;top:424.70px" class="cls_008"><span class="cls_008">in Kubernetes with sensitive data, using secrets. Stay tuned.</span></div>
<div style="position:absolute;left:108.00px;top:457.19px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:482.17px" class="cls_008"><span class="cls_008">Please answer the following questions, to assess what you have learned from</span></div>
<div style="position:absolute;left:108.00px;top:494.77px" class="cls_008"><span class="cls_008">this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:516.02px" class="cls_008"><span class="cls_008">1.  Explain in a few short sentences what the role of a Kubernetes master is.</span></div>
<div style="position:absolute;left:126.00px;top:532.93px" class="cls_008"><span class="cls_008">2.  List the elements that need to be present on each Kubernetes (worker) node.</span></div>
<div style="position:absolute;left:126.00px;top:549.85px" class="cls_008"><span class="cls_008">3.  True or false: We cannot run individual containers in a Kubernetes cluster.</span></div>
<div style="position:absolute;left:126.00px;top:566.76px" class="cls_008"><span class="cls_008">4.  Explain the reason containers of a pod can use localhost to communicate with</span></div>
<div style="position:absolute;left:143.99px;top:579.36px" class="cls_008"><span class="cls_008">each other.</span></div>
<div style="position:absolute;left:126.00px;top:596.28px" class="cls_008"><span class="cls_008">5.  What is the purpose of the so-called pause </span><span class="cls_010">container</span><span class="cls_008"> in a pod?</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 213 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:183658px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background237.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Orchestrating Containerized Applications with Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">6.  Bob tells you: Our application consists of three Docker images: </span><span class="cls_010">web</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_010"><span class="cls_010">inventory</span><span class="cls_008">, and </span><span class="cls_010">db</span><span class="cls_008">. Since we can run multiple containers in a Kubernetes</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">pod, we are going to deploy all the services of our application in a single pod.</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">List three to four reasons why this is a bad idea.</span></div>
<div style="position:absolute;left:126.01px;top:169.21px" class="cls_008"><span class="cls_008">7.  Explain in your own words why we need Kubernetes ReplicaSets.</span></div>
<div style="position:absolute;left:126.01px;top:186.13px" class="cls_008"><span class="cls_008">8.  Under what circumstances do we need Kubernetes deployments?</span></div>
<div style="position:absolute;left:126.01px;top:203.04px" class="cls_008"><span class="cls_008">9.  List at least three types of Kubernetes services and explain their purposes</span></div>
<div style="position:absolute;left:144.00px;top:215.64px" class="cls_008"><span class="cls_008">and their differences.</span></div>
<div style="position:absolute;left:108.00px;top:248.15px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:273.13px" class="cls_008"><span class="cls_008">Here is a list of articles with more detailed information on various topics discussed</span></div>
<div style="position:absolute;left:108.00px;top:285.73px" class="cls_008"><span class="cls_008">in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:306.97px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  The Raft Consensus Algorithm</span><span class="cls_008"> (</span><A HREF="https://raft.github.io/">https://raft.github.io/</A> </span><span class="cls_008">)</span></div>
<div style="position:absolute;left:126.00px;top:323.89px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Docker Compose and Kubernetes with Docker for Desktop</span><span class="cls_008"> (</span><A HREF="https://dockr.ly/2G8Iqb9">https://dockr.</A> </span></div>
<div style="position:absolute;left:144.00px;top:336.49px" class="cls_010"><span class="cls_010"> </span><A HREF="https://dockr.ly/2G8Iqb9">ly/2G8Iqb9</A> <span class="cls_008">)</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 214 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:184460px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background238.jpg" width=612 height=792></div>
<div style="position:absolute;left:225.49px;top:218.71px" class="cls_015"><span class="cls_015">Deploying, Updating,</span></div>
<div style="position:absolute;left:132.07px;top:254.71px" class="cls_015"><span class="cls_015">and Securing an Application</span></div>
<div style="position:absolute;left:288.88px;top:290.71px" class="cls_015"><span class="cls_015">with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:344.41px" class="cls_008"><span class="cls_008">In the last chapter, we learned about the basics of the container orchestrator,</span></div>
<div style="position:absolute;left:108.00px;top:357.01px" class="cls_008"><span class="cls_008">Kubernetes. We got a high-level overview of the architecture of Kubernetes and</span></div>
<div style="position:absolute;left:108.00px;top:369.61px" class="cls_008"><span class="cls_008">learned much about the important objects used by Kubernetes to define and manage</span></div>
<div style="position:absolute;left:108.00px;top:382.21px" class="cls_008"><span class="cls_008">a containerized application.</span></div>
<div style="position:absolute;left:108.00px;top:403.46px" class="cls_008"><span class="cls_008">In this chapter, we will learn how to deploy, update, and scale applications into</span></div>
<div style="position:absolute;left:108.00px;top:416.06px" class="cls_008"><span class="cls_008">a Kubernetes cluster. We will also explain how zero downtime deployments</span></div>
<div style="position:absolute;left:108.00px;top:428.66px" class="cls_008"><span class="cls_008">are achieved to enable disruption-free updates and rollbacks of mission critical</span></div>
<div style="position:absolute;left:108.00px;top:441.26px" class="cls_008"><span class="cls_008">applications. Finally, in this chapter, we are introducing Kubernetes secrets as a</span></div>
<div style="position:absolute;left:108.00px;top:453.86px" class="cls_008"><span class="cls_008">means to configure services with and protect sensitive data.</span></div>
<div style="position:absolute;left:108.00px;top:475.10px" class="cls_008"><span class="cls_008">The chapter covers the following topics:</span></div>
<div style="position:absolute;left:126.00px;top:496.34px" class="cls_008"><span class="cls_008">•  Deploying a first application</span></div>
<div style="position:absolute;left:126.00px;top:513.25px" class="cls_008"><span class="cls_008">•  Zero-downtime deployments</span></div>
<div style="position:absolute;left:126.00px;top:530.17px" class="cls_008"><span class="cls_008">•  Kubernetes secrets</span></div>
<div style="position:absolute;left:107.99px;top:551.41px" class="cls_008"><span class="cls_008">After working through this chapter, you will be able to:</span></div>
<div style="position:absolute;left:125.99px;top:572.65px" class="cls_008"><span class="cls_008">•  Deploy a multi-service application into a Kubernetes cluster</span></div>
<div style="position:absolute;left:125.99px;top:589.57px" class="cls_008"><span class="cls_008">•  Update an application service running in Kubernetes without</span></div>
<div style="position:absolute;left:143.98px;top:602.17px" class="cls_008"><span class="cls_008">causing downtime</span></div>
<div style="position:absolute;left:125.99px;top:619.08px" class="cls_008"><span class="cls_008">•  Define secrets in a Kubernetes cluster</span></div>
<div style="position:absolute;left:125.99px;top:636.00px" class="cls_008"><span class="cls_008">•  Configure an application service to use Kubernetes secrets</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 215 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:185262px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background239.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">In this chapter, we're going to use Minikube on our local computer. Please refer to</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_021"><span class="cls_021">Chapter 2</span><span class="cls_008">, </span><span class="cls_021">Setting up a Working Environment</span><span class="cls_008">, for more information on how to install</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">and use Minikube.</span></div>
<div style="position:absolute;left:108.00px;top:183.34px" class="cls_008"><span class="cls_008">The code for this chapter can be found in the </span><span class="cls_010">ch11</span><span class="cls_008"> subfolder of the </span><span class="cls_010">labs</span><span class="cls_008"> folder.</span></div>
<div style="position:absolute;left:108.00px;top:195.94px" class="cls_008"><span class="cls_008">Please make sure you have cloned the GitHub repository at </span><A HREF="https://github.com/appswithdockerandkubernetes/labs">https://github.</A> </span></div>
<div style="position:absolute;left:108.00px;top:208.54px" class="cls_010"><span class="cls_010">com/appswithdockerandkubernetes/labs</span><span class="cls_021">,</span><span class="cls_008"> as described in </span><span class="cls_021">Chapter 2</span><span class="cls_008">, </span><span class="cls_021">Setting up a</span></div>
<div style="position:absolute;left:108.00px;top:221.14px" class="cls_021"><span class="cls_021">Working Environment</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:242.38px" class="cls_008"><span class="cls_008">In your Terminal, navigate to the folder </span><span class="cls_010">labs/ch11</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:274.88px" class="cls_011"><span class="cls_011">Deploying a first application</span></div>
<div style="position:absolute;left:108.00px;top:299.86px" class="cls_008"><span class="cls_008">We will take our pets application, which we first introduced in </span><span class="cls_021">Chapter 8</span><span class="cls_008">, </span><span class="cls_021">Docker</span></div>
<div style="position:absolute;left:108.00px;top:312.46px" class="cls_021"><span class="cls_021">Compose</span><span class="cls_008">, and deploy it into a Kubernetes cluster. Our cluster will be Minikube, which,</span></div>
<div style="position:absolute;left:108.00px;top:325.06px" class="cls_008"><span class="cls_008">as you know, is a single-node cluster. But, from the perspective of a deployment, it</span></div>
<div style="position:absolute;left:108.00px;top:337.66px" class="cls_008"><span class="cls_008">doesn't really matter how big the cluster is and where the cluster is located—in the</span></div>
<div style="position:absolute;left:108.00px;top:350.26px" class="cls_008"><span class="cls_008">cloud, in your company's data center, or on your personal workstation.</span></div>
<div style="position:absolute;left:108.00px;top:380.20px" class="cls_022"><span class="cls_022">Deploying the web component</span></div>
<div style="position:absolute;left:108.00px;top:403.18px" class="cls_008"><span class="cls_008">Just as a reminder, our application consists of two application services, the Node.</span></div>
<div style="position:absolute;left:108.00px;top:415.78px" class="cls_008"><span class="cls_008">js-based web component and the backing PostgreSQL database. In the previous</span></div>
<div style="position:absolute;left:108.00px;top:428.38px" class="cls_008"><span class="cls_008">chapter, we learned that we need to define a Kubernetes </span><span class="cls_010">Deployment</span><span class="cls_008"> object for each</span></div>
<div style="position:absolute;left:108.00px;top:440.98px" class="cls_008"><span class="cls_008">application service we want to deploy. Let's do this first for the web component. As</span></div>
<div style="position:absolute;left:108.00px;top:453.58px" class="cls_008"><span class="cls_008">always in this book, we will choose the declarative way of defining our objects. Here</span></div>
<div style="position:absolute;left:108.00px;top:466.18px" class="cls_008"><span class="cls_008">is the YAML defining a </span><span class="cls_010">Deployment</span><span class="cls_008"> object for the web component:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 216 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:186064px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background240.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:203.01px;top:400.05px" class="cls_026"><span class="cls_026">Kubernetes deployment definition for the web component</span></div>
<div style="position:absolute;left:108.00px;top:418.79px" class="cls_008"><span class="cls_008">The preceding deployment definition can be found in the </span><span class="cls_010">web-deployment.yaml</span><span class="cls_008"> file</span></div>
<div style="position:absolute;left:108.00px;top:431.39px" class="cls_008"><span class="cls_008">in the labs folder </span><span class="cls_010">ch11</span><span class="cls_008">. The lines of code are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:452.63px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On line 4</span><span class="cls_008">:  We define the </span><span class="cls_010">name</span><span class="cls_008"> for our </span><span class="cls_010">Deployment</span><span class="cls_008"> object as </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:126.00px;top:469.55px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On line 6</span><span class="cls_008">:  We declare that we want to have one instance of the </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:144.00px;top:482.15px" class="cls_008"><span class="cls_008">component running</span></div>
<div style="position:absolute;left:126.00px;top:499.07px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  From line 8 to 10</span><span class="cls_008">: We define which pods will be part of our deployment,</span></div>
<div style="position:absolute;left:144.00px;top:511.67px" class="cls_008"><span class="cls_008">namely those which have the labels </span><span class="cls_010">app</span><span class="cls_008"> and </span><span class="cls_010">service</span><span class="cls_008"> with values, </span><span class="cls_010">pets</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:144.00px;top:524.27px" class="cls_010"><span class="cls_010">web</span><span class="cls_008"> respectively</span></div>
<div style="position:absolute;left:126.00px;top:541.19px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On line 11</span><span class="cls_008">: In the template for the pods starting at line 11, we define that</span></div>
<div style="position:absolute;left:144.00px;top:553.79px" class="cls_008"><span class="cls_008">each pod will have the two labels </span><span class="cls_010">app</span><span class="cls_008"> and </span><span class="cls_010">service</span><span class="cls_008"> applied</span></div>
<div style="position:absolute;left:126.00px;top:570.71px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  From line 17</span><span class="cls_008">: We define the single container that will be running</span></div>
<div style="position:absolute;left:143.99px;top:583.31px" class="cls_008"><span class="cls_008">in the pod. The image for the container is our well-known</span></div>
<div style="position:absolute;left:144.00px;top:595.91px" class="cls_010"><span class="cls_010">appswithdockerandkubernetes/ch08-web:1.0</span><span class="cls_008"> image and the name of the</span></div>
<div style="position:absolute;left:144.00px;top:608.51px" class="cls_008"><span class="cls_008">container will be </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:126.00px;top:625.43px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Ports</span><span class="cls_008">: Finally, we declare that the container exposes port </span><span class="cls_010">3000</span><span class="cls_008"> for</span></div>
<div style="position:absolute;left:144.00px;top:638.03px" class="cls_008"><span class="cls_008">TCP-type traffic</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 217 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:186866px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background241.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:167.30px;top:126.11px" class="cls_025"><span class="cls_025">Make sure that you have set the context of </span><span class="cls_010">kubectl</span><span class="cls_025"> to </span><span class="cls_010">Minikube</span><span class="cls_025">. See</span></div>
<div style="position:absolute;left:167.30px;top:137.51px" class="cls_030"><span class="cls_030">Chapter 2</span><span class="cls_025">, </span><span class="cls_030">Setting up a Working Environment</span><span class="cls_025">, for details on how to do that.</span></div>
<div style="position:absolute;left:108.00px;top:165.46px" class="cls_008"><span class="cls_008">We can deploy this </span><span class="cls_010">Deployment</span><span class="cls_008"> object using </span><span class="cls_010">kubectl</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:186.40px" class="cls_024"><span class="cls_024">$ kubectl create -f web-deployment.yaml</span></div>
<div style="position:absolute;left:108.00px;top:206.14px" class="cls_008"><span class="cls_008">We can double-check that the deployment has been created again using our</span></div>
<div style="position:absolute;left:108.00px;top:218.74px" class="cls_008"><span class="cls_008">Kubernetes CLI, and we should see the following output:</span></div>
<div style="position:absolute;left:232.53px;top:437.76px" class="cls_026"><span class="cls_026">Listing all resources running in Minikube</span></div>
<div style="position:absolute;left:169.92px;top:464.95px" class="cls_025"><span class="cls_025">At the time of writing, there seems to be a bug in Minikube or </span><span class="cls_010">kubectl</span></div>
<div style="position:absolute;left:169.92px;top:476.35px" class="cls_025"><span class="cls_025">that displays certain resources twice when using the command </span><span class="cls_010">kubectl</span></div>
<div style="position:absolute;left:169.92px;top:487.75px" class="cls_010"><span class="cls_010">get all</span><span class="cls_025">. You can just ignore the duplicate output.</span></div>
<div style="position:absolute;left:108.00px;top:513.14px" class="cls_008"><span class="cls_008">In the preceding output, we see that Kubernetes created three objects—the</span></div>
<div style="position:absolute;left:108.00px;top:525.74px" class="cls_008"><span class="cls_008">deployment, a pertaining </span><span class="cls_010">ReplicaSet</span><span class="cls_008">, and a single pod (remember we specified that</span></div>
<div style="position:absolute;left:108.00px;top:538.34px" class="cls_008"><span class="cls_008">we want one replica only). The current state corresponds to the desired state for all</span></div>
<div style="position:absolute;left:108.00px;top:550.94px" class="cls_008"><span class="cls_008">three objects, thus we are fine so far.</span></div>
<div style="position:absolute;left:108.00px;top:572.18px" class="cls_008"><span class="cls_008">Now, the web service needs to be exposed to the public. For this, we need to define</span></div>
<div style="position:absolute;left:108.00px;top:584.78px" class="cls_008"><span class="cls_008">a Kubernetes </span><span class="cls_010">Service</span><span class="cls_008"> object of type </span><span class="cls_010">NodePort</span><span class="cls_008">. Here is the definition, which can be</span></div>
<div style="position:absolute;left:108.00px;top:597.38px" class="cls_008"><span class="cls_008">found in the </span><span class="cls_010">web-service.yaml</span><span class="cls_008"> file in the </span><span class="cls_010">labs</span><span class="cls_008"> folder </span><span class="cls_010">ch11</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 218 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:187668px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background242.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:209.22px;top:286.44px" class="cls_026"><span class="cls_026">Definition of the Service object for our web component</span></div>
<div style="position:absolute;left:108.00px;top:305.18px" class="cls_008"><span class="cls_008">The preceding lines of codes are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:326.42px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On line 4</span><span class="cls_008">: We set the name of this </span><span class="cls_010">Service</span><span class="cls_008"> object to </span><span class="cls_010">web</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:343.34px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On line 6</span><span class="cls_008">: We define the type of </span><span class="cls_010">Service</span><span class="cls_008"> object we're using. Since the </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:144.00px;top:355.94px" class="cls_008"><span class="cls_008">component has to be accessible from outside of the cluster, this cannot be a</span></div>
<div style="position:absolute;left:144.00px;top:368.54px" class="cls_010"><span class="cls_010">Service</span><span class="cls_008"> object of type </span><span class="cls_010">ClusterIP</span><span class="cls_008"> but must be either of type </span><span class="cls_010">NodePort</span><span class="cls_008"> or</span></div>
<div style="position:absolute;left:144.00px;top:381.14px" class="cls_010"><span class="cls_010">LoadBalancer</span><span class="cls_008">. We have discussed the various types of Kubernetes services</span></div>
<div style="position:absolute;left:144.00px;top:393.74px" class="cls_008"><span class="cls_008">in the previous chapter and so will not go into further detail about this. In</span></div>
<div style="position:absolute;left:144.00px;top:406.34px" class="cls_008"><span class="cls_008">our sample, we're using a </span><span class="cls_010">NodePort</span><span class="cls_008"> type of service.</span></div>
<div style="position:absolute;left:126.00px;top:423.26px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  On lines 8 and 9</span><span class="cls_008">: We specify that we want to expose port </span><span class="cls_010">3000</span><span class="cls_008"> for access</span></div>
<div style="position:absolute;left:144.00px;top:435.86px" class="cls_008"><span class="cls_008">through the TCP protocol. Kubernetes will map container port </span><span class="cls_010">3000</span></div>
<div style="position:absolute;left:144.00px;top:448.46px" class="cls_008"><span class="cls_008">automatically to a free host port in the range of 30,000 to 32,768. Which port</span></div>
<div style="position:absolute;left:144.00px;top:461.06px" class="cls_008"><span class="cls_008">Kubernetes effectively chooses can be determined using the </span><span class="cls_010">kubectl get</span></div>
<div style="position:absolute;left:144.00px;top:473.66px" class="cls_010"><span class="cls_010">service</span><span class="cls_008"> or </span><span class="cls_010">kubectl describe</span><span class="cls_008"> command for the service after it has been</span></div>
<div style="position:absolute;left:144.00px;top:486.26px" class="cls_008"><span class="cls_008">created.</span></div>
<div style="position:absolute;left:126.01px;top:503.18px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  From line 10 to 12</span><span class="cls_008">: We define the filter criteria for the pods for which this</span></div>
<div style="position:absolute;left:144.00px;top:515.78px" class="cls_008"><span class="cls_008">service will be a stable endpoint. In this case, it is all pods that have the labels</span></div>
<div style="position:absolute;left:144.00px;top:528.38px" class="cls_010"><span class="cls_010">app</span><span class="cls_008"> and </span><span class="cls_010">service</span><span class="cls_008"> with values </span><span class="cls_010">pets</span><span class="cls_008"> and </span><span class="cls_010">web</span><span class="cls_008"> respectively.</span></div>
<div style="position:absolute;left:108.00px;top:549.62px" class="cls_008"><span class="cls_008">Having this specification for a </span><span class="cls_010">Service</span><span class="cls_008"> object, we can create it using </span><span class="cls_010">kubectl</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:570.56px" class="cls_024"><span class="cls_024">$ kubectl create -f web-service.yaml</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 219 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:188470px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background243.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can list all services to see the result of the preceding command:</span></div>
<div style="position:absolute;left:218.27px;top:203.64px" class="cls_026"><span class="cls_026">The Service object created for the web component</span></div>
<div style="position:absolute;left:108.00px;top:222.38px" class="cls_008"><span class="cls_008">In the output, we see that a service called </span><span class="cls_010">web</span><span class="cls_008"> has been created. A unique </span><span class="cls_010">clusterIP</span></div>
<div style="position:absolute;left:108.00px;top:234.98px" class="cls_010"><span class="cls_010">10.103.113.40</span><span class="cls_008"> has been assigned to this service, and the container port </span><span class="cls_010">3000</span><span class="cls_008"> has</span></div>
<div style="position:absolute;left:108.00px;top:247.58px" class="cls_008"><span class="cls_008">been published on port </span><span class="cls_010">30125</span><span class="cls_008"> on all cluster nodes.</span></div>
<div style="position:absolute;left:108.00px;top:268.83px" class="cls_008"><span class="cls_008">If we want to test this deployment, we need to first find out what IP address</span></div>
<div style="position:absolute;left:108.00px;top:281.42px" class="cls_008"><span class="cls_008">Minikube has, and then use this IP address to access our </span><span class="cls_010">web</span><span class="cls_008"> service. The following</span></div>
<div style="position:absolute;left:108.00px;top:294.02px" class="cls_008"><span class="cls_008">is the command that we can use to do this:</span></div>
<div style="position:absolute;left:126.00px;top:314.96px" class="cls_024"><span class="cls_024">$ IP=$(minikube ip)</span></div>
<div style="position:absolute;left:126.00px;top:325.76px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:325.76px" class="cls_024"><span class="cls_024">$IP:30125/</span></div>
<div style="position:absolute;left:126.00px;top:336.56px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:108.00px;top:356.30px" class="cls_008"><span class="cls_008">OK, the response is Pets Demo Application, which is what we expected. The</span></div>
<div style="position:absolute;left:108.00px;top:368.90px" class="cls_010"><span class="cls_010">web</span><span class="cls_008"> service is up and running in the Kubernetes cluster. Next, we want to deploy</span></div>
<div style="position:absolute;left:108.00px;top:381.50px" class="cls_008"><span class="cls_008">the database.</span></div>
<div style="position:absolute;left:108.00px;top:411.44px" class="cls_022"><span class="cls_022">Deploying the database</span></div>
<div style="position:absolute;left:108.00px;top:434.42px" class="cls_008"><span class="cls_008">A database is a stateful component and has to be treated differently to stateless</span></div>
<div style="position:absolute;left:108.00px;top:447.02px" class="cls_008"><span class="cls_008">components, such as our web component. We have discussed the difference between</span></div>
<div style="position:absolute;left:108.00px;top:459.62px" class="cls_008"><span class="cls_008">stateful and stateless components in a distributed application architecture in detail in</span></div>
<div style="position:absolute;left:108.00px;top:472.22px" class="cls_021"><span class="cls_021">Chapter 6</span><span class="cls_008">, </span><span class="cls_021">Distributed Application Architecture</span><span class="cls_008">, and </span><span class="cls_021">Chapter 9</span><span class="cls_008">, </span><span class="cls_021">Orchestrators</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:493.46px" class="cls_008"><span class="cls_008">Kubernetes has defined a special type of </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> object for </span><span class="cls_010">stateful</span></div>
<div style="position:absolute;left:108.00px;top:506.06px" class="cls_008"><span class="cls_008">components. The object is called a </span><span class="cls_010">StatefulSet</span><span class="cls_008">. Let's use this kind of object to</span></div>
<div style="position:absolute;left:108.00px;top:518.66px" class="cls_008"><span class="cls_008">deploy our database. The definition can be found in the </span><span class="cls_010">labs/ch11/db-stateful-</span></div>
<div style="position:absolute;left:108.00px;top:531.26px" class="cls_010"><span class="cls_010">set.yaml</span><span class="cls_008"> file. The details are as follows:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 220 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:189272px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background244.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:242.90px;top:505.99px" class="cls_026"><span class="cls_026">A StatefulSet for the DB component</span></div>
<div style="position:absolute;left:108.00px;top:524.73px" class="cls_008"><span class="cls_008">OK, this looks a bit scary, but it is not. It is a bit longer than the definition of the</span></div>
<div style="position:absolute;left:108.00px;top:537.33px" class="cls_008"><span class="cls_008">deployment for the web component due to the fact that we also need to define</span></div>
<div style="position:absolute;left:108.00px;top:549.93px" class="cls_008"><span class="cls_008">a volume where the PostgreSQL database can store the data. The volume claim</span></div>
<div style="position:absolute;left:108.00px;top:562.53px" class="cls_008"><span class="cls_008">definition is on lines 25 to 33. We want to create a volume with the name </span><span class="cls_010">pets-</span></div>
<div style="position:absolute;left:108.00px;top:575.13px" class="cls_010"><span class="cls_010">data</span><span class="cls_008"> and of a maximum size equal to 100 MB. On lines 22 to 24, we use this volume</span></div>
<div style="position:absolute;left:108.00px;top:587.73px" class="cls_008"><span class="cls_008">and mount it into the container at </span><span class="cls_010">/var/lib/postgresql/data</span><span class="cls_008"> where PostgreSQL</span></div>
<div style="position:absolute;left:108.00px;top:600.33px" class="cls_008"><span class="cls_008">expects it. On line 21, we also declare that PostgreSQL is listening at port </span><span class="cls_010">5432</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:621.57px" class="cls_008"><span class="cls_008">As always, we use </span><span class="cls_010">kubectl</span><span class="cls_008"> to deploy the </span><span class="cls_010">StatefulSet</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:642.51px" class="cls_024"><span class="cls_024">$ kubectl create -f db-stateful-set.yaml</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 221 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:190074px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background245.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">If we now list all resources in the cluster we can see the additional objects created:</span></div>
<div style="position:absolute;left:258.48px;top:361.00px" class="cls_026"><span class="cls_026">The StatefulSet and its pod</span></div>
<div style="position:absolute;left:108.00px;top:379.74px" class="cls_008"><span class="cls_008">We see that a </span><span class="cls_010">StatefulSet</span><span class="cls_008"> and a pod have been created. For both, the current state</span></div>
<div style="position:absolute;left:108.00px;top:392.34px" class="cls_008"><span class="cls_008">corresponds to the desired state and thus the system is healthy. But that doesn't</span></div>
<div style="position:absolute;left:108.00px;top:404.94px" class="cls_008"><span class="cls_008">mean that the </span><span class="cls_010">web</span><span class="cls_008"> component can access the database at this time. Service discovery</span></div>
<div style="position:absolute;left:108.00px;top:417.54px" class="cls_008"><span class="cls_008">would not work so far. Remember that the </span><span class="cls_010">web</span><span class="cls_008"> component wants to access the </span><span class="cls_010">db</span></div>
<div style="position:absolute;left:108.00px;top:430.14px" class="cls_008"><span class="cls_008">service under the name </span><span class="cls_010">db</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:451.38px" class="cls_008"><span class="cls_008">To make </span><span class="cls_010">service</span><span class="cls_008"> discovery work inside the cluster, we have to define a Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:463.98px" class="cls_010"><span class="cls_010">Service</span><span class="cls_008"> object for the database component too. Since the database should only</span></div>
<div style="position:absolute;left:108.00px;top:476.58px" class="cls_008"><span class="cls_008">ever be accessible from within the cluster, the type of </span><span class="cls_010">Service</span><span class="cls_008"> object we need is</span></div>
<div style="position:absolute;left:108.00px;top:489.18px" class="cls_010"><span class="cls_010">ClusterIP</span><span class="cls_008">. Here is the specification, which can be found in the </span><span class="cls_010">labs/ch11/db-</span></div>
<div style="position:absolute;left:108.00px;top:501.78px" class="cls_010"><span class="cls_010">service.yaml</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 222 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:190876px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background246.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:201.51px;top:309.75px" class="cls_026"><span class="cls_026">Definition of the Kubernetes Service object for the database</span></div>
<div style="position:absolute;left:108.00px;top:328.49px" class="cls_008"><span class="cls_008">The database component will be represented by this </span><span class="cls_010">Service</span><span class="cls_008"> object and it will be</span></div>
<div style="position:absolute;left:108.00px;top:341.09px" class="cls_008"><span class="cls_008">reachable by the name </span><span class="cls_010">db</span><span class="cls_008">, which is the name of the service, as defined on line 4.</span></div>
<div style="position:absolute;left:108.00px;top:353.69px" class="cls_008"><span class="cls_008">The database component does not have to be publicly accessible, so we decided to</span></div>
<div style="position:absolute;left:108.00px;top:366.29px" class="cls_008"><span class="cls_008">use a </span><span class="cls_010">Service</span><span class="cls_008"> object of type </span><span class="cls_010">ClusterIP</span><span class="cls_008">. The selector on lines 10 to 12 defines that</span></div>
<div style="position:absolute;left:108.00px;top:378.89px" class="cls_008"><span class="cls_008">this service represents a stable endpoint for all pods that have the according labels</span></div>
<div style="position:absolute;left:108.00px;top:391.49px" class="cls_008"><span class="cls_008">defined, that is, </span><span class="cls_010">app: pets</span><span class="cls_008"> and </span><span class="cls_010">service: db</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:412.73px" class="cls_008"><span class="cls_008">Let's deploy this service with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:433.67px" class="cls_024"><span class="cls_024">$ kubectl create -f db-service.yaml</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 223 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:191678px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background247.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">And we should now be ready to test the application. We can use the browser this</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">time to enjoy the funny cat images:</span></div>
<div style="position:absolute;left:216.11px;top:359.69px" class="cls_026"><span class="cls_026">Testing the pets application running in Kubernetes</span></div>
<div style="position:absolute;left:181.44px;top:388.15px" class="cls_010"><span class="cls_010">192.168.99.100</span><span class="cls_025"> is the IP address of my Minikube. Verify your</span></div>
<div style="position:absolute;left:181.44px;top:399.55px" class="cls_025"><span class="cls_025">address using the command </span><span class="cls_010">minikube ip</span><span class="cls_025">. The port number</span></div>
<div style="position:absolute;left:181.44px;top:410.95px" class="cls_010"><span class="cls_010">30125</span><span class="cls_025"> is the number that Kubernetes automatically selected for</span></div>
<div style="position:absolute;left:181.44px;top:422.35px" class="cls_025"><span class="cls_025">my web </span><span class="cls_010">Service</span><span class="cls_025"> object. Replace this number with the port that</span></div>
<div style="position:absolute;left:181.44px;top:433.75px" class="cls_025"><span class="cls_025">Kubernetes assigned to your service. Get the number by using the</span></div>
<div style="position:absolute;left:181.44px;top:445.15px" class="cls_025"><span class="cls_025">command </span><span class="cls_010">kubectl</span><span class="cls_025"> </span><span class="cls_010">get services</span><span class="cls_025">.</span></div>
<div style="position:absolute;left:108.00px;top:471.79px" class="cls_008"><span class="cls_008">Now we have successfully deployed the pets application to Minikube, which is a</span></div>
<div style="position:absolute;left:108.00px;top:484.39px" class="cls_008"><span class="cls_008">single-node Kubernetes cluster. We had to define four artifacts to do so, which are</span></div>
<div style="position:absolute;left:108.00px;top:496.99px" class="cls_008"><span class="cls_008">as follows:</span></div>
<div style="position:absolute;left:126.00px;top:518.23px" class="cls_008"><span class="cls_008">•  A </span><span class="cls_010">Deployment</span><span class="cls_008"> and a </span><span class="cls_010">Service</span><span class="cls_008"> object for the web component</span></div>
<div style="position:absolute;left:126.00px;top:535.15px" class="cls_008"><span class="cls_008">•  A </span><span class="cls_010">StatefulSet</span><span class="cls_008"> and a </span><span class="cls_010">Service</span><span class="cls_008"> object for the database component</span></div>
<div style="position:absolute;left:108.00px;top:556.39px" class="cls_008"><span class="cls_008">To remove the application from the cluster, we can use the following small script:</span></div>
<div style="position:absolute;left:126.00px;top:577.33px" class="cls_024"><span class="cls_024">kubectl delete svc/web</span></div>
<div style="position:absolute;left:126.00px;top:588.13px" class="cls_024"><span class="cls_024">kubectl delete deploy/web</span></div>
<div style="position:absolute;left:126.00px;top:598.93px" class="cls_024"><span class="cls_024">kubectl delete svc/db</span></div>
<div style="position:absolute;left:126.00px;top:609.73px" class="cls_024"><span class="cls_024">kubectl delete statefulset/db</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 224 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:192480px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background248.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Streamlining the deployment</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">So far, we have created four artifacts that needed to be deployed to the cluster. And</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">this is only a very simple application, consisting of two components. Imagine having a</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">much more complex application. It would quickly become a maintenance nightmare.</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">Luckily, we have several options as to how we can simplify the deployment.</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">The method that we are going to discuss here is the possibility of defining all the</span></div>
<div style="position:absolute;left:108.00px;top:198.44px" class="cls_008"><span class="cls_008">components that make up an application in Kubernetes in a single file.</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">Other solutions that lie outside of the scope of this book would include the use of a</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">package manager, such as </span><span class="cls_009">Helm</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:253.52px" class="cls_008"><span class="cls_008">If we have an application consisting of many Kubernetes objects such as </span><span class="cls_010">Deployment</span></div>
<div style="position:absolute;left:108.00px;top:266.12px" class="cls_008"><span class="cls_008">and </span><span class="cls_010">Service</span><span class="cls_008"> objects, then we can keep them all in one single file and separate the</span></div>
<div style="position:absolute;left:108.00px;top:278.72px" class="cls_008"><span class="cls_008">individual object definitions by three dashes. For example, if we wanted to have the</span></div>
<div style="position:absolute;left:108.00px;top:291.32px" class="cls_008"><span class="cls_008">deployment and the service definition for the web component in a single file, this</span></div>
<div style="position:absolute;left:108.00px;top:303.92px" class="cls_008"><span class="cls_008">would look as follows:</span></div>
<div style="position:absolute;left:126.00px;top:324.86px" class="cls_023"><span class="cls_023">apiVersion: extensions/v1beta1</span></div>
<div style="position:absolute;left:126.00px;top:335.66px" class="cls_023"><span class="cls_023">kind: Deployment</span></div>
<div style="position:absolute;left:126.00px;top:346.46px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:357.26px" class="cls_023"><span class="cls_023">name: web</span></div>
<div style="position:absolute;left:126.00px;top:368.06px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:378.86px" class="cls_023"><span class="cls_023">replicas: 1</span></div>
<div style="position:absolute;left:136.80px;top:389.66px" class="cls_023"><span class="cls_023">selector:</span></div>
<div style="position:absolute;left:147.60px;top:400.46px" class="cls_023"><span class="cls_023">matchLabels:</span></div>
<div style="position:absolute;left:158.40px;top:411.26px" class="cls_023"><span class="cls_023">app: pets</span></div>
<div style="position:absolute;left:158.40px;top:422.06px" class="cls_023"><span class="cls_023">service: web</span></div>
<div style="position:absolute;left:136.80px;top:432.86px" class="cls_023"><span class="cls_023">template:</span></div>
<div style="position:absolute;left:147.60px;top:443.66px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:158.40px;top:454.46px" class="cls_023"><span class="cls_023">labels:</span></div>
<div style="position:absolute;left:169.20px;top:465.26px" class="cls_023"><span class="cls_023">app: pets</span></div>
<div style="position:absolute;left:169.20px;top:476.06px" class="cls_023"><span class="cls_023">service: web</span></div>
<div style="position:absolute;left:147.60px;top:486.86px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:158.40px;top:497.66px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:158.40px;top:508.46px" class="cls_023"><span class="cls_023">- image: appswithdockerandkubernetes/ch08-web:1.0</span></div>
<div style="position:absolute;left:169.20px;top:519.26px" class="cls_023"><span class="cls_023">name: web</span></div>
<div style="position:absolute;left:169.20px;top:530.06px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:169.20px;top:540.86px" class="cls_023"><span class="cls_023">- containerPort: 3000</span></div>
<div style="position:absolute;left:180.00px;top:551.66px" class="cls_023"><span class="cls_023">protocol: TCP</span></div>
<div style="position:absolute;left:126.00px;top:562.46px" class="cls_023"><span class="cls_023">---</span></div>
<div style="position:absolute;left:126.00px;top:573.26px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:584.06px" class="cls_023"><span class="cls_023">kind: Service</span></div>
<div style="position:absolute;left:126.00px;top:594.86px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:605.66px" class="cls_023"><span class="cls_023">name: web</span></div>
<div style="position:absolute;left:126.00px;top:616.46px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:627.26px" class="cls_023"><span class="cls_023">type: NodePort</span></div>
<div style="position:absolute;left:136.80px;top:638.06px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 225 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:193282px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background249.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:136.80px;top:114.01px" class="cls_023"><span class="cls_023">- port: 3000</span></div>
<div style="position:absolute;left:147.60px;top:124.81px" class="cls_023"><span class="cls_023">protocol: TCP</span></div>
<div style="position:absolute;left:136.80px;top:135.61px" class="cls_023"><span class="cls_023">selector:</span></div>
<div style="position:absolute;left:147.60px;top:146.41px" class="cls_023"><span class="cls_023">app: pets</span></div>
<div style="position:absolute;left:147.60px;top:157.21px" class="cls_023"><span class="cls_023">service: web</span></div>
<div style="position:absolute;left:108.00px;top:176.94px" class="cls_008"><span class="cls_008">We have collected all the four object definitions for the pets application in the </span><span class="cls_010">labs/</span></div>
<div style="position:absolute;left:108.00px;top:189.54px" class="cls_010"><span class="cls_010">ch11/pets.yaml</span><span class="cls_008"> file, and we can deploy the application in one go:</span></div>
<div style="position:absolute;left:216.47px;top:285.81px" class="cls_026"><span class="cls_026">Using a single script to deploy the pets application</span></div>
<div style="position:absolute;left:108.00px;top:304.55px" class="cls_008"><span class="cls_008">Similarly, we have created a script, </span><span class="cls_010">labs/ch11/remove-pets.sh</span><span class="cls_008">, to remove all</span></div>
<div style="position:absolute;left:108.00px;top:317.15px" class="cls_008"><span class="cls_008">artifacts of the pets application from the Kubernetes cluster:</span></div>
<div style="position:absolute;left:229.19px;top:421.43px" class="cls_026"><span class="cls_026">Removing pets from the Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:440.17px" class="cls_008"><span class="cls_008">We have taken our pets application we introduced in </span><span class="cls_021">Chapter 8</span><span class="cls_008">, </span><span class="cls_021">Docker Compose</span><span class="cls_008">, and</span></div>
<div style="position:absolute;left:108.00px;top:452.77px" class="cls_008"><span class="cls_008">defined all the Kubernetes objects that are necessary to deploy this application into a</span></div>
<div style="position:absolute;left:108.00px;top:465.37px" class="cls_008"><span class="cls_008">Kubernetes cluster. In each step, we have made sure that we got the expected result,</span></div>
<div style="position:absolute;left:108.00px;top:477.97px" class="cls_008"><span class="cls_008">and once all artifacts existed in the cluster, we have shown the running application.</span></div>
<div style="position:absolute;left:108.00px;top:510.47px" class="cls_011"><span class="cls_011">Zero downtime deployments</span></div>
<div style="position:absolute;left:108.00px;top:535.45px" class="cls_008"><span class="cls_008">In a mission-critical environment, it is important that the application is always up</span></div>
<div style="position:absolute;left:108.00px;top:548.05px" class="cls_008"><span class="cls_008">and running. These days we cannot afford any downtime anymore. Kubernetes gives</span></div>
<div style="position:absolute;left:108.00px;top:560.65px" class="cls_008"><span class="cls_008">us various means of achieving this. An update of an application in the cluster that</span></div>
<div style="position:absolute;left:108.00px;top:573.25px" class="cls_008"><span class="cls_008">causes no downtime is called a </span><span class="cls_009">zero downtime deployment</span><span class="cls_008">. In this chapter, we will</span></div>
<div style="position:absolute;left:108.00px;top:585.85px" class="cls_008"><span class="cls_008">present two ways of achieving this. These are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:607.09px" class="cls_008"><span class="cls_008">•  Rolling updates</span></div>
<div style="position:absolute;left:126.00px;top:624.01px" class="cls_008"><span class="cls_008">•  Blue-green deployments</span></div>
<div style="position:absolute;left:107.99px;top:645.25px" class="cls_008"><span class="cls_008">Let's start by discussing rolling updates.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 226 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:194084px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background250.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Rolling updates</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">In the previous chapter, we learned that the Kubernetes </span><span class="cls_010">Deployment</span><span class="cls_008"> object</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">distinguishes itself from the </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> object in that it adds rolling updates</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">and rollbacks on top of the latter's functionality. Let's use our </span><span class="cls_010">web</span><span class="cls_008"> component to</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">demonstrate this. Evidently, we will  have to modify the manifest or description of</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">the deployment for the </span><span class="cls_010">web</span><span class="cls_008"> component.</span></div>
<div style="position:absolute;left:108.00px;top:207.09px" class="cls_008"><span class="cls_008">We will use the same deployment definition as in the previous section, with one</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">important difference—we will have five replicas of the web component running. The</span></div>
<div style="position:absolute;left:108.00px;top:232.29px" class="cls_008"><span class="cls_008">following definition can also be found in the </span><span class="cls_010">labs/ch11/web-deploy-rolling-v1.</span></div>
<div style="position:absolute;left:108.00px;top:244.88px" class="cls_010"><span class="cls_010">yaml</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:126.00px;top:265.82px" class="cls_023"><span class="cls_023">apiVersion: extensions/v1beta1</span></div>
<div style="position:absolute;left:126.00px;top:276.62px" class="cls_023"><span class="cls_023">kind: Deployment</span></div>
<div style="position:absolute;left:126.00px;top:287.42px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:298.22px" class="cls_023"><span class="cls_023">name: web</span></div>
<div style="position:absolute;left:126.00px;top:309.02px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:136.80px;top:319.82px" class="cls_023"><span class="cls_023">replicas: 5</span></div>
<div style="position:absolute;left:136.80px;top:330.62px" class="cls_023"><span class="cls_023">selector:</span></div>
<div style="position:absolute;left:147.60px;top:341.42px" class="cls_023"><span class="cls_023">matchLabels:</span></div>
<div style="position:absolute;left:158.40px;top:352.22px" class="cls_023"><span class="cls_023">app: pets</span></div>
<div style="position:absolute;left:158.40px;top:363.02px" class="cls_023"><span class="cls_023">service: web</span></div>
<div style="position:absolute;left:136.80px;top:373.82px" class="cls_023"><span class="cls_023">template:</span></div>
<div style="position:absolute;left:147.60px;top:384.62px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:158.40px;top:395.42px" class="cls_023"><span class="cls_023">labels:</span></div>
<div style="position:absolute;left:169.20px;top:406.22px" class="cls_023"><span class="cls_023">app: pets</span></div>
<div style="position:absolute;left:169.20px;top:417.02px" class="cls_023"><span class="cls_023">service: web</span></div>
<div style="position:absolute;left:147.60px;top:427.82px" class="cls_023"><span class="cls_023">spec:</span></div>
<div style="position:absolute;left:158.40px;top:438.62px" class="cls_023"><span class="cls_023">containers:</span></div>
<div style="position:absolute;left:158.40px;top:449.42px" class="cls_023"><span class="cls_023">- image: appswithdockerandkubernetes/ch08-web:1.0</span></div>
<div style="position:absolute;left:169.20px;top:460.22px" class="cls_023"><span class="cls_023">name: web</span></div>
<div style="position:absolute;left:169.20px;top:471.02px" class="cls_023"><span class="cls_023">ports:</span></div>
<div style="position:absolute;left:169.20px;top:481.82px" class="cls_023"><span class="cls_023">- containerPort: 3000</span></div>
<div style="position:absolute;left:180.00px;top:492.62px" class="cls_023"><span class="cls_023">protocol: TCP</span></div>
<div style="position:absolute;left:108.00px;top:512.36px" class="cls_008"><span class="cls_008">We can now create this deployment as usual and also, at the same time, the service</span></div>
<div style="position:absolute;left:108.00px;top:524.96px" class="cls_008"><span class="cls_008">that makes our component accessible:</span></div>
<div style="position:absolute;left:126.00px;top:545.90px" class="cls_024"><span class="cls_024">$ kubectl create -f web-deploy-rolling-v1.yaml</span></div>
<div style="position:absolute;left:126.00px;top:556.70px" class="cls_024"><span class="cls_024">$ kubectl create -f web-service.yaml</span></div>
<div style="position:absolute;left:108.00px;top:576.44px" class="cls_008"><span class="cls_008">Once we have deployed the pods and the service, we can test our web component</span></div>
<div style="position:absolute;left:108.00px;top:589.04px" class="cls_008"><span class="cls_008">with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:609.98px" class="cls_024"><span class="cls_024">$ PORT=$(kubectl get svc/web -o yaml | grep nodePort | cut -d' ' -f5)</span></div>
<div style="position:absolute;left:126.00px;top:620.78px" class="cls_024"><span class="cls_024">$ IP=$(minikube ip)</span></div>
<div style="position:absolute;left:126.00px;top:631.58px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:631.58px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:642.38px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 227 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:194886px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background251.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">As we can see, the application is up and running and returns us the expected</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">message, </span><span class="cls_010">Pets Demo Application</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:148.33px" class="cls_008"><span class="cls_008">Now developers have created a new version, </span><span class="cls_010">2.0</span><span class="cls_008">, of the </span><span class="cls_010">web</span><span class="cls_008"> component. The code</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_008"><span class="cls_008">of the new version of the </span><span class="cls_010">web</span><span class="cls_008"> component can be found in the </span><span class="cls_010">labs/ch11/web/src</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_008"><span class="cls_008">folder, and the only change is located on line 12 of the file </span><span class="cls_010">server.js</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:216.34px;top:267.34px" class="cls_026"><span class="cls_026">Code change for version 2.0 of the web component</span></div>
<div style="position:absolute;left:108.00px;top:286.08px" class="cls_008"><span class="cls_008">The developers have built the new image as follows:</span></div>
<div style="position:absolute;left:126.00px;top:307.02px" class="cls_024"><span class="cls_024">$ docker image build -t appswithdockerandkubernetes/ch11-web:2.0 web</span></div>
<div style="position:absolute;left:108.00px;top:326.76px" class="cls_008"><span class="cls_008">And, subsequently, they pushed the image to Docker Hub:</span></div>
<div style="position:absolute;left:126.00px;top:347.70px" class="cls_024"><span class="cls_024">$ docker image push appswithdockerandkubernetes/ch11-web:2.0</span></div>
<div style="position:absolute;left:108.00px;top:367.44px" class="cls_008"><span class="cls_008">We now want to update the image used by our pods that are part of the web</span></div>
<div style="position:absolute;left:108.00px;top:380.04px" class="cls_010"><span class="cls_010">Deployment</span><span class="cls_008"> object. We can do this by using the set </span><span class="cls_010">image</span><span class="cls_008"> command of </span><span class="cls_010">kubectl</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:400.98px" class="cls_024"><span class="cls_024">$ kubectl set image deployment/web \</span></div>
<div style="position:absolute;left:147.60px;top:411.78px" class="cls_024"><span class="cls_024">web=appswithdockerandkubernetes/ch11-web:2.0</span></div>
<div style="position:absolute;left:108.00px;top:431.52px" class="cls_008"><span class="cls_008">If we then test the application again, we get the confirmation that the update has</span></div>
<div style="position:absolute;left:108.00px;top:444.12px" class="cls_008"><span class="cls_008">indeed happened:</span></div>
<div style="position:absolute;left:126.00px;top:465.06px" class="cls_024"><span class="cls_024">curl -4</span></div>
<div style="position:absolute;left:169.20px;top:465.06px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:475.86px" class="cls_024"><span class="cls_024">Pets Demo Application v2</span></div>
<div style="position:absolute;left:108.00px;top:495.60px" class="cls_008"><span class="cls_008">Now, </span><span class="cls_021">how do we know that there hasn't been any downtime during this update? Did the</span></div>
<div style="position:absolute;left:108.00px;top:508.20px" class="cls_021"><span class="cls_021">update really happen in a rolling fashion? What does rolling update mean at all?</span><span class="cls_008"> Let's</span></div>
<div style="position:absolute;left:108.00px;top:520.80px" class="cls_008"><span class="cls_008">investigate. First, we can get a confirmation from Kubernetes that the deployment</span></div>
<div style="position:absolute;left:108.00px;top:533.40px" class="cls_008"><span class="cls_008">has indeed happened and was successful by using the </span><span class="cls_010">rollout status</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:126.00px;top:554.34px" class="cls_024"><span class="cls_024">$ kubectl rollout status deploy/web</span></div>
<div style="position:absolute;left:126.00px;top:565.14px" class="cls_024"><span class="cls_024">deployment "web" successfully rolled out</span></div>
<div style="position:absolute;left:108.00px;top:584.88px" class="cls_008"><span class="cls_008">If we describe the deployment web with </span><span class="cls_010">kubectl</span><span class="cls_008"> describe </span><span class="cls_010">deploy/web</span><span class="cls_008"> , we get the</span></div>
<div style="position:absolute;left:107.99px;top:597.48px" class="cls_008"><span class="cls_008">following list of events at the end of the output:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 228 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:195688px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background252.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:151.77px;top:238.32px" class="cls_026"><span class="cls_026">List of events found in the output of the deployment description of the web component</span></div>
<div style="position:absolute;left:108.00px;top:257.06px" class="cls_008"><span class="cls_008">The first event tells us that when we created the deployment, a </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> </span><span class="cls_010">web-</span></div>
<div style="position:absolute;left:108.00px;top:269.66px" class="cls_010"><span class="cls_010">769b88f67</span><span class="cls_008"> with five replicas was created. Then we executed the update command</span></div>
<div style="position:absolute;left:108.00px;top:282.26px" class="cls_008"><span class="cls_008">and the second event in the list tells us that this meant creating a new </span><span class="cls_010">ReplicaSet</span></div>
<div style="position:absolute;left:108.00px;top:294.86px" class="cls_008"><span class="cls_008">called </span><span class="cls_010">web-55cdf67cd</span><span class="cls_008"> with, initially, one replica only. Thus, at that particular</span></div>
<div style="position:absolute;left:108.00px;top:307.46px" class="cls_008"><span class="cls_008">moment there existed six pods on the system, the five initial pods, and one pod with</span></div>
<div style="position:absolute;left:108.00px;top:320.06px" class="cls_008"><span class="cls_008">the new version. But since the desired state of the </span><span class="cls_010">Deployment</span><span class="cls_008"> object states that we</span></div>
<div style="position:absolute;left:108.00px;top:332.66px" class="cls_008"><span class="cls_008">want five replicas only, Kubernetes now scales down the old </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> to four</span></div>
<div style="position:absolute;left:108.00px;top:345.26px" class="cls_008"><span class="cls_008">instances, which we see in the third event. Then, again, the new </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> is scaled</span></div>
<div style="position:absolute;left:108.00px;top:357.86px" class="cls_008"><span class="cls_008">up to two instances and, subsequently, the old </span><span class="cls_010">ReplicaSet</span><span class="cls_008"> scaled down to three</span></div>
<div style="position:absolute;left:108.00px;top:370.46px" class="cls_008"><span class="cls_008">instances, and so on, until we have five new instances and all the old instances have</span></div>
<div style="position:absolute;left:108.00px;top:383.06px" class="cls_008"><span class="cls_008">been decommissioned. Although, we cannot see any precise time (other than three</span></div>
<div style="position:absolute;left:108.00px;top:395.66px" class="cls_008"><span class="cls_008">minutes) when that happened, the order of the events tells us that the whole update</span></div>
<div style="position:absolute;left:108.00px;top:408.26px" class="cls_008"><span class="cls_008">happened in a rolling fashion.</span></div>
<div style="position:absolute;left:108.00px;top:429.50px" class="cls_008"><span class="cls_008">During a short time period, some of the calls to the web service would have had an</span></div>
<div style="position:absolute;left:108.00px;top:442.10px" class="cls_008"><span class="cls_008">answer from the old version of the component and some calls would have received</span></div>
<div style="position:absolute;left:108.00px;top:454.70px" class="cls_008"><span class="cls_008">an answer from the new version of the component. But at no time would the service</span></div>
<div style="position:absolute;left:108.00px;top:467.30px" class="cls_008"><span class="cls_008">have been down.</span></div>
<div style="position:absolute;left:108.00px;top:488.54px" class="cls_008"><span class="cls_008">We can also list the </span><span class="cls_010">Recordset</span><span class="cls_008"> objects in the cluster and will get the confirmation of</span></div>
<div style="position:absolute;left:107.99px;top:501.14px" class="cls_008"><span class="cls_008">what I said in the preceding section:</span></div>
<div style="position:absolute;left:238.67px;top:589.51px" class="cls_026"><span class="cls_026">List all Recordset objects in the cluster</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 229 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:196490px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background253.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We see that the new recordset has five instances running and the old one has been</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">scaled down to zero instances. The reason why the old </span><span class="cls_010">Recordset</span><span class="cls_008"> object is still</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">lingering around is that Kubernetes provides us with the possibility of rolling back</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the update and, in that case, will reuse the </span><span class="cls_010">Recordset</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">To roll back the update of the image in case some undetected bug sneaked in to the</span></div>
<div style="position:absolute;left:108.00px;top:186.13px" class="cls_008"><span class="cls_008">new code, we can use the rollout </span><span class="cls_010">undo</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:126.00px;top:207.07px" class="cls_024"><span class="cls_024">$ kubectl rollout undo deploy/web</span></div>
<div style="position:absolute;left:126.00px;top:217.87px" class="cls_024"><span class="cls_024">deployment "web"</span></div>
<div style="position:absolute;left:126.00px;top:228.67px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:228.67px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:239.47px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:108.00px;top:259.21px" class="cls_008"><span class="cls_008">I have also listed the test command using curl in the preceding snippet to</span></div>
<div style="position:absolute;left:108.00px;top:271.81px" class="cls_008"><span class="cls_008">verify that the rollback indeed happened. If we list the </span><span class="cls_010">recordsets</span><span class="cls_008">, we see</span></div>
<div style="position:absolute;left:108.00px;top:284.41px" class="cls_008"><span class="cls_008">the following output:</span></div>
<div style="position:absolute;left:237.32px;top:369.71px" class="cls_026"><span class="cls_026">Listing RecordSet objects after rollback</span></div>
<div style="position:absolute;left:108.00px;top:388.45px" class="cls_008"><span class="cls_008">This confirms that the old </span><span class="cls_010">RecordSet</span><span class="cls_008"> (</span><span class="cls_010">web-769b88f67</span><span class="cls_008">) object has been reused and</span></div>
<div style="position:absolute;left:108.00px;top:401.05px" class="cls_008"><span class="cls_008">the new one has been scaled down to zero instances.</span></div>
<div style="position:absolute;left:108.00px;top:422.30px" class="cls_008"><span class="cls_008">Sometimes though we cannot, or do not want to, tolerate the mixed state of an old</span></div>
<div style="position:absolute;left:108.00px;top:434.90px" class="cls_008"><span class="cls_008">version coexisting with new version. We want an all-or-nothing strategy. This is</span></div>
<div style="position:absolute;left:108.00px;top:447.50px" class="cls_008"><span class="cls_008">where blue-green deployments come into play, which we will discuss next.</span></div>
<div style="position:absolute;left:108.00px;top:477.43px" class="cls_022"><span class="cls_022">Blue-green deployment</span></div>
<div style="position:absolute;left:108.00px;top:500.41px" class="cls_008"><span class="cls_008">If we want to do a blue-green style deployment for our component web of the pets</span></div>
<div style="position:absolute;left:108.00px;top:513.01px" class="cls_008"><span class="cls_008">application, then we can do so by using labels creatively. Let's first remind ourselves</span></div>
<div style="position:absolute;left:108.00px;top:525.61px" class="cls_008"><span class="cls_008">how blue-green deployments work. Here is a rough step-by-step instruction:</span></div>
<div style="position:absolute;left:126.00px;top:546.85px" class="cls_008"><span class="cls_008">1.  Deploy a first version of the component </span><span class="cls_010">web</span><span class="cls_008"> as </span><span class="cls_010">blue</span><span class="cls_008">. We will label the pods</span></div>
<div style="position:absolute;left:144.00px;top:559.45px" class="cls_008"><span class="cls_008">with a label </span><span class="cls_010">color: blue</span><span class="cls_008"> to do so.</span></div>
<div style="position:absolute;left:126.00px;top:576.37px" class="cls_008"><span class="cls_008">2.  Deploy the Kubernetes service for these pods with the </span><span class="cls_010">label</span><span class="cls_008">, </span><span class="cls_010">color: blue</span></div>
<div style="position:absolute;left:144.00px;top:588.97px" class="cls_008"><span class="cls_008">in the selector section.</span></div>
<div style="position:absolute;left:126.00px;top:605.89px" class="cls_008"><span class="cls_008">3.  Now we can deploy version 2 of the web component, but this time the pods</span></div>
<div style="position:absolute;left:144.00px;top:618.49px" class="cls_008"><span class="cls_008">have a </span><span class="cls_010">label</span><span class="cls_008">, </span><span class="cls_010">color: green</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 230 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:197292px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background254.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">4.  We can test the green version of the service that it works as expected.</span></div>
<div style="position:absolute;left:126.00px;top:131.41px" class="cls_008"><span class="cls_008">5.  Now we flip traffic from </span><span class="cls_010">blue</span><span class="cls_008"> to </span><span class="cls_010">green</span><span class="cls_008"> by updating the Kubernetes</span></div>
<div style="position:absolute;left:144.00px;top:144.01px" class="cls_008"><span class="cls_008">service for the </span><span class="cls_010">web</span><span class="cls_008"> component. We modify the selector to use the label</span></div>
<div style="position:absolute;left:144.00px;top:156.61px" class="cls_010"><span class="cls_010">color: green</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:177.85px" class="cls_008"><span class="cls_008">Let's define a </span><span class="cls_010">Deployment</span><span class="cls_008"> object for version 1, blue:</span></div>
<div style="position:absolute;left:199.14px;top:525.84px" class="cls_026"><span class="cls_026">Specification of the deployment blue for the web component</span></div>
<div style="position:absolute;left:108.00px;top:544.58px" class="cls_008"><span class="cls_008">The preceding definition can be found in the </span><span class="cls_010">labs/ch11/web-deploy-blue.yaml</span></div>
<div style="position:absolute;left:108.00px;top:557.18px" class="cls_008"><span class="cls_008">file. Please note line 4 where we define the name of the deployment as </span><span class="cls_010">web-blue</span><span class="cls_008"> to</span></div>
<div style="position:absolute;left:108.00px;top:569.78px" class="cls_008"><span class="cls_008">distinguish it from the upcoming deployment </span><span class="cls_010">web-green</span><span class="cls_008">. Also note that we have</span></div>
<div style="position:absolute;left:108.00px;top:582.38px" class="cls_008"><span class="cls_008">added the label </span><span class="cls_010">color: blue</span><span class="cls_008"> on lines 11 and 17. Everything else remains the same</span></div>
<div style="position:absolute;left:108.00px;top:594.98px" class="cls_008"><span class="cls_008">as before.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 231 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:198094px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background255.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Now we define the </span><span class="cls_010">Service</span><span class="cls_008"> object for the </span><span class="cls_010">web</span><span class="cls_008"> component. It will be the same as we</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">used before with a minor change, as you will see in the following screenshot:</span></div>
<div style="position:absolute;left:164.96px;top:325.00px" class="cls_026"><span class="cls_026">Kubernetes service for the web component supporting blue-green deployments</span></div>
<div style="position:absolute;left:108.00px;top:343.74px" class="cls_008"><span class="cls_008">The only difference to the definition of the </span><span class="cls_010">service</span><span class="cls_008"> we used earlier in this chapter is</span></div>
<div style="position:absolute;left:108.00px;top:356.34px" class="cls_008"><span class="cls_008">line 13, which adds the label </span><span class="cls_010">color: blue</span><span class="cls_008"> to the selector. We can find the preceding</span></div>
<div style="position:absolute;left:108.00px;top:368.94px" class="cls_008"><span class="cls_008">definition in the </span><span class="cls_010">labs/ch11/web-svc-blue-green.yaml</span><span class="cls_008"> file.</span></div>
<div style="position:absolute;left:108.00px;top:390.18px" class="cls_008"><span class="cls_008">We can then deploy the blue version of the </span><span class="cls_010">web</span><span class="cls_008"> component with the following</span></div>
<div style="position:absolute;left:108.00px;top:402.78px" class="cls_008"><span class="cls_008">command:</span></div>
<div style="position:absolute;left:126.00px;top:423.72px" class="cls_024"><span class="cls_024">$ kubectl create -f web-deploy-blue.yaml</span></div>
<div style="position:absolute;left:126.00px;top:434.52px" class="cls_024"><span class="cls_024">$ kubectl create -f web-svc-blue-green.yaml</span></div>
<div style="position:absolute;left:108.00px;top:454.26px" class="cls_008"><span class="cls_008">Once the service is up and running, we can determine its IP address and port</span></div>
<div style="position:absolute;left:108.00px;top:466.86px" class="cls_008"><span class="cls_008">number and test it:</span></div>
<div style="position:absolute;left:126.00px;top:487.80px" class="cls_024"><span class="cls_024">$ PORT=$(kubectl get svc/web -o yaml | grep nodePort | cut -d' ' -f5)</span></div>
<div style="position:absolute;left:126.00px;top:498.60px" class="cls_024"><span class="cls_024">$ IP=$(minikube ip)</span></div>
<div style="position:absolute;left:126.00px;top:509.40px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:509.40px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:520.20px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:108.00px;top:539.94px" class="cls_008"><span class="cls_008">As expected, we get the response </span><span class="cls_010">Pets Demo Application</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:561.18px" class="cls_008"><span class="cls_008">Now we can deploy the </span><span class="cls_010">green</span><span class="cls_008"> version of the web component. The definition of its</span></div>
<div style="position:absolute;left:108.00px;top:573.78px" class="cls_010"><span class="cls_010">Deployment</span><span class="cls_008"> object can be found in the </span><span class="cls_010">labs/ch11/web-deploy-green.yaml</span><span class="cls_008"> file and</span></div>
<div style="position:absolute;left:108.00px;top:586.38px" class="cls_008"><span class="cls_008">looks as follows:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 232 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:198896px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background256.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:196.88px;top:414.71px" class="cls_026"><span class="cls_026">Specification of the deployment green for the web component</span></div>
<div style="position:absolute;left:108.00px;top:433.45px" class="cls_008"><span class="cls_008">The interesting lines are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:454.69px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Line 4</span><span class="cls_008">: With the name </span><span class="cls_010">web-green</span><span class="cls_008"> to distinguish from </span><span class="cls_010">web-blue</span><span class="cls_008"> and allow</span></div>
<div style="position:absolute;left:144.00px;top:467.29px" class="cls_008"><span class="cls_008">for parallel install</span></div>
<div style="position:absolute;left:126.00px;top:484.21px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Lines 11 and 17</span><span class="cls_008">: Having the color </span><span class="cls_010">green</span></div>
<div style="position:absolute;left:126.00px;top:501.13px" class="cls_008"><span class="cls_008">•</span><span class="cls_009">  Line 20</span><span class="cls_008">: Now using version </span><span class="cls_010">2.0</span><span class="cls_008"> of the image</span></div>
<div style="position:absolute;left:108.00px;top:522.37px" class="cls_008"><span class="cls_008">Now we're ready to deploy this </span><span class="cls_010">green</span><span class="cls_008"> version of the service, and it should run</span></div>
<div style="position:absolute;left:108.00px;top:534.97px" class="cls_008"><span class="cls_008">separate from the </span><span class="cls_010">blue</span><span class="cls_008"> service:</span></div>
<div style="position:absolute;left:126.00px;top:555.91px" class="cls_024"><span class="cls_024">$ kubectl create -f web-deploy-green.yaml</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 233 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:199698px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background257.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can make sure that both deployments coexist:</span></div>
<div style="position:absolute;left:193.80px;top:199.02px" class="cls_026"><span class="cls_026">Displaying the list of Deployment objects running in the cluster</span></div>
<div style="position:absolute;left:108.00px;top:217.76px" class="cls_008"><span class="cls_008">As expected, we have both </span><span class="cls_010">blue</span><span class="cls_008"> and </span><span class="cls_010">green</span><span class="cls_008"> running. We can verify that </span><span class="cls_010">blue</span><span class="cls_008"> is still</span></div>
<div style="position:absolute;left:108.00px;top:230.36px" class="cls_008"><span class="cls_008">the active service:</span></div>
<div style="position:absolute;left:126.00px;top:251.30px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:251.30px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:262.10px" class="cls_024"><span class="cls_024">Pets Demo Application</span></div>
<div style="position:absolute;left:108.00px;top:281.84px" class="cls_008"><span class="cls_008">Now comes the interesting part. We can flip traffic from </span><span class="cls_010">blue</span><span class="cls_008"> to </span><span class="cls_010">green</span><span class="cls_008"> by editing the</span></div>
<div style="position:absolute;left:108.00px;top:294.44px" class="cls_008"><span class="cls_008">existing service for the web component. So, execute the following command:</span></div>
<div style="position:absolute;left:126.00px;top:315.38px" class="cls_024"><span class="cls_024">$ kubectl edit svc/web</span></div>
<div style="position:absolute;left:108.00px;top:335.12px" class="cls_008"><span class="cls_008">Change the value of the label color from </span><span class="cls_010">blue</span><span class="cls_008"> to </span><span class="cls_010">green</span><span class="cls_008">. Then save and quit the</span></div>
<div style="position:absolute;left:108.00px;top:347.72px" class="cls_008"><span class="cls_008">editor. The Kubernetes CLI will automatically update the service. When we now</span></div>
<div style="position:absolute;left:108.00px;top:360.32px" class="cls_008"><span class="cls_008">query the web service again, we get this:</span></div>
<div style="position:absolute;left:126.00px;top:381.26px" class="cls_024"><span class="cls_024">$ curl -4</span></div>
<div style="position:absolute;left:180.00px;top:381.26px" class="cls_024"><span class="cls_024">${IP}:${PORT}/</span></div>
<div style="position:absolute;left:126.00px;top:392.06px" class="cls_024"><span class="cls_024">Pets Demo Application v2</span></div>
<div style="position:absolute;left:108.00px;top:411.80px" class="cls_008"><span class="cls_008">This confirms that the traffic has indeed switched to the </span><span class="cls_010">green</span><span class="cls_008"> version of the </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:108.00px;top:424.40px" class="cls_008"><span class="cls_008">component (note the </span><span class="cls_010">v2</span><span class="cls_008"> at the end of the response to the </span><span class="cls_010">curl</span><span class="cls_008"> command).</span></div>
<div style="position:absolute;left:107.99px;top:445.64px" class="cls_008"><span class="cls_008">If we realize that something went wrong with our green deployment and the new</span></div>
<div style="position:absolute;left:107.99px;top:458.24px" class="cls_008"><span class="cls_008">version has a defect, we can easily switch back to the </span><span class="cls_010">blue</span><span class="cls_008"> version by editing the</span></div>
<div style="position:absolute;left:108.00px;top:470.84px" class="cls_008"><span class="cls_008">service web again and replacing the value of the label color from </span><span class="cls_010">green</span><span class="cls_008"> back to</span></div>
<div style="position:absolute;left:108.00px;top:483.44px" class="cls_010"><span class="cls_010">blue</span><span class="cls_008">. This rollback is instantaneous and should always work. We can then remove</span></div>
<div style="position:absolute;left:108.00px;top:496.04px" class="cls_008"><span class="cls_008">the buggy </span><span class="cls_010">green</span><span class="cls_008"> deployment and fix the component. When we have corrected the</span></div>
<div style="position:absolute;left:108.00px;top:508.64px" class="cls_008"><span class="cls_008">problem, we can deploy the </span><span class="cls_010">green</span><span class="cls_008"> version once again.</span></div>
<div style="position:absolute;left:108.00px;top:529.88px" class="cls_008"><span class="cls_008">Once the </span><span class="cls_010">green</span><span class="cls_008"> version of the component is running as expected and performing</span></div>
<div style="position:absolute;left:108.00px;top:542.48px" class="cls_008"><span class="cls_008">well, we can decommission the </span><span class="cls_010">blue</span><span class="cls_008"> version:</span></div>
<div style="position:absolute;left:126.00px;top:563.42px" class="cls_024"><span class="cls_024">$ kubectl delete deploy/web-blue</span></div>
<div style="position:absolute;left:108.00px;top:583.16px" class="cls_008"><span class="cls_008">When we're ready to deploy a new version, 3.0, this one becomes the blue version.</span></div>
<div style="position:absolute;left:108.00px;top:595.76px" class="cls_008"><span class="cls_008">We update the </span><span class="cls_010">labs/ch11/web-deploy-blue.yaml</span><span class="cls_008"> file accordingly and deploy it.</span></div>
<div style="position:absolute;left:108.00px;top:608.36px" class="cls_008"><span class="cls_008">Then we flip the service web from </span><span class="cls_010">green</span><span class="cls_008"> to </span><span class="cls_010">blue</span><span class="cls_008">, and so on.</span></div>
<div style="position:absolute;left:108.00px;top:629.60px" class="cls_008"><span class="cls_008">We have successfully demonstrated, with our component web of the pets</span></div>
<div style="position:absolute;left:108.00px;top:642.20px" class="cls_008"><span class="cls_008">application, how blue-green deployment can be achieved in a Kubernetes cluster.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 234 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:200500px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background258.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Kubernetes secrets</span></div>
<div style="position:absolute;left:108.00px;top:136.90px" class="cls_008"><span class="cls_008">Sometimes, services that we want to run in the Kubernetes cluster have to use</span></div>
<div style="position:absolute;left:108.00px;top:149.50px" class="cls_008"><span class="cls_008">confidential data such as passwords, secret API keys or certificates, to name just a</span></div>
<div style="position:absolute;left:108.00px;top:162.10px" class="cls_008"><span class="cls_008">few. We want to make sure that this sensitive information can only ever be seen by</span></div>
<div style="position:absolute;left:108.00px;top:174.70px" class="cls_008"><span class="cls_008">the authorized or dedicated service. All other services running in the cluster should</span></div>
<div style="position:absolute;left:108.00px;top:187.30px" class="cls_008"><span class="cls_008">not have any access to this data.</span></div>
<div style="position:absolute;left:108.00px;top:208.54px" class="cls_008"><span class="cls_008">For this reason, Kubernetes secrets have been introduced. A secret is a key-value pair</span></div>
<div style="position:absolute;left:108.00px;top:221.14px" class="cls_008"><span class="cls_008">where the key is the unique name of the secret and the value is the actual sensitive</span></div>
<div style="position:absolute;left:108.00px;top:233.74px" class="cls_008"><span class="cls_008">data. Secrets are stored in </span><span class="cls_010">etcd</span><span class="cls_008">. Kubernetes can be configured such that secrets are</span></div>
<div style="position:absolute;left:108.00px;top:246.34px" class="cls_008"><span class="cls_008">encrypted at rest, that is, in </span><span class="cls_010">etcd</span><span class="cls_008">, and in transit, that is, when the secrets are going</span></div>
<div style="position:absolute;left:108.00px;top:258.94px" class="cls_008"><span class="cls_008">over the wire from a master node to the worker nodes on which the pods of the</span></div>
<div style="position:absolute;left:108.00px;top:271.54px" class="cls_008"><span class="cls_008">service using this secret are running.</span></div>
<div style="position:absolute;left:108.00px;top:301.48px" class="cls_022"><span class="cls_022">Manually defining secrets</span></div>
<div style="position:absolute;left:108.00px;top:324.46px" class="cls_008"><span class="cls_008">We can create a secret declaratively the same way we created any other object in</span></div>
<div style="position:absolute;left:108.00px;top:337.06px" class="cls_008"><span class="cls_008">Kubernetes. Here is the YAML for such a secret:</span></div>
<div style="position:absolute;left:126.00px;top:358.00px" class="cls_023"><span class="cls_023">apiVersion: v1</span></div>
<div style="position:absolute;left:126.00px;top:368.80px" class="cls_023"><span class="cls_023">kind: Secret</span></div>
<div style="position:absolute;left:126.00px;top:379.60px" class="cls_023"><span class="cls_023">metadata:</span></div>
<div style="position:absolute;left:136.80px;top:390.40px" class="cls_023"><span class="cls_023">name: pets-secret</span></div>
<div style="position:absolute;left:126.00px;top:401.20px" class="cls_023"><span class="cls_023">type: Opaque</span></div>
<div style="position:absolute;left:126.00px;top:412.00px" class="cls_023"><span class="cls_023">data:</span></div>
<div style="position:absolute;left:136.80px;top:422.80px" class="cls_023"><span class="cls_023">username: am9obi5kb2UK</span></div>
<div style="position:absolute;left:136.80px;top:433.60px" class="cls_023"><span class="cls_023">password: c0VjcmV0LXBhc1N3MHJECg==</span></div>
<div style="position:absolute;left:108.00px;top:453.34px" class="cls_008"><span class="cls_008">The preceding definition can be found in the </span><span class="cls_010">labs/ch11/pets-secret.yaml</span><span class="cls_008"> file.</span></div>
<div style="position:absolute;left:108.00px;top:465.94px" class="cls_008"><span class="cls_008">Now you might wonder what the values are. Are these the real (unencrypted)</span></div>
<div style="position:absolute;left:108.00px;top:478.54px" class="cls_008"><span class="cls_008">values? No, they are not. And they are also not really encrypted values but just</span></div>
<div style="position:absolute;left:108.00px;top:491.14px" class="cls_010"><span class="cls_010">base64</span><span class="cls_008"> encoded values. Thus they are not really secure, since  base64-encoded</span></div>
<div style="position:absolute;left:108.00px;top:503.74px" class="cls_008"><span class="cls_008">values can be easily reverted to clear text values. How did I get these values?</span></div>
<div style="position:absolute;left:108.00px;top:516.34px" class="cls_008"><span class="cls_008">That's easy:</span></div>
<div style="position:absolute;left:225.21px;top:603.77px" class="cls_026"><span class="cls_026">Creating base64-encoded values for the secret</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 235 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:201302px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background259.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can then create the secret and describe it:</span></div>
<div style="position:absolute;left:224.45px;top:295.81px" class="cls_026"><span class="cls_026">Creating and describing the Kubernetes secret</span></div>
<div style="position:absolute;left:108.00px;top:314.55px" class="cls_008"><span class="cls_008">In the description of the secret, the values are hidden and only their length is given.</span></div>
<div style="position:absolute;left:108.00px;top:327.15px" class="cls_021"><span class="cls_021">So maybe the secrets are safe now?</span><span class="cls_008"> No, not really. We can easily decode this secret using</span></div>
<div style="position:absolute;left:108.00px;top:339.75px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">kubectl get</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:258.51px;top:537.67px" class="cls_026"><span class="cls_026">Kubernetes secret decoded</span></div>
<div style="position:absolute;left:108.00px;top:556.41px" class="cls_008"><span class="cls_008">As we can see in the preceding screenshot, we have our original secret values back.</span></div>
<div style="position:absolute;left:108.00px;top:569.01px" class="cls_008"><span class="cls_008">And we can decode them:</span></div>
<div style="position:absolute;left:126.00px;top:589.95px" class="cls_024"><span class="cls_024">$ echo "c0VjcmV0LXBhc1N3MHJECg==" | base64 --decode</span></div>
<div style="position:absolute;left:126.00px;top:600.75px" class="cls_024"><span class="cls_024">sEcret-pasSw0rD</span></div>
<div style="position:absolute;left:108.00px;top:620.49px" class="cls_008"><span class="cls_008">Thus, the consequences are that this method of creating a Kubernetes is not to be</span></div>
<div style="position:absolute;left:108.00px;top:633.09px" class="cls_008"><span class="cls_008">used in any other environment than development, where we deal with non-sensitive</span></div>
<div style="position:absolute;left:108.00px;top:645.69px" class="cls_008"><span class="cls_008">data. In all other environments, we need a better way to deal with secrets.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 236 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:202104px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background260.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Creating secrets with kubectl</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">A much safer way to define secrets is to use </span><span class="cls_010">kubectl</span><span class="cls_008">. First, we create files containing</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">the base64-encoded secret values similar to what we did in the preceding section, but</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">this time we store the values in temporary files:</span></div>
<div style="position:absolute;left:126.00px;top:181.58px" class="cls_024"><span class="cls_024">$ echo "sue-hunter" | base64 > username.txt</span></div>
<div style="position:absolute;left:126.00px;top:192.38px" class="cls_024"><span class="cls_024">$ echo "123abc456def" | base64 > password.txt</span></div>
<div style="position:absolute;left:108.00px;top:212.12px" class="cls_008"><span class="cls_008">Now we can use </span><span class="cls_010">kubectl</span><span class="cls_008"> to create a secret from those files as follows:</span></div>
<div style="position:absolute;left:126.00px;top:233.06px" class="cls_024"><span class="cls_024">$ kubectl create secret generic pets-secret-prod \</span></div>
<div style="position:absolute;left:147.60px;top:243.86px" class="cls_024"><span class="cls_024">--from-file=./username.txt \</span></div>
<div style="position:absolute;left:147.60px;top:254.66px" class="cls_024"><span class="cls_024">--from-file=./password.txt</span></div>
<div style="position:absolute;left:126.00px;top:265.46px" class="cls_024"><span class="cls_024">secret "pets-secret-prod" created</span></div>
<div style="position:absolute;left:108.00px;top:285.20px" class="cls_008"><span class="cls_008">The secret can then be used the same way as the manually-created secret.</span></div>
<div style="position:absolute;left:108.00px;top:306.45px" class="cls_021"><span class="cls_021">Why is this method more secure than the other one you might ask?</span><span class="cls_008"> Well, first of all, there</span></div>
<div style="position:absolute;left:108.00px;top:319.05px" class="cls_008"><span class="cls_008">is no YAML that defines a secret and is stored in some source code version control</span></div>
<div style="position:absolute;left:108.00px;top:331.65px" class="cls_008"><span class="cls_008">system, such as GitHub, which many people have access to and so can see and</span></div>
<div style="position:absolute;left:108.00px;top:344.25px" class="cls_008"><span class="cls_008">decode the secrets. Only the admin person that is authorized to know the secrets</span></div>
<div style="position:absolute;left:108.00px;top:356.85px" class="cls_008"><span class="cls_008">ever sees their values and uses them to directly create the secrets in the (production)</span></div>
<div style="position:absolute;left:108.00px;top:369.45px" class="cls_008"><span class="cls_008">cluster. The cluster itself is protected by role-based access control so that no</span></div>
<div style="position:absolute;left:108.00px;top:382.05px" class="cls_008"><span class="cls_008">unauthorized people have access to it nor can they possibly decode the secrets</span></div>
<div style="position:absolute;left:108.00px;top:394.65px" class="cls_008"><span class="cls_008">defined in the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:415.89px" class="cls_008"><span class="cls_008">But now, let's see how we can actually use the secrets that we have defined.</span></div>
<div style="position:absolute;left:108.00px;top:445.82px" class="cls_022"><span class="cls_022">Using secrets in a pod</span></div>
<div style="position:absolute;left:108.00px;top:468.80px" class="cls_008"><span class="cls_008">Let's say we want to create a </span><span class="cls_010">Deployment</span><span class="cls_008"> object where the </span><span class="cls_010">web</span><span class="cls_008"> component uses our</span></div>
<div style="position:absolute;left:108.00px;top:481.40px" class="cls_008"><span class="cls_008">secret called </span><span class="cls_010">pets-secret</span><span class="cls_008"> that we introduced in the preceding section. We use the</span></div>
<div style="position:absolute;left:108.00px;top:494.00px" class="cls_008"><span class="cls_008">following command to create the secret in the cluster:</span></div>
<div style="position:absolute;left:126.00px;top:514.94px" class="cls_024"><span class="cls_024">$ kubectl create -f pets-secret.yaml</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 237 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:202906px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background261.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the </span><span class="cls_010">labs/ch11/web-deploy-secret.yaml</span><span class="cls_008"> file, we can find the definition of</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">Deployment</span><span class="cls_008"> object. We had to add the part starting from line 23 to the original</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">definition of the </span><span class="cls_010">Deployment</span><span class="cls_008"> object:</span></div>
<div style="position:absolute;left:213.77px;top:543.61px" class="cls_026"><span class="cls_026">Deployment object for web component with a secret</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 238 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:203708px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background262.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">On lines 27 through 30 we define a volume called secrets from our secret </span><span class="cls_010">pets-</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">secret</span><span class="cls_008">. We then use this volume in the container, as described on lines 23 through</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">26. We mount the secrets in the container filesystem at </span><span class="cls_010">/etc/secrets</span><span class="cls_008"> and we mount</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">the volume in read-only mode. Thus, the </span><span class="cls_010">secret</span><span class="cls_008"> values will be available to the</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">container as files in said folder. The names of the files will correspond to the key</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">names, and the content of the files will be the values of the corresponding keys.</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">The values will be provided in unencrypted form to the application running</span></div>
<div style="position:absolute;left:108.00px;top:202.69px" class="cls_008"><span class="cls_008">inside the container.</span></div>
<div style="position:absolute;left:108.00px;top:223.93px" class="cls_008"><span class="cls_008">In our case, having the keys' </span><span class="cls_010">username</span><span class="cls_008"> and </span><span class="cls_010">password</span><span class="cls_008"> in the secret, we will find two</span></div>
<div style="position:absolute;left:108.00px;top:236.53px" class="cls_008"><span class="cls_008">files, named </span><span class="cls_010">username</span><span class="cls_008"> and </span><span class="cls_010">password</span><span class="cls_008">, in the </span><span class="cls_010">/etc/secrets</span><span class="cls_008"> folder in the container</span></div>
<div style="position:absolute;left:108.00px;top:249.13px" class="cls_008"><span class="cls_008">filesystem. The file </span><span class="cls_010">username</span><span class="cls_008"> should contain the value </span><span class="cls_010">john.doe</span><span class="cls_008">, and the file</span></div>
<div style="position:absolute;left:108.00px;top:261.73px" class="cls_008"><span class="cls_008">password the value </span><span class="cls_010">sEcret-pasSw0rD</span><span class="cls_008">. Here is the confirmation:</span></div>
<div style="position:absolute;left:205.29px;top:405.27px" class="cls_026"><span class="cls_026">Confirming that secrets are available inside the container</span></div>
<div style="position:absolute;left:108.00px;top:424.01px" class="cls_008"><span class="cls_008">On line 1 of the preceding output, we exec into the container where the </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:108.00px;top:436.61px" class="cls_008"><span class="cls_008">component runs. Then, on lines 2 to 5, we list the files in the </span><span class="cls_010">/etc/secrets</span></div>
<div style="position:absolute;left:108.00px;top:449.21px" class="cls_008"><span class="cls_008">folder, and finally, on lines 6 to 8, we show the content of the two files which,</span></div>
<div style="position:absolute;left:108.00px;top:461.81px" class="cls_008"><span class="cls_008">unsurprisingly, show the secret values in clear text.</span></div>
<div style="position:absolute;left:108.00px;top:483.05px" class="cls_008"><span class="cls_008">Since any application written in any language can read simple files, this mechanism</span></div>
<div style="position:absolute;left:108.00px;top:495.65px" class="cls_008"><span class="cls_008">of using secrets is very backwards compatible. Even an old COBOL application can</span></div>
<div style="position:absolute;left:108.00px;top:508.25px" class="cls_008"><span class="cls_008">read clear text files from the filesystem.</span></div>
<div style="position:absolute;left:108.00px;top:529.49px" class="cls_008"><span class="cls_008">Sometimes, though, applications expect secrets to be available in environment</span></div>
<div style="position:absolute;left:108.00px;top:542.09px" class="cls_008"><span class="cls_008">variables. Let's look at what Kubernetes offers us in this case.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 239 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:204510px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background263.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Secret values in environment variables</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Let's say our web component expects the username in the environment variable,</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_010"><span class="cls_010">PETS_USERNAME</span><span class="cls_008"> and the password in </span><span class="cls_010">PETS_PASSWORD</span><span class="cls_008">, then we can modify our</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">deployment YAML to look as follows:</span></div>
<div style="position:absolute;left:197.92px;top:589.13px" class="cls_026"><span class="cls_026">Deployment mapping secret values to environment variables</span></div>
<div style="position:absolute;left:108.00px;top:607.87px" class="cls_008"><span class="cls_008">On lines 23 through 33, we define the two environment variables, </span><span class="cls_010">PETS_USERNAME</span></div>
<div style="position:absolute;left:108.00px;top:620.47px" class="cls_008"><span class="cls_008">and </span><span class="cls_010">PETS_PASSWORD</span><span class="cls_008">, and map the corresponding key-value pair of the </span><span class="cls_010">pets-secret</span></div>
<div style="position:absolute;left:108.00px;top:633.07px" class="cls_008"><span class="cls_008">to them.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 240 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:205312px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background264.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 11</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Note, we don't need a volume anymore but we directly map the individual keys</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">of our </span><span class="cls_010">pets-secret</span><span class="cls_008"> into corresponding environment variables valid inside the</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">container. The following sequence of commands shows that the secret values are</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">indeed available inside the container in the respective environment variables:</span></div>
<div style="position:absolute;left:215.45px;top:241.91px" class="cls_026"><span class="cls_026">Secret values are mapped to environment variables</span></div>
<div style="position:absolute;left:108.00px;top:260.65px" class="cls_008"><span class="cls_008">In this section, we have shown how to define secrets in a Kubernetes cluster and how</span></div>
<div style="position:absolute;left:108.00px;top:273.25px" class="cls_008"><span class="cls_008">to use those secrets in containers running as part of the pods of a deployment. We</span></div>
<div style="position:absolute;left:108.00px;top:285.85px" class="cls_008"><span class="cls_008">have shown two variants on how secrets can be mapped inside a container, the first</span></div>
<div style="position:absolute;left:108.00px;top:298.45px" class="cls_008"><span class="cls_008">one using files and the second approach using environment variables.</span></div>
<div style="position:absolute;left:108.00px;top:330.95px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:355.93px" class="cls_008"><span class="cls_008">In this chapter, we have learned how to deploy an application into a Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:368.53px" class="cls_008"><span class="cls_008">cluster and how to set up application-level routing for this application. Furthermore,</span></div>
<div style="position:absolute;left:108.00px;top:381.13px" class="cls_008"><span class="cls_008">we have learned ways to update application services running in a Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:393.73px" class="cls_008"><span class="cls_008">without causing any downtime. Finally, we have used secrets to provide sensitive</span></div>
<div style="position:absolute;left:108.00px;top:406.33px" class="cls_008"><span class="cls_008">information to application services running in the cluster.</span></div>
<div style="position:absolute;left:108.00px;top:427.57px" class="cls_008"><span class="cls_008">In the next and final chapter, we are going to learn how to deploy, run, monitor</span></div>
<div style="position:absolute;left:108.00px;top:440.17px" class="cls_008"><span class="cls_008">and debug a containerized sample application in the cloud using Microsoft's Azure</span></div>
<div style="position:absolute;left:108.00px;top:452.77px" class="cls_008"><span class="cls_008">Kubernetes Service (AKS) offering. Stay tuned.</span></div>
<div style="position:absolute;left:108.00px;top:485.27px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:510.25px" class="cls_008"><span class="cls_008">To assess your learning progress, please answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:531.49px" class="cls_008"><span class="cls_008">1.  You have an application consisting of two services, the first one being a</span></div>
<div style="position:absolute;left:143.99px;top:544.09px" class="cls_008"><span class="cls_008">web API and the second one a DB, such as Mongo. You want to deploy this</span></div>
<div style="position:absolute;left:143.99px;top:556.69px" class="cls_008"><span class="cls_008">application into a Kubernetes cluster. In a few short sentences, explain how</span></div>
<div style="position:absolute;left:143.99px;top:569.29px" class="cls_008"><span class="cls_008">you proceed.</span></div>
<div style="position:absolute;left:126.00px;top:586.21px" class="cls_008"><span class="cls_008">2.  Describe in your own words in a few sentences the components you need to</span></div>
<div style="position:absolute;left:143.99px;top:598.81px" class="cls_008"><span class="cls_008">establish layer 7 (or application level) routing for your application.</span></div>
<div style="position:absolute;left:126.00px;top:615.72px" class="cls_008"><span class="cls_008">3.  List the main steps needed to implement blue-green deployment for a simple</span></div>
<div style="position:absolute;left:143.99px;top:628.32px" class="cls_008"><span class="cls_008">application service. Avoid going into too much detail.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 241 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:206114px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background265.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Deploying, Updating, and Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">4.  Name three or four types of information that you would provide to an</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">application service through Kubernetes secrets.</span></div>
<div style="position:absolute;left:126.00px;top:144.01px" class="cls_008"><span class="cls_008">5.  Name the sources that Kubernetes accepts when creating a secret.</span></div>
<div style="position:absolute;left:108.00px;top:176.51px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:201.49px" class="cls_008"><span class="cls_008">Here are a few links that provide additional information on the topics discussed in</span></div>
<div style="position:absolute;left:108.00px;top:214.09px" class="cls_008"><span class="cls_008">this cha</span><A HREF="https://bit.ly/2o2okEQ">pter:</A> </div>
<div style="position:absolute;left:126.00px;top:235.34px" class="cls_008"><span class="cls_008">•  </span><A HREF="https://bit.ly/2o2okEQ">Performing a rol</A><span class="cls_010">https://bit<A HREF="https://bit.ly/2r2IxNJ">.ly/2o2okEQ</A> </span></div>
<div style="position:absolute;left:126.00px;top:252.25px" class="cls_008"><span class="cls_008">•  </span><A HREF="https://bit.ly/2r2IxNJ">Blue-green</A><span class="cls_010">https://bit.<A HREF="https://bit.ly/2C6hMZF">ly/2r2IxNJ</A> </span></div>
<div style="position:absolute;left:126.00px;top:269.17px" class="cls_008"><span class="cls_008">•  </span><A HREF="https://bit.ly/2C6hMZF">Secrets in</A><A HREF="https://bit.ly/2C6hMZF">https://bit.ly/2C6hMZF</A> </span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 242 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:206916px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background266.jpg" width=612 height=792></div>
<div style="position:absolute;left:173.78px;top:218.96px" class="cls_015"><span class="cls_015">Running a Containerized</span></div>
<div style="position:absolute;left:282.17px;top:254.96px" class="cls_015"><span class="cls_015">App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:308.66px" class="cls_008"><span class="cls_008">In the previous chapter, we learned how to deploy a multi-service application into</span></div>
<div style="position:absolute;left:108.00px;top:321.26px" class="cls_008"><span class="cls_008">a Kubernetes cluster. We configured application-level routing for that application</span></div>
<div style="position:absolute;left:108.00px;top:333.86px" class="cls_008"><span class="cls_008">and updated its services using a zero-downtime strategy. Finally, we provided</span></div>
<div style="position:absolute;left:108.00px;top:346.46px" class="cls_008"><span class="cls_008">confidential data to the running services by using Kubernetes secrets.</span></div>
<div style="position:absolute;left:108.00px;top:367.70px" class="cls_008"><span class="cls_008">In this chapter, we will show how to deploy a complex containerized application</span></div>
<div style="position:absolute;left:108.00px;top:380.30px" class="cls_008"><span class="cls_008">into a hosted Kubernetes cluster on Microsoft Azure. There, we will use the</span></div>
<div style="position:absolute;left:108.00px;top:392.90px" class="cls_008"><span class="cls_008">so-called </span><span class="cls_009">Azure Kubernetes Service</span><span class="cls_008"> (</span><span class="cls_009">AKS</span><span class="cls_008">) offering. AKS fully manages the</span></div>
<div style="position:absolute;left:108.00px;top:405.50px" class="cls_008"><span class="cls_008">Kubernetes cluster for us so that we can concentrate on deploying, running, and,</span></div>
<div style="position:absolute;left:108.00px;top:418.10px" class="cls_008"><span class="cls_008">if needed, upgrading our application.</span></div>
<div style="position:absolute;left:108.00px;top:439.34px" class="cls_008"><span class="cls_008">Here are the topics we will be discussing in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:460.59px" class="cls_008"><span class="cls_008">•  Creating a fully managed Kubernetes cluster in Azure</span></div>
<div style="position:absolute;left:126.00px;top:477.50px" class="cls_008"><span class="cls_008">•  Pushing Docker images to the Azure container registry</span></div>
<div style="position:absolute;left:126.00px;top:494.42px" class="cls_008"><span class="cls_008">•  Deploying the application into the Kubernetes cluster</span></div>
<div style="position:absolute;left:126.00px;top:511.33px" class="cls_008"><span class="cls_008">•  Scaling the Pets application</span></div>
<div style="position:absolute;left:126.00px;top:528.25px" class="cls_008"><span class="cls_008">•  Monitoring the cluster and application</span></div>
<div style="position:absolute;left:126.00px;top:545.16px" class="cls_008"><span class="cls_008">•  Upgrading the application with zero downtime</span></div>
<div style="position:absolute;left:126.00px;top:562.08px" class="cls_008"><span class="cls_008">•  Upgrading Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:578.99px" class="cls_008"><span class="cls_008">•  Debugging an application while it is running in AKS</span></div>
<div style="position:absolute;left:126.00px;top:595.91px" class="cls_008"><span class="cls_008">•  Cleaning up</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 243 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:207718px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background267.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">After reading this chapter, you will be able to:</span></div>
<div style="position:absolute;left:126.00px;top:135.74px" class="cls_008"><span class="cls_008">•  Provision a fully managed Kubernetes cluster in AKS</span></div>
<div style="position:absolute;left:126.00px;top:152.65px" class="cls_008"><span class="cls_008">•  Deploy a multi-container based application into your cluster</span></div>
<div style="position:absolute;left:126.00px;top:169.57px" class="cls_008"><span class="cls_008">•  Monitor the health of your Kubernetes cluster and the application</span></div>
<div style="position:absolute;left:143.99px;top:182.17px" class="cls_008"><span class="cls_008">running on it</span></div>
<div style="position:absolute;left:126.00px;top:199.08px" class="cls_008"><span class="cls_008">•  Execute a rolling update of your application in AKS</span></div>
<div style="position:absolute;left:126.00px;top:216.00px" class="cls_008"><span class="cls_008">•  Interactively debug a Node.js application running on a Kubernetes</span></div>
<div style="position:absolute;left:143.99px;top:228.60px" class="cls_008"><span class="cls_008">cluster in AKS</span></div>
<div style="position:absolute;left:108.00px;top:261.11px" class="cls_011"><span class="cls_011">Technical requirements</span></div>
<div style="position:absolute;left:108.23px;top:286.09px" class="cls_008"><span class="cls_008">We are going to use the AKS hosted on Microsoft Azure. Thus, it is necessary to have</span></div>
<div style="position:absolute;left:108.23px;top:298.69px" class="cls_008"><span class="cls_008">an account on Azure. If you do not have an existing account, you can ask for a free</span></div>
<div style="position:absolute;left:108.23px;top:311.29px" class="cls_008"><span class="cls_008">trial account at </span><A HREF="https://azure.microsoft.com/services/kubernetes-service/">https://azure.microsoft.com/services/kubernetes-service/</A> </span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:345.14px" class="cls_008"><span class="cls_008">To access Azure, we will also use the Azure CLI. Thus, make sure you have the</span></div>
<div style="position:absolute;left:108.00px;top:357.74px" class="cls_008"><span class="cls_008">latest version of it available on your computer. Since this is a book about containers,</span></div>
<div style="position:absolute;left:108.00px;top:370.34px" class="cls_008"><span class="cls_008">we will not natively install the CLI but use a containerized version of it.</span></div>
<div style="position:absolute;left:108.00px;top:391.57px" class="cls_008"><span class="cls_008">We also use the </span><span class="cls_010">ch12</span><span class="cls_008"> and </span><span class="cls_010">ch12-dev-spaces</span><span class="cls_008"> folders of our </span><span class="cls_010">labs</span><span class="cls_008"> repository</span></div>
<div style="position:absolute;left:108.00px;top:404.17px" class="cls_008"><span class="cls_008">from GitHub. The link to the code files can be found at </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master">https://github.com/</A> </span></div>
<div style="position:absolute;left:108.00px;top:416.77px" class="cls_010"><span class="cls_010"> </span><A HREF="https://github.com/appswithdockerandkubernetes/labs/tree/master">appswithdockerandkubernetes/labs/tree/master</A> <span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:449.27px" class="cls_011"><span class="cls_011">Creating a fully managed Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:473.27px" class="cls_011"><span class="cls_011">cluster in Azure</span></div>
<div style="position:absolute;left:108.00px;top:498.25px" class="cls_008"><span class="cls_008">So far, we have used a local node-1 Kubernetes cluster to deploy our applications.</span></div>
<div style="position:absolute;left:108.00px;top:510.85px" class="cls_008"><span class="cls_008">This is well suited for the development, testing, and debugging on a containerized</span></div>
<div style="position:absolute;left:108.00px;top:523.45px" class="cls_008"><span class="cls_008">application destined to run on Kubernetes. Eventually, though, we will want to</span></div>
<div style="position:absolute;left:108.00px;top:536.05px" class="cls_008"><span class="cls_008">deploy the finished application in a production environment. There exist various</span></div>
<div style="position:absolute;left:108.00px;top:548.65px" class="cls_008"><span class="cls_008">ways to achieve this. We could, for example, self-host a highly available, scalable</span></div>
<div style="position:absolute;left:108.00px;top:561.25px" class="cls_008"><span class="cls_008">Kubernetes cluster, yet that is no easy feat. In this chapter, we are going to delegate</span></div>
<div style="position:absolute;left:108.00px;top:573.85px" class="cls_008"><span class="cls_008">the hard work of provisioning and hosting a highly available and massively scalable</span></div>
<div style="position:absolute;left:108.00px;top:586.45px" class="cls_008"><span class="cls_008">Kubernetes cluster to Microsoft and will be using their AKS running on Azure.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 244 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:208520px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background268.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We will then deploy our Pets application to this cluster. Once deployed, we will</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">want to monitor the behavior of the cluster and of our application on it. Later, we</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">will scale the web part of the application and then update the web part and trigger</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">a rolling update that should cause zero downtime.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">Finally, we will show how one can use Dev Spaces in AKS to remote debug an</span></div>
<div style="position:absolute;left:108.00px;top:186.14px" class="cls_008"><span class="cls_008">application, such as our Node.js frontend, while it is running in the cloud.</span></div>
<div style="position:absolute;left:108.00px;top:207.38px" class="cls_008"><span class="cls_008">AKS can be used and operated in three different ways. First and foremost, we</span></div>
<div style="position:absolute;left:108.00px;top:219.98px" class="cls_008"><span class="cls_008">can use a graphical web UI provided by the Azure portal. The next two are well</span></div>
<div style="position:absolute;left:108.00px;top:232.58px" class="cls_008"><span class="cls_008">suited for automation:</span></div>
<div style="position:absolute;left:126.00px;top:253.82px" class="cls_008"><span class="cls_008">•  We can use the Azure CLI to provision and manage the Kubernetes cluster</span></div>
<div style="position:absolute;left:143.99px;top:266.41px" class="cls_008"><span class="cls_008">combined with </span><span class="cls_010">kubectl</span><span class="cls_008"> to deploy, scale, or update the application in the</span></div>
<div style="position:absolute;left:144.00px;top:279.01px" class="cls_008"><span class="cls_008">cluster, and more</span></div>
<div style="position:absolute;left:126.00px;top:295.93px" class="cls_008"><span class="cls_008">•  We can use tools such as Terraform and Azure resource templates to do</span></div>
<div style="position:absolute;left:144.00px;top:308.53px" class="cls_008"><span class="cls_008">the same</span></div>
<div style="position:absolute;left:107.99px;top:329.77px" class="cls_008"><span class="cls_008">In this chapter, we will concentrate on the Azure CLI and </span><span class="cls_010">kubectl</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:359.71px" class="cls_022"><span class="cls_022">Running the Azure CLI</span></div>
<div style="position:absolute;left:108.00px;top:382.69px" class="cls_008"><span class="cls_008">As mentioned earlier, we will need the Azure CLI to access Microsoft Azure. It is</span></div>
<div style="position:absolute;left:108.00px;top:395.29px" class="cls_008"><span class="cls_008">important to use a new or the newest version of the CLI to be able to access all the</span></div>
<div style="position:absolute;left:108.00px;top:407.89px" class="cls_008"><span class="cls_008">AKS-related resources. We will not run the CLI natively on our computer this time</span></div>
<div style="position:absolute;left:108.00px;top:420.49px" class="cls_008"><span class="cls_008">but rather use a containerized version of it. Microsoft has created a container with</span></div>
<div style="position:absolute;left:108.00px;top:433.09px" class="cls_008"><span class="cls_008">the CLI installed on it. In our case, we also want to use the Docker (</span><span class="cls_010">docker</span><span class="cls_008">) and the</span></div>
<div style="position:absolute;left:108.00px;top:445.69px" class="cls_008"><span class="cls_008">Kubernetes CLI (</span><span class="cls_010">kubectl</span><span class="cls_008">) from within the container, but those tools are not installed</span></div>
<div style="position:absolute;left:108.00px;top:458.29px" class="cls_008"><span class="cls_008">by default. Thus, I have created a Dockerfile that can be used to create new Docker</span></div>
<div style="position:absolute;left:108.00px;top:470.89px" class="cls_008"><span class="cls_008">images based on the Microsofts one that will have the tools installed. Follow</span></div>
<div style="position:absolute;left:108.00px;top:483.49px" class="cls_008"><span class="cls_008">the steps:</span></div>
<div style="position:absolute;left:126.00px;top:504.73px" class="cls_008"><span class="cls_008">1.  Open a new Terminal window and navigate to the </span><span class="cls_010">ch12</span><span class="cls_008"> subfolder of</span></div>
<div style="position:absolute;left:144.00px;top:517.33px" class="cls_008"><span class="cls_008">your </span><span class="cls_010">labs</span><span class="cls_008"> folder:</span></div>
<div style="position:absolute;left:165.60px;top:533.95px" class="cls_024"><span class="cls_024">cd ~/labs/ch12</span></div>
<div style="position:absolute;left:126.00px;top:553.69px" class="cls_008"><span class="cls_008">2.  Execute the following command to build our customized Azure</span></div>
<div style="position:absolute;left:144.00px;top:566.29px" class="cls_008"><span class="cls_008">CLI container:</span></div>
<div style="position:absolute;left:165.60px;top:582.91px" class="cls_024"><span class="cls_024">docker image build -t custom-azure-cli:v1 azure-cli</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 245 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:209322px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background269.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.  Once this image is built, we can execute the following command to</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">interactively run a container with the newest version of Azure, Docker,</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">and Kubernetes CLI:</span></div>
<div style="position:absolute;left:165.60px;top:156.31px" class="cls_024"><span class="cls_024">docker container run --rm -it \</span></div>
<div style="position:absolute;left:171.00px;top:167.11px" class="cls_024"><span class="cls_024">-v /var/run/docker.sock:/var/run/docker.sock \</span></div>
<div style="position:absolute;left:187.20px;top:177.91px" class="cls_024"><span class="cls_024">-v $(pwd):/src \</span></div>
<div style="position:absolute;left:171.00px;top:188.71px" class="cls_024"><span class="cls_024">custom-azure-cli:v1</span></div>
<div style="position:absolute;left:108.00px;top:208.45px" class="cls_008"><span class="cls_008">Please note how we mount the Docker socket into the container so as that we can</span></div>
<div style="position:absolute;left:108.00px;top:221.05px" class="cls_008"><span class="cls_008">execute any Docker command from within the container. We are also mounting the</span></div>
<div style="position:absolute;left:108.00px;top:233.65px" class="cls_008"><span class="cls_008">current folder into the </span><span class="cls_010">/src</span><span class="cls_008"> folder inside the container to have access to the source</span></div>
<div style="position:absolute;left:108.00px;top:246.25px" class="cls_008"><span class="cls_008">code of this chapter.</span></div>
<div style="position:absolute;left:108.00px;top:267.50px" class="cls_008"><span class="cls_008">After the container instance has started, you will be presented with the</span></div>
<div style="position:absolute;left:108.00px;top:280.10px" class="cls_008"><span class="cls_008">following prompt:</span></div>
<div style="position:absolute;left:126.00px;top:301.03px" class="cls_024"><span class="cls_024">bash-4.4#</span></div>
<div style="position:absolute;left:108.00px;top:320.77px" class="cls_008"><span class="cls_008">We can test the container using the following commands:</span></div>
<div style="position:absolute;left:126.00px;top:341.71px" class="cls_024"><span class="cls_024">bash-4.4# docker version</span></div>
<div style="position:absolute;left:126.00px;top:352.51px" class="cls_024"><span class="cls_024">Client:</span></div>
<div style="position:absolute;left:131.40px;top:363.31px" class="cls_024"><span class="cls_024">Version: 18.06.0-ce</span></div>
<div style="position:absolute;left:131.40px;top:374.11px" class="cls_024"><span class="cls_024">API version: 1.38</span></div>
<div style="position:absolute;left:131.40px;top:384.91px" class="cls_024"><span class="cls_024">Go version: go1.10.3</span></div>
<div style="position:absolute;left:131.40px;top:395.71px" class="cls_024"><span class="cls_024">Git commit: 0ffa825</span></div>
<div style="position:absolute;left:131.40px;top:406.51px" class="cls_024"><span class="cls_024">Built: Wed Jul 18 19:04:39 2018</span></div>
<div style="position:absolute;left:131.40px;top:417.31px" class="cls_024"><span class="cls_024">OS/Arch: linux/amd64</span></div>
<div style="position:absolute;left:131.40px;top:428.11px" class="cls_024"><span class="cls_024">Experimental: false</span></div>
<div style="position:absolute;left:126.00px;top:438.91px" class="cls_024"><span class="cls_024">Server:</span></div>
<div style="position:absolute;left:131.40px;top:449.71px" class="cls_024"><span class="cls_024">Engine:</span></div>
<div style="position:absolute;left:131.40px;top:460.51px" class="cls_024"><span class="cls_024">Version: 18.06.0-ce</span></div>
<div style="position:absolute;left:131.40px;top:471.31px" class="cls_024"><span class="cls_024">API version: 1.38 (minimum version 1.12)</span></div>
<div style="position:absolute;left:131.40px;top:482.11px" class="cls_024"><span class="cls_024">Go version: go1.10.3</span></div>
<div style="position:absolute;left:131.40px;top:492.91px" class="cls_024"><span class="cls_024">Git commit: 0ffa825</span></div>
<div style="position:absolute;left:131.40px;top:503.71px" class="cls_024"><span class="cls_024">Built: Wed Jul 18 19:13:46 2018</span></div>
<div style="position:absolute;left:131.40px;top:514.51px" class="cls_024"><span class="cls_024">OS/Arch: linux/amd64</span></div>
<div style="position:absolute;left:131.40px;top:525.31px" class="cls_024"><span class="cls_024">Experimental: true</span></div>
<div style="position:absolute;left:108.00px;top:545.05px" class="cls_008"><span class="cls_008">The output of running the </span><span class="cls_010">kubectl</span><span class="cls_008"> command is as follows:</span></div>
<div style="position:absolute;left:126.00px;top:565.99px" class="cls_024"><span class="cls_024">bash-4.4# kubectl version</span></div>
<div style="position:absolute;left:126.00px;top:576.79px" class="cls_024"><span class="cls_024">Client Version: version.Info{Major:”1”, Minor:”11”,</span></div>
<div style="position:absolute;left:126.00px;top:587.59px" class="cls_024"><span class="cls_024">GitVersion:”v1.11.2”, GitCommit:”bb9ffb1654d4a729bb4cec18ff088eac</span></div>
<div style="position:absolute;left:126.00px;top:598.39px" class="cls_024"><span class="cls_024">c153c239”, GitTreeState:”clean”, BuildDate:”2018-08-07T23:17:28Z”,</span></div>
<div style="position:absolute;left:126.00px;top:609.19px" class="cls_024"><span class="cls_024">GoVersion:”go1.10.3”, Compiler:”gc”, Platform:”linux/amd64”}</span></div>
<div style="position:absolute;left:126.00px;top:619.99px" class="cls_024"><span class="cls_024">Server Version: version.Info{Major:”1”, Minor:”9”,</span></div>
<div style="position:absolute;left:126.00px;top:630.79px" class="cls_024"><span class="cls_024">GitVersion:”v1.9.9”, GitCommit:”57729ea3d9a1b75f3fc7bbbadc597ba70</span></div>
<div style="position:absolute;left:126.00px;top:641.59px" class="cls_024"><span class="cls_024">7d47c8a”, GitTreeState:”clean”, BuildDate:”2018-06-29T01:07:01Z”,</span></div>
<div style="position:absolute;left:126.00px;top:652.39px" class="cls_024"><span class="cls_024">GoVersion:”go1.9.3”, Compiler:”gc”, Platform:”linux/amd64”}</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 246 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:210124px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background270.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The output shows us that we’re running Docker </span><span class="cls_010">18.06.0-ce</span><span class="cls_008"> and Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">v1.11.2</span><span class="cls_008"> on the client and </span><span class="cls_010">v1.9.9</span><span class="cls_008"> on the server.</span></div>
<div style="position:absolute;left:108.00px;top:148.34px" class="cls_008"><span class="cls_008">To be able to use the Azure CLI to work with our account on Microsoft Azure, we</span></div>
<div style="position:absolute;left:108.00px;top:160.93px" class="cls_008"><span class="cls_008">first need to log in to the account. To do that, enter the following on the </span><span class="cls_010">bash-4.4#</span></div>
<div style="position:absolute;left:108.00px;top:173.53px" class="cls_008"><span class="cls_008">command prompt:</span></div>
<div style="position:absolute;left:126.00px;top:194.47px" class="cls_024"><span class="cls_024">az login</span></div>
<div style="position:absolute;left:108.00px;top:214.21px" class="cls_008"><span class="cls_008">You will be prompted with a message similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:235.15px" class="cls_024"><span class="cls_024">To sign in, use a web browser to open the page </span><A HREF="https://microsoft.com/">https://microsoft.com/</A> </div>
<div style="position:absolute;left:126.00px;top:245.95px" class="cls_024"><span class="cls_024">devicelogin and enter the code CMNB2TSND to authenticate.</span></div>
<div style="position:absolute;left:108.00px;top:265.69px" class="cls_008"><span class="cls_008">Once you have successfully authenticated, you should see a response similar to the</span></div>
<div style="position:absolute;left:108.00px;top:278.29px" class="cls_008"><span class="cls_008">following in the Terminal window:</span></div>
<div style="position:absolute;left:126.00px;top:310.03px" class="cls_024"><span class="cls_024">[</span></div>
<div style="position:absolute;left:131.40px;top:320.83px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:131.40px;top:331.63px" class="cls_024"><span class="cls_024">“cloudName”: “AzureCloud”,</span></div>
<div style="position:absolute;left:131.40px;top:342.43px" class="cls_024"><span class="cls_024">“id”: “186760ad-9152-4499-b317-xxxxxxxxxxxx”,</span></div>
<div style="position:absolute;left:131.40px;top:353.23px" class="cls_024"><span class="cls_024">“isDefault”: true,</span></div>
<div style="position:absolute;left:131.40px;top:364.03px" class="cls_024"><span class="cls_024">“name”: “xxxxxxxxx”,</span></div>
<div style="position:absolute;left:131.40px;top:374.83px" class="cls_024"><span class="cls_024">“state”: “Enabled”,</span></div>
<div style="position:absolute;left:131.40px;top:385.63px" class="cls_024"><span class="cls_024">“tenantId”: “f5e90e29-00df-4ea6-b8a4-xxxxxxxxxxxx”,</span></div>
<div style="position:absolute;left:131.40px;top:396.43px" class="cls_024"><span class="cls_024">“user”: {</span></div>
<div style="position:absolute;left:131.40px;top:407.23px" class="cls_024"><span class="cls_024">“name”: “gnschenker@xxxxx.xxx”,</span></div>
<div style="position:absolute;left:131.40px;top:418.03px" class="cls_024"><span class="cls_024">“type”: “user”</span></div>
<div style="position:absolute;left:131.40px;top:428.83px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:131.40px;top:439.63px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:126.00px;top:450.43px" class="cls_024"><span class="cls_024">]</span></div>
<div style="position:absolute;left:108.00px;top:470.17px" class="cls_008"><span class="cls_008">We are now ready to start working with Azure in general and AKS specifically.</span></div>
<div style="position:absolute;left:108.00px;top:500.11px" class="cls_022"><span class="cls_022">Azure resource groups</span></div>
<div style="position:absolute;left:108.00px;top:523.09px" class="cls_008"><span class="cls_008">In Azure, an important concept is </span><span class="cls_009">resource groups</span><span class="cls_008">. A resource group is a container</span></div>
<div style="position:absolute;left:108.00px;top:535.69px" class="cls_008"><span class="cls_008">for all kinds of cloud resources that logically belong together. In our case, all</span></div>
<div style="position:absolute;left:108.00px;top:548.29px" class="cls_008"><span class="cls_008">elements making up the Kubernetes cluster that we’re going to provision in AKS</span></div>
<div style="position:absolute;left:108.00px;top:560.89px" class="cls_008"><span class="cls_008">belong to the same resource group. Thus, let’s start by creating such a group. We</span></div>
<div style="position:absolute;left:108.00px;top:573.49px" class="cls_008"><span class="cls_008">will use the Azure CLI to do so. We will name the group </span><span class="cls_010">pets-group</span><span class="cls_008"> and it will</span></div>
<div style="position:absolute;left:108.00px;top:586.09px" class="cls_008"><span class="cls_008">be located in the </span><span class="cls_010">westeurope</span><span class="cls_008"> region. Use the following command to create the</span></div>
<div style="position:absolute;left:108.00px;top:598.69px" class="cls_008"><span class="cls_008">resource group:</span></div>
<div style="position:absolute;left:126.00px;top:619.63px" class="cls_024"><span class="cls_024">az group create --name pets-group --location westeurope</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 247 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:210926px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background271.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The response of this command looks similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:131.40px;top:146.23px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/186760ad-9152-4499-b317-xxxxxxxxxxxx/</span></div>
<div style="position:absolute;left:126.00px;top:157.03px" class="cls_024"><span class="cls_024">resourceGroups/pets-group”,</span></div>
<div style="position:absolute;left:131.40px;top:167.83px" class="cls_024"><span class="cls_024">“location”: “westeurope”,</span></div>
<div style="position:absolute;left:131.40px;top:178.63px" class="cls_024"><span class="cls_024">“managedBy”: null,</span></div>
<div style="position:absolute;left:131.40px;top:189.43px" class="cls_024"><span class="cls_024">“name”: “pets-group”,</span></div>
<div style="position:absolute;left:131.40px;top:200.23px" class="cls_024"><span class="cls_024">“properties”: {</span></div>
<div style="position:absolute;left:131.40px;top:211.03px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”</span></div>
<div style="position:absolute;left:131.40px;top:221.83px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:108.00px;top:241.57px" class="cls_008"><span class="cls_008">Once we have created a service group, we need to create a service principal so that</span></div>
<div style="position:absolute;left:108.00px;top:254.17px" class="cls_008"><span class="cls_008">our AKS cluster will be able to interact with other Azure resources. To do so, use the</span></div>
<div style="position:absolute;left:108.00px;top:266.77px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:287.71px" class="cls_024"><span class="cls_024">az ad sp create-for-rbac \</span></div>
<div style="position:absolute;left:147.60px;top:298.51px" class="cls_024"><span class="cls_024">--name pets-principal \</span></div>
<div style="position:absolute;left:147.60px;top:309.31px" class="cls_024"><span class="cls_024">--password adminadmin \</span></div>
<div style="position:absolute;left:147.60px;top:320.11px" class="cls_024"><span class="cls_024">--skip-assignment</span></div>
<div style="position:absolute;left:108.00px;top:339.85px" class="cls_008"><span class="cls_008">This results in an output similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:360.79px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:136.80px;top:371.59px" class="cls_024"><span class="cls_024">“appId”: “a1a2bdbc-ba07-49bd-ae77-fb8b6948869d”,</span></div>
<div style="position:absolute;left:136.80px;top:382.39px" class="cls_024"><span class="cls_024">“displayName”: “azure-cli-2018-08-27-19-26-20”,</span></div>
<div style="position:absolute;left:136.80px;top:393.19px" class="cls_024"><span class="cls_024">“name”: “</span><A HREF="http://pets-principal”/">http://pets-principal”</A>,</div>
<div style="position:absolute;left:136.80px;top:403.99px" class="cls_024"><span class="cls_024">“password”: “adminadmin”,</span></div>
<div style="position:absolute;left:136.80px;top:414.79px" class="cls_024"><span class="cls_024">“tenant”: “f5e90e29-00df-4ea6-b8a4-ce8553f10be7”</span></div>
<div style="position:absolute;left:126.00px;top:425.59px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:445.33px" class="cls_008"><span class="cls_008">In the preceding output, </span><span class="cls_010">appId</span><span class="cls_008"> and </span><span class="cls_010">password</span><span class="cls_008"> are important, and you should</span></div>
<div style="position:absolute;left:108.00px;top:457.93px" class="cls_008"><span class="cls_008">note them down somewhere so that you can access them in the commands in the</span></div>
<div style="position:absolute;left:108.00px;top:470.53px" class="cls_008"><span class="cls_008">following sections.</span></div>
<div style="position:absolute;left:108.00px;top:500.47px" class="cls_022"><span class="cls_022">Provisioning the Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:523.45px" class="cls_008"><span class="cls_008">Finally, we are ready to provision our Kubernetes cluster in AKS. We can use the</span></div>
<div style="position:absolute;left:108.00px;top:536.05px" class="cls_008"><span class="cls_008">following command to do so:</span></div>
<div style="position:absolute;left:126.00px;top:556.99px" class="cls_024"><span class="cls_024">az aks create \</span></div>
<div style="position:absolute;left:136.80px;top:567.79px" class="cls_024"><span class="cls_024">--resource-group pets-group \</span></div>
<div style="position:absolute;left:136.80px;top:578.59px" class="cls_024"><span class="cls_024">--name pets-cluster \</span></div>
<div style="position:absolute;left:136.80px;top:589.39px" class="cls_024"><span class="cls_024">--node-count 1 \</span></div>
<div style="position:absolute;left:136.80px;top:600.19px" class="cls_024"><span class="cls_024">--generate-ssh-keys \</span></div>
<div style="position:absolute;left:136.80px;top:610.99px" class="cls_024"><span class="cls_024">--service-principal &lt;appId> \</span></div>
<div style="position:absolute;left:136.80px;top:621.79px" class="cls_024"><span class="cls_024">--client-secret &lt;password></span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 248 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:211728px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background272.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Note, you need to replace the </span><span class="cls_010">&lt;appId></span><span class="cls_008"> and </span><span class="cls_010">&lt;password></span><span class="cls_008"> placeholders with the values</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">you noted down after creating the service principal. Also note that we have created a</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">Kubernetes cluster with a single worker node for the moment. Later on we can scale</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">this cluster up (and down) using the Azure CLI.</span></div>
<div style="position:absolute;left:108.00px;top:173.54px" class="cls_008"><span class="cls_008">The response to the preceding command looks like this:</span></div>
<div style="position:absolute;left:126.00px;top:194.47px" class="cls_024"><span class="cls_024">SSH key files ‘/root/.ssh/id_rsa’ and ‘/root/.ssh/id_rsa.pub’ have</span></div>
<div style="position:absolute;left:126.00px;top:205.27px" class="cls_024"><span class="cls_024">been generated under ~/.ssh to allow SSH access to the VM. If using</span></div>
<div style="position:absolute;left:126.00px;top:216.07px" class="cls_024"><span class="cls_024">machines without permanent storage like Azure Cloud Shell without an</span></div>
<div style="position:absolute;left:126.00px;top:226.87px" class="cls_024"><span class="cls_024">attached file share, back up your keys to a safe location</span></div>
<div style="position:absolute;left:131.40px;top:237.67px" class="cls_024"><span class="cls_024">- Running ..</span></div>
<div style="position:absolute;left:108.00px;top:257.41px" class="cls_008"><span class="cls_008">The whole provisioning takes a few minutes (as indicated by the </span><span class="cls_010">- Running ..</span></div>
<div style="position:absolute;left:108.00px;top:270.01px" class="cls_008"><span class="cls_008">status).</span></div>
<div style="position:absolute;left:108.00px;top:291.26px" class="cls_008"><span class="cls_008">While we’re waiting for the command to complete, we can open a new browser</span></div>
<div style="position:absolute;left:108.00px;top:303.85px" class="cls_008"><span class="cls_008">window and navigate to the Azure portal at </span><A HREF="https://portal.azure.com">https://portal.azure.com</A> </span><span class="cls_008"> and log</span></div>
<div style="position:absolute;left:108.00px;top:316.45px" class="cls_008"><span class="cls_008">in to our account. Once successfully authenticated, we can then navigate to the</span></div>
<div style="position:absolute;left:108.00px;top:329.05px" class="cls_009"><span class="cls_009">Resource groups</span><span class="cls_008"> option and should see the </span><span class="cls_010">pets-group</span><span class="cls_008"> resource group in the list of</span></div>
<div style="position:absolute;left:108.00px;top:341.65px" class="cls_008"><span class="cls_008">resource groups. If we click on this group, we should see </span><span class="cls_010">pets-cluster</span><span class="cls_008"> listed as a</span></div>
<div style="position:absolute;left:108.00px;top:354.25px" class="cls_008"><span class="cls_008">resource in the group:</span></div>
<div style="position:absolute;left:259.36px;top:548.30px" class="cls_026"><span class="cls_026">Kubernetes cluster in AKS</span></div>
<div style="position:absolute;left:108.00px;top:567.04px" class="cls_008"><span class="cls_008">Once the cluster has been created, we see the final output in the Terminal window</span></div>
<div style="position:absolute;left:108.00px;top:579.64px" class="cls_008"><span class="cls_008">shown as follows:</span></div>
<div style="position:absolute;left:126.00px;top:600.58px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:142.20px;top:600.58px" class="cls_024"><span class="cls_024">“aadProfile”: null,</span></div>
<div style="position:absolute;left:136.80px;top:611.38px" class="cls_024"><span class="cls_024">“addonProfiles”: null,</span></div>
<div style="position:absolute;left:136.80px;top:622.18px" class="cls_024"><span class="cls_024">“agentPoolProfiles”: [</span></div>
<div style="position:absolute;left:147.60px;top:632.98px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 249 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:212530px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background273.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:158.40px;top:114.01px" class="cls_024"><span class="cls_024">“count”: 1,</span></div>
<div style="position:absolute;left:158.40px;top:124.81px" class="cls_024"><span class="cls_024">“maxPods”: 110,</span></div>
<div style="position:absolute;left:158.40px;top:135.61px" class="cls_024"><span class="cls_024">“name”: “nodepool1”,</span></div>
<div style="position:absolute;left:158.40px;top:146.41px" class="cls_024"><span class="cls_024">“osDiskSizeGb”: null,</span></div>
<div style="position:absolute;left:158.40px;top:157.21px" class="cls_024"><span class="cls_024">“osType”: “Linux”,</span></div>
<div style="position:absolute;left:158.40px;top:168.01px" class="cls_024"><span class="cls_024">“storageProfile”: “ManagedDisks”,</span></div>
<div style="position:absolute;left:158.40px;top:178.81px" class="cls_024"><span class="cls_024">“vmSize”: “Standard_DS1_v2”,</span></div>
<div style="position:absolute;left:158.40px;top:189.61px" class="cls_024"><span class="cls_024">“vnetSubnetId”: null</span></div>
<div style="position:absolute;left:147.60px;top:200.41px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:136.80px;top:211.21px" class="cls_024"><span class="cls_024">],</span></div>
<div style="position:absolute;left:136.80px;top:222.01px" class="cls_024"><span class="cls_024">“dnsPrefix”: “pets-clust-pets-group-186760”,</span></div>
<div style="position:absolute;left:136.80px;top:232.81px" class="cls_024"><span class="cls_024">“enableRbac”: true,</span></div>
<div style="position:absolute;left:136.80px;top:243.61px" class="cls_024"><span class="cls_024">“fqdn”: “pets-clust-pets-group-186760-d706beb4.hcp.westeurope.</span></div>
<div style="position:absolute;left:126.00px;top:254.41px" class="cls_024"><span class="cls_024">azmk8s.io”,</span></div>
<div style="position:absolute;left:196.20px;top:254.41px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/186760ad-9152-4499-b317-</span></div>
<div style="position:absolute;left:126.00px;top:265.21px" class="cls_024"><span class="cls_024">c9bff441fb9d/resourcegroups/pets-group/providers/Microsoft.</span></div>
<div style="position:absolute;left:126.00px;top:276.01px" class="cls_024"><span class="cls_024">ContainerService/managedClusters/pets-cluster”,</span></div>
<div style="position:absolute;left:136.80px;top:286.81px" class="cls_024"><span class="cls_024">“kubernetesVersion”: “1.9.9”,</span></div>
<div style="position:absolute;left:136.80px;top:297.61px" class="cls_024"><span class="cls_024">“linuxProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:308.41px" class="cls_024"><span class="cls_024">“adminUsername”: “azureuser”,</span></div>
<div style="position:absolute;left:147.60px;top:319.21px" class="cls_024"><span class="cls_024">“ssh”: {</span></div>
<div style="position:absolute;left:158.40px;top:330.01px" class="cls_024"><span class="cls_024">“publicKeys”: [</span></div>
<div style="position:absolute;left:169.20px;top:340.81px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:180.00px;top:351.61px" class="cls_024"><span class="cls_024">“keyData”: “ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDMp</span></div>
<div style="position:absolute;left:126.00px;top:362.41px" class="cls_024"><span class="cls_024">2BFCRUo7v1ktVQa57ep7zLg7HEjsRQAkb7UnovDXrLg1nBuzMslHZY3mJ5ulxU00</span></div>
<div style="position:absolute;left:126.00px;top:373.21px" class="cls_024"><span class="cls_024">YWeUuxObeHjRh+ZJHc4+xKaDV8M6GmuHjD8HJnw5tsCbV8w/A+5oUOECaeJn5sQMCkmS</span></div>
<div style="position:absolute;left:126.00px;top:384.01px" class="cls_024"><span class="cls_024">DovmDQZchAjLjVHQLSTiEqjLYmjjqYmhqYpO2vRsnZXpelRrlmfNWoSV5J3L7/</span></div>
<div style="position:absolute;left:126.00px;top:394.81px" class="cls_024"><span class="cls_024">hayI2fg35X/H4xnx1sm403O9pwyEKYYBFfNzCXigNnqyBvxOqwURZUW/caIpTqAhS6</span></div>
<div style="position:absolute;left:126.00px;top:405.61px" class="cls_024"><span class="cls_024">K+D1xPa2w7y1A5qcZS++SnJOHCHyRKZ3UQ4BVZTSejBhxYTr5/dgJE+LEvLk2i</span></div>
<div style="position:absolute;left:126.00px;top:416.41px" class="cls_024"><span class="cls_024">YUo4kUmbxDSVssnWJ”</span></div>
<div style="position:absolute;left:169.20px;top:427.21px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:158.40px;top:438.01px" class="cls_024"><span class="cls_024">]</span></div>
<div style="position:absolute;left:147.60px;top:448.81px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:136.80px;top:459.61px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:136.80px;top:470.41px" class="cls_024"><span class="cls_024">“location”: “westeurope”,</span></div>
<div style="position:absolute;left:136.80px;top:481.21px" class="cls_024"><span class="cls_024">“name”: “pets-cluster”,</span></div>
<div style="position:absolute;left:136.80px;top:492.01px" class="cls_024"><span class="cls_024">“networkProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:502.81px" class="cls_024"><span class="cls_024">“dnsServiceIp”: “10.0.0.10”,</span></div>
<div style="position:absolute;left:147.60px;top:513.61px" class="cls_024"><span class="cls_024">“dockerBridgeCidr”: “172.17.0.1/16”,</span></div>
<div style="position:absolute;left:147.60px;top:524.41px" class="cls_024"><span class="cls_024">“networkPlugin”: “kubenet”,</span></div>
<div style="position:absolute;left:147.60px;top:535.21px" class="cls_024"><span class="cls_024">“networkPolicy”: null,</span></div>
<div style="position:absolute;left:147.60px;top:546.01px" class="cls_024"><span class="cls_024">“podCidr”: “10.244.0.0/16”,</span></div>
<div style="position:absolute;left:147.60px;top:556.81px" class="cls_024"><span class="cls_024">“serviceCidr”: “10.0.0.0/16”</span></div>
<div style="position:absolute;left:136.80px;top:567.61px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:136.80px;top:578.41px" class="cls_024"><span class="cls_024">“nodeResourceGroup”: “MC_pets-group_pets-cluster_westeurope”,</span></div>
<div style="position:absolute;left:136.80px;top:589.21px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”,</span></div>
<div style="position:absolute;left:136.80px;top:600.01px" class="cls_024"><span class="cls_024">“resourceGroup”: “pets-group”,</span></div>
<div style="position:absolute;left:136.80px;top:610.81px" class="cls_024"><span class="cls_024">“servicePrincipalProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:621.61px" class="cls_024"><span class="cls_024">“clientId”: “a1a2bdbc-ba07-49bd-ae77-fb8b6948869d”,</span></div>
<div style="position:absolute;left:147.60px;top:632.41px" class="cls_024"><span class="cls_024">“secret”: null</span></div>
<div style="position:absolute;left:136.80px;top:643.21px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 250 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:213332px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background274.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:136.80px;top:114.01px" class="cls_024"><span class="cls_024">“tags”: null,</span></div>
<div style="position:absolute;left:136.80px;top:124.81px" class="cls_024"><span class="cls_024">“type”: “Microsoft.ContainerService/ManagedClusters”</span></div>
<div style="position:absolute;left:126.00px;top:135.61px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:155.34px" class="cls_008"><span class="cls_008">To access the cluster, we need to configure </span><span class="cls_010">kubectl</span><span class="cls_008"> by using the following</span></div>
<div style="position:absolute;left:108.00px;top:167.94px" class="cls_008"><span class="cls_008">command:</span></div>
<div style="position:absolute;left:126.00px;top:188.88px" class="cls_024"><span class="cls_024">az aks get-credentials --resource-group pets-group --name pets-cluster</span></div>
<div style="position:absolute;left:108.00px;top:208.62px" class="cls_008"><span class="cls_008">If successful, this will generate the following response in the Terminal:</span></div>
<div style="position:absolute;left:126.00px;top:229.56px" class="cls_024"><span class="cls_024">Merged “pets-cluster” as current context in /root/.kube/config</span></div>
<div style="position:absolute;left:108.00px;top:249.30px" class="cls_008"><span class="cls_008">Now we can try to use </span><span class="cls_010">kubectl</span><span class="cls_008"> by getting all nodes of the cluster:</span></div>
<div style="position:absolute;left:126.00px;top:270.24px" class="cls_024"><span class="cls_024">kubectl get nodes</span></div>
<div style="position:absolute;left:108.00px;top:289.98px" class="cls_008"><span class="cls_008">This results in something similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:310.92px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:271.80px;top:310.92px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:325.80px;top:310.92px" class="cls_024"><span class="cls_024">ROLES</span></div>
<div style="position:absolute;left:379.80px;top:310.92px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:433.80px;top:310.92px" class="cls_024"><span class="cls_024">VERSION</span></div>
<div style="position:absolute;left:126.00px;top:321.72px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0</span></div>
<div style="position:absolute;left:271.80px;top:321.72px" class="cls_024"><span class="cls_024">Ready</span></div>
<div style="position:absolute;left:325.80px;top:321.72px" class="cls_024"><span class="cls_024">agent</span></div>
<div style="position:absolute;left:379.80px;top:321.72px" class="cls_024"><span class="cls_024">13m</span></div>
<div style="position:absolute;left:433.80px;top:321.72px" class="cls_024"><span class="cls_024">v1.9.9</span></div>
<div style="position:absolute;left:108.00px;top:341.46px" class="cls_008"><span class="cls_008">We see that our cluster consists of one worker node whose Kubernetes version is</span></div>
<div style="position:absolute;left:108.00px;top:354.06px" class="cls_010"><span class="cls_010">1.9.9</span><span class="cls_008"> and who has been up for 13 minutes. The attentive reader might have noticed</span></div>
<div style="position:absolute;left:108.00px;top:366.66px" class="cls_008"><span class="cls_008">that the version of Kubernetes is a bit outdated. The most recent version available</span></div>
<div style="position:absolute;left:108.00px;top:379.26px" class="cls_008"><span class="cls_008">on AKS at the time of writing is </span><span class="cls_010">1.11.2</span><span class="cls_008">. This is perfectly fine and gives us the</span></div>
<div style="position:absolute;left:108.00px;top:391.86px" class="cls_008"><span class="cls_008">possibility to show how we can upgrade the cluster to a newer version</span></div>
<div style="position:absolute;left:108.00px;top:404.46px" class="cls_008"><span class="cls_008">of Kubernetes.</span></div>
<div style="position:absolute;left:108.00px;top:436.96px" class="cls_011"><span class="cls_011">Pushing Docker images to the Azure</span></div>
<div style="position:absolute;left:108.00px;top:460.96px" class="cls_011"><span class="cls_011">Container Registry (ACR)</span></div>
<div style="position:absolute;left:108.00px;top:485.94px" class="cls_008"><span class="cls_008">When deploying a containerized application onto a Kubernetes cluster hosted on</span></div>
<div style="position:absolute;left:108.00px;top:498.54px" class="cls_008"><span class="cls_008">Azure, it is of benefit to have the underlying Docker images stored in the same</span></div>
<div style="position:absolute;left:108.00px;top:511.14px" class="cls_008"><span class="cls_008">security context and close to the cluster. Thus, the ACR is a good choice. Before we</span></div>
<div style="position:absolute;left:108.00px;top:523.74px" class="cls_008"><span class="cls_008">deploy our application to the cluster, we will thus push the necessary Docker images</span></div>
<div style="position:absolute;left:108.00px;top:536.34px" class="cls_008"><span class="cls_008">to the ACR.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 251 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:214134px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background275.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Creating an ACR</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Once more we will use the Azure CLI to create a registry for our Docker images on</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">Azure. The registry will also belong to the </span><span class="cls_010">pet-group</span><span class="cls_008"> resource group we created in</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">the </span><span class="cls_021">Azure resource groups</span><span class="cls_008"> section in this chapter. We can use the following command</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">to create a registry named </span><span class="cls_010">&lt;registry-name></span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:194.18px" class="cls_024"><span class="cls_024">az acr create --resource-group pets-group --name &lt;registry-name></span></div>
<div style="position:absolute;left:126.00px;top:204.98px" class="cls_024"><span class="cls_024">--sku Basic</span></div>
<div style="position:absolute;left:108.00px;top:224.72px" class="cls_008"><span class="cls_008">Please note that the name of the registry is </span><span class="cls_010">&lt;registry-name></span><span class="cls_008">, which needs to be</span></div>
<div style="position:absolute;left:108.00px;top:237.32px" class="cls_008"><span class="cls_008">unique on Azure. Thus, you need to come up with your own unique name and</span></div>
<div style="position:absolute;left:108.00px;top:249.92px" class="cls_008"><span class="cls_008">cannot use the same one as the author of this book. This is the reason that we are</span></div>
<div style="position:absolute;left:108.00px;top:262.52px" class="cls_008"><span class="cls_008">using a </span><span class="cls_010">&lt;registry-name></span><span class="cls_008"> placeholder instead of a real name here. In my case, I have</span></div>
<div style="position:absolute;left:108.00px;top:275.12px" class="cls_008"><span class="cls_008">named the registry </span><span class="cls_010">gnsPetsRegistry</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:296.37px" class="cls_008"><span class="cls_008">Note that the preceding command takes a while. The command’s answer then looks</span></div>
<div style="position:absolute;left:108.00px;top:308.97px" class="cls_008"><span class="cls_008">similar to the following:</span></div>
<div style="position:absolute;left:126.00px;top:329.90px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:131.40px;top:340.70px" class="cls_024"><span class="cls_024">“adminUserEnabled”: false,</span></div>
<div style="position:absolute;left:131.40px;top:351.50px" class="cls_024"><span class="cls_024">“creationDate”: “2018-08-27T19:57:01.434521+00:00”,</span></div>
<div style="position:absolute;left:131.40px;top:362.30px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/186760ad-9152-4499-b317-xxxxxxxxxxxx/</span></div>
<div style="position:absolute;left:126.00px;top:373.10px" class="cls_024"><span class="cls_024">resourceGroups/pets-group/providers/Microsoft.ContainerRegistry/</span></div>
<div style="position:absolute;left:126.00px;top:383.90px" class="cls_024"><span class="cls_024">registries/gnsPetsRegistry”,</span></div>
<div style="position:absolute;left:131.40px;top:394.70px" class="cls_024"><span class="cls_024">“location”: “westeurope”,</span></div>
<div style="position:absolute;left:131.40px;top:405.50px" class="cls_024"><span class="cls_024">“loginServer”: “gnspetsregistry.azurecr.io”,</span></div>
<div style="position:absolute;left:131.40px;top:416.30px" class="cls_024"><span class="cls_024">“name”: “gnsPetsRegistry”,</span></div>
<div style="position:absolute;left:131.40px;top:427.10px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”,</span></div>
<div style="position:absolute;left:131.40px;top:437.90px" class="cls_024"><span class="cls_024">“resourceGroup”: “pets-group”,</span></div>
<div style="position:absolute;left:131.40px;top:448.70px" class="cls_024"><span class="cls_024">“sku”: {</span></div>
<div style="position:absolute;left:131.40px;top:459.50px" class="cls_024"><span class="cls_024">“name”: “Basic”,</span></div>
<div style="position:absolute;left:131.40px;top:470.30px" class="cls_024"><span class="cls_024">“tier”: “Basic”</span></div>
<div style="position:absolute;left:131.40px;top:481.10px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:131.40px;top:491.90px" class="cls_024"><span class="cls_024">“status”: null,</span></div>
<div style="position:absolute;left:131.40px;top:502.70px" class="cls_024"><span class="cls_024">“storageAccount”: null,</span></div>
<div style="position:absolute;left:131.40px;top:513.50px" class="cls_024"><span class="cls_024">“tags”: {},</span></div>
<div style="position:absolute;left:131.40px;top:524.30px" class="cls_024"><span class="cls_024">“type”: “Microsoft.ContainerRegistry/registries”</span></div>
<div style="position:absolute;left:126.00px;top:535.10px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:554.84px" class="cls_008"><span class="cls_008">Note the </span><span class="cls_010">loginServer</span><span class="cls_008"> entry in the preceding output. The value of that key</span></div>
<div style="position:absolute;left:108.00px;top:567.44px" class="cls_008"><span class="cls_008">corresponds to the URL that we need to use to prefix the Docker images when we</span></div>
<div style="position:absolute;left:108.00px;top:580.04px" class="cls_008"><span class="cls_008">tag them so that they can then be pushed to the ACR.</span></div>
<div style="position:absolute;left:108.00px;top:601.29px" class="cls_008"><span class="cls_008">After we have created the registry, we can log in to it using this command:</span></div>
<div style="position:absolute;left:126.00px;top:622.22px" class="cls_024"><span class="cls_024">az acr login --name &lt;registry-name></span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 252 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:214936px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background276.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">The answer should be:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">Login Succeeded</span></div>
<div style="position:absolute;left:108.00px;top:155.17px" class="cls_008"><span class="cls_008">In the Azure portal, we should now see our registry listed as an additional</span></div>
<div style="position:absolute;left:108.00px;top:167.77px" class="cls_008"><span class="cls_008">resource of the </span><span class="cls_010">pets-group</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:274.36px;top:373.42px" class="cls_026"><span class="cls_026">ACR Pets registry</span></div>
<div style="position:absolute;left:108.00px;top:392.16px" class="cls_008"><span class="cls_008">We are now ready to push images to our ACR.</span></div>
<div style="position:absolute;left:108.00px;top:422.10px" class="cls_022"><span class="cls_022">Tagging and pushing Docker images</span></div>
<div style="position:absolute;left:108.00px;top:445.08px" class="cls_008"><span class="cls_008">In the previous chapters, we built the Docker images we’re going to use in this</span></div>
<div style="position:absolute;left:108.00px;top:457.68px" class="cls_008"><span class="cls_008">chapter. But to be able to push those images to the ACR, we need to first re-tag the</span></div>
<div style="position:absolute;left:108.00px;top:470.28px" class="cls_008"><span class="cls_008">images with the correct URL prefix for the ACR. To get this prefix (or </span><span class="cls_009">ACR login</span></div>
<div style="position:absolute;left:108.00px;top:482.88px" class="cls_009"><span class="cls_009">server</span><span class="cls_008">, as it is also called; we already saw this in the output of the command that</span></div>
<div style="position:absolute;left:108.00px;top:495.48px" class="cls_008"><span class="cls_008">was used to create the registry), we can use the following command:</span></div>
<div style="position:absolute;left:126.00px;top:516.42px" class="cls_024"><span class="cls_024">az acr list --resource-group pets-group --query “[].</span></div>
<div style="position:absolute;left:126.00px;top:527.22px" class="cls_024"><span class="cls_024">{acrLoginServer:loginServer}” --output table</span></div>
<div style="position:absolute;left:108.00px;top:546.96px" class="cls_008"><span class="cls_008">The preceding command should result in an output similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:567.90px" class="cls_024"><span class="cls_024">AcrLoginServer</span></div>
<div style="position:absolute;left:126.00px;top:578.70px" class="cls_024"><span class="cls_024">--------------------------</span></div>
<div style="position:absolute;left:126.00px;top:589.50px" class="cls_024"><span class="cls_024">gnspetsregistry.azurecr.io</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 253 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:215738px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background277.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">OK, now that we have a registry in the ACR, we can finally tag our Docker images</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">accordingly. In my case, using the gnspetsregistry.azurecr.io URL, the command for</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the pets-web:v1 Docker image looks like this:</span></div>
<div style="position:absolute;left:126.00px;top:160.63px" class="cls_024"><span class="cls_024">docker image tag pets-web:v1 gnspetsregistry.azurecr.io/pets-web:v1</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">Once this is done, we can push the image with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:201.31px" class="cls_024"><span class="cls_024">docker image push gnspetsregistry.azurecr.io/pets-web:v1</span></div>
<div style="position:absolute;left:108.00px;top:221.05px" class="cls_008"><span class="cls_008">If everything works OK, you should see something similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:241.99px" class="cls_024"><span class="cls_024">The push refers to repository [gnspetsregistry.azurecr.io/pets-web]</span></div>
<div style="position:absolute;left:126.00px;top:252.79px" class="cls_024"><span class="cls_024">9d5c9e1e5f97: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:263.59px" class="cls_024"><span class="cls_024">39f3a72e04a3: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:274.39px" class="cls_024"><span class="cls_024">3177c088200b: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:285.19px" class="cls_024"><span class="cls_024">5f896b8130b3: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:295.99px" class="cls_024"><span class="cls_024">287ef32bfa90: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:306.79px" class="cls_024"><span class="cls_024">ce291010afac: Pushed</span></div>
<div style="position:absolute;left:126.00px;top:317.59px" class="cls_024"><span class="cls_024">73046094a9b8: Mounted from alpine</span></div>
<div style="position:absolute;left:126.00px;top:328.39px" class="cls_024"><span class="cls_024">v1: digest: sha256:9a32931874f4fdf5... size: 1783</span></div>
<div style="position:absolute;left:108.00px;top:348.13px" class="cls_008"><span class="cls_008">Now do the same for the Docker </span><span class="cls_010">pets-db:v1</span><span class="cls_008"> image:</span></div>
<div style="position:absolute;left:126.00px;top:369.07px" class="cls_024"><span class="cls_024">docker image tag pets-db:v1 gnspetsregistry.azurecr.io/pets-db:v1</span></div>
<div style="position:absolute;left:126.00px;top:379.87px" class="cls_024"><span class="cls_024">docker image push gnspetsregistry.azurecr.io/pets-db:v1</span></div>
<div style="position:absolute;left:108.00px;top:416.95px" class="cls_022"><span class="cls_022">Configuring the service principal</span></div>
<div style="position:absolute;left:108.00px;top:439.93px" class="cls_008"><span class="cls_008">As a final step, we need to give the AKS service principal that we created earlier</span></div>
<div style="position:absolute;left:108.00px;top:452.53px" class="cls_008"><span class="cls_008">in this chapter the necessary rights to access and pull images from our container</span></div>
<div style="position:absolute;left:108.00px;top:465.13px" class="cls_008"><span class="cls_008">registry. First, we get the ACR resource ID (</span><span class="cls_010">&lt;acrId></span><span class="cls_008">) using the following command:</span></div>
<div style="position:absolute;left:126.00px;top:486.07px" class="cls_024"><span class="cls_024">az acr show --resource-group pets-group \</span></div>
<div style="position:absolute;left:147.60px;top:496.87px" class="cls_024"><span class="cls_024">--query “id” \</span></div>
<div style="position:absolute;left:147.60px;top:507.67px" class="cls_024"><span class="cls_024">--output tsv \</span></div>
<div style="position:absolute;left:147.60px;top:518.47px" class="cls_024"><span class="cls_024">--name &lt;registry-name></span></div>
<div style="position:absolute;left:108.00px;top:538.21px" class="cls_008"><span class="cls_008">This should result in an output similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:559.15px" class="cls_024"><span class="cls_024">/subscriptions/186760ad-9152-4499-b317-xxxxxxxxxxxx/resourceGroups/</span></div>
<div style="position:absolute;left:126.00px;top:569.95px" class="cls_024"><span class="cls_024">pets-group/providers/Microsoft.ContainerRegistry/registries/</span></div>
<div style="position:absolute;left:126.00px;top:580.75px" class="cls_024"><span class="cls_024">gnsPetsRegistry</span></div>
<div style="position:absolute;left:108.00px;top:600.49px" class="cls_008"><span class="cls_008">Having this information, we can assign the service principal identified by </span><span class="cls_010">&lt;appId></span></div>
<div style="position:absolute;left:108.00px;top:613.09px" class="cls_008"><span class="cls_008">the necessary read access to the container registry identified by </span><span class="cls_010">&lt;acrId></span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:634.03px" class="cls_024"><span class="cls_024">az role assignment create --assignee &lt;appId> --scope &lt;acrId></span></div>
<div style="position:absolute;left:126.00px;top:644.83px" class="cls_024"><span class="cls_024">--role Reader</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 254 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:216540px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background278.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Here, </span><span class="cls_010">&lt;appId></span><span class="cls_008"> is the application ID of the principal that we stored previously and</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">&lt;acrId></span><span class="cls_008"> is the the ACR resource ID. The output looks similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:131.40px;top:158.83px" class="cls_024"><span class="cls_024">“canDelegate”: null,</span></div>
<div style="position:absolute;left:131.40px;top:169.63px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/.../roleAssignments/1b7c2a63-c4d3-41a9-a1bc-</span></div>
<div style="position:absolute;left:126.00px;top:180.43px" class="cls_024"><span class="cls_024">bd9d65966f43”,</span></div>
<div style="position:absolute;left:131.40px;top:191.23px" class="cls_024"><span class="cls_024">“name”: “1b7c2a63-c4d3-41a9-a1bc-bd9d65966f43”,</span></div>
<div style="position:absolute;left:131.40px;top:202.03px" class="cls_024"><span class="cls_024">“principalId”: “ab5fe519-3982-4aac-95e0-761c242aa61b”,</span></div>
<div style="position:absolute;left:131.40px;top:212.83px" class="cls_024"><span class="cls_024">“resourceGroup”: “pets-group”,</span></div>
<div style="position:absolute;left:131.40px;top:223.63px" class="cls_024"><span class="cls_024">“roleDefinitionId”: “/subscriptions/.../roleDefinitions/acdd72a7-</span></div>
<div style="position:absolute;left:126.00px;top:234.43px" class="cls_024"><span class="cls_024">3385-48ef-bd42-f606fba81ae7”,</span></div>
<div style="position:absolute;left:131.40px;top:245.23px" class="cls_024"><span class="cls_024">“scope”: “/subscriptions/.../registries/gnspetsregistry”,</span></div>
<div style="position:absolute;left:131.40px;top:256.03px" class="cls_024"><span class="cls_024">“type”: “Microsoft.Authorization/roleAssignments”</span></div>
<div style="position:absolute;left:126.00px;top:266.83px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:297.83px" class="cls_011"><span class="cls_011">Deploying an application into the</span></div>
<div style="position:absolute;left:108.00px;top:321.83px" class="cls_011"><span class="cls_011">Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:346.81px" class="cls_008"><span class="cls_008">After we have successfully pushed our Docker images into the ACR, we are ready</span></div>
<div style="position:absolute;left:108.00px;top:359.41px" class="cls_008"><span class="cls_008">to deploy the application into the Kubernetes cluster in AKS. For this, we can use</span></div>
<div style="position:absolute;left:108.00px;top:372.01px" class="cls_008"><span class="cls_008">the manifest file, </span><span class="cls_010">pets.yaml</span><span class="cls_008">, which is part of the source code in the </span><span class="cls_010">ch12</span><span class="cls_008"> folder.</span></div>
<div style="position:absolute;left:108.00px;top:384.61px" class="cls_008"><span class="cls_008">Please open this file with your editor and modify the file to match your environment.</span></div>
<div style="position:absolute;left:108.00px;top:397.21px" class="cls_008"><span class="cls_008">Replace the repository URL prefixing the Docker images with your specific URL.</span></div>
<div style="position:absolute;left:108.00px;top:418.45px" class="cls_008"><span class="cls_008">In the following snippet, we see the default value, </span><span class="cls_010">gnsPetsRegistry</span><span class="cls_008">, that you have</span></div>
<div style="position:absolute;left:108.00px;top:431.05px" class="cls_008"><span class="cls_008">to replace with your own </span><span class="cls_010">&lt;registry name></span><span class="cls_008"> value:</span></div>
<div style="position:absolute;left:126.00px;top:451.99px" class="cls_024"><span class="cls_024">containers:</span></div>
<div style="position:absolute;left:126.00px;top:462.79px" class="cls_024"><span class="cls_024">- name: web</span></div>
<div style="position:absolute;left:136.80px;top:473.59px" class="cls_024"><span class="cls_024">image: gnsPetsRegistry.azurecr.io/pets-web:v1</span></div>
<div style="position:absolute;left:108.00px;top:493.33px" class="cls_008"><span class="cls_008">Save the changes. Then use </span><span class="cls_010">kubectl</span><span class="cls_008"> to apply the manifest:</span></div>
<div style="position:absolute;left:126.00px;top:514.27px" class="cls_024"><span class="cls_024">kubectl apply -f /src/pets.yaml</span></div>
<div style="position:absolute;left:108.00px;top:534.01px" class="cls_008"><span class="cls_008">The output of the preceding command should be similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:554.95px" class="cls_024"><span class="cls_024">deployment.apps/db created</span></div>
<div style="position:absolute;left:126.00px;top:565.75px" class="cls_024"><span class="cls_024">service/db created</span></div>
<div style="position:absolute;left:126.00px;top:576.55px" class="cls_024"><span class="cls_024">deployment.apps/web created</span></div>
<div style="position:absolute;left:126.00px;top:587.35px" class="cls_024"><span class="cls_024">service/web created</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 255 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:217342px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background279.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We are creating a </span><span class="cls_010">LoadBalancer</span><span class="cls_008"> type service for the frontend of the Pets application</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">that will have been assigned a public IP address by AKS. This takes a moment and</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">we can observe the status with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:160.63px" class="cls_024"><span class="cls_024">kubectl get service web --watch</span></div>
<div style="position:absolute;left:108.00px;top:180.37px" class="cls_008"><span class="cls_008">Initially, the output will be similar to this (see the </span><span class="cls_010">pending</span><span class="cls_008"> output in the</span></div>
<div style="position:absolute;left:108.00px;top:192.97px" class="cls_010"><span class="cls_010">EXTERNAL-IP</span><span class="cls_008"> column):</span></div>
<div style="position:absolute;left:126.00px;top:213.91px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:163.80px;top:213.91px" class="cls_024"><span class="cls_024">TYPE</span></div>
<div style="position:absolute;left:234.00px;top:213.91px" class="cls_024"><span class="cls_024">CLUSTER-IP</span></div>
<div style="position:absolute;left:315.00px;top:213.91px" class="cls_024"><span class="cls_024">EXTERNAL-IP</span></div>
<div style="position:absolute;left:390.60px;top:213.91px" class="cls_024"><span class="cls_024">PORT(S)</span></div>
<div style="position:absolute;left:477.00px;top:213.91px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:224.71px" class="cls_024"><span class="cls_024">web</span></div>
<div style="position:absolute;left:169.20px;top:224.71px" class="cls_024"><span class="cls_024">LoadBalancer</span></div>
<div style="position:absolute;left:244.80px;top:224.71px" class="cls_024"><span class="cls_024">10.0.49.36</span></div>
<div style="position:absolute;left:325.80px;top:224.71px" class="cls_024"><span class="cls_024">&lt;pending></span></div>
<div style="position:absolute;left:396.00px;top:224.71px" class="cls_024"><span class="cls_024">80:31035/TCP</span></div>
<div style="position:absolute;left:482.40px;top:224.71px" class="cls_024"><span class="cls_024">41s</span></div>
<div style="position:absolute;left:108.00px;top:244.45px" class="cls_008"><span class="cls_008">Once the deployment is finished, </span><span class="cls_010">&lt;pending></span><span class="cls_008"> will be replaced by the public IP</span></div>
<div style="position:absolute;left:108.00px;top:257.05px" class="cls_008"><span class="cls_008">address, and be ready to use to access our Pets application:</span></div>
<div style="position:absolute;left:126.00px;top:277.99px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:163.80px;top:277.99px" class="cls_024"><span class="cls_024">TYPE</span></div>
<div style="position:absolute;left:239.40px;top:277.99px" class="cls_024"><span class="cls_024">CLUSTER-IP  EXTERNAL-IP</span></div>
<div style="position:absolute;left:385.20px;top:277.99px" class="cls_024"><span class="cls_024">PORT(S)</span></div>
<div style="position:absolute;left:460.80px;top:277.99px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:288.79px" class="cls_024"><span class="cls_024">web</span></div>
<div style="position:absolute;left:163.80px;top:288.79px" class="cls_024"><span class="cls_024">LoadBalancer</span></div>
<div style="position:absolute;left:239.40px;top:288.79px" class="cls_024"><span class="cls_024">10.0.49.36</span></div>
<div style="position:absolute;left:304.20px;top:288.79px" class="cls_024"><span class="cls_024">40.114.197.39</span></div>
<div style="position:absolute;left:385.20px;top:288.79px" class="cls_024"><span class="cls_024">80:31035/TCP</span></div>
<div style="position:absolute;left:460.80px;top:288.79px" class="cls_024"><span class="cls_024">2m</span></div>
<div style="position:absolute;left:108.00px;top:308.53px" class="cls_008"><span class="cls_008">Open a browser window at </span><A HREF="http://&lt;ip/">http://&lt;IP</A> address>/pet</span><span class="cls_008"> and you should see a nice</span></div>
<div style="position:absolute;left:108.00px;top:321.13px" class="cls_008"><span class="cls_008">cat image:</span></div>
<div style="position:absolute;left:222.11px;top:640.86px" class="cls_026"><span class="cls_026">Pets application running in Kubernetes on AKS</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 256 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:218144px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background280.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">With this, we have successfully deployed a complex application into our Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">cluster on AKS.</span></div>
<div style="position:absolute;left:108.00px;top:159.59px" class="cls_011"><span class="cls_011">Scaling the Pets application</span></div>
<div style="position:absolute;left:108.00px;top:184.57px" class="cls_008"><span class="cls_008">There are two ways that we can scale our Pets application, which are as follows:</span></div>
<div style="position:absolute;left:126.00px;top:205.82px" class="cls_008"><span class="cls_008">•  The first one is by scaling the number of application instances</span></div>
<div style="position:absolute;left:126.00px;top:222.73px" class="cls_008"><span class="cls_008">•  The second one is by scaling the number of worker nodes in the cluster</span></div>
<div style="position:absolute;left:107.99px;top:243.97px" class="cls_008"><span class="cls_008">The second approach, of course, only makes sense if we scale the number of</span></div>
<div style="position:absolute;left:107.99px;top:256.57px" class="cls_008"><span class="cls_008">application instances at the same time too, so that those additional instances will</span></div>
<div style="position:absolute;left:107.99px;top:269.17px" class="cls_008"><span class="cls_008">leverage the resources of the newly added cluster nodes.</span></div>
<div style="position:absolute;left:108.00px;top:299.11px" class="cls_022"><span class="cls_022">Scaling the number of app instances</span></div>
<div style="position:absolute;left:108.00px;top:322.09px" class="cls_008"><span class="cls_008">Scaling the number of instances that a given application service is running is easy,</span></div>
<div style="position:absolute;left:108.00px;top:334.69px" class="cls_008"><span class="cls_008">and we can use </span><span class="cls_010">kubectl</span><span class="cls_008"> to do so. Let’s assume that our Pets application is so</span></div>
<div style="position:absolute;left:108.00px;top:347.29px" class="cls_008"><span class="cls_008">successful that we need to increase the number of web instances to three while the</span></div>
<div style="position:absolute;left:108.00px;top:359.89px" class="cls_008"><span class="cls_008">database can still handle the incoming traffic with a single instance. Let’s first see</span></div>
<div style="position:absolute;left:108.00px;top:372.49px" class="cls_008"><span class="cls_008">what pods are currently running in our cluster:</span></div>
<div style="position:absolute;left:126.00px;top:393.43px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get pods</span></div>
<div style="position:absolute;left:126.00px;top:404.23px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:250.20px;top:404.23px" class="cls_024"><span class="cls_024">READY</span></div>
<div style="position:absolute;left:293.40px;top:404.23px" class="cls_024"><span class="cls_024">STATUS</span></div>
<div style="position:absolute;left:347.40px;top:404.23px" class="cls_024"><span class="cls_024">RESTARTS  AGE</span></div>
<div style="position:absolute;left:126.00px;top:415.03px" class="cls_024"><span class="cls_024">db-6746668f6c-wdscl</span></div>
<div style="position:absolute;left:250.20px;top:415.03px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:293.40px;top:415.03px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:347.40px;top:415.03px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:401.40px;top:415.03px" class="cls_024"><span class="cls_024">2h</span></div>
<div style="position:absolute;left:126.00px;top:425.83px" class="cls_024"><span class="cls_024">web-798745b679-8kh2j</span></div>
<div style="position:absolute;left:250.20px;top:425.83px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:293.40px;top:425.83px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:347.40px;top:425.83px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:401.40px;top:425.83px" class="cls_024"><span class="cls_024">2h</span></div>
<div style="position:absolute;left:108.00px;top:445.57px" class="cls_008"><span class="cls_008">And we can see that we have one pod for each of the two services, </span><span class="cls_010">web</span><span class="cls_008"> and </span><span class="cls_010">db</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:108.00px;top:458.17px" class="cls_008"><span class="cls_008">up and running. None of the pods have been restarted so far. Let’s scale our web</span></div>
<div style="position:absolute;left:108.00px;top:470.77px" class="cls_008"><span class="cls_008">deployment to three instances:</span></div>
<div style="position:absolute;left:126.00px;top:491.71px" class="cls_024"><span class="cls_024">bash-4.4# kubectl scale --replicas=3 deployment/web</span></div>
<div style="position:absolute;left:126.00px;top:502.51px" class="cls_024"><span class="cls_024">deployment.extensions/web scaled</span></div>
<div style="position:absolute;left:108.00px;top:522.25px" class="cls_008"><span class="cls_008">And this is the result of the scale operation:</span></div>
<div style="position:absolute;left:126.00px;top:543.19px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get pods</span></div>
<div style="position:absolute;left:126.00px;top:553.99px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:244.80px;top:553.99px" class="cls_024"><span class="cls_024">READY  STATUS</span></div>
<div style="position:absolute;left:331.20px;top:553.99px" class="cls_024"><span class="cls_024">RESTARTS AGE</span></div>
<div style="position:absolute;left:126.00px;top:564.79px" class="cls_024"><span class="cls_024">db-6746668f6c-wdscl</span></div>
<div style="position:absolute;left:244.80px;top:564.79px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:282.60px;top:564.79px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:336.60px;top:564.79px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:564.79px" class="cls_024"><span class="cls_024">2h</span></div>
<div style="position:absolute;left:126.00px;top:575.59px" class="cls_024"><span class="cls_024">web-74dbc994bc-6f7qh</span></div>
<div style="position:absolute;left:244.80px;top:575.59px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:282.60px;top:575.59px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:336.60px;top:575.59px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:575.59px" class="cls_024"><span class="cls_024">14s</span></div>
<div style="position:absolute;left:126.00px;top:586.39px" class="cls_024"><span class="cls_024">web-74dbc994bc-l99bh</span></div>
<div style="position:absolute;left:244.80px;top:586.39px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:282.60px;top:586.39px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:336.60px;top:586.39px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:586.39px" class="cls_024"><span class="cls_024">1m</span></div>
<div style="position:absolute;left:126.00px;top:597.19px" class="cls_024"><span class="cls_024">web-74dbc994bc-rz8vs</span></div>
<div style="position:absolute;left:244.80px;top:597.19px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:282.60px;top:597.19px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:336.60px;top:597.19px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:597.19px" class="cls_024"><span class="cls_024">14s</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 257 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:218946px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background281.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the browser running the Pets application, refresh the view a few times and notice</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">that the ID of the container instance changes every so often. This is the Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">load balancer in action, distributing the calls to the different </span><span class="cls_010">web</span><span class="cls_008"> instances.</span></div>
<div style="position:absolute;left:165.37px;top:182.29px" class="cls_025"><span class="cls_025">The best way to get different instances of the web service is by opening</span></div>
<div style="position:absolute;left:165.37px;top:193.69px" class="cls_025"><span class="cls_025">several incognito browser windows.</span></div>
<div style="position:absolute;left:108.00px;top:236.35px" class="cls_022"><span class="cls_022">Scaling the number of cluster nodes</span></div>
<div style="position:absolute;left:108.00px;top:259.33px" class="cls_008"><span class="cls_008">So far, we have only worked with one cluster (worker) node. We can use the Azure</span></div>
<div style="position:absolute;left:108.00px;top:271.93px" class="cls_008"><span class="cls_008">CLI to increase the number of nodes and thus provide more computing power to our</span></div>
<div style="position:absolute;left:108.00px;top:284.53px" class="cls_008"><span class="cls_008">application. Let’s scale our cluster to three nodes:</span></div>
<div style="position:absolute;left:126.00px;top:305.47px" class="cls_024"><span class="cls_024">az aks scale --resource-group=pets-group --name=pets-cluster</span></div>
<div style="position:absolute;left:126.00px;top:316.27px" class="cls_024"><span class="cls_024">--node-count 3</span></div>
<div style="position:absolute;left:108.00px;top:336.01px" class="cls_008"><span class="cls_008">This will take a few minutes and, when done, you should see a response in the</span></div>
<div style="position:absolute;left:108.00px;top:348.61px" class="cls_008"><span class="cls_008">Terminal similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:369.55px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:136.80px;top:380.35px" class="cls_024"><span class="cls_024">“aadProfile”: null,</span></div>
<div style="position:absolute;left:136.80px;top:391.15px" class="cls_024"><span class="cls_024">“addonProfiles”: null,</span></div>
<div style="position:absolute;left:136.80px;top:401.95px" class="cls_024"><span class="cls_024">“agentPoolProfiles”: [</span></div>
<div style="position:absolute;left:147.60px;top:412.75px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:158.40px;top:423.55px" class="cls_024"><span class="cls_024">“count”: 3,</span></div>
<div style="position:absolute;left:158.40px;top:434.35px" class="cls_024"><span class="cls_024">“maxPods”: 110,</span></div>
<div style="position:absolute;left:158.40px;top:445.15px" class="cls_024"><span class="cls_024">“name”: “nodepool1”,</span></div>
<div style="position:absolute;left:131.40px;top:455.95px" class="cls_024"><span class="cls_024">“osDiskSizeGb”: null,</span></div>
<div style="position:absolute;left:131.40px;top:466.75px" class="cls_024"><span class="cls_024">“osType”: “Linux”,</span></div>
<div style="position:absolute;left:131.40px;top:477.55px" class="cls_024"><span class="cls_024">“storageProfile”: “ManagedDisks”,</span></div>
<div style="position:absolute;left:131.40px;top:488.35px" class="cls_024"><span class="cls_024">“vmSize”: “Standard_DS1_v2”,</span></div>
<div style="position:absolute;left:131.40px;top:499.15px" class="cls_024"><span class="cls_024">“vnetSubnetId”: null</span></div>
<div style="position:absolute;left:131.40px;top:509.95px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:131.40px;top:520.75px" class="cls_024"><span class="cls_024">],</span></div>
<div style="position:absolute;left:131.40px;top:531.55px" class="cls_024"><span class="cls_024">“dnsPrefix”: “pets-clust-pets-group-186760”,</span></div>
<div style="position:absolute;left:131.40px;top:542.35px" class="cls_024"><span class="cls_024">“enableRbac”: true,</span></div>
<div style="position:absolute;left:131.40px;top:553.15px" class="cls_024"><span class="cls_024">“fqdn”: “pets-clust-pets-group-186760-d706beb4.hcp.westeurope.azmk8s.</span></div>
<div style="position:absolute;left:126.00px;top:563.95px" class="cls_024"><span class="cls_024">io”,</span></div>
<div style="position:absolute;left:131.40px;top:574.75px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/186760ad-9152-4499-b317-xxxxxxxxxxxx/</span></div>
<div style="position:absolute;left:126.00px;top:585.55px" class="cls_024"><span class="cls_024">resourcegroups/pets-group/providers/Microsoft.ContainerService/</span></div>
<div style="position:absolute;left:126.00px;top:596.35px" class="cls_024"><span class="cls_024">managedClusters/pets-cluster”,</span></div>
<div style="position:absolute;left:131.40px;top:607.15px" class="cls_024"><span class="cls_024">“kubernetesVersion”: “1.9.9”,</span></div>
<div style="position:absolute;left:131.40px;top:617.95px" class="cls_024"><span class="cls_024">“linuxProfile”: {</span></div>
<div style="position:absolute;left:131.40px;top:628.75px" class="cls_024"><span class="cls_024">“adminUsername”: “azureuser”,</span></div>
<div style="position:absolute;left:131.40px;top:639.55px" class="cls_024"><span class="cls_024">“ssh”: {</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 258 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:219748px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background282.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:131.40px;top:114.01px" class="cls_024"><span class="cls_024">“publicKeys”: [</span></div>
<div style="position:absolute;left:131.40px;top:124.81px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:131.40px;top:135.61px" class="cls_024"><span class="cls_024">“keyData”: “ssh-rsa AAAAB3NzaC...”</span></div>
<div style="position:absolute;left:131.40px;top:146.41px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:131.40px;top:157.21px" class="cls_024"><span class="cls_024">]</span></div>
<div style="position:absolute;left:131.40px;top:168.01px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:131.40px;top:178.81px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:131.40px;top:189.61px" class="cls_024"><span class="cls_024">“location”: “westeurope”,</span></div>
<div style="position:absolute;left:131.40px;top:200.41px" class="cls_024"><span class="cls_024">“name”: “pets-cluster”,</span></div>
<div style="position:absolute;left:131.40px;top:211.21px" class="cls_024"><span class="cls_024">“networkProfile”: {</span></div>
<div style="position:absolute;left:131.40px;top:222.01px" class="cls_024"><span class="cls_024">“dnsServiceIp”: “10.0.0.10”,</span></div>
<div style="position:absolute;left:131.40px;top:232.81px" class="cls_024"><span class="cls_024">“dockerBridgeCidr”: “172.17.0.1/16”,</span></div>
<div style="position:absolute;left:131.40px;top:243.61px" class="cls_024"><span class="cls_024">“networkPlugin”: “kubenet”,</span></div>
<div style="position:absolute;left:131.40px;top:254.41px" class="cls_024"><span class="cls_024">“networkPolicy”: null,</span></div>
<div style="position:absolute;left:131.40px;top:265.21px" class="cls_024"><span class="cls_024">“podCidr”: “10.244.0.0/16”,</span></div>
<div style="position:absolute;left:131.40px;top:276.01px" class="cls_024"><span class="cls_024">“serviceCidr”: “10.0.0.0/16”</span></div>
<div style="position:absolute;left:131.40px;top:286.81px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:131.40px;top:297.61px" class="cls_024"><span class="cls_024">“nodeResourceGroup”: “MC_pets-group_pets-cluster_westeurope”,</span></div>
<div style="position:absolute;left:131.40px;top:308.41px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”,</span></div>
<div style="position:absolute;left:131.40px;top:319.21px" class="cls_024"><span class="cls_024">“resourceGroup”: “pets-group”,</span></div>
<div style="position:absolute;left:131.40px;top:330.01px" class="cls_024"><span class="cls_024">“servicePrincipalProfile”: {</span></div>
<div style="position:absolute;left:131.40px;top:340.81px" class="cls_024"><span class="cls_024">“clientId”: “a1a2bdbc-ba07-49bd-ae77-xxxxxxxxxxxx”,</span></div>
<div style="position:absolute;left:131.40px;top:351.61px" class="cls_024"><span class="cls_024">“secret”: null</span></div>
<div style="position:absolute;left:131.40px;top:362.41px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:131.40px;top:373.21px" class="cls_024"><span class="cls_024">“tags”: null,</span></div>
<div style="position:absolute;left:131.40px;top:384.01px" class="cls_024"><span class="cls_024">“type”: “Microsoft.ContainerService/ManagedClusters”</span></div>
<div style="position:absolute;left:126.00px;top:394.81px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:414.54px" class="cls_008"><span class="cls_008">We can verify the progress of the provisioning of the worker nodes using the</span></div>
<div style="position:absolute;left:108.00px;top:427.14px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:448.08px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get nodes --watch</span></div>
<div style="position:absolute;left:126.00px;top:458.88px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 Ready agent 1d v1.9.9</span></div>
<div style="position:absolute;left:126.00px;top:469.68px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-2 NotReady agent 0s v1.9.9</span></div>
<div style="position:absolute;left:126.00px;top:491.28px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 Ready agent 1d v1.9.9</span></div>
<div style="position:absolute;left:126.00px;top:502.08px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-2 Ready agent 2m v1.9.9</span></div>
<div style="position:absolute;left:126.00px;top:512.88px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-1 Ready agent 20s v1.9.9</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 259 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:220550px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background283.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Of course, the addition of extra worker nodes does not automatically redistribute the</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">service instances of our application. To achieve, this we need to scale, for example,</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">the </span><span class="cls_010">web</span><span class="cls_008"> service again:</span></div>
<div style="position:absolute;left:126.00px;top:160.63px" class="cls_024"><span class="cls_024">bash-4.4# kubectl scale --replicas=5 deployment/web</span></div>
<div style="position:absolute;left:126.00px;top:171.43px" class="cls_024"><span class="cls_024">deployment.extensions/web scaled</span></div>
<div style="position:absolute;left:108.00px;top:191.17px" class="cls_008"><span class="cls_008">We can now use the wide output to see on which nodes the pods have landed:</span></div>
<div style="position:absolute;left:126.00px;top:212.11px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get pods --output=’wide’</span></div>
<div style="position:absolute;left:126.00px;top:224.35px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:239.40px;top:224.35px" class="cls_024"><span class="cls_024">READY  STATUS</span></div>
<div style="position:absolute;left:325.80px;top:224.35px" class="cls_024"><span class="cls_024">RESTARTS  AGE</span></div>
<div style="position:absolute;left:412.20px;top:224.35px" class="cls_024"><span class="cls_024">IP</span></div>
<div style="position:absolute;left:126.00px;top:235.15px" class="cls_024"><span class="cls_024">NODE ...</span></div>
<div style="position:absolute;left:126.00px;top:245.95px" class="cls_024"><span class="cls_024">db-6746668f6c-wdscl</span></div>
<div style="position:absolute;left:239.40px;top:245.95px" class="cls_024"><span class="cls_024">1/1</span></div>
<div style="position:absolute;left:277.20px;top:245.95px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:245.95px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:245.95px" class="cls_024"><span class="cls_024">3h</span></div>
<div style="position:absolute;left:412.20px;top:245.95px" class="cls_024"><span class="cls_024">10.244.0.24</span></div>
<div style="position:absolute;left:126.00px;top:256.75px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 ...</span></div>
<div style="position:absolute;left:126.00px;top:267.55px" class="cls_024"><span class="cls_024">web-59545bb958-2v4zp 1/1</span></div>
<div style="position:absolute;left:277.20px;top:267.55px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:267.55px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:267.55px" class="cls_024"><span class="cls_024">2m</span></div>
<div style="position:absolute;left:412.20px;top:267.55px" class="cls_024"><span class="cls_024">10.244.1.3</span></div>
<div style="position:absolute;left:126.00px;top:278.35px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-2 ...</span></div>
<div style="position:absolute;left:126.00px;top:289.15px" class="cls_024"><span class="cls_024">web-59545bb958-7mpfx 1/1</span></div>
<div style="position:absolute;left:277.20px;top:289.15px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:289.15px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:289.15px" class="cls_024"><span class="cls_024">31m</span></div>
<div style="position:absolute;left:412.20px;top:289.15px" class="cls_024"><span class="cls_024">10.244.0.31</span></div>
<div style="position:absolute;left:126.00px;top:299.95px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 ...</span></div>
<div style="position:absolute;left:126.00px;top:310.75px" class="cls_024"><span class="cls_024">web-59545bb958-9mc6m 1/1</span></div>
<div style="position:absolute;left:277.20px;top:310.75px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:310.75px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:310.75px" class="cls_024"><span class="cls_024">2m</span></div>
<div style="position:absolute;left:412.20px;top:310.75px" class="cls_024"><span class="cls_024">10.244.1.2</span></div>
<div style="position:absolute;left:126.00px;top:321.55px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-2 ...</span></div>
<div style="position:absolute;left:126.00px;top:332.35px" class="cls_024"><span class="cls_024">web-59545bb958-sbctd 1/1</span></div>
<div style="position:absolute;left:277.20px;top:332.35px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:332.35px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:332.35px" class="cls_024"><span class="cls_024">35m</span></div>
<div style="position:absolute;left:412.20px;top:332.35px" class="cls_024"><span class="cls_024">10.244.0.29</span></div>
<div style="position:absolute;left:126.00px;top:343.15px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 ...</span></div>
<div style="position:absolute;left:126.00px;top:353.95px" class="cls_024"><span class="cls_024">web-59545bb958-tvthv 1/1</span></div>
<div style="position:absolute;left:277.20px;top:353.95px" class="cls_024"><span class="cls_024">Running</span></div>
<div style="position:absolute;left:325.80px;top:353.95px" class="cls_024"><span class="cls_024">0</span></div>
<div style="position:absolute;left:379.80px;top:353.95px" class="cls_024"><span class="cls_024">31m</span></div>
<div style="position:absolute;left:412.20px;top:353.95px" class="cls_024"><span class="cls_024">10.244.0.30</span></div>
<div style="position:absolute;left:126.00px;top:364.75px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 ...</span></div>
<div style="position:absolute;left:108.00px;top:384.49px" class="cls_008"><span class="cls_008">We can see that three pods are on the first and two (the additional ones) have been</span></div>
<div style="position:absolute;left:108.00px;top:397.09px" class="cls_008"><span class="cls_008">deployed to the third node.</span></div>
<div style="position:absolute;left:108.00px;top:429.59px" class="cls_011"><span class="cls_011">Monitoring the cluster and application</span></div>
<div style="position:absolute;left:108.00px;top:454.57px" class="cls_008"><span class="cls_008">In this section, we will show three different elements of our Kubernetes cluster. We</span></div>
<div style="position:absolute;left:108.00px;top:467.17px" class="cls_008"><span class="cls_008">will do the following:</span></div>
<div style="position:absolute;left:126.00px;top:488.42px" class="cls_008"><span class="cls_008">•  Monitor the container health</span></div>
<div style="position:absolute;left:126.00px;top:505.33px" class="cls_008"><span class="cls_008">•  View the logs of the Kubernetes masters</span></div>
<div style="position:absolute;left:126.00px;top:522.25px" class="cls_008"><span class="cls_008">•  View the logs of </span><span class="cls_010">kublets</span><span class="cls_008"> installed on each worker node</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 260 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:221352px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background284.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Creating a log analytics workspace</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">To store the monitoring and logging data produced by our cluster, we need a log</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">analytics workspace. We will use the Azure portal GUI to create one in our</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">pets-group resource group, with the following steps:</span></div>
<div style="position:absolute;left:126.00px;top:181.89px" class="cls_008"><span class="cls_008">1.  In the portal, click on the </span><span class="cls_009">+Create a resource</span><span class="cls_008"> option.</span></div>
<div style="position:absolute;left:126.00px;top:198.80px" class="cls_008"><span class="cls_008">2.  Select the </span><span class="cls_009">Log Analytics</span><span class="cls_008"> option and then </span><span class="cls_009">Create</span><span class="cls_008">. Enter the required data,</span></div>
<div style="position:absolute;left:143.99px;top:211.40px" class="cls_008"><span class="cls_008">similar to the one shown in the following screenshot:</span></div>
<div style="position:absolute;left:248.10px;top:592.21px" class="cls_026"><span class="cls_026">Create a log analytics workspace</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 261 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:222154px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background285.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">Once the workspace has been created, we should see it in the overview of our</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_010"><span class="cls_010">pets-group</span><span class="cls_008"> resource group:</span></div>
<div style="position:absolute;left:203.02px;top:351.36px" class="cls_026"><span class="cls_026">Log analytics workspace in the pets-group resource group</span></div>
<div style="position:absolute;left:126.00px;top:370.10px" class="cls_008"><span class="cls_008">3.  Click on the </span><span class="cls_010">pets-oms-workspace</span><span class="cls_008"> entry to see the details of the workspace:</span></div>
<div style="position:absolute;left:193.76px;top:566.50px" class="cls_026"><span class="cls_026">Detail view of the pets-oms-workspace log analytics workspace</span></div>
<div style="position:absolute;left:108.00px;top:585.24px" class="cls_008"><span class="cls_008">Note down </span><span class="cls_010">&lt;workspace ID></span><span class="cls_008"> of the workspace you just created, as we need it in the</span></div>
<div style="position:absolute;left:108.00px;top:597.84px" class="cls_008"><span class="cls_008">next section.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 262 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:222956px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background286.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Monitoring the container health</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Let’s use the Azure CLI to enable monitoring for </span><span class="cls_010">pets-cluster</span><span class="cls_008">. We could have</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">done this when we created the cluster, but it is also possible to do it at a later time.</span></div>
<div style="position:absolute;left:108.00px;top:169.29px" class="cls_008"><span class="cls_008">We use the Azure CLI once again to enable monitoring of our cluster. Use the</span></div>
<div style="position:absolute;left:108.00px;top:181.88px" class="cls_008"><span class="cls_008">following command to do so and make sure to replace </span><span class="cls_010">&lt;workspace ID></span><span class="cls_008"> with the ID</span></div>
<div style="position:absolute;left:108.00px;top:194.48px" class="cls_008"><span class="cls_008">of your workspace that you have just created:</span></div>
<div style="position:absolute;left:126.00px;top:215.42px" class="cls_024"><span class="cls_024">az aks enable-addons \</span></div>
<div style="position:absolute;left:147.60px;top:226.22px" class="cls_024"><span class="cls_024">-a monitoring \</span></div>
<div style="position:absolute;left:147.60px;top:237.02px" class="cls_024"><span class="cls_024">-g pets-group \</span></div>
<div style="position:absolute;left:147.60px;top:247.82px" class="cls_024"><span class="cls_024">-n pets-cluster \</span></div>
<div style="position:absolute;left:147.60px;top:258.62px" class="cls_024"><span class="cls_024">--workspace-resource-id &lt;workspace ID></span></div>
<div style="position:absolute;left:108.00px;top:278.36px" class="cls_008"><span class="cls_008">Please be patient as this command takes a while. It eventually should respond with</span></div>
<div style="position:absolute;left:108.00px;top:290.96px" class="cls_008"><span class="cls_008">the following (shortened for readability):</span></div>
<div style="position:absolute;left:126.00px;top:322.70px" class="cls_024"><span class="cls_024">“properties”: {</span></div>
<div style="position:absolute;left:136.80px;top:333.50px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”</span></div>
<div style="position:absolute;left:126.00px;top:344.30px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:108.00px;top:374.84px" class="cls_008"><span class="cls_008">Note that we could also have used the Azure portal GUI or an Azure Resource</span></div>
<div style="position:absolute;left:108.00px;top:387.44px" class="cls_008"><span class="cls_008">Manager template to enable monitoring.</span></div>
<div style="position:absolute;left:108.00px;top:408.69px" class="cls_008"><span class="cls_008">Monitoring is based on a </span><span class="cls_009">Log Analytics</span><span class="cls_008"> agent, which is running on each node</span></div>
<div style="position:absolute;left:108.00px;top:421.29px" class="cls_008"><span class="cls_008">of the Kubernetes cluster and will collect memory and processor metrics from</span></div>
<div style="position:absolute;left:108.00px;top:433.89px" class="cls_008"><span class="cls_008">all controllers, nodes, and containers that the native Kubernetes Metrics API is</span></div>
<div style="position:absolute;left:108.00px;top:446.49px" class="cls_008"><span class="cls_008">providing. The resulting metrics are collected by the agents and forwarded and</span></div>
<div style="position:absolute;left:108.00px;top:459.09px" class="cls_008"><span class="cls_008">stored in the Log Analytics workspace.</span></div>
<div style="position:absolute;left:108.00px;top:480.33px" class="cls_008"><span class="cls_008">Once we have enabled monitoring for our cluster, we can verify that the Log</span></div>
<div style="position:absolute;left:108.00px;top:492.92px" class="cls_008"><span class="cls_008">Analytics agent has been deployed into the </span><span class="cls_010">kube-system</span><span class="cls_008"> namespace once for each</span></div>
<div style="position:absolute;left:108.00px;top:505.52px" class="cls_008"><span class="cls_008">worker node (</span><span class="cls_010">3</span><span class="cls_008">):</span></div>
<div style="position:absolute;left:126.00px;top:526.46px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get ds omsagent --namespace=kube-system</span></div>
<div style="position:absolute;left:126.00px;top:537.26px" class="cls_024"><span class="cls_024">NAME</span></div>
<div style="position:absolute;left:180.00px;top:537.26px" class="cls_024"><span class="cls_024">DESIRED CURRENT READY UP-TO-DATE AVAILABLE</span></div>
<div style="position:absolute;left:126.00px;top:548.06px" class="cls_024"><span class="cls_024">NODE SELECTOR</span></div>
<div style="position:absolute;left:282.60px;top:548.06px" class="cls_024"><span class="cls_024">AGE</span></div>
<div style="position:absolute;left:126.00px;top:558.86px" class="cls_024"><span class="cls_024">omsagent</span></div>
<div style="position:absolute;left:185.40px;top:558.86px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:228.60px;top:558.86px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:271.80px;top:558.86px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:304.20px;top:558.86px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:358.20px;top:558.86px" class="cls_024"><span class="cls_024">3</span></div>
<div style="position:absolute;left:385.20px;top:558.86px" class="cls_024"><span class="cls_024">beta.kubernetes.io/</span></div>
<div style="position:absolute;left:126.00px;top:569.66px" class="cls_024"><span class="cls_024">os=linux</span></div>
<div style="position:absolute;left:180.00px;top:569.66px" class="cls_024"><span class="cls_024">1d</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 263 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:223758px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background287.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">We can now open the Azure portal to view the metrics of our cluster. Navigate to</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_009"><span class="cls_009">Resource groups</span><span class="cls_008"> | </span><span class="cls_009">pets-group</span><span class="cls_008"> | </span><span class="cls_009">pets-cluster</span><span class="cls_008"> and then click on the </span><span class="cls_009">Health (preview)</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">option to see a display similar to the following screenshot:</span></div>
<div style="position:absolute;left:245.15px;top:386.32px" class="cls_026"><span class="cls_026">Microsoft Azure AKS Health view</span></div>
<div style="position:absolute;left:108.00px;top:405.06px" class="cls_008"><span class="cls_008">In this view, we can see the aggregated metrics for the CPU and memory utilization</span></div>
<div style="position:absolute;left:108.00px;top:417.66px" class="cls_008"><span class="cls_008">as well as the node count and active pod count per cluster, node, controller,</span></div>
<div style="position:absolute;left:108.00px;top:430.26px" class="cls_008"><span class="cls_008">and container.</span></div>
<div style="position:absolute;left:108.00px;top:460.20px" class="cls_022"><span class="cls_022">Viewing the logs of Kubernetes masters</span></div>
<div style="position:absolute;left:108.00px;top:483.18px" class="cls_008"><span class="cls_008">By default, diagnostic logs are disabled, and we have to first turn them on. We can</span></div>
<div style="position:absolute;left:108.00px;top:495.78px" class="cls_008"><span class="cls_008">use our Log Analytics </span><span class="cls_010">pets-oms-workspace</span><span class="cls_008"> workspace as the target for the logs. To</span></div>
<div style="position:absolute;left:108.00px;top:508.38px" class="cls_008"><span class="cls_008">enable the diagnostic logs, we will use the Azure portal this time. Follow the steps:</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 264 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:224560px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background288.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">1.  Navigate to the </span><span class="cls_010">pets-group</span><span class="cls_008"> resource group and select the </span><span class="cls_009">Diagnostic</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_009"><span class="cls_009">settings</span><span class="cls_008"> option on the left side. You should see something like this:</span></div>
<div style="position:absolute;left:204.89px;top:468.11px" class="cls_026"><span class="cls_026">Diagnostic log settings for the resource group pets-group</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 265 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:225362px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background289.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">2.  Select the </span><span class="cls_010">pets-cluster</span><span class="cls_008"> entry and then click on the </span><span class="cls_009">Turn on diagnostics</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">link. Fill out the form with values similar to the one shown in the</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">following screenshot:</span></div>
<div style="position:absolute;left:208.37px;top:611.73px" class="cls_026"><span class="cls_026">Setting for the diagnostic logs of the Kubernetes cluster</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 266 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:226164px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background290.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.  Make sure that you select </span><span class="cls_009">Send to Log Analytics</span><span class="cls_008"> checkbox and select </span><span class="cls_010">pets-</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_010"><span class="cls_010">oms-workspace</span><span class="cls_008"> as the target for the logs.</span></div>
<div style="position:absolute;left:126.00px;top:144.01px" class="cls_008"><span class="cls_008">4.  Click on the </span><span class="cls_009">Save</span><span class="cls_008"> button to update the settings.</span></div>
<div style="position:absolute;left:108.00px;top:165.25px" class="cls_008"><span class="cls_008">Give the system a few minutes or hours to collect some relevant information before</span></div>
<div style="position:absolute;left:108.00px;top:177.85px" class="cls_008"><span class="cls_008">you proceed.</span></div>
<div style="position:absolute;left:108.00px;top:199.09px" class="cls_008"><span class="cls_008">To analyze the logs, navigate to the </span><span class="cls_010">pets-group</span><span class="cls_008"> resource group and select the</span></div>
<div style="position:absolute;left:108.00px;top:211.69px" class="cls_010"><span class="cls_010">pets-cluster</span><span class="cls_008"> entry. Then select the </span><span class="cls_009">Logs</span><span class="cls_008"> option on the left side and you will be</span></div>
<div style="position:absolute;left:108.00px;top:224.29px" class="cls_008"><span class="cls_008">presented with a view similar to the one shown in the followings screenshot:</span></div>
<div style="position:absolute;left:159.12px;top:433.90px" class="cls_026"><span class="cls_026">Analyze Logs generated by the Kubernetes cluster and the containers running on it</span></div>
<div style="position:absolute;left:108.00px;top:452.64px" class="cls_008"><span class="cls_008">In the preceding screenshot, we can see the default query that generated log</span></div>
<div style="position:absolute;left:108.00px;top:465.24px" class="cls_008"><span class="cls_008">entries produced by the </span><span class="cls_010">ssh-helper</span><span class="cls_008"> container running Kubernetes on node </span><span class="cls_010">aks-</span></div>
<div style="position:absolute;left:108.00px;top:477.84px" class="cls_010"><span class="cls_010">nodepool1-54489083-0</span><span class="cls_008">. This container will be introduced in the next section.</span></div>
<div style="position:absolute;left:108.00px;top:499.08px" class="cls_008"><span class="cls_008">We can now use the rich query language provided to us by Azures Log Analytics to</span></div>
<div style="position:absolute;left:108.00px;top:511.68px" class="cls_008"><span class="cls_008">get more insight into the vast amount of logging data.</span></div>
<div style="position:absolute;left:108.00px;top:541.62px" class="cls_022"><span class="cls_022">Viewing the kublet and container logs</span></div>
<div style="position:absolute;left:108.00px;top:564.60px" class="cls_008"><span class="cls_008">Sometimes it is necessary to investigate the logs of a kubelet on a particular node</span></div>
<div style="position:absolute;left:108.00px;top:577.20px" class="cls_008"><span class="cls_008">in the Kubernetes cluster. To do so, we need to establish an SSH connection to that</span></div>
<div style="position:absolute;left:108.00px;top:589.80px" class="cls_008"><span class="cls_008">particular node and can then use the Linux tool, </span><span class="cls_010">journalctl</span><span class="cls_008">, to access those logs.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 267 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:226966px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background291.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">First we need to find the node (or VM) of which we want to investigate the kublet’s</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">logs. Let’s list all the VMs that are part of our </span><span class="cls_010">pets-cluster</span><span class="cls_008"> cluster in the resource</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">group, </span><span class="cls_010">pets-group</span><span class="cls_008">, in the </span><span class="cls_010">westeurope</span><span class="cls_008"> region. Azure has implicitly created a</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">resource group called </span><span class="cls_010">MC_&lt;group name> _&lt;cluster name>_&lt;region name></span><span class="cls_008"> where</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">it put all the resources (including the VMs) of our Kubernetes cluster. Thus, in my</span></div>
<div style="position:absolute;left:108.00px;top:177.49px" class="cls_008"><span class="cls_008">case, the group name is </span><span class="cls_010">MC_pets-group_pets-cluster_westeurope</span><span class="cls_008">. Here is the</span></div>
<div style="position:absolute;left:108.00px;top:190.09px" class="cls_008"><span class="cls_008">command that gives me the list of VMs:</span></div>
<div style="position:absolute;left:126.00px;top:211.03px" class="cls_024"><span class="cls_024">bash-4.4# az vm list --resource-group MC_pets-group_pets-cluster_</span></div>
<div style="position:absolute;left:126.00px;top:221.83px" class="cls_024"><span class="cls_024">westeurope -o table</span></div>
<div style="position:absolute;left:126.00px;top:243.43px" class="cls_024"><span class="cls_024">Name</span></div>
<div style="position:absolute;left:261.00px;top:243.43px" class="cls_024"><span class="cls_024">ResourceGroup</span></div>
<div style="position:absolute;left:126.00px;top:254.23px" class="cls_024"><span class="cls_024">Location</span></div>
<div style="position:absolute;left:185.40px;top:254.23px" class="cls_024"><span class="cls_024">Zones</span></div>
<div style="position:absolute;left:126.00px;top:265.03px" class="cls_024"><span class="cls_024">------------------------ ------------------------------------- ------</span></div>
<div style="position:absolute;left:126.00px;top:275.83px" class="cls_024"><span class="cls_024">---- -------</span></div>
<div style="position:absolute;left:126.00px;top:286.63px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0 MC_pets-group_pets-cluster_westeurope</span></div>
<div style="position:absolute;left:126.00px;top:297.43px" class="cls_024"><span class="cls_024">westeurope</span></div>
<div style="position:absolute;left:108.00px;top:317.17px" class="cls_008"><span class="cls_008">We can now add the public SSH keys that we use to connect to the cluster through</span></div>
<div style="position:absolute;left:108.00px;top:329.77px" class="cls_008"><span class="cls_008">the Azure CLI to this VM (with the name </span><span class="cls_010">aks-nodepool1-54489083-0</span><span class="cls_008">) with the</span></div>
<div style="position:absolute;left:108.00px;top:342.37px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:363.31px" class="cls_024"><span class="cls_024">bash-4.4# az vm user update \</span></div>
<div style="position:absolute;left:131.40px;top:374.11px" class="cls_024"><span class="cls_024">--resource-group MC_pets-group_pets-cluster_westeurope \</span></div>
<div style="position:absolute;left:131.40px;top:384.91px" class="cls_024"><span class="cls_024">--name aks-nodepool1-54489083-0 \</span></div>
<div style="position:absolute;left:131.40px;top:395.71px" class="cls_024"><span class="cls_024">--username azureuser \</span></div>
<div style="position:absolute;left:131.40px;top:406.51px" class="cls_024"><span class="cls_024">--ssh-key-value ~/.ssh/id_rsa.pub</span></div>
<div style="position:absolute;left:108.00px;top:426.25px" class="cls_008"><span class="cls_008">Now we need to get the address of this VM and can do so with this command:</span></div>
<div style="position:absolute;left:126.00px;top:447.19px" class="cls_024"><span class="cls_024">bash-4.4# az vm list-ip-addresses --resource-group MC_pets-group_pets-</span></div>
<div style="position:absolute;left:126.00px;top:457.99px" class="cls_024"><span class="cls_024">cluster_westeurope -o table</span></div>
<div style="position:absolute;left:126.00px;top:479.59px" class="cls_024"><span class="cls_024">VirtualMachine</span></div>
<div style="position:absolute;left:266.40px;top:479.59px" class="cls_024"><span class="cls_024">PrivateIPAddresses</span></div>
<div style="position:absolute;left:126.00px;top:490.39px" class="cls_024"><span class="cls_024">------------------------</span></div>
<div style="position:absolute;left:266.40px;top:490.39px" class="cls_024"><span class="cls_024">--------------------</span></div>
<div style="position:absolute;left:126.00px;top:501.19px" class="cls_024"><span class="cls_024">aks-nodepool1-54489083-0</span></div>
<div style="position:absolute;left:266.40px;top:501.19px" class="cls_024"><span class="cls_024">10.240.0.4</span></div>
<div style="position:absolute;left:108.00px;top:520.93px" class="cls_008"><span class="cls_008">Having all this information, we need a way to SSH into this VM. We cannot just</span></div>
<div style="position:absolute;left:108.00px;top:533.53px" class="cls_008"><span class="cls_008">do this directly from our local workstation without additional hassles, but an easy</span></div>
<div style="position:absolute;left:108.00px;top:546.13px" class="cls_008"><span class="cls_008">way is to run a helper container (called </span><span class="cls_010">ssh-helper</span><span class="cls_008">) in the Kubernetes cluster</span></div>
<div style="position:absolute;left:107.99px;top:558.73px" class="cls_008"><span class="cls_008">interactively from which we can then SSH into the VM. Let’s start such a helper</span></div>
<div style="position:absolute;left:107.99px;top:571.33px" class="cls_008"><span class="cls_008">container using the </span><span class="cls_010">kubectl</span><span class="cls_008"> command:</span></div>
<div style="position:absolute;left:126.00px;top:592.27px" class="cls_024"><span class="cls_024">bash-4.4# kubectl run -it --rm ssh-helper --image=debian</span></div>
<div style="position:absolute;left:126.00px;top:603.07px" class="cls_024"><span class="cls_024">root@ssh-helper-86966767d-v2xqg:/#</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 268 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:227768px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background292.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This container does not have an SSH client installed. Let’s do this now. Inside this</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_010"><span class="cls_010">helper</span><span class="cls_008"> container run the following command:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">root@ssh-helper-86966767d-v2xqg:/# apt-get update && apt-get install</span></div>
<div style="position:absolute;left:126.00px;top:158.83px" class="cls_024"><span class="cls_024">openssh-client -y</span></div>
<div style="position:absolute;left:108.00px;top:178.57px" class="cls_008"><span class="cls_008">In another Terminal, we can attach to our Azure CLI container as follows:</span></div>
<div style="position:absolute;left:126.00px;top:199.51px" class="cls_024"><span class="cls_024">$ docker container exec azure-cli /bin/bash</span></div>
<div style="position:absolute;left:108.00px;top:219.25px" class="cls_008"><span class="cls_008">Then, inside the container, run the following command to see all running pods</span></div>
<div style="position:absolute;left:108.00px;top:231.85px" class="cls_008"><span class="cls_008">in our cluster:</span></div>
<div style="position:absolute;left:126.00px;top:252.79px" class="cls_024"><span class="cls_024">bash-4.4# kubectl get pods</span></div>
<div style="position:absolute;left:108.00px;top:272.53px" class="cls_008"><span class="cls_008">Here is the result of running the preceding command:</span></div>
<div style="position:absolute;left:217.07px;top:390.64px" class="cls_026"><span class="cls_026">SSH helper pod running in our Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:409.38px" class="cls_008"><span class="cls_008">The next step is to copy our private SSH key into the pod to the expected location.</span></div>
<div style="position:absolute;left:108.00px;top:421.98px" class="cls_008"><span class="cls_008">We can use this command to do so:</span></div>
<div style="position:absolute;left:126.00px;top:442.92px" class="cls_024"><span class="cls_024">bash-4.4# kubectl cp ~/.ssh/id_rsa ssh-helper-86966767d-v2xqg:/id_rsa</span></div>
<div style="position:absolute;left:108.00px;top:462.66px" class="cls_008"><span class="cls_008">From within the </span><span class="cls_010">helper</span><span class="cls_008"> container, we now need to change the access rights to this</span></div>
<div style="position:absolute;left:108.00px;top:475.26px" class="cls_008"><span class="cls_008">SSH key using this command:</span></div>
<div style="position:absolute;left:126.00px;top:496.20px" class="cls_024"><span class="cls_024">root@ssh-helper-86966767d-v2xqg:/# chmod 0600 id_rsa</span></div>
<div style="position:absolute;left:108.00px;top:515.94px" class="cls_008"><span class="cls_008">Finally, we’re ready to SSH into the target VM:</span></div>
<div style="position:absolute;left:126.00px;top:536.88px" class="cls_024"><span class="cls_024">root@ssh-helper-86966767d-v2xqg:/# ssh -i id_rsa azureuser@10.240.0.4</span></div>
<div style="position:absolute;left:108.00px;top:556.62px" class="cls_008"><span class="cls_008">We should then see something similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:577.56px" class="cls_024"><span class="cls_024">The authenticity of host ‘10.240.0.4 (10.240.0.4)’ can’t be</span></div>
<div style="position:absolute;left:126.00px;top:588.36px" class="cls_024"><span class="cls_024">established.</span></div>
<div style="position:absolute;left:126.00px;top:599.16px" class="cls_024"><span class="cls_024">ECDSA key fingerprint is SHA256:pl03ZLFd0pkkPTtzDphSXCuNl0npBJO1JmU</span></div>
<div style="position:absolute;left:126.00px;top:609.96px" class="cls_024"><span class="cls_024">iLI5aSzY.Are you sure you want to continue connecting (yes/no)? yes</span></div>
<div style="position:absolute;left:126.00px;top:620.76px" class="cls_024"><span class="cls_024">Warning: Permanently added ‘10.240.0.4’ (ECDSA) to the list of known</span></div>
<div style="position:absolute;left:126.00px;top:631.56px" class="cls_024"><span class="cls_024">hosts.Welcome to Ubuntu 16.04.5 LTS (GNU/Linux 4.15.0-1021-azure</span></div>
<div style="position:absolute;left:126.00px;top:642.36px" class="cls_024"><span class="cls_024">x86_64)</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 269 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:228570px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background293.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:131.40px;top:114.01px" class="cls_024"><span class="cls_024">* Documentation: </span><A HREF="https://help.ubuntu.com/">https://help.ubuntu.com</A><span class="cls_024"> * Management: <A HREF="https://">https://</A> </div>
<div style="position:absolute;left:126.00px;top:124.81px" class="cls_024"><span class="cls_024">landscape.canonical.com</span></div>
<div style="position:absolute;left:131.40px;top:135.61px" class="cls_024"><span class="cls_024">* Support: </span><A HREF="https://ubuntu.com/advantage/">https://ubuntu.com/advantage</A> </div>
<div style="position:absolute;left:136.80px;top:157.21px" class="cls_024"><span class="cls_024">Get cloud support with Ubuntu Advantage Cloud Guest:</span></div>
<div style="position:absolute;left:147.60px;top:168.01px" class="cls_024"><span class="cls_024"> </span><A HREF="http://www.ubuntu.com/business/services/cloud/">http://www.ubuntu.com/business/services/cloud</A> </div>
<div style="position:absolute;left:126.00px;top:189.61px" class="cls_024"><span class="cls_024">3 packages can be updated.</span></div>
<div style="position:absolute;left:126.00px;top:200.41px" class="cls_024"><span class="cls_024">0 updates are security updates.</span></div>
<div style="position:absolute;left:126.00px;top:232.81px" class="cls_024"><span class="cls_024">*** System restart required ***</span></div>
<div style="position:absolute;left:126.00px;top:254.41px" class="cls_024"><span class="cls_024">The programs included with the Ubuntu system are free software;</span></div>
<div style="position:absolute;left:126.00px;top:265.21px" class="cls_024"><span class="cls_024">the exact distribution terms for each program are described in the</span></div>
<div style="position:absolute;left:126.00px;top:276.01px" class="cls_024"><span class="cls_024">individual files in /usr/share/doc/*/copyright.</span></div>
<div style="position:absolute;left:126.00px;top:297.61px" class="cls_024"><span class="cls_024">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span></div>
<div style="position:absolute;left:126.00px;top:308.41px" class="cls_024"><span class="cls_024">applicable law.</span></div>
<div style="position:absolute;left:126.00px;top:330.01px" class="cls_024"><span class="cls_024">To run a command as administrator (user “root”), use “sudo &lt;command>”.</span></div>
<div style="position:absolute;left:126.00px;top:340.81px" class="cls_024"><span class="cls_024">See “man sudo_root” for details.</span></div>
<div style="position:absolute;left:126.00px;top:362.41px" class="cls_024"><span class="cls_024">azureuser@aks-nodepool1-54489083-0:~$</span></div>
<div style="position:absolute;left:108.00px;top:377.82px" class="cls_008"><span class="cls_008">And we’re in! We can now access the desired node of our Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:390.42px" class="cls_008"><span class="cls_008">cluster remotely.</span></div>
<div style="position:absolute;left:165.37px;top:427.12px" class="cls_025"><span class="cls_025">What we just showed, to access the cluster over a helper container or pod,</span></div>
<div style="position:absolute;left:165.37px;top:438.52px" class="cls_025"><span class="cls_025">is a well established way of debugging a remote and secured Kubernetes</span></div>
<div style="position:absolute;left:165.37px;top:449.92px" class="cls_025"><span class="cls_025">cluster.</span></div>
<div style="position:absolute;left:108.00px;top:482.30px" class="cls_008"><span class="cls_008">Now that we’re finally on the VM, using SSH, we can get access to the logs of the</span></div>
<div style="position:absolute;left:108.00px;top:494.90px" class="cls_008"><span class="cls_008">local kubelet. Do this with the following command:</span></div>
<div style="position:absolute;left:126.00px;top:511.52px" class="cls_024"><span class="cls_024">azureuser@aks-nodepool1-54489083-0:~$ sudo journalctl -u kubelet -o</span></div>
<div style="position:absolute;left:126.00px;top:522.32px" class="cls_024"><span class="cls_024">cat</span></div>
<div style="position:absolute;left:108.00px;top:542.06px" class="cls_008"><span class="cls_008">And we should see something along the lines of this (shortened):</span></div>
<div style="position:absolute;left:126.00px;top:558.68px" class="cls_024"><span class="cls_024">Stopped Kubelet.</span></div>
<div style="position:absolute;left:126.00px;top:569.48px" class="cls_024"><span class="cls_024">Starting Kubelet...</span></div>
<div style="position:absolute;left:126.00px;top:580.28px" class="cls_024"><span class="cls_024">net.ipv4.tcp_retries2 = 8</span></div>
<div style="position:absolute;left:126.00px;top:591.08px" class="cls_024"><span class="cls_024">Bridge table: nat</span></div>
<div style="position:absolute;left:126.00px;top:601.88px" class="cls_024"><span class="cls_024">Bridge chain: PREROUTING, entries: 0, policy: ACCEPT</span></div>
<div style="position:absolute;left:126.00px;top:612.68px" class="cls_024"><span class="cls_024">Bridge chain: OUTPUT, entries: 0, policy: ACCEPT</span></div>
<div style="position:absolute;left:126.00px;top:623.48px" class="cls_024"><span class="cls_024">Bridge chain: POSTROUTING, entries: 0, policy: ACCEPT</span></div>
<div style="position:absolute;left:126.00px;top:634.28px" class="cls_024"><span class="cls_024">Chain PREROUTING (policy ACCEPT)</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 270 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:229372px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background294.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:126.00px;top:114.01px" class="cls_024"><span class="cls_024">I0831 08:30:52.872882 8787 server.go:182] Version: v1.9.9</span></div>
<div style="position:absolute;left:126.00px;top:124.81px" class="cls_024"><span class="cls_024">I0831 08:30:52.873306 8787 feature_gate.go:226] feature gates: &{{}</span></div>
<div style="position:absolute;left:126.00px;top:135.61px" class="cls_024"><span class="cls_024">map[]}</span></div>
<div style="position:absolute;left:126.00px;top:146.41px" class="cls_024"><span class="cls_024">I0831 08:30:54.082665 8787 mount_linux.go:210] Detected OS with</span></div>
<div style="position:absolute;left:126.00px;top:157.21px" class="cls_024"><span class="cls_024">systemd</span></div>
<div style="position:absolute;left:126.00px;top:168.01px" class="cls_024"><span class="cls_024">W0831 08:30:54.083717 8787 cni.go:171] Unable to update cni config: No</span></div>
<div style="position:absolute;left:126.00px;top:178.81px" class="cls_024"><span class="cls_024">networks found in /etc/cni/net.d</span></div>
<div style="position:absolute;left:126.00px;top:189.61px" class="cls_024"><span class="cls_024">I0831 08:30:54.091357 8787 azure.go:249] azure: using client_</span></div>
<div style="position:absolute;left:126.00px;top:200.41px" class="cls_024"><span class="cls_024">id+client_secret to retrieve access token</span></div>
<div style="position:absolute;left:126.00px;top:211.21px" class="cls_024"><span class="cls_024">I0831 08:30:54.091777 8787 azure.go:382] Azure cloudprovider using</span></div>
<div style="position:absolute;left:126.00px;top:222.01px" class="cls_024"><span class="cls_024">rate limit config: QPS=3, bucket=10</span></div>
<div style="position:absolute;left:108.00px;top:252.54px" class="cls_008"><span class="cls_008">In a similar way, we can now access the logs of any of the containers running</span></div>
<div style="position:absolute;left:108.00px;top:265.14px" class="cls_008"><span class="cls_008">on this node. To list all containers running on our web frontend, execute the</span></div>
<div style="position:absolute;left:108.00px;top:277.74px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:298.68px" class="cls_024"><span class="cls_024">azureuser@aks-nodepool1-54489083-0:~$ docker container ls | grep pets-</span></div>
<div style="position:absolute;left:126.00px;top:309.48px" class="cls_024"><span class="cls_024">web</span></div>
<div style="position:absolute;left:126.00px;top:331.08px" class="cls_024"><span class="cls_024">614b6d27dc13</span></div>
<div style="position:absolute;left:234.00px;top:331.08px" class="cls_024"><span class="cls_024">gnspetsregistry.azurecr.io/pets-web@</span></div>
<div style="position:absolute;left:126.00px;top:341.88px" class="cls_024"><span class="cls_024">sha256:43d3f3b3...</span></div>
<div style="position:absolute;left:126.00px;top:352.68px" class="cls_024"><span class="cls_024">493341aff54a</span></div>
<div style="position:absolute;left:234.00px;top:352.68px" class="cls_024"><span class="cls_024">gnspetsregistry.azurecr.io/pets-web@</span></div>
<div style="position:absolute;left:126.00px;top:363.48px" class="cls_024"><span class="cls_024">sha256:43d3f3b3...</span></div>
<div style="position:absolute;left:126.00px;top:374.28px" class="cls_024"><span class="cls_024">f5b730aa1449</span></div>
<div style="position:absolute;left:234.00px;top:374.28px" class="cls_024"><span class="cls_024">gnspetsregistry.azurecr.io/pets-web@</span></div>
<div style="position:absolute;left:126.00px;top:385.08px" class="cls_024"><span class="cls_024">sha256:43d3f3b3...</span></div>
<div style="position:absolute;left:108.00px;top:404.82px" class="cls_008"><span class="cls_008">Apparently, I have three instances running on this node. Let’s analyze the logs of the</span></div>
<div style="position:absolute;left:108.00px;top:417.42px" class="cls_008"><span class="cls_008">first one:</span></div>
<div style="position:absolute;left:126.00px;top:438.36px" class="cls_024"><span class="cls_024">azureuser@aks-nodepool1-54489083-0:~$ docker container logs</span></div>
<div style="position:absolute;left:126.00px;top:449.16px" class="cls_024"><span class="cls_024">614b6d27dc13</span></div>
<div style="position:absolute;left:126.00px;top:470.76px" class="cls_024"><span class="cls_024">Listening at 0.0.0.0:80</span></div>
<div style="position:absolute;left:126.00px;top:481.56px" class="cls_024"><span class="cls_024">Connecting to DB</span></div>
<div style="position:absolute;left:126.00px;top:492.36px" class="cls_024"><span class="cls_024">Connected!</span></div>
<div style="position:absolute;left:126.00px;top:503.16px" class="cls_024"><span class="cls_024"> </span><A HREF="http://upload.wikimedia.org/wikipedia/commons/d/dc/cats_petunia_and_/">http://upload.wikimedia.org/wikipedia/commons/d/dc/Cats_Petunia_and_</A> </div>
<div style="position:absolute;left:126.00px;top:513.96px" class="cls_024"><span class="cls_024">Mimosa_2004.jpg</span></div>
<div style="position:absolute;left:126.00px;top:524.76px" class="cls_024"><span class="cls_024">Connecting to DB</span></div>
<div style="position:absolute;left:126.00px;top:535.56px" class="cls_024"><span class="cls_024">Connected!</span></div>
<div style="position:absolute;left:126.00px;top:546.36px" class="cls_024"><span class="cls_024"> </span><A HREF="https://upload.wikimedia.org/wikipedia/commons/9/9e/green_eyes_kitten./">https://upload.wikimedia.org/wikipedia/commons/9/9e/Green_eyes_kitten.</A> </div>
<div style="position:absolute;left:126.00px;top:557.16px" class="cls_024"><span class="cls_024">jpg</span></div>
<div style="position:absolute;left:176.76px;top:592.12px" class="cls_025"><span class="cls_025">Keep in mind though that the technique shown here can be</span></div>
<div style="position:absolute;left:176.76px;top:603.52px" class="cls_025"><span class="cls_025">potentially dangerous since we just got root access to the cluster</span></div>
<div style="position:absolute;left:176.76px;top:614.92px" class="cls_025"><span class="cls_025">node. Use this technique only on non-production systems, or</span></div>
<div style="position:absolute;left:176.76px;top:626.32px" class="cls_025"><span class="cls_025">in an emergency if there is no better way to access the relevant</span></div>
<div style="position:absolute;left:176.76px;top:637.72px" class="cls_025"><span class="cls_025">information.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 271 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:230174px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background295.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Upgrading the application with zero downtime</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">Now that we have the Pets application successfully running in the cloud, we are</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">getting some requests for change. Users seem to not particularly like the background</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">color of our application. Let’s change that and then roll out the changes in a fashion</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">that causes zero downtime to the application.</span></div>
<div style="position:absolute;left:108.00px;top:194.49px" class="cls_008"><span class="cls_008">In the following steps, we will first do the code change in our project, then build a</span></div>
<div style="position:absolute;left:108.00px;top:207.09px" class="cls_008"><span class="cls_008">new version of the corresponding container image, push it to the ACR, and deploy it</span></div>
<div style="position:absolute;left:108.00px;top:219.69px" class="cls_008"><span class="cls_008">from there:</span></div>
<div style="position:absolute;left:126.00px;top:240.93px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:143.99px;top:240.92px" class="cls_008"><span class="cls_008">In the </span><span class="cls_010">ch12/web/src</span><span class="cls_008"> folder of the </span><span class="cls_010">labs</span><span class="cls_008"> folder, locate the </span><span class="cls_010">main.css</span><span class="cls_008"> file and</span></div>
<div style="position:absolute;left:144.00px;top:253.52px" class="cls_008"><span class="cls_008">open it in your editor</span></div>
<div style="position:absolute;left:126.01px;top:270.44px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:270.44px" class="cls_008"><span class="cls_008">Change the </span><span class="cls_010">background</span><span class="cls_008"> color of the body element to a color of your liking,</span></div>
<div style="position:absolute;left:144.00px;top:283.04px" class="cls_008"><span class="cls_008">such as </span><span class="cls_010">lightgreen</span></div>
<div style="position:absolute;left:126.00px;top:299.96px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:299.96px" class="cls_008"><span class="cls_008">Save the changes</span></div>
<div style="position:absolute;left:126.00px;top:316.88px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:316.88px" class="cls_008"><span class="cls_008">From within the Azure CLI container build, tag and push the new version </span><span class="cls_010">v2</span></div>
<div style="position:absolute;left:144.00px;top:329.48px" class="cls_008"><span class="cls_008">of the </span><span class="cls_010">pets-web</span><span class="cls_008"> container:</span></div>
<div style="position:absolute;left:165.60px;top:346.10px" class="cls_024"><span class="cls_024">docker image build -t pets-web:v2 /src/web</span></div>
<div style="position:absolute;left:165.60px;top:356.90px" class="cls_024"><span class="cls_024">docker image tag pets-web:v2 gnspetsregistry.azurecr.io/pets-</span></div>
<div style="position:absolute;left:165.60px;top:367.70px" class="cls_024"><span class="cls_024">web:v2</span></div>
<div style="position:absolute;left:165.60px;top:378.50px" class="cls_024"><span class="cls_024">docker push gnspetsregistry.azurecr.io/pets-web:v2</span></div>
<div style="position:absolute;left:126.00px;top:398.24px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:398.24px" class="cls_008"><span class="cls_008">Once the new version of the Docker image of the </span><span class="cls_010">web</span><span class="cls_008"> service is in the ACR,</span></div>
<div style="position:absolute;left:144.00px;top:410.84px" class="cls_008"><span class="cls_008">we can issue the update command for the </span><span class="cls_010">web</span><span class="cls_008"> service:</span></div>
<div style="position:absolute;left:165.60px;top:427.46px" class="cls_024"><span class="cls_024">kubectl set image deployment web web=gnspetsregistry.azurecr.</span></div>
<div style="position:absolute;left:165.60px;top:438.26px" class="cls_024"><span class="cls_024">io/pets-web:v2</span></div>
<div style="position:absolute;left:126.00px;top:458.00px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:144.00px;top:458.00px" class="cls_008"><span class="cls_008">During the (rolling) update, we can monitor the pods:</span></div>
<div style="position:absolute;left:165.60px;top:474.62px" class="cls_024"><span class="cls_024">kubectl get pods --output=’wide’ --watch</span></div>
<div style="position:absolute;left:144.00px;top:494.36px" class="cls_008"><span class="cls_008">In the </span><span class="cls_010">pets.yaml</span><span class="cls_008"> manifest, we have defined that the </span><span class="cls_010">maxSurge</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:144.00px;top:506.96px" class="cls_010"><span class="cls_010">maxUnavailable</span><span class="cls_008"> values are each 1. This means that one pod at a time is</span></div>
<div style="position:absolute;left:144.00px;top:519.56px" class="cls_008"><span class="cls_008">updated so that always at least four (5-1=4) pods are available at any given</span></div>
<div style="position:absolute;left:144.00px;top:532.16px" class="cls_008"><span class="cls_008">time and thus the application is always fully functional.</span></div>
<div style="position:absolute;left:126.00px;top:553.41px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:144.00px;top:553.41px" class="cls_008"><span class="cls_008">Refresh the browser window with the Pets application running, and verify</span></div>
<div style="position:absolute;left:144.00px;top:566.01px" class="cls_008"><span class="cls_008">that the background color has indeed changed to the new value.</span></div>
<div style="position:absolute;left:168.97px;top:601.76px" class="cls_025"><span class="cls_025">The new pods are now nicely distributed among the three worker nodes</span></div>
<div style="position:absolute;left:168.97px;top:613.16px" class="cls_025"><span class="cls_025">of the Kubernetes cluster.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 272 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:230976px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background296.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Upgrading Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">We noted earlier that the version of Kubernetes (</span><span class="cls_010">v1.9.9</span><span class="cls_008">) installed on our cluster</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">nodes is pretty outdated. It is now time to demonstrate how we can upgrade</span></div>
<div style="position:absolute;left:108.00px;top:160.64px" class="cls_008"><span class="cls_008">Kubernetes without causing any downtime to the Pets application. Note, we can only</span></div>
<div style="position:absolute;left:108.00px;top:173.24px" class="cls_008"><span class="cls_008">upgrade Kubernetes in steps; that is, one minor version at a time. We can find out</span></div>
<div style="position:absolute;left:108.00px;top:185.84px" class="cls_008"><span class="cls_008">which versions are available to us to upgrade to with this command:</span></div>
<div style="position:absolute;left:126.00px;top:206.78px" class="cls_024"><span class="cls_024">az aks get-upgrades --resource-group pets-group --name pets-cluster</span></div>
<div style="position:absolute;left:126.00px;top:217.58px" class="cls_024"><span class="cls_024">--output table</span></div>
<div style="position:absolute;left:108.00px;top:237.32px" class="cls_008"><span class="cls_008">The output generated by the command should look similar to this:</span></div>
<div style="position:absolute;left:126.00px;top:258.26px" class="cls_024"><span class="cls_024">Name</span></div>
<div style="position:absolute;left:169.20px;top:258.26px" class="cls_024"><span class="cls_024">ResourceGroup</span></div>
<div style="position:absolute;left:255.60px;top:258.26px" class="cls_024"><span class="cls_024">MasterVersion</span></div>
<div style="position:absolute;left:342.00px;top:258.26px" class="cls_024"><span class="cls_024">NodePoolVersion</span></div>
<div style="position:absolute;left:439.20px;top:258.26px" class="cls_024"><span class="cls_024">Upgrades</span></div>
<div style="position:absolute;left:126.00px;top:269.06px" class="cls_024"><span class="cls_024">------- --------------- --------------- ----------------- ------------</span></div>
<div style="position:absolute;left:126.00px;top:279.86px" class="cls_024"><span class="cls_024">------------------</span></div>
<div style="position:absolute;left:126.00px;top:290.66px" class="cls_024"><span class="cls_024">default pets-group</span></div>
<div style="position:absolute;left:255.60px;top:290.66px" class="cls_024"><span class="cls_024">1.9.9</span></div>
<div style="position:absolute;left:342.00px;top:290.66px" class="cls_024"><span class="cls_024">1.9.9</span></div>
<div style="position:absolute;left:439.20px;top:290.66px" class="cls_024"><span class="cls_024">1.9.10,</span></div>
<div style="position:absolute;left:126.00px;top:301.46px" class="cls_024"><span class="cls_024">1.10.3, 1.10.5, 1.10.6</span></div>
<div style="position:absolute;left:108.00px;top:321.20px" class="cls_008"><span class="cls_008">Since we are currently on version </span><span class="cls_010">v1.9.9</span><span class="cls_008">, we can only upgrade in the same minor</span></div>
<div style="position:absolute;left:108.00px;top:333.80px" class="cls_008"><span class="cls_008">version </span><span class="cls_010">9</span><span class="cls_008"> or to one of the versions </span><span class="cls_010">v1.10.x</span><span class="cls_008">. Once we’re on version </span><span class="cls_010">v1.10.x</span><span class="cls_008">, we can</span></div>
<div style="position:absolute;left:108.00px;top:346.40px" class="cls_008"><span class="cls_008">then upgrade to </span><span class="cls_010">v1.11.x</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:108.00px;top:367.64px" class="cls_008"><span class="cls_008">Let’s upgrade our cluster to version </span><span class="cls_010">v1.10.6</span><span class="cls_008">:</span></div>
<div style="position:absolute;left:126.00px;top:388.58px" class="cls_024"><span class="cls_024">az aks upgrade --resource-group pets-group --name pets-cluster</span></div>
<div style="position:absolute;left:126.00px;top:399.38px" class="cls_024"><span class="cls_024">--kubernetes-version 1.10.6</span></div>
<div style="position:absolute;left:108.00px;top:419.12px" class="cls_008"><span class="cls_008">The upgrade will happen node by node, guaranteeing that the applications running</span></div>
<div style="position:absolute;left:108.00px;top:431.72px" class="cls_008"><span class="cls_008">on the cluster are always operational. The whole upgrade takes a few minutes. We</span></div>
<div style="position:absolute;left:108.00px;top:444.32px" class="cls_008"><span class="cls_008">can observe the progress using the following command:</span></div>
<div style="position:absolute;left:126.00px;top:465.26px" class="cls_024"><span class="cls_024">kubectl get nodes --watch</span></div>
<div style="position:absolute;left:108.00px;top:485.00px" class="cls_008"><span class="cls_008">We should see how one node at a time is drained and then disabled before it is</span></div>
<div style="position:absolute;left:108.00px;top:497.60px" class="cls_008"><span class="cls_008">upgraded and made ready again.</span></div>
<div style="position:absolute;left:108.00px;top:518.85px" class="cls_008"><span class="cls_008">Once it’s finished, an output similar to this one will be generated:</span></div>
<div style="position:absolute;left:126.00px;top:539.78px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:136.80px;top:550.58px" class="cls_024"><span class="cls_024">“aadProfile”: null,</span></div>
<div style="position:absolute;left:136.80px;top:561.38px" class="cls_024"><span class="cls_024">“addonProfiles”: null,</span></div>
<div style="position:absolute;left:136.80px;top:572.18px" class="cls_024"><span class="cls_024">“agentPoolProfiles”: [</span></div>
<div style="position:absolute;left:147.60px;top:582.98px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:158.40px;top:593.78px" class="cls_024"><span class="cls_024">“count”: 3,</span></div>
<div style="position:absolute;left:158.40px;top:604.58px" class="cls_024"><span class="cls_024">“maxPods”: 110,</span></div>
<div style="position:absolute;left:158.40px;top:615.38px" class="cls_024"><span class="cls_024">“name”: “nodepool1”,</span></div>
<div style="position:absolute;left:158.40px;top:626.18px" class="cls_024"><span class="cls_024">“osDiskSizeGb”: null,</span></div>
<div style="position:absolute;left:158.40px;top:636.98px" class="cls_024"><span class="cls_024">“osType”: “Linux”,</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 273 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:231778px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background297.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:158.40px;top:114.01px" class="cls_024"><span class="cls_024">“storageProfile”: “ManagedDisks”,</span></div>
<div style="position:absolute;left:158.40px;top:124.81px" class="cls_024"><span class="cls_024">“vmSize”: “Standard_DS1_v2”,</span></div>
<div style="position:absolute;left:158.40px;top:135.61px" class="cls_024"><span class="cls_024">“vnetSubnetId”: null</span></div>
<div style="position:absolute;left:147.60px;top:146.41px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:136.80px;top:157.21px" class="cls_024"><span class="cls_024">],</span></div>
<div style="position:absolute;left:136.80px;top:168.01px" class="cls_024"><span class="cls_024">“dnsPrefix”: “pets-clust-pets-group-186760”,</span></div>
<div style="position:absolute;left:136.80px;top:178.81px" class="cls_024"><span class="cls_024">“enableRbac”: true,</span></div>
<div style="position:absolute;left:136.80px;top:189.61px" class="cls_024"><span class="cls_024">“fqdn”: “pets-clust-pets-group-186760-d706beb4.hcp.westeurope.</span></div>
<div style="position:absolute;left:126.00px;top:200.41px" class="cls_024"><span class="cls_024">azmk8s.io”,</span></div>
<div style="position:absolute;left:136.80px;top:211.21px" class="cls_024"><span class="cls_024">“id”: “/subscriptions/186760ad-9152-4499-b317-xxxxxxxxxxxx/</span></div>
<div style="position:absolute;left:126.00px;top:222.01px" class="cls_024"><span class="cls_024">resourcegroups/pets-group/providers/Microsoft.ContainerService/</span></div>
<div style="position:absolute;left:126.00px;top:232.81px" class="cls_024"><span class="cls_024">managedClusters/pets-cluster”,</span></div>
<div style="position:absolute;left:136.80px;top:243.61px" class="cls_024"><span class="cls_024">“kubernetesVersion”: “1.10.6”,</span></div>
<div style="position:absolute;left:136.80px;top:254.41px" class="cls_024"><span class="cls_024">“linuxProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:265.21px" class="cls_024"><span class="cls_024">“adminUsername”: “azureuser”,</span></div>
<div style="position:absolute;left:147.60px;top:276.01px" class="cls_024"><span class="cls_024">“ssh”: {</span></div>
<div style="position:absolute;left:158.40px;top:286.81px" class="cls_024"><span class="cls_024">“publicKeys”: [</span></div>
<div style="position:absolute;left:169.20px;top:297.61px" class="cls_024"><span class="cls_024">{</span></div>
<div style="position:absolute;left:180.00px;top:308.41px" class="cls_024"><span class="cls_024">“keyData”: “ssh-rsa ...”</span></div>
<div style="position:absolute;left:169.20px;top:319.21px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:158.40px;top:330.01px" class="cls_024"><span class="cls_024">]</span></div>
<div style="position:absolute;left:147.60px;top:340.81px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:136.80px;top:351.61px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:136.80px;top:362.41px" class="cls_024"><span class="cls_024">“location”: “westeurope”,</span></div>
<div style="position:absolute;left:136.80px;top:373.21px" class="cls_024"><span class="cls_024">“name”: “pets-cluster”,</span></div>
<div style="position:absolute;left:136.80px;top:384.01px" class="cls_024"><span class="cls_024">“networkProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:394.81px" class="cls_024"><span class="cls_024">“dnsServiceIp”: “10.0.0.10”,</span></div>
<div style="position:absolute;left:147.60px;top:405.61px" class="cls_024"><span class="cls_024">“dockerBridgeCidr”: “172.17.0.1/16”,</span></div>
<div style="position:absolute;left:147.60px;top:416.41px" class="cls_024"><span class="cls_024">“networkPlugin”: “kubenet”,</span></div>
<div style="position:absolute;left:147.60px;top:427.21px" class="cls_024"><span class="cls_024">“networkPolicy”: null,</span></div>
<div style="position:absolute;left:147.60px;top:438.01px" class="cls_024"><span class="cls_024">“podCidr”: “10.244.0.0/16”,</span></div>
<div style="position:absolute;left:147.60px;top:448.81px" class="cls_024"><span class="cls_024">“serviceCidr”: “10.0.0.0/16”</span></div>
<div style="position:absolute;left:136.80px;top:459.61px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:136.80px;top:470.41px" class="cls_024"><span class="cls_024">“nodeResourceGroup”: “MC_pets-group_pets-cluster_westeurope”,</span></div>
<div style="position:absolute;left:136.80px;top:481.21px" class="cls_024"><span class="cls_024">“provisioningState”: “Succeeded”,</span></div>
<div style="position:absolute;left:136.80px;top:492.01px" class="cls_024"><span class="cls_024">“resourceGroup”: “pets-group”,</span></div>
<div style="position:absolute;left:136.80px;top:502.81px" class="cls_024"><span class="cls_024">“servicePrincipalProfile”: {</span></div>
<div style="position:absolute;left:147.60px;top:513.61px" class="cls_024"><span class="cls_024">“clientId”: “a1a2bdbc-ba07-49bd-ae77-xxxxxxxxxxxx”,</span></div>
<div style="position:absolute;left:147.60px;top:524.41px" class="cls_024"><span class="cls_024">“secret”: null</span></div>
<div style="position:absolute;left:136.80px;top:535.21px" class="cls_024"><span class="cls_024">},</span></div>
<div style="position:absolute;left:136.80px;top:546.01px" class="cls_024"><span class="cls_024">“tags”: null,</span></div>
<div style="position:absolute;left:136.80px;top:556.81px" class="cls_024"><span class="cls_024">“type”: “Microsoft.ContainerService/ManagedClusters”</span></div>
<div style="position:absolute;left:126.00px;top:567.61px" class="cls_024"><span class="cls_024">}</span></div>
<div style="position:absolute;left:108.00px;top:587.34px" class="cls_008"><span class="cls_008">To verify the upgrade, we can use this command:</span></div>
<div style="position:absolute;left:126.00px;top:608.28px" class="cls_024"><span class="cls_024">az aks show --resource-group pets-group --name pets-cluster --output</span></div>
<div style="position:absolute;left:126.00px;top:619.08px" class="cls_024"><span class="cls_024">table</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 274 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:232580px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background298.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">This results in the following output:</span></div>
<div style="position:absolute;left:126.00px;top:135.43px" class="cls_024"><span class="cls_024">Name</span></div>
<div style="position:absolute;left:196.20px;top:135.43px" class="cls_024"><span class="cls_024">Location</span></div>
<div style="position:absolute;left:255.60px;top:135.43px" class="cls_024"><span class="cls_024">ResourceGroup</span></div>
<div style="position:absolute;left:342.00px;top:135.43px" class="cls_024"><span class="cls_024">KubernetesVersion</span></div>
<div style="position:absolute;left:126.00px;top:146.23px" class="cls_024"><span class="cls_024">ProvisioningState</span></div>
<div style="position:absolute;left:234.00px;top:146.23px" class="cls_024"><span class="cls_024">Fqdn</span></div>
<div style="position:absolute;left:126.00px;top:157.03px" class="cls_024"><span class="cls_024">------------ ---------- --------------- ------------------- ----------</span></div>
<div style="position:absolute;left:126.00px;top:167.83px" class="cls_024"><span class="cls_024">--------- -------------</span></div>
<div style="position:absolute;left:126.00px;top:178.63px" class="cls_024"><span class="cls_024">pets-cluster westeurope pets-group</span></div>
<div style="position:absolute;left:342.00px;top:178.63px" class="cls_024"><span class="cls_024">1.10.6</span></div>
<div style="position:absolute;left:126.00px;top:189.43px" class="cls_024"><span class="cls_024">Succeeded</span></div>
<div style="position:absolute;left:234.00px;top:189.43px" class="cls_024"><span class="cls_024">pets-clust...</span></div>
<div style="position:absolute;left:108.00px;top:209.17px" class="cls_008"><span class="cls_008">We have successfully upgraded our three-node cluster from Kubernetes </span><span class="cls_010">v1.9.9</span><span class="cls_008"> to</span></div>
<div style="position:absolute;left:108.00px;top:221.77px" class="cls_010"><span class="cls_010">v1.10.6</span><span class="cls_008">. This upgrade includes the master nodes. During the whole process, the</span></div>
<div style="position:absolute;left:108.00px;top:234.37px" class="cls_008"><span class="cls_008">application deployed on the cluster was fully operational.</span></div>
<div style="position:absolute;left:108.00px;top:266.87px" class="cls_011"><span class="cls_011">Debugging the application while it is</span></div>
<div style="position:absolute;left:108.00px;top:290.87px" class="cls_011"><span class="cls_011">running in AKS</span></div>
<div style="position:absolute;left:108.00px;top:315.85px" class="cls_008"><span class="cls_008">So far we have seen how we can deploy and run applications in Kubernetes on</span></div>
<div style="position:absolute;left:108.00px;top:328.45px" class="cls_008"><span class="cls_008">AKS. This is interesting for operation engineers that work with </span><span class="cls_021">finished</span><span class="cls_008"> applications.</span></div>
<div style="position:absolute;left:108.00px;top:341.05px" class="cls_008"><span class="cls_008">Developers though would sometimes love to interactively develop and debug</span></div>
<div style="position:absolute;left:108.00px;top:353.65px" class="cls_008"><span class="cls_008">applications directly in the cloud, specifically if these applications consist of many</span></div>
<div style="position:absolute;left:108.00px;top:366.25px" class="cls_008"><span class="cls_008">individual services or components running in containers on Kubernetes. At the time</span></div>
<div style="position:absolute;left:108.00px;top:378.85px" class="cls_008"><span class="cls_008">of writing, Microsoft offers a preview of so-called Azure Dev Spaces on AKS, which</span></div>
<div style="position:absolute;left:108.00px;top:391.45px" class="cls_008"><span class="cls_008">allow developers to do exactly this kind of interactive development and debugging.</span></div>
<div style="position:absolute;left:108.00px;top:421.39px" class="cls_022"><span class="cls_022">Creating a Kubernetes cluster for</span></div>
<div style="position:absolute;left:108.00px;top:442.99px" class="cls_022"><span class="cls_022">development</span></div>
<div style="position:absolute;left:108.00px;top:465.97px" class="cls_008"><span class="cls_008">In this section, we are going to create a Kubernetes cluster in Azure’s AKS that can</span></div>
<div style="position:absolute;left:108.00px;top:478.57px" class="cls_008"><span class="cls_008">be used for development purposes. We will be using this cluster to show how to</span></div>
<div style="position:absolute;left:108.00px;top:491.17px" class="cls_008"><span class="cls_008">remote debug an application running on it. We will use the Azure portal to provision</span></div>
<div style="position:absolute;left:108.00px;top:503.77px" class="cls_008"><span class="cls_008">the cluster:</span></div>
<div style="position:absolute;left:126.00px;top:525.01px" class="cls_008"><span class="cls_008">1.  Open the Azure portal at </span><A HREF="https://portal.azure.com/">https://portal.azure.com/</A> </span><span class="cls_008"> and log in to</span></div>
<div style="position:absolute;left:144.00px;top:537.61px" class="cls_008"><span class="cls_008">your account</span></div>
<div style="position:absolute;left:126.00px;top:554.53px" class="cls_008"><span class="cls_008">2.  Select the </span><span class="cls_009">+ Create a resource</span><span class="cls_008"> option and select </span><span class="cls_009">Kubernetes Service</span></div>
<div style="position:absolute;left:126.00px;top:571.45px" class="cls_008"><span class="cls_008">3.  Fill out the necessary details needed to create a Kubernetes cluster for</span></div>
<div style="position:absolute;left:144.00px;top:584.04px" class="cls_008"><span class="cls_008">development purposes</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 275 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:233382px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background299.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">In the following screenshot, we can see a sample configuration that the author used</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">during the writing of this section:</span></div>
<div style="position:absolute;left:201.44px;top:521.47px" class="cls_026"><span class="cls_026">Configuration of a Kubernetes development cluster in AKS</span></div>
<div style="position:absolute;left:108.00px;top:540.21px" class="cls_008"><span class="cls_008">Specifically, note that I created a new resource group, </span><span class="cls_010">pets-dev-group</span><span class="cls_008">, selected</span></div>
<div style="position:absolute;left:108.00px;top:552.81px" class="cls_008"><span class="cls_008">the value </span><span class="cls_010">pets-dev-cluster</span><span class="cls_008"> for the cluster name, and created a new Log Analytics</span></div>
<div style="position:absolute;left:108.00px;top:565.41px" class="cls_008"><span class="cls_008">workspace, </span><span class="cls_010">pets-dev-workspace</span><span class="cls_008">, to capture all log and monitoring data produced</span></div>
<div style="position:absolute;left:108.00px;top:578.01px" class="cls_008"><span class="cls_008">by the cluster and the applications running on it. It is also important to have HTTP</span></div>
<div style="position:absolute;left:108.00px;top:590.61px" class="cls_008"><span class="cls_008">application routing turned on.</span></div>
<div style="position:absolute;left:108.00px;top:611.86px" class="cls_008"><span class="cls_008">After clicking on the </span><span class="cls_009">Create</span><span class="cls_008"> button, the whole provisioning takes a few minutes.</span></div>
<div style="position:absolute;left:108.00px;top:624.46px" class="cls_008"><span class="cls_008">You can continue with the installation of the Azure CLI on your workstation in the</span></div>
<div style="position:absolute;left:108.00px;top:637.06px" class="cls_008"><span class="cls_008">meantime, as described in the next section.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 276 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:234184px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background300.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:112.46px" class="cls_022"><span class="cls_022">Configuring the environment</span></div>
<div style="position:absolute;left:108.00px;top:135.44px" class="cls_008"><span class="cls_008">In this section, we are going to configure our working environment (that is, our</span></div>
<div style="position:absolute;left:108.00px;top:148.04px" class="cls_008"><span class="cls_008">computer), to be able to work with Azure from the command line. Follow the steps:</span></div>
<div style="position:absolute;left:126.00px;top:169.29px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:143.99px;top:169.29px" class="cls_008"><span class="cls_008">To work with Azure Dev Spaces, install the Azure CLI natively on your</span></div>
<div style="position:absolute;left:143.99px;top:181.89px" class="cls_008"><span class="cls_008">workstation. Here is how you can do this on a Mac:</span></div>
<div style="position:absolute;left:165.60px;top:198.50px" class="cls_024"><span class="cls_024">$ brew install azure-cli</span></div>
<div style="position:absolute;left:126.00px;top:218.24px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:218.24px" class="cls_008"><span class="cls_008">Make sure you have the newest version of the CLI. The version returned</span></div>
<div style="position:absolute;left:144.00px;top:230.84px" class="cls_008"><span class="cls_008">should be </span><span class="cls_010">2.0.44</span><span class="cls_008"> or newer:</span></div>
<div style="position:absolute;left:165.60px;top:247.46px" class="cls_024"><span class="cls_024">$ az --version</span></div>
<div style="position:absolute;left:165.60px;top:258.26px" class="cls_024"><span class="cls_024">azure-cli (2.0.45)</span></div>
<div style="position:absolute;left:126.00px;top:288.80px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:288.80px" class="cls_008"><span class="cls_008">Log in to Azure:</span></div>
<div style="position:absolute;left:165.60px;top:305.42px" class="cls_024"><span class="cls_024">$ az login</span></div>
<div style="position:absolute;left:144.00px;top:325.16px" class="cls_008"><span class="cls_008">Do not continue until the provisioning of your Kubernetes development</span></div>
<div style="position:absolute;left:144.00px;top:337.76px" class="cls_008"><span class="cls_008">cluster is complete.</span></div>
<div style="position:absolute;left:126.00px;top:359.01px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:359.01px" class="cls_008"><span class="cls_008">To set up the Azure Dev Space in our development Kubernetes cluster use</span></div>
<div style="position:absolute;left:144.00px;top:371.61px" class="cls_008"><span class="cls_008">the following command:</span></div>
<div style="position:absolute;left:165.60px;top:392.44px" class="cls_031"><span class="cls_031">$ az aks use-dev-spaces -g pets-dev-group -n pets-dev-cluster</span></div>
<div style="position:absolute;left:165.60px;top:412.84px" class="cls_031"><span class="cls_031">The installed extension ‘dev-spaces-preview’ is in preview.</span></div>
<div style="position:absolute;left:165.60px;top:423.04px" class="cls_031"><span class="cls_031">Installing Dev Spaces (Preview) commands...</span></div>
<div style="position:absolute;left:165.60px;top:433.24px" class="cls_031"><span class="cls_031">Installing Azure Dev Spaces (Preview) client components...</span></div>
<div style="position:absolute;left:165.60px;top:453.64px" class="cls_031"><span class="cls_031">By continuing, you agree to the Microsoft Software License Terms</span></div>
<div style="position:absolute;left:165.60px;top:463.84px" class="cls_031"><span class="cls_031">(</span><A HREF="https://aka.ms/azds-licenseterms/">https://aka.ms/azds-LicenseTerms</A>) and Microsoft Privacy Statement</div>
<div style="position:absolute;left:165.60px;top:474.04px" class="cls_031"><span class="cls_031">(</span><A HREF="https://aka.ms/privacystatement/">https://aka.ms/privacystatement</A>). Do you want to continue? (Y/n):</div>
<div style="position:absolute;left:165.60px;top:494.44px" class="cls_031"><span class="cls_031">You may be prompted for your administrator password to authorize</span></div>
<div style="position:absolute;left:165.60px;top:504.64px" class="cls_031"><span class="cls_031">the installation process.</span></div>
<div style="position:absolute;left:165.60px;top:514.84px" class="cls_031"><span class="cls_031">Password:</span></div>
<div style="position:absolute;left:165.60px;top:535.24px" class="cls_031"><span class="cls_031">[INFO] Downloading Azure Dev Spaces (Preview) Package...</span></div>
<div style="position:absolute;left:165.60px;top:545.44px" class="cls_031"><span class="cls_031">[INFO] Downloading Bash completion script...</span></div>
<div style="position:absolute;left:165.60px;top:565.84px" class="cls_031"><span class="cls_031">Successfully installed Azure Dev Spaces (Preview) to /usr/local/</span></div>
<div style="position:absolute;left:165.60px;top:576.04px" class="cls_031"><span class="cls_031">bin/azds.</span></div>
<div style="position:absolute;left:165.60px;top:596.44px" class="cls_031"><span class="cls_031">An Azure Dev Spaces Controller will be created that targets</span></div>
<div style="position:absolute;left:165.60px;top:606.64px" class="cls_031"><span class="cls_031">resource ‘pets-dev-cluster’ in resource group ‘pets-dev-group’.</span></div>
<div style="position:absolute;left:165.60px;top:616.84px" class="cls_031"><span class="cls_031">Continue? (y/N): Y</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 277 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:234986px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background301.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:165.60px;top:114.19px" class="cls_031"><span class="cls_031">Creating and selecting Azure Dev Spaces Controller ‘pets-dev-</span></div>
<div style="position:absolute;left:165.60px;top:124.39px" class="cls_031"><span class="cls_031">cluster’ in resource group ‘pets-dev-group’ that targets resource</span></div>
<div style="position:absolute;left:165.60px;top:134.59px" class="cls_031"><span class="cls_031">‘pets-dev-cluster’ in resource group ‘pets-dev-group’...</span></div>
<div style="position:absolute;left:165.60px;top:154.99px" class="cls_031"><span class="cls_031">Select a dev space or Kubernetes namespace to use as a dev space.</span></div>
<div style="position:absolute;left:170.70px;top:165.19px" class="cls_031"><span class="cls_031">[1] default</span></div>
<div style="position:absolute;left:165.60px;top:175.39px" class="cls_031"><span class="cls_031">Type a number or a new name: pets</span></div>
<div style="position:absolute;left:165.60px;top:195.79px" class="cls_031"><span class="cls_031">Dev space ‘pets’ does not exist and will be created.</span></div>
<div style="position:absolute;left:165.60px;top:216.19px" class="cls_031"><span class="cls_031">Select a parent dev space or Kubernetes namespace to use as a</span></div>
<div style="position:absolute;left:165.60px;top:226.39px" class="cls_031"><span class="cls_031">parent dev space.</span></div>
<div style="position:absolute;left:170.70px;top:236.59px" class="cls_031"><span class="cls_031">[0] &lt;none></span></div>
<div style="position:absolute;left:170.70px;top:246.79px" class="cls_031"><span class="cls_031">[1] default</span></div>
<div style="position:absolute;left:165.60px;top:256.99px" class="cls_031"><span class="cls_031">Type a number: 0</span></div>
<div style="position:absolute;left:165.60px;top:277.39px" class="cls_031"><span class="cls_031">Creating and selecting dev space ‘pets’...2s</span></div>
<div style="position:absolute;left:165.60px;top:297.79px" class="cls_031"><span class="cls_031">Managed Kubernetes cluster ‘pets-dev-cluster’ in resource group</span></div>
<div style="position:absolute;left:165.60px;top:307.99px" class="cls_031"><span class="cls_031">‘pets-dev-group’ is ready for development in dev space ‘pets’.</span></div>
<div style="position:absolute;left:165.60px;top:318.19px" class="cls_031"><span class="cls_031">Type `azds prep` to prepare a source directory for use with Azure</span></div>
<div style="position:absolute;left:165.60px;top:328.39px" class="cls_031"><span class="cls_031">Dev Spaces and `azds up` to run.</span></div>
<div style="position:absolute;left:108.00px;top:356.33px" class="cls_022"><span class="cls_022">Deploying and running a service</span></div>
<div style="position:absolute;left:108.00px;top:379.31px" class="cls_008"><span class="cls_008">We are now ready to build, deploy, and run our first service in the Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:391.91px" class="cls_008"><span class="cls_008">cluster on AKS.</span></div>
<div style="position:absolute;left:108.00px;top:413.15px" class="cls_008"><span class="cls_008">Navigate to the </span><span class="cls_010">ch12-dev-spaces/web</span><span class="cls_008"> subfolder of your </span><span class="cls_010">labs</span><span class="cls_008"> folder:</span></div>
<div style="position:absolute;left:126.00px;top:434.09px" class="cls_024"><span class="cls_024">$ cd ~/labs/ch12-dev-spaces/web</span></div>
<div style="position:absolute;left:108.00px;top:453.83px" class="cls_008"><span class="cls_008">And run the </span><span class="cls_010">azds prep</span><span class="cls_008"> command, as indicated in the preceding output. This will</span></div>
<div style="position:absolute;left:108.00px;top:466.43px" class="cls_008"><span class="cls_008">create the </span><span class="cls_009">Helm charts</span><span class="cls_008"> for this component:</span></div>
<div style="position:absolute;left:126.00px;top:487.37px" class="cls_024"><span class="cls_024">$ azds prep --public</span></div>
<div style="position:absolute;left:126.00px;top:508.97px" class="cls_024"><span class="cls_024">Preparing ‘web’ of type ‘node.js’ with files:</span></div>
<div style="position:absolute;left:136.80px;top:519.77px" class="cls_024"><span class="cls_024">/.dockerignore</span></div>
<div style="position:absolute;left:136.80px;top:530.57px" class="cls_024"><span class="cls_024">/azds.yaml</span></div>
<div style="position:absolute;left:136.80px;top:541.37px" class="cls_024"><span class="cls_024">/charts/web/.helmignore</span></div>
<div style="position:absolute;left:136.80px;top:552.17px" class="cls_024"><span class="cls_024">/charts/web/Chart.yaml</span></div>
<div style="position:absolute;left:136.80px;top:562.97px" class="cls_024"><span class="cls_024">/charts/web/templates/_helpers.tpl</span></div>
<div style="position:absolute;left:136.80px;top:573.77px" class="cls_024"><span class="cls_024">/charts/web/templates/deployment.yaml</span></div>
<div style="position:absolute;left:136.80px;top:584.57px" class="cls_024"><span class="cls_024">/charts/web/templates/ingress.yaml</span></div>
<div style="position:absolute;left:136.80px;top:595.37px" class="cls_024"><span class="cls_024">/charts/web/templates/NOTES.txt</span></div>
<div style="position:absolute;left:136.80px;top:606.17px" class="cls_024"><span class="cls_024">/charts/web/templates/secrets.yaml</span></div>
<div style="position:absolute;left:136.80px;top:616.97px" class="cls_024"><span class="cls_024">/charts/web/templates/service.yaml</span></div>
<div style="position:absolute;left:136.80px;top:627.77px" class="cls_024"><span class="cls_024">/charts/web/values.yaml</span></div>
<div style="position:absolute;left:126.00px;top:638.57px" class="cls_024"><span class="cls_024">Type ‘azds up’ to run.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 278 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:235788px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background302.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">To build the artefacts and run them in AKS, we can now simply use the following</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">command:</span></div>
<div style="position:absolute;left:126.00px;top:148.03px" class="cls_024"><span class="cls_024">$ azds up</span></div>
<div style="position:absolute;left:126.00px;top:169.63px" class="cls_024"><span class="cls_024">Using dev space ‘pets’ with target ‘pets-dev-cluster’</span></div>
<div style="position:absolute;left:126.00px;top:180.43px" class="cls_024"><span class="cls_024">Synchronizing files...1s</span></div>
<div style="position:absolute;left:126.00px;top:191.23px" class="cls_024"><span class="cls_024">Installing Helm chart...10s</span></div>
<div style="position:absolute;left:126.00px;top:202.03px" class="cls_024"><span class="cls_024">Waiting for container image build...7s</span></div>
<div style="position:absolute;left:126.00px;top:212.83px" class="cls_024"><span class="cls_024">Building container image...</span></div>
<div style="position:absolute;left:126.00px;top:223.63px" class="cls_024"><span class="cls_024">Step 1/8 : FROM node:10.9-alpine</span></div>
<div style="position:absolute;left:126.00px;top:234.43px" class="cls_024"><span class="cls_024">Step 2/8 : RUN mkdir /app</span></div>
<div style="position:absolute;left:126.00px;top:245.23px" class="cls_024"><span class="cls_024">Step 3/8 : WORKDIR /app</span></div>
<div style="position:absolute;left:126.00px;top:256.03px" class="cls_024"><span class="cls_024">Step 4/8 : COPY package.json /app/</span></div>
<div style="position:absolute;left:126.00px;top:266.83px" class="cls_024"><span class="cls_024">Step 5/8 : RUN npm install</span></div>
<div style="position:absolute;left:126.00px;top:277.63px" class="cls_024"><span class="cls_024">Step 6/8 : COPY ./src /app/src</span></div>
<div style="position:absolute;left:126.00px;top:288.43px" class="cls_024"><span class="cls_024">Step 7/8 : EXPOSE 80</span></div>
<div style="position:absolute;left:126.00px;top:299.23px" class="cls_024"><span class="cls_024">Step 8/8 : CMD node src/server.js</span></div>
<div style="position:absolute;left:126.00px;top:310.03px" class="cls_024"><span class="cls_024">Built container image in 51s</span></div>
<div style="position:absolute;left:126.00px;top:320.83px" class="cls_024"><span class="cls_024">Waiting for container...8s</span></div>
<div style="position:absolute;left:126.00px;top:331.63px" class="cls_024"><span class="cls_024">(pending registration) Service ‘web’ port ‘http’ will be available at</span></div>
<div style="position:absolute;left:126.00px;top:342.43px" class="cls_024"><span class="cls_024"> </span><A HREF="http://web.2785a289211f45f6a8fa.westeurope.aksapp.io/">http://web.2785a289211f45f6a8fa.westeurope.aksapp.io/</A> </div>
<div style="position:absolute;left:126.00px;top:353.23px" class="cls_024"><span class="cls_024">Service ‘web’ port 80 (TCP) is available at </span><A HREF="http://localhost:52353/">http://localhost:52353</A> </div>
<div style="position:absolute;left:126.00px;top:364.03px" class="cls_024"><span class="cls_024">press Ctrl+C to detach</span></div>
<div style="position:absolute;left:126.00px;top:374.83px" class="cls_024"><span class="cls_024">web-6488b5585b-c9cg5: Listening at 0.0.0.0:80</span></div>
<div style="position:absolute;left:108.00px;top:394.57px" class="cls_008"><span class="cls_008">We can immediately open a browser window at </span><A HREF="http://localhost:52353/">http://localhost:52353</A> </span><span class="cls_008">, as</span></div>
<div style="position:absolute;left:108.00px;top:407.17px" class="cls_008"><span class="cls_008">indicated in the preceding output, to access our service that is now running in</span></div>
<div style="position:absolute;left:108.00px;top:419.77px" class="cls_008"><span class="cls_008">AKS. A few minutes later, we should also be able to use the public DNS (</span><A HREF="http://">http://</A> </span></div>
<div style="position:absolute;left:108.00px;top:432.37px" class="cls_010"><span class="cls_010">web.2785a289211f45f6a8fa.westeurope.aksapp.io</span><span class="cls_008">) provided in the preceding</span></div>
<div style="position:absolute;left:108.00px;top:444.97px" class="cls_008"><span class="cls_008">output to access the service. What we should see is the following screenshot:</span></div>
<div style="position:absolute;left:224.74px;top:545.55px" class="cls_026"><span class="cls_026">Pets application running in Azure Dev Spaces</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 279 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:236590px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background303.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">At any time, we can stop (or detach) the service by pressing </span><span class="cls_021">Ctrl </span><span class="cls_008">+ </span><span class="cls_021">C</span><span class="cls_008"> in the Terminal</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">and then we can update the code. When done, simply start the new version with</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_010"><span class="cls_010">$ azds up</span><span class="cls_008"> again. Do this now and press </span><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">C</span><span class="cls_008">. Then change the message in the</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_010"><span class="cls_010">server.js</span><span class="cls_008"> file to be </span><span class="cls_010">My Pets Application</span><span class="cls_008">. Save the changes and then execute the</span></div>
<div style="position:absolute;left:108.00px;top:164.89px" class="cls_008"><span class="cls_008">following command:</span></div>
<div style="position:absolute;left:126.00px;top:185.83px" class="cls_024"><span class="cls_024">$ azds up</span></div>
<div style="position:absolute;left:108.00px;top:205.57px" class="cls_008"><span class="cls_008">Once the application is ready, refresh the browser, and you should see the changed</span></div>
<div style="position:absolute;left:108.00px;top:218.17px" class="cls_008"><span class="cls_008">message.</span></div>
<div style="position:absolute;left:108.00px;top:239.42px" class="cls_008"><span class="cls_008">To prepare for the next exercise, hit </span><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">C</span><span class="cls_008"> and then execute the following</span></div>
<div style="position:absolute;left:108.00px;top:252.02px" class="cls_008"><span class="cls_008">command to stop and remove the component from our Kubernetes cluster:</span></div>
<div style="position:absolute;left:126.00px;top:272.95px" class="cls_024"><span class="cls_024">$ azds down</span></div>
<div style="position:absolute;left:126.00px;top:294.55px" class="cls_024"><span class="cls_024">‘web’ identifies Helm release ‘pets-web-9c1bf6d2’ which includes these</span></div>
<div style="position:absolute;left:126.00px;top:305.35px" class="cls_024"><span class="cls_024">services:</span></div>
<div style="position:absolute;left:136.80px;top:316.15px" class="cls_024"><span class="cls_024">web</span></div>
<div style="position:absolute;left:126.00px;top:326.95px" class="cls_024"><span class="cls_024">Are you sure you want to delete this release? (y/N): Y</span></div>
<div style="position:absolute;left:126.00px;top:348.55px" class="cls_024"><span class="cls_024">Deleting Helm release ‘pets-web-9c1bf6d2’...19s</span></div>
<div style="position:absolute;left:108.00px;top:376.99px" class="cls_022"><span class="cls_022">Remote debugging a service using Visual</span></div>
<div style="position:absolute;left:108.00px;top:398.59px" class="cls_022"><span class="cls_022">Studio Code</span></div>
<div style="position:absolute;left:108.00px;top:421.57px" class="cls_008"><span class="cls_008">Of course this is a bit slow and we can do better by using remote debugging in</span></div>
<div style="position:absolute;left:108.00px;top:434.17px" class="cls_009"><span class="cls_009">Visual Studio Code</span><span class="cls_008"> (</span><span class="cls_009">VS Code</span><span class="cls_008">):</span></div>
<div style="position:absolute;left:126.00px;top:455.42px" class="cls_008"><span class="cls_008">1.  Open VS Code and download and install the </span><span class="cls_009">Azure Dev Spaces</span><span class="cls_008"> extension</span></div>
<div style="position:absolute;left:143.99px;top:468.02px" class="cls_008"><span class="cls_008">for it. Then restart VS Code.</span></div>
<div style="position:absolute;left:126.00px;top:484.93px" class="cls_008"><span class="cls_008">2.  Open VS Code from within the </span><span class="cls_010">ch12-dev-spaces/web</span><span class="cls_008"> folder. You will be</span></div>
<div style="position:absolute;left:144.00px;top:497.53px" class="cls_008"><span class="cls_008">asked if the Azure Dev Spaces extension should create the assets needed to</span></div>
<div style="position:absolute;left:144.00px;top:510.13px" class="cls_008"><span class="cls_008">build and debug the </span><span class="cls_010">web</span><span class="cls_008"> component. Select the </span><span class="cls_009">Yes</span><span class="cls_008"> option:</span></div>
<div style="position:absolute;left:214.71px;top:629.18px" class="cls_026"><span class="cls_026">Visual Studio Code creating build and debug assets</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 280 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:237392px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background304.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">You will notice that a folder, </span><span class="cls_010">.vscode</span><span class="cls_008">, will be created in your project that</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">contains the two files, </span><span class="cls_010">launch.json</span><span class="cls_008"> and </span><span class="cls_010">tasks.json</span><span class="cls_008">. These are used when</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">remote debugging the </span><span class="cls_010">web</span><span class="cls_008"> service.</span></div>
<div style="position:absolute;left:126.00px;top:160.94px" class="cls_008"><span class="cls_008">3.  In VS Code, hit </span><span class="cls_021">F5</span><span class="cls_008"> and observe how the service is built and run in AKS in</span></div>
<div style="position:absolute;left:143.99px;top:173.54px" class="cls_008"><span class="cls_008">debug mode. This will use the launch task called </span><span class="cls_009">Launch Server (AZDS)</span><span class="cls_008">, as</span></div>
<div style="position:absolute;left:143.98px;top:186.14px" class="cls_008"><span class="cls_008">we can see in the debug pane of VS Code:</span></div>
<div style="position:absolute;left:216.27px;top:411.56px" class="cls_026"><span class="cls_026">Launching the web service in debug mode on AKS</span></div>
<div style="position:absolute;left:126.00px;top:430.30px" class="cls_008"><span class="cls_008">4.  Set a breakpoint on line 13 of the </span><span class="cls_010">server.json</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:217.14px;top:520.35px" class="cls_026"><span class="cls_026">Setting a breakpoint in the code of the web service</span></div>
<div style="position:absolute;left:144.00px;top:539.09px" class="cls_008"><span class="cls_008">If you now refresh the browser at </span><A HREF="http://localhost:52353/">http://localhost:52353</A> </span><span class="cls_008">, the code</span></div>
<div style="position:absolute;left:144.00px;top:551.69px" class="cls_008"><span class="cls_008">execution should stop at the breakpoint.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 281 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:238194px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background305.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">You can use the debug toolbar in VS Code to step through the code line by</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">line or continue execution:</span></div>
<div style="position:absolute;left:264.12px;top:354.42px" class="cls_026"><span class="cls_026">Debugging step by step</span></div>
<div style="position:absolute;left:108.00px;top:381.86px" class="cls_022"><span class="cls_022">Enabling edit-and-continue style development</span></div>
<div style="position:absolute;left:108.00px;top:403.46px" class="cls_022"><span class="cls_022">in the cloud</span></div>
<div style="position:absolute;left:108.00px;top:426.44px" class="cls_008"><span class="cls_008">To allow an edit-and-continue experience, we can do even better. For this, we have a</span></div>
<div style="position:absolute;left:108.00px;top:439.04px" class="cls_008"><span class="cls_008">second launch task called </span><span class="cls_009">Attach (AZDS)</span><span class="cls_008">, which is based on </span><span class="cls_010">nodemon</span><span class="cls_008">. Whenever we</span></div>
<div style="position:absolute;left:108.00px;top:451.64px" class="cls_008"><span class="cls_008">update the code locally, this is mirrored in the container running remotely in AKS,</span></div>
<div style="position:absolute;left:108.00px;top:464.24px" class="cls_008"><span class="cls_008">and </span><span class="cls_010">nodemon</span><span class="cls_008"> upon detection of changes will automatically restart the application in</span></div>
<div style="position:absolute;left:108.00px;top:476.84px" class="cls_008"><span class="cls_008">the container. As a consequence, we can change and update the code in VS Code,</span></div>
<div style="position:absolute;left:108.00px;top:489.44px" class="cls_008"><span class="cls_008">save the changes, and a few seconds later, use and debug the new code in AKS.</span></div>
<div style="position:absolute;left:108.00px;top:510.69px" class="cls_008"><span class="cls_008">If your application is still running from the previous exercise then stop debugging</span></div>
<div style="position:absolute;left:108.00px;top:523.28px" class="cls_008"><span class="cls_008">now, press </span><span class="cls_021">Ctrl</span><span class="cls_008"> + </span><span class="cls_021">C</span><span class="cls_008"> in the console, and then execute the </span><span class="cls_010">$ azds down</span><span class="cls_008"> command to</span></div>
<div style="position:absolute;left:108.00px;top:535.88px" class="cls_008"><span class="cls_008">stop and remove the service.</span></div>
<div style="position:absolute;left:108.00px;top:557.13px" class="cls_008"><span class="cls_008">In the debug view of VS Code, select the launch task </span><span class="cls_009">Attach to Server (AZDS)</span><span class="cls_008"> and</span></div>
<div style="position:absolute;left:108.00px;top:569.73px" class="cls_008"><span class="cls_008">then hit </span><span class="cls_021">F5</span><span class="cls_008">. Once the service is deployed, you can set breakpoints as before and</span></div>
<div style="position:absolute;left:108.00px;top:582.33px" class="cls_008"><span class="cls_008">navigate through the code, but, in addition to that, you can now also change the code</span></div>
<div style="position:absolute;left:108.00px;top:594.92px" class="cls_008"><span class="cls_008">in </span><span class="cls_010">server.js</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 282 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:238996px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background306.jpg" width=612 height=792></div>
<div style="position:absolute;left:464.37px;top:94.56px" class="cls_019"><span class="cls_019">Chapter 12</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">Once you save the changes, the changed files will be synced with AKS and </span><span class="cls_010">nodemon</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">restarts the application running inside the container on Kubernetes. Try this by</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">adding the following code snippet to the </span><span class="cls_010">server.js</span><span class="cls_008"> file:</span></div>
<div style="position:absolute;left:225.55px;top:255.27px" class="cls_026"><span class="cls_026">Adding code to a running component in AKS</span></div>
<div style="position:absolute;left:108.00px;top:274.01px" class="cls_008"><span class="cls_008">After you have saved the file and waited for a few seconds, navigate to the URL</span></div>
<div style="position:absolute;left:108.00px;top:286.61px" class="cls_010"><span class="cls_010">http://localhost:52353/pet</span><span class="cls_008">. You should see a nice cat picture.</span></div>
<div style="position:absolute;left:108.00px;top:319.11px" class="cls_011"><span class="cls_011">Cleaning up</span></div>
<div style="position:absolute;left:108.00px;top:344.09px" class="cls_008"><span class="cls_008">To avoid unnecessary cost, we should clean up (that is delete) all resources that</span></div>
<div style="position:absolute;left:108.00px;top:356.69px" class="cls_008"><span class="cls_008">we have created on Microsoft Azure. This is rather straightforward since we have</span></div>
<div style="position:absolute;left:108.00px;top:369.29px" class="cls_008"><span class="cls_008">grouped all our resources in the </span><span class="cls_010">pets-group</span><span class="cls_008"> and </span><span class="cls_010">pets-dev-group</span><span class="cls_008"> resource groups,</span></div>
<div style="position:absolute;left:108.00px;top:381.89px" class="cls_008"><span class="cls_008">and we only need to delete the groups to get rid of all contained resources. We can</span></div>
<div style="position:absolute;left:108.00px;top:394.49px" class="cls_008"><span class="cls_008">do this with our Azure CLI:</span></div>
<div style="position:absolute;left:126.00px;top:415.43px" class="cls_024"><span class="cls_024">bash-4.4# az group delete --name pets-group</span></div>
<div style="position:absolute;left:126.00px;top:426.23px" class="cls_024"><span class="cls_024">Are you sure you want to perform this operation? (y/n): y</span></div>
<div style="position:absolute;left:126.00px;top:447.83px" class="cls_024"><span class="cls_024">bash-4.4# az group delete --name pets-dev-group</span></div>
<div style="position:absolute;left:126.00px;top:458.63px" class="cls_024"><span class="cls_024">Are you sure you want to perform this operation? (y/n): y</span></div>
<div style="position:absolute;left:108.00px;top:478.37px" class="cls_008"><span class="cls_008">The whole process will take a few minutes to terminate.</span></div>
<div style="position:absolute;left:108.00px;top:499.62px" class="cls_008"><span class="cls_008">You might also want to double check in the Azure portal that indeed all resources</span></div>
<div style="position:absolute;left:108.00px;top:512.22px" class="cls_008"><span class="cls_008">have been deleted.</span></div>
<div style="position:absolute;left:108.00px;top:544.71px" class="cls_011"><span class="cls_011">Summary</span></div>
<div style="position:absolute;left:108.00px;top:569.69px" class="cls_008"><span class="cls_008">In this chapter, we have learned how to provision a fully hosted Kubernetes cluster</span></div>
<div style="position:absolute;left:108.00px;top:582.29px" class="cls_008"><span class="cls_008">on the Microsoft cloud offering AKS. Furthermore, we have learned how to deploy,</span></div>
<div style="position:absolute;left:108.00px;top:594.89px" class="cls_008"><span class="cls_008">run, monitor, upgrade, and even interactively debug an application running in this</span></div>
<div style="position:absolute;left:108.00px;top:607.49px" class="cls_008"><span class="cls_008">cluster on AKS. We have also gotten a brief overview of how we can update the</span></div>
<div style="position:absolute;left:108.00px;top:620.09px" class="cls_008"><span class="cls_008">version of Kubernetes on AKS without disrupting the applications running in the</span></div>
<div style="position:absolute;left:108.00px;top:632.69px" class="cls_008"><span class="cls_008">cluster.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 283 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:239798px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background307.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Running a Containerized App in the Cloud</span></div>
<div style="position:absolute;left:108.00px;top:114.49px" class="cls_008"><span class="cls_008">With this, you have successfully worked through this book, and it is time for</span></div>
<div style="position:absolute;left:108.00px;top:127.09px" class="cls_008"><span class="cls_008">me to say thank you for choosing my book as a guide on your journey from a</span></div>
<div style="position:absolute;left:108.00px;top:139.69px" class="cls_008"><span class="cls_008">Docker newbie to an expert who containerizes their complex and mission-critical</span></div>
<div style="position:absolute;left:108.00px;top:152.29px" class="cls_008"><span class="cls_008">applications and deploys them onto Kubernetes running in the cloud.</span></div>
<div style="position:absolute;left:108.00px;top:184.79px" class="cls_011"><span class="cls_011">Questions</span></div>
<div style="position:absolute;left:108.00px;top:209.77px" class="cls_008"><span class="cls_008">To assess your knowledge, please answer the following questions:</span></div>
<div style="position:absolute;left:126.00px;top:231.02px" class="cls_008"><span class="cls_008">1.  Which three options do you have to provision a fully hosted Kubernetes</span></div>
<div style="position:absolute;left:143.99px;top:243.62px" class="cls_008"><span class="cls_008">cluster on AKS?</span></div>
<div style="position:absolute;left:126.00px;top:260.53px" class="cls_008"><span class="cls_008">2.  Name two to three reasons why it makes sense to host your Docker images in</span></div>
<div style="position:absolute;left:143.99px;top:273.13px" class="cls_008"><span class="cls_008">the ACR when using AKS.</span></div>
<div style="position:absolute;left:126.00px;top:290.05px" class="cls_008"><span class="cls_008">3.  Explain in three to four short sentences the main steps needed to run your</span></div>
<div style="position:absolute;left:143.99px;top:302.65px" class="cls_008"><span class="cls_008">containerized application on AKS.</span></div>
<div style="position:absolute;left:126.00px;top:319.56px" class="cls_008"><span class="cls_008">4.  Show how you can get access to the container log files of your app running</span></div>
<div style="position:absolute;left:143.99px;top:332.16px" class="cls_008"><span class="cls_008">on AKS.</span></div>
<div style="position:absolute;left:126.00px;top:349.08px" class="cls_008"><span class="cls_008">5.  Describe how you can scale the number of nodes in your Kubernetes cluster</span></div>
<div style="position:absolute;left:143.99px;top:361.68px" class="cls_008"><span class="cls_008">on AKS.</span></div>
<div style="position:absolute;left:108.00px;top:394.19px" class="cls_011"><span class="cls_011">Further reading</span></div>
<div style="position:absolute;left:108.00px;top:419.17px" class="cls_008"><span class="cls_008">The following articles will give you some more information related to the topics we</span></div>
<div style="position:absolute;left:108.00px;top:431.77px" class="cls_008"><span class="cls_008">discussed in this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:453.02px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Azure Kubernetes Service (AKS)</span><span class="cls_008"> at </span><A HREF="https://bit.ly/2JglX9d">https://bit.ly/2JglX9d</A> </span></div>
<div style="position:absolute;left:126.00px;top:469.93px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Upgrade an Azure Kubernetes Service (AKS) cluster</span><span class="cls_008"> at </span><A HREF="https://bit.ly/2wCYA4P">https://bit.</A> </span></div>
<div style="position:absolute;left:144.00px;top:483.53px" class="cls_010"><span class="cls_010"> </span><A HREF="https://bit.ly/2wCYA4P">ly/2wCYA4P</A> </div>
<div style="position:absolute;left:126.00px;top:499.45px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  What is Azure Log Analytics?</span><span class="cls_008"> at </span><A HREF="https://bit.ly/2LN4Tbr">https://bit.ly/2LN4Tbr</A> </span></div>
<div style="position:absolute;left:126.00px;top:516.37px" class="cls_008"><span class="cls_008">•</span><span class="cls_021">  Introducing Dev Spaces for AKS</span><span class="cls_008"> at </span><A HREF="https://bit.ly/2NljFba">https://bit.ly/2NljFba</A> </span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 284 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:240600px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background308.jpg" width=612 height=792></div>
<div style="position:absolute;left:340.61px;top:218.71px" class="cls_015"><span class="cls_015">Assessment</span></div>
<div style="position:absolute;left:108.00px;top:292.31px" class="cls_011"><span class="cls_011">Chapter 1: What Are Containers and Why</span></div>
<div style="position:absolute;left:108.00px;top:316.31px" class="cls_011"><span class="cls_011">Should I Use Them?</span></div>
<div style="position:absolute;left:126.00px;top:341.29px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:144.00px;top:341.29px" class="cls_008"><span class="cls_008">Correct answers are: 4, 5.</span></div>
<div style="position:absolute;left:126.00px;top:358.21px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:358.21px" class="cls_008"><span class="cls_008">A Docker container is, to IT, what a shipping container is to the</span></div>
<div style="position:absolute;left:144.00px;top:370.81px" class="cls_008"><span class="cls_008">transportation industry. It defines a standard on how to package goods. In</span></div>
<div style="position:absolute;left:144.00px;top:383.41px" class="cls_008"><span class="cls_008">this case, goods are the application(s) developers write. The suppliers (in</span></div>
<div style="position:absolute;left:144.00px;top:396.01px" class="cls_008"><span class="cls_008">this case, the developers) are responsible for packaging the goods into the</span></div>
<div style="position:absolute;left:144.00px;top:408.61px" class="cls_008"><span class="cls_008">container and making sure everything fits as expected. Once the goods are</span></div>
<div style="position:absolute;left:144.00px;top:421.21px" class="cls_008"><span class="cls_008">packaged into a container, it can be shipped. Since it is a standard container,</span></div>
<div style="position:absolute;left:144.00px;top:433.81px" class="cls_008"><span class="cls_008">the shippers can standardize their means of transportation such as lorries,</span></div>
<div style="position:absolute;left:144.00px;top:446.41px" class="cls_008"><span class="cls_008">trains, or ships. The shipper doesn't really care what's in a container. Also,</span></div>
<div style="position:absolute;left:144.00px;top:459.01px" class="cls_008"><span class="cls_008">the loading and unloading process from one transportation means to another</span></div>
<div style="position:absolute;left:144.00px;top:471.61px" class="cls_008"><span class="cls_008">(for example, train to ship) can be highly standardized. This massively</span></div>
<div style="position:absolute;left:144.00px;top:484.21px" class="cls_008"><span class="cls_008">increases the efficiency of transportation. Analogous to this is an operations</span></div>
<div style="position:absolute;left:144.00px;top:496.81px" class="cls_008"><span class="cls_008">engineer in IT who can take a software container built by a developer and</span></div>
<div style="position:absolute;left:144.00px;top:509.41px" class="cls_008"><span class="cls_008">ship it to a production system and run it there in a highly standardized way,</span></div>
<div style="position:absolute;left:144.00px;top:522.01px" class="cls_008"><span class="cls_008">without worrying about what's in the container. It will just work.</span></div>
<div style="position:absolute;left:126.00px;top:538.92px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:538.92px" class="cls_008"><span class="cls_008">Some of the reasons why containers are game changers are:</span></div>
<div style="position:absolute;left:161.99px;top:555.84px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:555.84px" class="cls_008"><span class="cls_008">Containers are self-contained and thus if they run on one system,</span></div>
<div style="position:absolute;left:179.99px;top:568.44px" class="cls_008"><span class="cls_008">they run anywhere where a container can run.</span></div>
<div style="position:absolute;left:161.99px;top:585.36px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:585.36px" class="cls_008"><span class="cls_008">Containers run on-premise and in the cloud, as well as in hybrid</span></div>
<div style="position:absolute;left:179.99px;top:597.96px" class="cls_008"><span class="cls_008">environments. This is important for today's typical enterprises since</span></div>
<div style="position:absolute;left:179.99px;top:610.56px" class="cls_008"><span class="cls_008">it allows a mostly smooth transition from on-premise to cloud.</span></div>
<div style="position:absolute;left:161.99px;top:627.47px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:627.47px" class="cls_008"><span class="cls_008">Container images are built or packaged by the people who know</span></div>
<div style="position:absolute;left:179.99px;top:640.07px" class="cls_008"><span class="cls_008">best - the developers.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 285 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:241402px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background309.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:162.00px;top:114.49px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:114.49px" class="cls_008"><span class="cls_008">Container images are immutable which is important for a good</span></div>
<div style="position:absolute;left:180.00px;top:127.09px" class="cls_008"><span class="cls_008">release management.</span></div>
<div style="position:absolute;left:162.00px;top:144.01px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:144.01px" class="cls_008"><span class="cls_008">Containers are enablers of a secure software supply chain-based</span></div>
<div style="position:absolute;left:180.00px;top:156.61px" class="cls_008"><span class="cls_008">on encapsulation (using Linux namespaces and cgroups), secrets,</span></div>
<div style="position:absolute;left:180.00px;top:169.21px" class="cls_008"><span class="cls_008">content trust, and image vulnerability scanning.</span></div>
<div style="position:absolute;left:125.99px;top:190.45px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:143.99px;top:190.45px" class="cls_008"><span class="cls_008">A container runs anywhere where a container can run because:</span></div>
<div style="position:absolute;left:161.99px;top:207.37px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:207.37px" class="cls_008"><span class="cls_008">Containers are self-contained black boxes. They encapsulate not</span></div>
<div style="position:absolute;left:179.99px;top:219.97px" class="cls_008"><span class="cls_008">only an application but all its dependencies, such as libraries and</span></div>
<div style="position:absolute;left:179.99px;top:232.57px" class="cls_008"><span class="cls_008">frameworks, configuration data, certificates, and so on.</span></div>
<div style="position:absolute;left:161.99px;top:249.48px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:249.48px" class="cls_008"><span class="cls_008">Containers are based on widely accepted standards such as OCI.</span></div>
<div style="position:absolute;left:161.99px;top:266.40px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:266.40px" class="cls_008"><span class="cls_008">TODO: add more reasons.</span></div>
<div style="position:absolute;left:125.98px;top:287.64px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:143.98px;top:287.64px" class="cls_008"><span class="cls_008">False! Containers are useful for modern applications as well as to</span></div>
<div style="position:absolute;left:143.98px;top:300.24px" class="cls_008"><span class="cls_008">containerize traditional applications. The benefit for an enterprise when</span></div>
<div style="position:absolute;left:143.98px;top:312.84px" class="cls_008"><span class="cls_008">doing the latter is huge. Cost savings in the maintenance of legacy apps of</span></div>
<div style="position:absolute;left:143.98px;top:325.44px" class="cls_008"><span class="cls_008">50% or more have been reported. The time between new releases of such</span></div>
<div style="position:absolute;left:143.98px;top:338.04px" class="cls_008"><span class="cls_008">legacy applications could be reduced by up to 90%. These numbers have</span></div>
<div style="position:absolute;left:143.98px;top:350.64px" class="cls_008"><span class="cls_008">been publicly reported by real enterprise customers.</span></div>
<div style="position:absolute;left:125.98px;top:367.55px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:143.98px;top:367.55px" class="cls_008"><span class="cls_008">50% or more.</span></div>
<div style="position:absolute;left:125.98px;top:384.47px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:143.98px;top:384.47px" class="cls_008"><span class="cls_008">Containers are based on Linux namespaces (network, process, user,</span></div>
<div style="position:absolute;left:143.98px;top:397.07px" class="cls_008"><span class="cls_008">and so on) and </span><span class="cls_009">control groups</span><span class="cls_008"> (</span><span class="cls_009">cgroups</span><span class="cls_008">).</span></div>
<div style="position:absolute;left:108.00px;top:429.59px" class="cls_011"><span class="cls_011">Chapter 2: Setting up a Working</span></div>
<div style="position:absolute;left:108.00px;top:453.59px" class="cls_011"><span class="cls_011">Environment</span></div>
<div style="position:absolute;left:126.00px;top:478.57px" class="cls_008"><span class="cls_008">1.</span><span class="cls_010">  docker-machine</span><span class="cls_008"> can be used to do the following:</span></div>
<div style="position:absolute;left:162.00px;top:495.49px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:495.49px" class="cls_008"><span class="cls_008">Create a VM configured as Docker host in different environments,</span></div>
<div style="position:absolute;left:179.99px;top:508.09px" class="cls_008"><span class="cls_008">such as VirtualBox</span></div>
<div style="position:absolute;left:162.00px;top:525.01px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:525.01px" class="cls_008"><span class="cls_008">SSH into a Docker host</span></div>
<div style="position:absolute;left:162.00px;top:541.92px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:541.92px" class="cls_008"><span class="cls_008">Configure the local Docker CLI for access of a remote Docker host</span></div>
<div style="position:absolute;left:162.00px;top:558.84px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:558.84px" class="cls_008"><span class="cls_008">List all hosts in a given environment</span></div>
<div style="position:absolute;left:162.00px;top:575.75px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:575.75px" class="cls_008"><span class="cls_008">Remove or destroy existing hosts</span></div>
<div style="position:absolute;left:125.99px;top:596.99px" class="cls_008"><span class="cls_008">2.  True. Docker for Windows creates a Linux VM in Hyper-V, on which it then</span></div>
<div style="position:absolute;left:143.99px;top:609.59px" class="cls_008"><span class="cls_008">runs Linux containers.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 286 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:242204px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background310.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.  Container are optimally used in CI/CD, which is all about automation.</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">Each step, from building a container image, shipping the image, and finally</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">running containers from this image, is ideally scripted for maximum</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">productivity. With it, one achieves a repeatable and auditable process.</span></div>
<div style="position:absolute;left:126.00px;top:169.21px" class="cls_008"><span class="cls_008">4.  Ubuntu 17.4 or later, CentOS 7.x, Alpine 3.x, Debian, Suse Linux, RedHat</span></div>
<div style="position:absolute;left:144.00px;top:181.81px" class="cls_008"><span class="cls_008">Linux, and so on.</span></div>
<div style="position:absolute;left:126.00px;top:198.73px" class="cls_008"><span class="cls_008">5.  Windows 10 Professional or Enterprise Edition, Windows Server 2016.</span></div>
<div style="position:absolute;left:108.00px;top:231.23px" class="cls_011"><span class="cls_011">Chapter 3: Working with Containers</span></div>
<div style="position:absolute;left:126.00px;top:256.21px" class="cls_008"><span class="cls_008">1.  The states of a container are as follows</span></div>
<div style="position:absolute;left:161.99px;top:273.13px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:273.13px" class="cls_008"><span class="cls_008">Created</span></div>
<div style="position:absolute;left:161.99px;top:290.05px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:290.05px" class="cls_008"><span class="cls_008">Running</span></div>
<div style="position:absolute;left:161.99px;top:306.96px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:306.96px" class="cls_008"><span class="cls_008">Exited</span></div>
<div style="position:absolute;left:125.99px;top:323.88px" class="cls_008"><span class="cls_008">2.  The following command helps us to find out what is currently running on</span></div>
<div style="position:absolute;left:143.99px;top:336.48px" class="cls_008"><span class="cls_008">our host:</span></div>
<div style="position:absolute;left:165.60px;top:353.11px" class="cls_024"><span class="cls_024">$ docker container ls</span></div>
<div style="position:absolute;left:126.00px;top:372.85px" class="cls_008"><span class="cls_008">3.  The following command is used to list down the IDs of all containers:</span></div>
<div style="position:absolute;left:165.60px;top:389.47px" class="cls_024"><span class="cls_024">$ docker container ls -q</span></div>
<div style="position:absolute;left:108.00px;top:429.11px" class="cls_011"><span class="cls_011">Chapter 4: Creating and Managing</span></div>
<div style="position:absolute;left:108.00px;top:453.11px" class="cls_011"><span class="cls_011">Container Images</span></div>
<div style="position:absolute;left:108.00px;top:478.09px" class="cls_008"><span class="cls_008">Here are possible answers to the questions:</span></div>
<div style="position:absolute;left:126.00px;top:499.34px" class="cls_008"><span class="cls_008">1.  Dockerfile:</span></div>
<div style="position:absolute;left:165.60px;top:515.95px" class="cls_023"><span class="cls_023">FROM ubuntu:17.04</span></div>
<div style="position:absolute;left:165.60px;top:528.19px" class="cls_023"><span class="cls_023">RUN apt-get update</span></div>
<div style="position:absolute;left:165.60px;top:540.43px" class="cls_023"><span class="cls_023">RUN apt-get install -y ping</span></div>
<div style="position:absolute;left:165.60px;top:552.67px" class="cls_023"><span class="cls_023">ENTRYPOINT ping</span></div>
<div style="position:absolute;left:165.60px;top:564.91px" class="cls_023"><span class="cls_023">CMD 127.0.0.1</span></div>
<div style="position:absolute;left:126.00px;top:584.65px" class="cls_008"><span class="cls_008">2.  To achieve the result you can execute the following steps:</span></div>
<div style="position:absolute;left:165.60px;top:601.27px" class="cls_024"><span class="cls_024">$ docker container run -it --name sample \</span></div>
<div style="position:absolute;left:187.20px;top:616.39px" class="cls_024"><span class="cls_024">alpine:latest /bin/sh</span></div>
<div style="position:absolute;left:165.60px;top:631.51px" class="cls_024"><span class="cls_024">/ # apk update && \</span></div>
<div style="position:absolute;left:187.20px;top:646.63px" class="cls_024"><span class="cls_024">apk add -y curl && \</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 287 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:243006px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background311.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:187.20px;top:114.01px" class="cls_024"><span class="cls_024">rm -rf /var/cache/apk/*</span></div>
<div style="position:absolute;left:165.60px;top:129.13px" class="cls_024"><span class="cls_024">/ # exit</span></div>
<div style="position:absolute;left:165.60px;top:144.25px" class="cls_024"><span class="cls_024">$ docker container commit sample my-alpine:1.0</span></div>
<div style="position:absolute;left:165.60px;top:159.37px" class="cls_024"><span class="cls_024">$ docker container rm sample</span></div>
<div style="position:absolute;left:126.00px;top:179.10px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:179.10px" class="cls_008"><span class="cls_008">As a sample here is the </span><span class="cls_010">Hello World</span><span class="cls_008"> in C:</span></div>
<div style="position:absolute;left:162.00px;top:196.02px" class="cls_008"><span class="cls_008">1.  Create a file hello.c with this content:</span></div>
<div style="position:absolute;left:203.40px;top:212.64px" class="cls_023"><span class="cls_023">#include &lt;stdio.h></span></div>
<div style="position:absolute;left:203.40px;top:224.88px" class="cls_023"><span class="cls_023">int main()</span></div>
<div style="position:absolute;left:203.40px;top:237.12px" class="cls_023"><span class="cls_023">{</span></div>
<div style="position:absolute;left:230.40px;top:249.36px" class="cls_023"><span class="cls_023">printf("Hello, World!");</span></div>
<div style="position:absolute;left:230.40px;top:261.60px" class="cls_023"><span class="cls_023">return 0;</span></div>
<div style="position:absolute;left:203.40px;top:273.84px" class="cls_023"><span class="cls_023">}</span></div>
<div style="position:absolute;left:162.00px;top:293.58px" class="cls_008"><span class="cls_008">2.  Create a Dockerfile with this content:</span></div>
<div style="position:absolute;left:203.40px;top:310.20px" class="cls_023"><span class="cls_023">FROM alpine:3.5 AS build</span></div>
<div style="position:absolute;left:203.40px;top:322.44px" class="cls_023"><span class="cls_023">RUN apk update && \</span></div>
<div style="position:absolute;left:219.60px;top:334.68px" class="cls_023"><span class="cls_023">apk add --update alpine-sdk</span></div>
<div style="position:absolute;left:203.40px;top:346.92px" class="cls_023"><span class="cls_023">RUN mkdir /app</span></div>
<div style="position:absolute;left:203.40px;top:359.16px" class="cls_023"><span class="cls_023">WORKDIR /app</span></div>
<div style="position:absolute;left:203.40px;top:371.40px" class="cls_023"><span class="cls_023">COPY hello.c /app</span></div>
<div style="position:absolute;left:203.40px;top:383.64px" class="cls_023"><span class="cls_023">RUN mkdir bin</span></div>
<div style="position:absolute;left:203.40px;top:395.88px" class="cls_023"><span class="cls_023">RUN gcc -Wall hello.c -o bin/hello</span></div>
<div style="position:absolute;left:203.40px;top:420.36px" class="cls_023"><span class="cls_023">FROM alpine:3.5</span></div>
<div style="position:absolute;left:203.40px;top:432.60px" class="cls_023"><span class="cls_023">COPY --from=build /app/bin/hello /app/hello</span></div>
<div style="position:absolute;left:203.40px;top:444.84px" class="cls_023"><span class="cls_023">CMD /app/hello</span></div>
<div style="position:absolute;left:126.00px;top:464.58px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:464.58px" class="cls_008"><span class="cls_008">Some characteristics of a Docker image are:</span></div>
<div style="position:absolute;left:161.99px;top:481.50px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:481.50px" class="cls_008"><span class="cls_008">It is immutable</span></div>
<div style="position:absolute;left:161.99px;top:498.41px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:498.41px" class="cls_008"><span class="cls_008">It is composed of immutable layers</span></div>
<div style="position:absolute;left:161.99px;top:515.33px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:515.33px" class="cls_008"><span class="cls_008">Each layer contains only what has changed (the delta) in regard to the</span></div>
<div style="position:absolute;left:179.99px;top:527.93px" class="cls_008"><span class="cls_008">lower lying layers</span></div>
<div style="position:absolute;left:161.99px;top:544.84px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:544.84px" class="cls_008"><span class="cls_008">An image is a (big) tarball of files and folders</span></div>
<div style="position:absolute;left:161.99px;top:561.76px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:561.76px" class="cls_008"><span class="cls_008">an image is a template for containers</span></div>
<div style="position:absolute;left:125.99px;top:583.00px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:143.99px;top:583.00px" class="cls_008"><span class="cls_008">Option 3 is correct. First we need to make sure we're logged in and then we</span></div>
<div style="position:absolute;left:143.99px;top:595.60px" class="cls_008"><span class="cls_008">tag the image and finally push it. Since it is an image we're using </span><span class="cls_010">docker</span></div>
<div style="position:absolute;left:144.00px;top:608.22px" class="cls_010"><span class="cls_010">image ...</span><span class="cls_008"> and not </span><span class="cls_010">docker container ...</span><span class="cls_008"> (as in number 4).</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 288 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:243808px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background312.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Chapter 5: Data Volumes and System</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">Management</span></div>
<div style="position:absolute;left:108.00px;top:160.90px" class="cls_008"><span class="cls_008">The easiest way to play with volumes is to use the Docker Toolbox as when directly</span></div>
<div style="position:absolute;left:108.00px;top:173.50px" class="cls_008"><span class="cls_008">using Docker for Mac or Docker for Windows, then the volumes are stored inside a</span></div>
<div style="position:absolute;left:108.00px;top:186.10px" class="cls_008"><span class="cls_008">(somewhat hidden) Linux VM that Docker for Mac/Win uses transparently.</span></div>
<div style="position:absolute;left:108.00px;top:207.34px" class="cls_008"><span class="cls_008">Thus, we suggest the following:</span></div>
<div style="position:absolute;left:144.00px;top:228.28px" class="cls_024"><span class="cls_024">$ docker-machine create --driver virtualbox volume-test</span></div>
<div style="position:absolute;left:144.00px;top:243.40px" class="cls_024"><span class="cls_024">$ docker-machine ssh volume-test</span></div>
<div style="position:absolute;left:108.00px;top:263.14px" class="cls_008"><span class="cls_008">And now that you're inside a Linux VM called </span><span class="cls_010">volume-test</span><span class="cls_008">, you can execute the</span></div>
<div style="position:absolute;left:108.00px;top:275.74px" class="cls_008"><span class="cls_008">following exercises:</span></div>
<div style="position:absolute;left:126.00px;top:296.98px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:143.99px;top:296.98px" class="cls_008"><span class="cls_008">To create a named </span><span class="cls_010">volume</span><span class="cls_008"> run the following command:</span></div>
<div style="position:absolute;left:165.60px;top:313.60px" class="cls_024"><span class="cls_024">$ docker volume create my-products</span></div>
<div style="position:absolute;left:126.00px;top:333.34px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:333.34px" class="cls_008"><span class="cls_008">Execute the following command:</span></div>
<div style="position:absolute;left:165.60px;top:349.96px" class="cls_024"><span class="cls_024">$ docker container run -it --rm \</span></div>
<div style="position:absolute;left:187.20px;top:362.20px" class="cls_024"><span class="cls_024">-v my-products:/data:ro \</span></div>
<div style="position:absolute;left:187.20px;top:374.44px" class="cls_024"><span class="cls_024">alpine /bin/sh</span></div>
<div style="position:absolute;left:126.00px;top:394.18px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:394.18px" class="cls_008"><span class="cls_008">To get the path on the host for the volume use, for example, this command:</span></div>
<div style="position:absolute;left:165.60px;top:410.80px" class="cls_024"><span class="cls_024">$ docker volume inspect my-products | grep Mountpoint</span></div>
<div style="position:absolute;left:144.00px;top:430.54px" class="cls_008"><span class="cls_008">Which (if using docker-machine and VirtualBox) should result in:</span></div>
<div style="position:absolute;left:167.00px;top:447.16px" class="cls_024"><span class="cls_024">"Mountpoint": "/mnt/sda1/var/lib/docker/volumes/my-products/_</span></div>
<div style="position:absolute;left:167.00px;top:457.96px" class="cls_024"><span class="cls_024">data"</span></div>
<div style="position:absolute;left:144.00px;top:477.70px" class="cls_008"><span class="cls_008">Now execute the following command:</span></div>
<div style="position:absolute;left:165.60px;top:494.32px" class="cls_024"><span class="cls_024">$ sudo su</span></div>
<div style="position:absolute;left:165.60px;top:509.44px" class="cls_024"><span class="cls_024">$ cd /mnt/sda1/var/lib/docker/volumes/my-products/_data</span></div>
<div style="position:absolute;left:165.60px;top:524.56px" class="cls_024"><span class="cls_024">$ echo "Hello world" > sample.txt</span></div>
<div style="position:absolute;left:165.60px;top:539.68px" class="cls_024"><span class="cls_024">$ exit</span></div>
<div style="position:absolute;left:126.00px;top:559.42px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:559.42px" class="cls_008"><span class="cls_008">Execute the following command:</span></div>
<div style="position:absolute;left:165.60px;top:576.04px" class="cls_024"><span class="cls_024">$ docker run -it --rm -v my-products:/data:ro alpine /bin/sh</span></div>
<div style="position:absolute;left:165.60px;top:591.16px" class="cls_024"><span class="cls_024"># / cd /data</span></div>
<div style="position:absolute;left:165.60px;top:606.28px" class="cls_024"><span class="cls_024"># / cat sample.txt</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 289 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:244610px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background313.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">In another terminal execute:</span></div>
<div style="position:absolute;left:171.00px;top:131.11px" class="cls_024"><span class="cls_024">$ docker run -it --rm -v my-products:/app-data alpine /bin/sh</span></div>
<div style="position:absolute;left:171.00px;top:146.23px" class="cls_024"><span class="cls_024"># / cd /app-data</span></div>
<div style="position:absolute;left:171.00px;top:161.35px" class="cls_024"><span class="cls_024"># / echo "Hello other container" > hello.txt</span></div>
<div style="position:absolute;left:171.00px;top:176.47px" class="cls_024"><span class="cls_024"># / exit</span></div>
<div style="position:absolute;left:126.00px;top:196.21px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:196.21px" class="cls_008"><span class="cls_008">Execute a command such as this:</span></div>
<div style="position:absolute;left:165.60px;top:212.83px" class="cls_024"><span class="cls_024">$ docker container run -it --rm \</span></div>
<div style="position:absolute;left:187.20px;top:227.95px" class="cls_024"><span class="cls_024">-v $HOME/my-project:/app/data \</span></div>
<div style="position:absolute;left:187.20px;top:243.07px" class="cls_024"><span class="cls_024">alpine /bin/sh</span></div>
<div style="position:absolute;left:126.00px;top:262.81px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:144.00px;top:262.81px" class="cls_008"><span class="cls_008">Exit both containers and then back on the host, execute this command:</span></div>
<div style="position:absolute;left:165.60px;top:279.43px" class="cls_024"><span class="cls_024">$ docker volume prune</span></div>
<div style="position:absolute;left:126.00px;top:299.17px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:144.00px;top:299.17px" class="cls_008"><span class="cls_008">Run the following command:</span></div>
<div style="position:absolute;left:165.60px;top:315.79px" class="cls_024"><span class="cls_024">$ docker system info | grep Version</span></div>
<div style="position:absolute;left:144.00px;top:335.53px" class="cls_008"><span class="cls_008">Which should output something similar to this:</span></div>
<div style="position:absolute;left:165.60px;top:352.15px" class="cls_024"><span class="cls_024">Server Version: 17.09.1-ce</span></div>
<div style="position:absolute;left:165.60px;top:367.27px" class="cls_024"><span class="cls_024">Kernel Version: 4.4.104-boot2docker</span></div>
<div style="position:absolute;left:144.00px;top:387.01px" class="cls_008"><span class="cls_008">If you have been using </span><span class="cls_010">docker-machine</span><span class="cls_008"> to create and use a Linux VM in</span></div>
<div style="position:absolute;left:144.00px;top:399.61px" class="cls_008"><span class="cls_008">VirtualBox, don't forget to clean up after you're done:</span></div>
<div style="position:absolute;left:165.60px;top:420.55px" class="cls_024"><span class="cls_024">$ docker-machine rm volume-test</span></div>
<div style="position:absolute;left:108.00px;top:451.55px" class="cls_011"><span class="cls_011">Chapter 6: Distributed Application</span></div>
<div style="position:absolute;left:108.00px;top:475.55px" class="cls_011"><span class="cls_011">Architecture</span></div>
<div style="position:absolute;left:126.00px;top:500.53px" class="cls_008"><span class="cls_008">1.  In a system consisting of many parts, failure of at least one part is only a</span></div>
<div style="position:absolute;left:144.00px;top:513.13px" class="cls_008"><span class="cls_008">matter of time. To avoid any downtime if such a situation occurs, one runs</span></div>
<div style="position:absolute;left:144.00px;top:525.73px" class="cls_008"><span class="cls_008">multiple instances of each component. If one of the instances fails, there are</span></div>
<div style="position:absolute;left:144.00px;top:538.33px" class="cls_008"><span class="cls_008">still others to serve the requests.</span></div>
<div style="position:absolute;left:126.00px;top:555.25px" class="cls_008"><span class="cls_008">2.  In a distributed application architecture, we have many moving parts. If</span></div>
<div style="position:absolute;left:144.00px;top:567.85px" class="cls_008"><span class="cls_008">Service A needs access to an instance of Service B, then it cannot know where</span></div>
<div style="position:absolute;left:144.00px;top:580.45px" class="cls_008"><span class="cls_008">to find such an instance. Instances can be on any random node of the cluster</span></div>
<div style="position:absolute;left:144.00px;top:593.05px" class="cls_008"><span class="cls_008">and they can even come and go as the orchestration engine sees fit, so we</span></div>
<div style="position:absolute;left:144.00px;top:605.65px" class="cls_008"><span class="cls_008">do not identify the target instance by, say, its IP address and port, but rather</span></div>
<div style="position:absolute;left:144.00px;top:618.25px" class="cls_008"><span class="cls_008">by its name and port. A DNS service knows how to resolve a service name</span></div>
<div style="position:absolute;left:144.00px;top:630.85px" class="cls_008"><span class="cls_008">into an IP address since it has all the information about all service instances</span></div>
<div style="position:absolute;left:144.00px;top:643.45px" class="cls_008"><span class="cls_008">running in the cluster.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 290 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:245412px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background314.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">A circuit breaker is a mechanism that helps to avoid cascading failures in</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">a distributed application triggered by a single failing service. The circuit</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">breaker observes a request from one service to another and measures the</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">latency over time and the number of request failures or timeouts. If a certain</span></div>
<div style="position:absolute;left:144.00px;top:164.89px" class="cls_008"><span class="cls_008">target instance causes too many failures, the calls to it are intercepted and an</span></div>
<div style="position:absolute;left:144.00px;top:177.49px" class="cls_008"><span class="cls_008">error code is returned to the caller, instantly giving the target time to recover</span></div>
<div style="position:absolute;left:144.00px;top:190.09px" class="cls_008"><span class="cls_008">if possible, and the caller, in turn, knows instantly that it either should</span></div>
<div style="position:absolute;left:144.00px;top:202.69px" class="cls_008"><span class="cls_008">degrade its own service or try with another instance of the target service.</span></div>
<div style="position:absolute;left:126.00px;top:219.61px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:219.61px" class="cls_008"><span class="cls_008">A monolith is an application that consists of one single code base that is</span></div>
<div style="position:absolute;left:144.00px;top:232.21px" class="cls_008"><span class="cls_008">highly coupled. If changes to the code are made, no matter how minimal,</span></div>
<div style="position:absolute;left:144.00px;top:244.81px" class="cls_008"><span class="cls_008">the whole application has to be compiled, packaged, and redeployed. A</span></div>
<div style="position:absolute;left:144.00px;top:257.41px" class="cls_008"><span class="cls_008">monolith is simple to deploy and monitor in production due to the fact that</span></div>
<div style="position:absolute;left:144.00px;top:270.01px" class="cls_008"><span class="cls_008">it has very few moving parts. Monoliths are difficult to maintain and extend.</span></div>
<div style="position:absolute;left:144.00px;top:282.61px" class="cls_008"><span class="cls_008">A distributed application consists of many loosely coupled services. Each</span></div>
<div style="position:absolute;left:144.00px;top:295.21px" class="cls_008"><span class="cls_008">service originates from its own independent source code base. Individual</span></div>
<div style="position:absolute;left:144.00px;top:307.81px" class="cls_008"><span class="cls_008">services can and often have independent life cycles. They can be developed</span></div>
<div style="position:absolute;left:144.00px;top:320.41px" class="cls_008"><span class="cls_008">and revised independently. Distributed applications are more difficult to</span></div>
<div style="position:absolute;left:144.00px;top:333.01px" class="cls_008"><span class="cls_008">manage and monitor.</span></div>
<div style="position:absolute;left:126.00px;top:349.92px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:349.92px" class="cls_008"><span class="cls_008">One talks about a blue-green deployment when a currently running version</span></div>
<div style="position:absolute;left:144.00px;top:362.52px" class="cls_008"><span class="cls_008">of a service, called blue, is replaced by a new release of the same service,</span></div>
<div style="position:absolute;left:144.00px;top:375.13px" class="cls_008"><span class="cls_008">called green. The replacement happens without any downtime since while</span></div>
<div style="position:absolute;left:144.00px;top:387.73px" class="cls_008"><span class="cls_008">the blue version is still running, the green version of the service is installed</span></div>
<div style="position:absolute;left:144.00px;top:400.33px" class="cls_008"><span class="cls_008">on the system and, once ready, a simple change in the configuration of the</span></div>
<div style="position:absolute;left:144.00px;top:412.92px" class="cls_008"><span class="cls_008">router that funnels traffic to the service is needed so that the traffic is now all</span></div>
<div style="position:absolute;left:144.00px;top:425.52px" class="cls_008"><span class="cls_008">directed to green instead of blue.</span></div>
<div style="position:absolute;left:108.00px;top:458.03px" class="cls_011"><span class="cls_011">Chapter 7: Single-Host Networking</span></div>
<div style="position:absolute;left:126.00px;top:483.01px" class="cls_008"><span class="cls_008">1.  The three core elements are sandbox, endpoint, and network</span></div>
<div style="position:absolute;left:126.00px;top:499.93px" class="cls_008"><span class="cls_008">2.  Execute this command:</span></div>
<div style="position:absolute;left:165.60px;top:516.55px" class="cls_024"><span class="cls_024">$ docker network create --driver bridge frontend</span></div>
<div style="position:absolute;left:126.00px;top:536.29px" class="cls_008"><span class="cls_008">3.  Run this command:</span></div>
<div style="position:absolute;left:165.60px;top:552.91px" class="cls_024"><span class="cls_024">$ docker container run -d --name n1 \</span></div>
<div style="position:absolute;left:181.80px;top:568.03px" class="cls_024"><span class="cls_024">--network frontend -p 8080:80 \</span></div>
<div style="position:absolute;left:181.80px;top:583.15px" class="cls_024"><span class="cls_024">nginx:alpine</span></div>
<div style="position:absolute;left:165.60px;top:598.27px" class="cls_024"><span class="cls_024">$ docker container run -d --name n2 \</span></div>
<div style="position:absolute;left:181.80px;top:613.39px" class="cls_024"><span class="cls_024">--network frontend -p 8081:80 \</span></div>
<div style="position:absolute;left:181.80px;top:628.51px" class="cls_024"><span class="cls_024">nginx:alpine</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 291 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:246214px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background315.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">Test that both Nginx instances are up and running:</span></div>
<div style="position:absolute;left:165.60px;top:131.11px" class="cls_024"><span class="cls_024">$ curl -4 localhost:8080</span></div>
<div style="position:absolute;left:165.60px;top:146.23px" class="cls_024"><span class="cls_024">$ curl -4 localhost:8081</span></div>
<div style="position:absolute;left:144.00px;top:165.97px" class="cls_008"><span class="cls_008">You should be seeing the welcome page of Nginx in both cases.</span></div>
<div style="position:absolute;left:126.00px;top:187.22px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:187.22px" class="cls_008"><span class="cls_008">To get the IPs of all attached containers, run:</span></div>
<div style="position:absolute;left:165.60px;top:203.83px" class="cls_024"><span class="cls_024">$ docker network inspect frontend | grep IPv4Address</span></div>
<div style="position:absolute;left:144.00px;top:223.57px" class="cls_008"><span class="cls_008">You should see something similar to the following:</span></div>
<div style="position:absolute;left:165.60px;top:240.19px" class="cls_023"><span class="cls_023">"IPv4Address": "172.18.0.2/16",</span></div>
<div style="position:absolute;left:165.60px;top:252.43px" class="cls_023"><span class="cls_023">"IPv4Address": "172.18.0.3/16",</span></div>
<div style="position:absolute;left:144.00px;top:272.17px" class="cls_008"><span class="cls_008">To get the subnet used by the network, use the following (for example):</span></div>
<div style="position:absolute;left:165.60px;top:288.79px" class="cls_024"><span class="cls_024">$ docker network inspect frontend | grep subnet</span></div>
<div style="position:absolute;left:144.00px;top:308.53px" class="cls_008"><span class="cls_008">You should receive something along the lines of the following (obtained from</span></div>
<div style="position:absolute;left:144.00px;top:321.13px" class="cls_008"><span class="cls_008">the previous example):</span></div>
<div style="position:absolute;left:165.60px;top:342.07px" class="cls_024"><span class="cls_024">"Subnet": "172.18.0.0/16",</span></div>
<div style="position:absolute;left:126.00px;top:361.81px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:361.81px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">host</span><span class="cls_008"> network allows us to run a container in the networking namespace</span></div>
<div style="position:absolute;left:144.00px;top:374.41px" class="cls_008"><span class="cls_008">of the host.</span></div>
<div style="position:absolute;left:126.01px;top:391.33px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:144.00px;top:391.33px" class="cls_008"><span class="cls_008">Only use this network for debugging purposes or when building a</span></div>
<div style="position:absolute;left:144.00px;top:403.93px" class="cls_008"><span class="cls_008">system-level tool. Never use the </span><span class="cls_010">host</span><span class="cls_008"> network for an application container</span></div>
<div style="position:absolute;left:144.00px;top:416.53px" class="cls_008"><span class="cls_008">running production!</span></div>
<div style="position:absolute;left:126.01px;top:433.45px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:144.00px;top:433.45px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">none</span><span class="cls_008"> network is basically saying that the container is not attached to any</span></div>
<div style="position:absolute;left:144.00px;top:446.05px" class="cls_008"><span class="cls_008">network. It should be used for containers that do not need to communicate</span></div>
<div style="position:absolute;left:144.00px;top:458.65px" class="cls_008"><span class="cls_008">with other containers and do not need to be accessed from outside.</span></div>
<div style="position:absolute;left:126.01px;top:475.57px" class="cls_008"><span class="cls_008">8.</span></div>
<div style="position:absolute;left:144.00px;top:475.57px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">none</span><span class="cls_008"> network could for example, be used for a batch process running in</span></div>
<div style="position:absolute;left:144.00px;top:488.17px" class="cls_008"><span class="cls_008">a container that only needs access to local resources such as files which could</span></div>
<div style="position:absolute;left:144.00px;top:500.77px" class="cls_008"><span class="cls_008">be accessed through a host mounted volume.</span></div>
<div style="position:absolute;left:108.00px;top:533.27px" class="cls_011"><span class="cls_011">Chapter 8: Docker Compose</span></div>
<div style="position:absolute;left:126.00px;top:558.25px" class="cls_008"><span class="cls_008">1.  The following code can be used to run the application in daemon mode.</span></div>
<div style="position:absolute;left:165.60px;top:574.87px" class="cls_024"><span class="cls_024">$ docker-compose up -d</span></div>
<div style="position:absolute;left:126.00px;top:594.61px" class="cls_008"><span class="cls_008">2.  Execute the following command to display the details of the running service.</span></div>
<div style="position:absolute;left:165.60px;top:611.23px" class="cls_024"><span class="cls_024">$ docker-compose ps</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 292 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:247016px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background316.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">This should result in the following output:</span></div>
<div style="position:absolute;left:165.60px;top:131.11px" class="cls_023"><span class="cls_023">Name</span></div>
<div style="position:absolute;left:257.40px;top:131.11px" class="cls_023"><span class="cls_023">Command</span></div>
<div style="position:absolute;left:370.80px;top:131.11px" class="cls_023"><span class="cls_023">State  Ports</span></div>
<div style="position:absolute;left:165.60px;top:143.35px" class="cls_023"><span class="cls_023">--------------------------------------------------------------</span></div>
<div style="position:absolute;left:144.00px;top:154.15px" class="cls_023"><span class="cls_023">----</span></div>
<div style="position:absolute;left:165.60px;top:166.39px" class="cls_023"><span class="cls_023">mycontent_nginx_1 nginx -g daemon off; Up</span></div>
<div style="position:absolute;left:414.00px;top:166.39px" class="cls_023"><span class="cls_023">0.0.0.0:3000-</span></div>
<div style="position:absolute;left:144.00px;top:177.19px" class="cls_023"><span class="cls_023">>80/tcp</span></div>
<div style="position:absolute;left:126.00px;top:196.93px" class="cls_008"><span class="cls_008">3.  The following command can be used to scale up the </span><span class="cls_010">web</span><span class="cls_008"> service:</span></div>
<div style="position:absolute;left:165.60px;top:217.87px" class="cls_024"><span class="cls_024">$ docker-compose up --scale web=3</span></div>
<div style="position:absolute;left:108.00px;top:257.51px" class="cls_011"><span class="cls_011">Chapter 9: Orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:282.49px" class="cls_008"><span class="cls_008">Here are the sample answers to the questions of this chapter:</span></div>
<div style="position:absolute;left:126.00px;top:303.74px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:143.99px;top:303.74px" class="cls_008"><span class="cls_008">Here are some reasons why we need an orchestration engine:</span></div>
<div style="position:absolute;left:161.99px;top:320.65px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:320.65px" class="cls_008"><span class="cls_008">Containers are ephemeral and only an automated system (the</span></div>
<div style="position:absolute;left:179.99px;top:333.25px" class="cls_008"><span class="cls_008">orchestrator) can handle this efficiently.</span></div>
<div style="position:absolute;left:161.99px;top:350.17px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:350.17px" class="cls_008"><span class="cls_008">For high availability reasons, we want to run multiple instances of</span></div>
<div style="position:absolute;left:179.99px;top:362.77px" class="cls_008"><span class="cls_008">each container. The number of containers to manage quickly becomes</span></div>
<div style="position:absolute;left:179.99px;top:375.37px" class="cls_008"><span class="cls_008">huge.</span></div>
<div style="position:absolute;left:161.99px;top:392.28px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:392.28px" class="cls_008"><span class="cls_008">To meet the demand of today's internet, we need to quickly scale up</span></div>
<div style="position:absolute;left:179.99px;top:404.88px" class="cls_008"><span class="cls_008">and down.</span></div>
<div style="position:absolute;left:161.99px;top:421.80px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:421.80px" class="cls_008"><span class="cls_008">Containers, contrary to VMs, are not treated as pets and fixed</span></div>
<div style="position:absolute;left:179.99px;top:434.40px" class="cls_008"><span class="cls_008">or healed when they misbehave, but are treated as cattle. If one</span></div>
<div style="position:absolute;left:179.99px;top:447.00px" class="cls_008"><span class="cls_008">misbehaves, we kill it and replace it with a new instance. The</span></div>
<div style="position:absolute;left:179.99px;top:459.60px" class="cls_008"><span class="cls_008">orchestrator quickly terminates an unhealthy container and schedules</span></div>
<div style="position:absolute;left:179.99px;top:472.20px" class="cls_008"><span class="cls_008">a new instance.</span></div>
<div style="position:absolute;left:125.99px;top:493.44px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:143.98px;top:493.44px" class="cls_008"><span class="cls_008">Here are some responsibilities of a container orchestration engine:</span></div>
<div style="position:absolute;left:161.98px;top:510.35px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:510.35px" class="cls_008"><span class="cls_008">Manages a set of nodes in a cluster</span></div>
<div style="position:absolute;left:161.98px;top:527.27px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:527.27px" class="cls_008"><span class="cls_008">Schedules workload to the nodes with sufficient free resources</span></div>
<div style="position:absolute;left:161.98px;top:544.19px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:544.19px" class="cls_008"><span class="cls_008">Monitors the health of nodes and workload</span></div>
<div style="position:absolute;left:161.98px;top:561.10px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:561.10px" class="cls_008"><span class="cls_008">Reconciles current state with desired state of applications and</span></div>
<div style="position:absolute;left:179.98px;top:573.70px" class="cls_008"><span class="cls_008">components</span></div>
<div style="position:absolute;left:161.98px;top:590.62px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:590.62px" class="cls_008"><span class="cls_008">Provides service discovery and routing</span></div>
<div style="position:absolute;left:161.98px;top:607.53px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:607.53px" class="cls_008"><span class="cls_008">Load balances requests</span></div>
<div style="position:absolute;left:161.98px;top:624.45px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.98px;top:624.45px" class="cls_008"><span class="cls_008">Secures confident data by providing support for secrets</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 293 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:247818px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background317.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">3.  Here is an (incomplete) list of orchestrators, sorted by their popularity:</span></div>
<div style="position:absolute;left:161.99px;top:131.41px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:131.41px" class="cls_008"><span class="cls_008">Kubernetes by Google, donated to the CNCF</span></div>
<div style="position:absolute;left:161.99px;top:148.32px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:148.32px" class="cls_008"><span class="cls_008">SwarmKit by Docker—that is, </span><span class="cls_009">Operations Support System</span><span class="cls_008"> (</span><span class="cls_009">OSS</span><span class="cls_008">)</span></div>
<div style="position:absolute;left:161.99px;top:165.24px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:165.24px" class="cls_008"><span class="cls_008">AWS ECS by Amazon</span></div>
<div style="position:absolute;left:161.99px;top:182.16px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:182.16px" class="cls_008"><span class="cls_008">Azure AKS by Microsoft</span></div>
<div style="position:absolute;left:161.99px;top:199.07px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:199.07px" class="cls_008"><span class="cls_008">Mesos by Apache—that is, OSS</span></div>
<div style="position:absolute;left:161.99px;top:215.99px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:215.99px" class="cls_008"><span class="cls_008">Cattle by Rancher</span></div>
<div style="position:absolute;left:161.99px;top:232.90px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:232.90px" class="cls_008"><span class="cls_008">Nomad by HashiCorp</span></div>
<div style="position:absolute;left:108.00px;top:265.43px" class="cls_011"><span class="cls_011">Chapter 10:  Orchestrating Containerized</span></div>
<div style="position:absolute;left:108.00px;top:289.43px" class="cls_011"><span class="cls_011">Applications with Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:314.41px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:144.00px;top:314.41px" class="cls_008"><span class="cls_008">The Kubernetes master is responsible for managing the cluster. All requests</span></div>
<div style="position:absolute;left:144.00px;top:327.01px" class="cls_008"><span class="cls_008">to create objects, the scheduling of pods, the managing of </span><span class="cls_010">ReplicaSets</span><span class="cls_008">,</span></div>
<div style="position:absolute;left:144.00px;top:339.61px" class="cls_008"><span class="cls_008">and more is happening on the master. The master does not run application</span></div>
<div style="position:absolute;left:144.00px;top:352.21px" class="cls_008"><span class="cls_008">workload in a production or production-like cluster.</span></div>
<div style="position:absolute;left:126.00px;top:369.13px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:369.13px" class="cls_008"><span class="cls_008">On each worker node, we have the kubelet, the proxy, and a</span></div>
<div style="position:absolute;left:144.00px;top:381.73px" class="cls_008"><span class="cls_008">container runtime.</span></div>
<div style="position:absolute;left:126.00px;top:398.64px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:398.64px" class="cls_008"><span class="cls_008">The answer is Yes. You cannot run standalone containers on a Kubernetes</span></div>
<div style="position:absolute;left:144.00px;top:411.24px" class="cls_008"><span class="cls_008">cluster. Pods are the atomic unit of deployment in such a cluster.</span></div>
<div style="position:absolute;left:126.00px;top:428.16px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:428.16px" class="cls_008"><span class="cls_008">All containers running inside a pod share the same Linux kernel network</span></div>
<div style="position:absolute;left:144.00px;top:440.76px" class="cls_008"><span class="cls_008">namespace. Thus, all processes running inside those containers can</span></div>
<div style="position:absolute;left:144.00px;top:453.36px" class="cls_008"><span class="cls_008">communicate with each other through </span><span class="cls_010">localhost</span><span class="cls_008"> in a similar way that</span></div>
<div style="position:absolute;left:144.00px;top:465.97px" class="cls_008"><span class="cls_008">processes or applications directly running on the host can communicate</span></div>
<div style="position:absolute;left:144.00px;top:478.57px" class="cls_008"><span class="cls_008">with each other through </span><span class="cls_010">localhost</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:495.49px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:495.49px" class="cls_008"><span class="cls_008">The </span><span class="cls_010">pause</span><span class="cls_008"> container's sole role is to reserve the namespaces of the pod for</span></div>
<div style="position:absolute;left:144.00px;top:508.09px" class="cls_008"><span class="cls_008">the containers that run in the pod.</span></div>
<div style="position:absolute;left:126.00px;top:525.01px" class="cls_008"><span class="cls_008">6.</span></div>
<div style="position:absolute;left:144.00px;top:525.01px" class="cls_008"><span class="cls_008">This is a bad idea since all containers of a pod are co-located, which means</span></div>
<div style="position:absolute;left:144.00px;top:537.61px" class="cls_008"><span class="cls_008">they run on the same cluster node. But the different component of the</span></div>
<div style="position:absolute;left:144.00px;top:550.21px" class="cls_008"><span class="cls_008">application (that is, </span><span class="cls_010">web</span><span class="cls_008">, </span><span class="cls_010">inventory</span><span class="cls_008">, and </span><span class="cls_010">db</span><span class="cls_008">) usually have very different</span></div>
<div style="position:absolute;left:144.00px;top:562.81px" class="cls_008"><span class="cls_008">requirements in regards to scalability or resource consumption. The </span><span class="cls_010">web</span></div>
<div style="position:absolute;left:144.00px;top:575.41px" class="cls_008"><span class="cls_008">component might need to be scaled up and down depending on the traffic</span></div>
<div style="position:absolute;left:144.00px;top:588.01px" class="cls_008"><span class="cls_008">and the </span><span class="cls_010">db</span><span class="cls_008"> component in turn has special requirements on storage that the</span></div>
<div style="position:absolute;left:144.00px;top:600.61px" class="cls_008"><span class="cls_008">others don't have. If we do run every component in its own pod, we are</span></div>
<div style="position:absolute;left:144.00px;top:613.21px" class="cls_008"><span class="cls_008">much more flexible in this regard.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 294 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:248620px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background318.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:126.00px;top:114.49px" class="cls_008"><span class="cls_008">7.</span></div>
<div style="position:absolute;left:144.00px;top:114.49px" class="cls_008"><span class="cls_008">We need a mechanism to run multiple instances of a pod in a cluster and</span></div>
<div style="position:absolute;left:144.00px;top:127.09px" class="cls_008"><span class="cls_008">make sure that the actual number of pods running always corresponds to</span></div>
<div style="position:absolute;left:144.00px;top:139.69px" class="cls_008"><span class="cls_008">the desired number, even when individual pods crash or disappear due to</span></div>
<div style="position:absolute;left:144.00px;top:152.29px" class="cls_008"><span class="cls_008">network partition or cluster node failures. The ReplicaSet is this mechanism</span></div>
<div style="position:absolute;left:144.00px;top:164.89px" class="cls_008"><span class="cls_008">that provides scalability and self-healing to any application service.</span></div>
<div style="position:absolute;left:126.00px;top:181.81px" class="cls_008"><span class="cls_008">8.</span></div>
<div style="position:absolute;left:144.00px;top:181.81px" class="cls_008"><span class="cls_008">We need deployment objects whenever we want to update an application</span></div>
<div style="position:absolute;left:144.00px;top:194.41px" class="cls_008"><span class="cls_008">service in a Kubernetes cluster without causing downtime to the service.</span></div>
<div style="position:absolute;left:144.00px;top:207.01px" class="cls_008"><span class="cls_008">Deployment objects add rolling update and rollback capabilities to ReplicaSets.</span></div>
<div style="position:absolute;left:126.00px;top:223.93px" class="cls_008"><span class="cls_008">9.</span></div>
<div style="position:absolute;left:144.00px;top:223.93px" class="cls_008"><span class="cls_008">Kubernetes service objects are used to make application services participate</span></div>
<div style="position:absolute;left:144.00px;top:236.52px" class="cls_008"><span class="cls_008">in service discovery. They provide a stable endpoint to a set of pods</span></div>
<div style="position:absolute;left:144.00px;top:249.13px" class="cls_008"><span class="cls_008">(normally governed by a ReplicaSet or a deployment). Kube services are</span></div>
<div style="position:absolute;left:144.00px;top:261.73px" class="cls_008"><span class="cls_008">abstractions which define a logical set of pods and a policy on how to access</span></div>
<div style="position:absolute;left:144.00px;top:274.33px" class="cls_008"><span class="cls_008">them. There are four types of Kube services:</span></div>
<div style="position:absolute;left:161.99px;top:291.24px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:291.24px" class="cls_009"><span class="cls_009">ClusterIP</span><span class="cls_008">: Exposes the service on an IP address only accessible from</span></div>
<div style="position:absolute;left:179.99px;top:303.84px" class="cls_008"><span class="cls_008">inside the cluster; this is a </span><span class="cls_009">virtual IP</span><span class="cls_008"> (</span><span class="cls_009">VIP</span><span class="cls_008">)</span></div>
<div style="position:absolute;left:161.99px;top:320.76px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:320.76px" class="cls_009"><span class="cls_009">NodePort</span><span class="cls_008">: Publishes a port in the range 30,000-32767 on every</span></div>
<div style="position:absolute;left:179.99px;top:333.36px" class="cls_008"><span class="cls_008">cluster node</span></div>
<div style="position:absolute;left:161.99px;top:350.27px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:350.27px" class="cls_009"><span class="cls_009">LoadBalancer</span><span class="cls_008">: This type exposes the application service externally</span></div>
<div style="position:absolute;left:179.99px;top:362.87px" class="cls_008"><span class="cls_008">using a cloud provider's load balancer such as ELB on AWS</span></div>
<div style="position:absolute;left:161.99px;top:379.79px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:379.79px" class="cls_009"><span class="cls_009">ExternalName</span><span class="cls_008">: Used when you need to define a proxy for a cluster</span></div>
<div style="position:absolute;left:179.99px;top:392.39px" class="cls_008"><span class="cls_008">external service such as a database</span></div>
<div style="position:absolute;left:108.00px;top:424.91px" class="cls_011"><span class="cls_011">Chapter 11: Deploying, Updating, and</span></div>
<div style="position:absolute;left:108.00px;top:448.91px" class="cls_011"><span class="cls_011">Securing an Application with Kubernetes</span></div>
<div style="position:absolute;left:126.00px;top:473.89px" class="cls_008"><span class="cls_008">1.  Assuming we have a Docker image in a registry for the two application</span></div>
<div style="position:absolute;left:144.00px;top:486.49px" class="cls_008"><span class="cls_008">services, the web API and Mongo DB, we then need to do the following:</span></div>
<div style="position:absolute;left:161.99px;top:503.41px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:503.41px" class="cls_008"><span class="cls_008">Define a deployment for Mongo DB using a </span><span class="cls_010"> StatefulSet</span><span class="cls_008">; let's call</span></div>
<div style="position:absolute;left:180.00px;top:516.01px" class="cls_008"><span class="cls_008">this deployment </span><span class="cls_010">db-deployment</span><span class="cls_008">. The </span><span class="cls_010">StatefulSet</span><span class="cls_008"> should have one</span></div>
<div style="position:absolute;left:180.00px;top:528.61px" class="cls_008"><span class="cls_008">replica (replicating Mongo DB is a bit more involved and is outside of</span></div>
<div style="position:absolute;left:180.00px;top:541.21px" class="cls_008"><span class="cls_008">the scope of this book).</span></div>
<div style="position:absolute;left:162.01px;top:558.13px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:558.13px" class="cls_008"><span class="cls_008">Define a Kubernetes service called </span><span class="cls_010">db</span><span class="cls_008"> of type </span><span class="cls_010">ClusterIP</span><span class="cls_008"> for the </span><span class="cls_010">db-</span></div>
<div style="position:absolute;left:180.00px;top:570.53px" class="cls_010"><span class="cls_010">deployment.</span></div>
<div style="position:absolute;left:162.00px;top:586.45px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:586.45px" class="cls_008"><span class="cls_008">Define a deployment for the web API; let's call it </span><span class="cls_010">web-deployment</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:180.00px;top:599.05px" class="cls_008"><span class="cls_008">Let's scale this service to three instances.</span></div>
<div style="position:absolute;left:162.00px;top:615.97px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:615.97px" class="cls_008"><span class="cls_008">Define a Kubernetes service called </span><span class="cls_010">api</span><span class="cls_008"> of type </span><span class="cls_010">NodePort</span><span class="cls_008"> for </span><span class="cls_010">web-</span></div>
<div style="position:absolute;left:180.00px;top:628.57px" class="cls_010"><span class="cls_010">deployment</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 295 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:249422px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background319.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.56px" class="cls_019"><span class="cls_019">Assessment</span></div>
<div style="position:absolute;left:162.00px;top:114.49px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:114.49px" class="cls_008"><span class="cls_008">If we use secrets, then define those secrets directly in the cluster using</span></div>
<div style="position:absolute;left:180.00px;top:127.09px" class="cls_010"><span class="cls_010">kubectl</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:162.00px;top:144.01px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:144.01px" class="cls_008"><span class="cls_008">Deploy the application using </span><span class="cls_010">kubectl</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:165.26px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:165.26px" class="cls_008"><span class="cls_008">To implement layer 7 routing for an application, we ideally use an</span></div>
<div style="position:absolute;left:144.00px;top:177.85px" class="cls_010"><span class="cls_010">IngressController</span><span class="cls_008">. The </span><span class="cls_010">IngressController</span><span class="cls_008"> is a reverse proxy such as</span></div>
<div style="position:absolute;left:144.00px;top:190.45px" class="cls_008"><span class="cls_008">Nginx that has a sidecar listening on the Kubernetes Server API for relevant</span></div>
<div style="position:absolute;left:144.00px;top:203.05px" class="cls_008"><span class="cls_008">changes and updating the reverse proxy's configuration and restarting it, if</span></div>
<div style="position:absolute;left:144.00px;top:215.65px" class="cls_008"><span class="cls_008">such a change has been detected. We then need to define Ingress resources in</span></div>
<div style="position:absolute;left:144.00px;top:228.25px" class="cls_008"><span class="cls_008">the cluster which define the routing, for example from a context-based route</span></div>
<div style="position:absolute;left:144.00px;top:240.85px" class="cls_008"><span class="cls_008">such as  </span><A HREF="https://example.com/pets/">https://example.com/pets</A> </span><span class="cls_008">  to </span><span class="cls_010">&lt;a service name>/&lt;port></span><span class="cls_008"> pair</span></div>
<div style="position:absolute;left:144.01px;top:253.45px" class="cls_008"><span class="cls_008">such as </span><span class="cls_010">api/32001</span><span class="cls_008">. The moment Kubernetes creates or changes this Ingress</span></div>
<div style="position:absolute;left:144.00px;top:266.05px" class="cls_008"><span class="cls_008">object, the </span><span class="cls_010">IngressController</span><span class="cls_008">'s sidecar picks it up and updates the proxy's</span></div>
<div style="position:absolute;left:144.00px;top:278.65px" class="cls_008"><span class="cls_008">routing configuration.</span></div>
<div style="position:absolute;left:126.00px;top:295.57px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:144.00px;top:295.57px" class="cls_008"><span class="cls_008">Assuming this is a </span><span class="cls_009">cluster internal</span><span class="cls_008"> inventory service:</span></div>
<div style="position:absolute;left:161.99px;top:312.48px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:312.48px" class="cls_008"><span class="cls_008">When deploying version 1.0 we define a deployment called</span></div>
<div style="position:absolute;left:180.00px;top:325.09px" class="cls_010"><span class="cls_010">inventory-deployment-blue</span><span class="cls_008"> and label the pods with a label </span><span class="cls_010">color:</span></div>
<div style="position:absolute;left:180.00px;top:337.69px" class="cls_010"><span class="cls_010">blue</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:162.00px;top:354.61px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:354.61px" class="cls_008"><span class="cls_008">We deploy the Kubernetes service of type </span><span class="cls_010">ClusterIP</span><span class="cls_008"> called</span></div>
<div style="position:absolute;left:180.00px;top:367.21px" class="cls_010"><span class="cls_010">inventory</span><span class="cls_008"> for the preceding deployment with the selector containing</span></div>
<div style="position:absolute;left:180.00px;top:379.81px" class="cls_010"><span class="cls_010">color: blue</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:162.00px;top:396.73px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:179.99px;top:396.73px" class="cls_008"><span class="cls_008">When ready to deploy the new version of the payments service, we</span></div>
<div style="position:absolute;left:179.99px;top:409.33px" class="cls_008"><span class="cls_008">first define a deployment for version 2.0 of the service and call it</span></div>
<div style="position:absolute;left:180.00px;top:421.93px" class="cls_010"><span class="cls_010">inventory-deployment-green</span><span class="cls_008">. We add a label </span><span class="cls_010">color: green</span></div>
<div style="position:absolute;left:180.00px;top:434.53px" class="cls_008"><span class="cls_008">to the pods.</span></div>
<div style="position:absolute;left:162.00px;top:451.45px" class="cls_029"><span class="cls_029">°</span><span class="cls_008">°</span></div>
<div style="position:absolute;left:180.00px;top:451.45px" class="cls_008"><span class="cls_008">We can now smoke test the "green" service and when everything is</span></div>
<div style="position:absolute;left:180.00px;top:464.05px" class="cls_008"><span class="cls_008">OK, we can update the inventory service such as the selector contains</span></div>
<div style="position:absolute;left:180.00px;top:476.65px" class="cls_010"><span class="cls_010">color: green</span><span class="cls_008">.</span></div>
<div style="position:absolute;left:126.00px;top:497.90px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:497.90px" class="cls_008"><span class="cls_008">Some type of information that is confidential and thus should be provided to</span></div>
<div style="position:absolute;left:144.00px;top:510.50px" class="cls_008"><span class="cls_008">services through Kubernetes secrets include: passwords, certificates, API key</span></div>
<div style="position:absolute;left:144.00px;top:523.10px" class="cls_008"><span class="cls_008">IDs, API key secrets or tokens.</span></div>
<div style="position:absolute;left:126.00px;top:540.01px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:540.01px" class="cls_008"><span class="cls_008">Sources for secret values can be files or base-64 encoded values.</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 296 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:250224px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background320.jpg" width=612 height=792></div>
<div style="position:absolute;left:469.11px;top:94.56px" class="cls_019"><span class="cls_019">Appendix</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Chapter 12: Running a Containerized App</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">in the Cloud</span></div>
<div style="position:absolute;left:126.00px;top:160.90px" class="cls_008"><span class="cls_008">1.</span></div>
<div style="position:absolute;left:144.00px;top:160.90px" class="cls_008"><span class="cls_008">You can use either the graphical user interface of the Azure portal, the Azure</span></div>
<div style="position:absolute;left:144.00px;top:173.50px" class="cls_008"><span class="cls_008">CLI or Azure Resource Templates combined with a tool such as Terraform to</span></div>
<div style="position:absolute;left:144.00px;top:186.10px" class="cls_008"><span class="cls_008">provision a fully hosted cluster on AKS.</span></div>
<div style="position:absolute;left:126.00px;top:203.02px" class="cls_008"><span class="cls_008">2.</span></div>
<div style="position:absolute;left:144.00px;top:203.02px" class="cls_008"><span class="cls_008">Here are a few reasons why it makes sense to use the Azure Container</span></div>
<div style="position:absolute;left:144.00px;top:215.62px" class="cls_008"><span class="cls_008">Registry to store images:</span></div>
<div style="position:absolute;left:161.99px;top:232.53px" class="cls_008"><span class="cls_008">3.  To avoid high latency when deploying images into a production</span></div>
<div style="position:absolute;left:179.99px;top:245.13px" class="cls_008"><span class="cls_008">system, it is important to have them stored in a container registry</span></div>
<div style="position:absolute;left:179.99px;top:257.73px" class="cls_008"><span class="cls_008">close to the Kubernetes cluster where the containers created from the</span></div>
<div style="position:absolute;left:179.99px;top:270.33px" class="cls_008"><span class="cls_008">images will be running.</span></div>
<div style="position:absolute;left:161.99px;top:287.25px" class="cls_008"><span class="cls_008">4.  For security reasons, one might not want the hosts of the Kubernetes</span></div>
<div style="position:absolute;left:179.99px;top:299.85px" class="cls_008"><span class="cls_008">cluster to reach outside of the Azure network to download images</span></div>
<div style="position:absolute;left:179.99px;top:312.45px" class="cls_008"><span class="cls_008">from an external container registry such as Docker Hub. The ACR</span></div>
<div style="position:absolute;left:179.99px;top:325.05px" class="cls_008"><span class="cls_008">can be in the same (internal) network as the Kubernetes cluster.</span></div>
<div style="position:absolute;left:161.99px;top:341.96px" class="cls_008"><span class="cls_008">5.  The bandwidth used to download container images is cheaper if it is</span></div>
<div style="position:absolute;left:179.99px;top:354.56px" class="cls_008"><span class="cls_008">inside the same data center than when using external data links.</span></div>
<div style="position:absolute;left:161.99px;top:371.48px" class="cls_008"><span class="cls_008">6.  If we want to concentrate on a single vendor and not deal with</span></div>
<div style="position:absolute;left:179.99px;top:384.08px" class="cls_008"><span class="cls_008">multiple vendors.</span></div>
<div style="position:absolute;left:125.99px;top:405.32px" class="cls_008"><span class="cls_008">3.</span></div>
<div style="position:absolute;left:143.99px;top:405.32px" class="cls_008"><span class="cls_008">To run a containerized application in AKS we need to:</span></div>
<div style="position:absolute;left:161.98px;top:422.23px" class="cls_008"><span class="cls_008">1.  Provision a fully managed Kubernetes cluster on AKS</span></div>
<div style="position:absolute;left:161.98px;top:439.15px" class="cls_008"><span class="cls_008">2.  Build and push the container images to the ACR</span></div>
<div style="position:absolute;left:161.98px;top:456.07px" class="cls_008"><span class="cls_008">3.  Use </span><span class="cls_010">kubectl</span><span class="cls_008"> to deploy the application into the cluster</span></div>
<div style="position:absolute;left:126.00px;top:477.34px" class="cls_008"><span class="cls_008">4.</span></div>
<div style="position:absolute;left:144.00px;top:477.34px" class="cls_008"><span class="cls_008">One way to view the container logs or the </span><span class="cls_010">kubelet</span><span class="cls_008"> logs of any worker node</span></div>
<div style="position:absolute;left:143.99px;top:489.94px" class="cls_008"><span class="cls_008">is to SSH into that node. We do that by running a special container on said</span></div>
<div style="position:absolute;left:143.99px;top:502.54px" class="cls_008"><span class="cls_008">host from within which we will establish the SSH connection to the host. We</span></div>
<div style="position:absolute;left:143.99px;top:515.14px" class="cls_008"><span class="cls_008">can then use a tool such as </span><span class="cls_010">journalctl</span><span class="cls_008"> to analyze the system logs, or just</span></div>
<div style="position:absolute;left:144.00px;top:527.74px" class="cls_008"><span class="cls_008">execute normal docker commands on the host to retrieve the container logs.</span></div>
<div style="position:absolute;left:126.00px;top:544.66px" class="cls_008"><span class="cls_008">5.</span></div>
<div style="position:absolute;left:144.00px;top:544.66px" class="cls_008"><span class="cls_008">We can use the Azure CLI to scale the number of worker nodes up or down.</span></div>
<div style="position:absolute;left:144.00px;top:557.26px" class="cls_008"><span class="cls_008">The command to do so is:</span></div>
<div style="position:absolute;left:166.00px;top:573.88px" class="cls_024"><span class="cls_024">az aks scale --resource-group=&lt;group-name> --name=&lt;cluster-</span></div>
<div style="position:absolute;left:166.00px;top:584.68px" class="cls_024"><span class="cls_024">name> --node-count &lt;num-nodes></span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 297 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:251026px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background321.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:251026px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background322.jpg" width=612 height=792></div>
<div style="position:absolute;left:130.45px;top:218.35px" class="cls_015"><span class="cls_015">Other Books You May Enjoy</span></div>
<div style="position:absolute;left:108.00px;top:271.95px" class="cls_033"><span class="cls_033">If you enjoyed this book, you may be interested in these other books by Packt:</span></div>
<div style="position:absolute;left:108.00px;top:428.47px" class="cls_034"><span class="cls_034">Docker on Windows</span></div>
<div style="position:absolute;left:108.00px;top:449.11px" class="cls_033"><span class="cls_033">Elton Stoneman</span></div>
<div style="position:absolute;left:108.00px;top:469.75px" class="cls_033"><span class="cls_033">ISBN: 978-1-78528-165-5</span></div>
<div style="position:absolute;left:126.00px;top:493.39px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:490.39px" class="cls_033"><span class="cls_033">Comprehend key Docker concepts: images, containers, registries, and swarms</span></div>
<div style="position:absolute;left:126.00px;top:509.71px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:506.71px" class="cls_033"><span class="cls_033">Run Docker on Windows 10, Windows Server 2016, and in the cloud</span></div>
<div style="position:absolute;left:126.00px;top:526.03px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:523.03px" class="cls_033"><span class="cls_033">Deploy and monitor distributed solutions across multiple Docker containers</span></div>
<div style="position:absolute;left:126.00px;top:542.35px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:539.35px" class="cls_033"><span class="cls_033">Run containers with high availability and fail-over with Docker Swarm</span></div>
<div style="position:absolute;left:126.00px;top:558.67px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:555.67px" class="cls_033"><span class="cls_033">Master security in-depth with the Docker platform, making your apps</span></div>
<div style="position:absolute;left:144.00px;top:567.67px" class="cls_033"><span class="cls_033">more secure</span></div>
<div style="position:absolute;left:126.00px;top:586.99px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:583.99px" class="cls_033"><span class="cls_033">Build a Continuous Deployment pipeline by running Jenkins in Docker</span></div>
<div style="position:absolute;left:126.00px;top:603.31px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:600.31px" class="cls_033"><span class="cls_033">Debug applications running in Docker containers using Visual Studio</span></div>
<div style="position:absolute;left:126.00px;top:619.63px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:616.63px" class="cls_033"><span class="cls_033">Plan the adoption of Docker in your own organization</span></div>
<div style="position:absolute;left:477.22px;top:666.54px" class="cls_032"><span class="cls_032">299</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:251828px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background323.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:94.29px" class="cls_037"><span class="cls_037">Another Book You May Enjoy</span></div>
<div style="position:absolute;left:108.00px;top:253.01px" class="cls_034"><span class="cls_034">Docker for Serverless Applications</span></div>
<div style="position:absolute;left:108.00px;top:273.65px" class="cls_033"><span class="cls_033">Chanwit Kaewkasi</span></div>
<div style="position:absolute;left:108.00px;top:294.29px" class="cls_033"><span class="cls_033">ISBN: 978-1-78883-526-8</span></div>
<div style="position:absolute;left:126.00px;top:317.93px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:314.93px" class="cls_033"><span class="cls_033">Learn what Serverless and FaaS applications are</span></div>
<div style="position:absolute;left:126.00px;top:334.25px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:331.25px" class="cls_033"><span class="cls_033">Get acquainted with the architectures of three major serverless systems</span></div>
<div style="position:absolute;left:126.00px;top:350.57px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:347.57px" class="cls_033"><span class="cls_033">Explore how Docker technologies can help develop Serverless applications</span></div>
<div style="position:absolute;left:126.00px;top:366.89px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:363.89px" class="cls_033"><span class="cls_033">Create and maintain FaaS infrastructures</span></div>
<div style="position:absolute;left:126.00px;top:383.21px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:380.21px" class="cls_033"><span class="cls_033">Set up Docker infrastructures to serve as on-premises FaaS infrastructures</span></div>
<div style="position:absolute;left:126.00px;top:399.53px" class="cls_036"><span class="cls_036">f</span><span class="cls_035">f</span></div>
<div style="position:absolute;left:144.00px;top:396.53px" class="cls_033"><span class="cls_033">Define functions for Serverless applications with Docker containers</span></div>
<div style="position:absolute;left:118.47px;top:666.54px" class="cls_032"><span class="cls_032">300</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:252630px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background324.jpg" width=612 height=792></div>
<div style="position:absolute;left:384.47px;top:94.04px" class="cls_037"><span class="cls_037">Another Book You May Enjoy</span></div>
<div style="position:absolute;left:108.00px;top:111.92px" class="cls_011"><span class="cls_011">Leave a review - let other readers know</span></div>
<div style="position:absolute;left:108.00px;top:135.92px" class="cls_011"><span class="cls_011">what you think</span></div>
<div style="position:absolute;left:108.00px;top:160.80px" class="cls_033"><span class="cls_033">Please share your thoughts on this book with others by leaving a review on the site that</span></div>
<div style="position:absolute;left:108.00px;top:172.80px" class="cls_033"><span class="cls_033">you bought it from. If you purchased the book from Amazon, please leave us an honest</span></div>
<div style="position:absolute;left:108.00px;top:184.80px" class="cls_033"><span class="cls_033">review on this book's Amazon page. This is vital so that other potential readers can see</span></div>
<div style="position:absolute;left:108.00px;top:196.80px" class="cls_033"><span class="cls_033">and use your unbiased opinion to make purchasing decisions, we can understand what</span></div>
<div style="position:absolute;left:108.00px;top:208.80px" class="cls_033"><span class="cls_033">our customers think about our products, and our authors can see your feedback on the</span></div>
<div style="position:absolute;left:108.00px;top:220.80px" class="cls_033"><span class="cls_033">title that they have worked with Packt to create. It will only take a few minutes of your</span></div>
<div style="position:absolute;left:108.00px;top:232.80px" class="cls_033"><span class="cls_033">time, but is valuable to other potential customers, our authors, and Packt. Thank you!</span></div>
<div style="position:absolute;left:477.22px;top:666.54px" class="cls_032"><span class="cls_032">301</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:253432px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background325.jpg" width=612 height=792></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:253432px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background326.jpg" width=612 height=792></div>
<div style="position:absolute;left:430.61px;top:185.09px" class="cls_015"><span class="cls_015">Index</span></div>
<div style="position:absolute;left:311.40px;top:241.52px" class="cls_027"><span class="cls_027">chief technology officer (CTO)  170</span></div>
<div style="position:absolute;left:108.00px;top:240.32px" class="cls_007"><span class="cls_007">A</span></div>
<div style="position:absolute;left:311.40px;top:252.92px" class="cls_027"><span class="cls_027">Chocolatey</span></div>
<div style="position:absolute;left:108.00px;top:263.42px" class="cls_027"><span class="cls_027">Accelerated Processing Unit (APU)  170</span></div>
<div style="position:absolute;left:318.41px;top:264.32px" class="cls_025"><span class="cls_025">installing, on Windows  18</span></div>
<div style="position:absolute;left:108.00px;top:274.82px" class="cls_027"><span class="cls_027">ADD keyword  66</span></div>
<div style="position:absolute;left:318.41px;top:275.72px" class="cls_025"><span class="cls_025">reference  18</span></div>
<div style="position:absolute;left:108.00px;top:286.22px" class="cls_027"><span class="cls_027">Amazon ECS  179</span></div>
<div style="position:absolute;left:311.40px;top:287.12px" class="cls_027"><span class="cls_027">circuit breaker  119</span></div>
<div style="position:absolute;left:108.00px;top:297.62px" class="cls_027"><span class="cls_027">Apache Mesos  178</span></div>
<div style="position:absolute;left:311.40px;top:298.52px" class="cls_027"><span class="cls_027">cloud</span></div>
<div style="position:absolute;left:108.00px;top:309.02px" class="cls_027"><span class="cls_027">application</span></div>
<div style="position:absolute;left:318.41px;top:309.92px" class="cls_025"><span class="cls_025">edit-and-continue style development,</span></div>
<div style="position:absolute;left:115.00px;top:320.42px" class="cls_025"><span class="cls_025">building  159</span></div>
<div style="position:absolute;left:339.41px;top:321.32px" class="cls_025"><span class="cls_025">enabling  282, 283</span></div>
<div style="position:absolute;left:115.00px;top:331.82px" class="cls_025"><span class="cls_025">database, deploying  220-224</span></div>
<div style="position:absolute;left:311.41px;top:332.72px" class="cls_027"><span class="cls_027">Cloud Native Computing Foundation</span></div>
<div style="position:absolute;left:115.00px;top:343.22px" class="cls_025"><span class="cls_025">deploying  216</span></div>
<div style="position:absolute;left:339.41px;top:344.12px" class="cls_027"><span class="cls_027">(CNCF)  8, 175</span></div>
<div style="position:absolute;left:115.00px;top:354.62px" class="cls_025"><span class="cls_025">deploying, into Kubernetes cluster  255-257</span></div>
<div style="position:absolute;left:311.41px;top:355.52px" class="cls_027"><span class="cls_027">cluster nodes  186</span></div>
<div style="position:absolute;left:115.00px;top:366.02px" class="cls_025"><span class="cls_025">deployment, streamlining  225, 226</span></div>
<div style="position:absolute;left:311.41px;top:366.92px" class="cls_027"><span class="cls_027">CMD keywords  68, 69</span></div>
<div style="position:absolute;left:115.00px;top:377.42px" class="cls_025"><span class="cls_025">pushing  159</span></div>
<div style="position:absolute;left:311.41px;top:378.32px" class="cls_027"><span class="cls_027">code editor</span></div>
<div style="position:absolute;left:115.00px;top:388.82px" class="cls_025"><span class="cls_025">web component, deploying  216-219</span></div>
<div style="position:absolute;left:318.42px;top:389.72px" class="cls_025"><span class="cls_025">selecting  19</span></div>
<div style="position:absolute;left:108.00px;top:400.22px" class="cls_027"><span class="cls_027">attach command</span></div>
<div style="position:absolute;left:311.41px;top:401.12px" class="cls_027"><span class="cls_027">command-line interface (CLI)  33</span></div>
<div style="position:absolute;left:115.00px;top:411.62px" class="cls_025"><span class="cls_025">using, into running containers  43, 44</span></div>
<div style="position:absolute;left:311.41px;top:412.52px" class="cls_027"><span class="cls_027">Community Edition (CE)  8</span></div>
<div style="position:absolute;left:108.00px;top:423.02px" class="cls_027"><span class="cls_027">Azure</span></div>
<div style="position:absolute;left:311.41px;top:423.92px" class="cls_027"><span class="cls_027">complex Dockerfile  70</span></div>
<div style="position:absolute;left:115.00px;top:434.42px" class="cls_025"><span class="cls_025">fully managed Kubernetes cluster,</span></div>
<div style="position:absolute;left:311.41px;top:435.32px" class="cls_027"><span class="cls_027">components, container plumbing</span></div>
<div style="position:absolute;left:136.01px;top:445.82px" class="cls_025"><span class="cls_025">creating  244, 245</span></div>
<div style="position:absolute;left:318.42px;top:446.72px" class="cls_025"><span class="cls_025">Containerd  52, 53</span></div>
<div style="position:absolute;left:108.01px;top:457.22px" class="cls_027"><span class="cls_027">Azure CLI</span></div>
<div style="position:absolute;left:318.42px;top:458.12px" class="cls_025"><span class="cls_025">Runc  52</span></div>
<div style="position:absolute;left:115.01px;top:468.62px" class="cls_025"><span class="cls_025">running  245-247</span></div>
<div style="position:absolute;left:311.41px;top:469.52px" class="cls_027"><span class="cls_027">container architecture  10, 11</span></div>
<div style="position:absolute;left:108.01px;top:480.02px" class="cls_027"><span class="cls_027">Azure Container Registry (ACR)</span></div>
<div style="position:absolute;left:311.41px;top:480.92px" class="cls_027"><span class="cls_027">container ecosystem  9</span></div>
<div style="position:absolute;left:115.01px;top:491.42px" class="cls_025"><span class="cls_025">creating  252</span></div>
<div style="position:absolute;left:311.41px;top:492.32px" class="cls_027"><span class="cls_027">container logs</span></div>
<div style="position:absolute;left:115.01px;top:502.82px" class="cls_025"><span class="cls_025">Docker images, pushing to  251</span></div>
<div style="position:absolute;left:318.42px;top:503.72px" class="cls_025"><span class="cls_025">logging drivers  46</span></div>
<div style="position:absolute;left:115.01px;top:514.22px" class="cls_025"><span class="cls_025">service principal, configuring  254, 255</span></div>
<div style="position:absolute;left:318.42px;top:515.12px" class="cls_025"><span class="cls_025">retrieving  45, 46</span></div>
<div style="position:absolute;left:318.42px;top:526.52px" class="cls_025"><span class="cls_025">viewing  267-270</span></div>
<div style="position:absolute;left:108.00px;top:533.72px" class="cls_007"><span class="cls_007">B</span></div>
<div style="position:absolute;left:311.41px;top:537.92px" class="cls_027"><span class="cls_027">Container Network Interface (CNI)  183</span></div>
<div style="position:absolute;left:311.41px;top:549.32px" class="cls_027"><span class="cls_027">container network model (CNM)</span></div>
<div style="position:absolute;left:108.00px;top:556.82px" class="cls_027"><span class="cls_027">bare metal  182</span></div>
<div style="position:absolute;left:318.42px;top:560.72px" class="cls_025"><span class="cls_025">about  128, 129, 149, </span><span class="cls_027">177</span></div>
<div style="position:absolute;left:108.00px;top:568.22px" class="cls_027"><span class="cls_027">blue-box-12a  111</span></div>
<div style="position:absolute;left:318.42px;top:572.12px" class="cls_025"><span class="cls_025">endpoint  129</span></div>
<div style="position:absolute;left:108.00px;top:579.62px" class="cls_027"><span class="cls_027">blue-green deployments  169</span></div>
<div style="position:absolute;left:318.42px;top:583.52px" class="cls_025"><span class="cls_025">network  129</span></div>
<div style="position:absolute;left:108.00px;top:591.02px" class="cls_027"><span class="cls_027">bridge network</span><span class="cls_025">  131-141</span></div>
<div style="position:absolute;left:318.42px;top:594.92px" class="cls_025"><span class="cls_025">sandbox  128</span></div>
<div style="position:absolute;left:311.41px;top:606.32px" class="cls_027"><span class="cls_027">Container Runtime  187</span></div>
<div style="position:absolute;left:108.00px;top:610.52px" class="cls_007"><span class="cls_007">C</span></div>
<div style="position:absolute;left:311.41px;top:617.72px" class="cls_027"><span class="cls_027">containers</span></div>
<div style="position:absolute;left:318.42px;top:629.12px" class="cls_025"><span class="cls_025">about  2-4</span></div>
<div style="position:absolute;left:108.00px;top:633.62px" class="cls_027"><span class="cls_027">canary releases  169</span></div>
<div style="position:absolute;left:318.42px;top:640.52px" class="cls_025"><span class="cls_025">anatomy  48</span></div>
<div style="position:absolute;left:108.00px;top:645.02px" class="cls_027"><span class="cls_027">chief information officer (CIO)  170</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 303 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:254234px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background327.jpg" width=612 height=792></div>
<div style="position:absolute;left:115.00px;top:114.77px" class="cls_025"><span class="cls_025">architecture  49</span></div>
<div style="position:absolute;left:318.41px;top:114.77px" class="cls_025"><span class="cls_025">defensive programming  117</span></div>
<div style="position:absolute;left:115.00px;top:126.17px" class="cls_025"><span class="cls_025">benefits  6</span></div>
<div style="position:absolute;left:318.41px;top:126.17px" class="cls_025"><span class="cls_025">executing, in production  120</span></div>
<div style="position:absolute;left:115.00px;top:137.57px" class="cls_025"><span class="cls_025">control groups (cgroups)  51</span></div>
<div style="position:absolute;left:318.41px;top:137.57px" class="cls_025"><span class="cls_025">health checks  118</span></div>
<div style="position:absolute;left:115.00px;top:148.97px" class="cls_025"><span class="cls_025">data, sharing between  91, 92</span></div>
<div style="position:absolute;left:318.41px;top:148.97px" class="cls_025"><span class="cls_025">load balancing  116</span></div>
<div style="position:absolute;left:115.00px;top:160.37px" class="cls_025"><span class="cls_025">executing  32, 33</span></div>
<div style="position:absolute;left:318.41px;top:160.37px" class="cls_025"><span class="cls_025">logging  120</span></div>
<div style="position:absolute;left:115.00px;top:171.77px" class="cls_025"><span class="cls_025">infrastructure, standardizing  6</span></div>
<div style="position:absolute;left:318.41px;top:171.77px" class="cls_025"><span class="cls_025">loosely coupled components  113</span></div>
<div style="position:absolute;left:115.00px;top:183.17px" class="cls_025"><span class="cls_025">inspecting  40, 41</span></div>
<div style="position:absolute;left:318.41px;top:183.17px" class="cls_025"><span class="cls_025">monitoring  121</span></div>
<div style="position:absolute;left:115.00px;top:194.57px" class="cls_025"><span class="cls_025">listing</span></div>
<div style="position:absolute;left:145.98px;top:194.57px" class="cls_025"><span class="cls_025">37</span></div>
<div style="position:absolute;left:318.41px;top:194.57px" class="cls_025"><span class="cls_025">patterns  113</span></div>
<div style="position:absolute;left:115.00px;top:205.97px" class="cls_025"><span class="cls_025">namespaces  50, 51</span></div>
<div style="position:absolute;left:318.41px;top:205.97px" class="cls_025"><span class="cls_025">redundancy  118</span></div>
<div style="position:absolute;left:115.00px;top:217.37px" class="cls_025"><span class="cls_025">production-like environments, simulating  6</span></div>
<div style="position:absolute;left:318.41px;top:217.37px" class="cls_025"><span class="cls_025">rolling updates  121</span></div>
<div style="position:absolute;left:115.00px;top:228.77px" class="cls_025"><span class="cls_025">pruning  101</span></div>
<div style="position:absolute;left:318.41px;top:228.77px" class="cls_025"><span class="cls_025">routing  116</span></div>
<div style="position:absolute;left:115.00px;top:240.17px" class="cls_025"><span class="cls_025">removing  33-39</span></div>
<div style="position:absolute;left:318.41px;top:240.17px" class="cls_025"><span class="cls_025">service discovery  114, 115</span></div>
<div style="position:absolute;left:115.00px;top:251.57px" class="cls_025"><span class="cls_025">security, enhancing  5</span></div>
<div style="position:absolute;left:318.41px;top:251.57px" class="cls_025"><span class="cls_025">stateful, versus stateless  113</span></div>
<div style="position:absolute;left:115.00px;top:262.97px" class="cls_025"><span class="cls_025">significance  5</span></div>
<div style="position:absolute;left:318.41px;top:262.97px" class="cls_025"><span class="cls_025">tracing  120</span></div>
<div style="position:absolute;left:115.00px;top:274.37px" class="cls_025"><span class="cls_025">starting  33-38</span></div>
<div style="position:absolute;left:311.40px;top:274.37px" class="cls_027"><span class="cls_027">DNS service  115</span></div>
<div style="position:absolute;left:115.00px;top:285.77px" class="cls_025"><span class="cls_025">stopping  33-38</span></div>
<div style="position:absolute;left:311.40px;top:285.77px" class="cls_027"><span class="cls_027">Docker Container</span></div>
<div style="position:absolute;left:115.00px;top:297.17px" class="cls_025"><span class="cls_025">union filesystem (UnionFS)  52</span></div>
<div style="position:absolute;left:318.41px;top:297.17px" class="cls_025"><span class="cls_025">versus Kubernetes pod networking  197</span></div>
<div style="position:absolute;left:108.00px;top:308.57px" class="cls_027"><span class="cls_027">content trust  5, 173</span></div>
<div style="position:absolute;left:311.40px;top:308.57px" class="cls_027"><span class="cls_027">Docker engine  7</span></div>
<div style="position:absolute;left:108.00px;top:319.97px" class="cls_027"><span class="cls_027">context-based routing  212, 213</span></div>
<div style="position:absolute;left:311.40px;top:319.97px" class="cls_027"><span class="cls_027">Dockerfiles</span></div>
<div style="position:absolute;left:108.00px;top:331.37px" class="cls_027"><span class="cls_027">continuous integration (CI)</span><span class="cls_025">  150</span></div>
<div style="position:absolute;left:318.41px;top:331.37px" class="cls_025"><span class="cls_025">ADD keyword  66</span></div>
<div style="position:absolute;left:108.00px;top:342.77px" class="cls_027"><span class="cls_027">control groups (cgroups)  5, 51</span></div>
<div style="position:absolute;left:318.41px;top:342.77px" class="cls_025"><span class="cls_025">best practices  77, 78</span></div>
<div style="position:absolute;left:108.00px;top:354.17px" class="cls_027"><span class="cls_027">COPY keyword  66</span></div>
<div style="position:absolute;left:318.41px;top:354.17px" class="cls_025"><span class="cls_025">CMD keyword  68, 69</span></div>
<div style="position:absolute;left:108.00px;top:365.57px" class="cls_027"><span class="cls_027">copy-on-write  59</span></div>
<div style="position:absolute;left:318.41px;top:365.57px" class="cls_025"><span class="cls_025">complex Dockerfile  70</span></div>
<div style="position:absolute;left:318.41px;top:376.97px" class="cls_025"><span class="cls_025">COPY keyword  66</span></div>
<div style="position:absolute;left:108.00px;top:385.07px" class="cls_007"><span class="cls_007">D</span></div>
<div style="position:absolute;left:318.41px;top:388.37px" class="cls_025"><span class="cls_025">ENTRYPOINT keyword  68, 69</span></div>
<div style="position:absolute;left:318.41px;top:399.77px" class="cls_025"><span class="cls_025">FROM keyword  64</span></div>
<div style="position:absolute;left:108.00px;top:408.17px" class="cls_027"><span class="cls_027">daemon set  165</span></div>
<div style="position:absolute;left:318.41px;top:411.17px" class="cls_025"><span class="cls_025">image, building  71-73</span></div>
<div style="position:absolute;left:108.00px;top:419.57px" class="cls_027"><span class="cls_027">data</span></div>
<div style="position:absolute;left:318.41px;top:422.57px" class="cls_025"><span class="cls_025">multistep builds  75, 76</span></div>
<div style="position:absolute;left:115.00px;top:430.97px" class="cls_025"><span class="cls_025">sharing, between containers  91, 92</span></div>
<div style="position:absolute;left:318.41px;top:433.97px" class="cls_025"><span class="cls_025">RUN keyword  65</span></div>
<div style="position:absolute;left:108.00px;top:442.37px" class="cls_027"><span class="cls_027">data volumes</span></div>
<div style="position:absolute;left:318.41px;top:445.37px" class="cls_025"><span class="cls_025">using  63, 64</span></div>
<div style="position:absolute;left:115.00px;top:453.77px" class="cls_025"><span class="cls_025">container layer, modifying  86, 87</span></div>
<div style="position:absolute;left:318.41px;top:456.77px" class="cls_025"><span class="cls_025">WORKDIR keyword  67</span></div>
<div style="position:absolute;left:115.00px;top:465.17px" class="cls_025"><span class="cls_025">creating  86-88</span></div>
<div style="position:absolute;left:311.40px;top:468.17px" class="cls_027"><span class="cls_027">Docker for macOS</span></div>
<div style="position:absolute;left:115.00px;top:476.57px" class="cls_025"><span class="cls_025">mounting  86-90</span></div>
<div style="position:absolute;left:318.41px;top:479.57px" class="cls_025"><span class="cls_025">about  22</span></div>
<div style="position:absolute;left:115.00px;top:487.97px" class="cls_025"><span class="cls_025">removing  90</span></div>
<div style="position:absolute;left:318.41px;top:490.97px" class="cls_025"><span class="cls_025">download link  22</span></div>
<div style="position:absolute;left:108.00px;top:499.37px" class="cls_027"><span class="cls_027">declarative</span></div>
<div style="position:absolute;left:318.41px;top:502.37px" class="cls_025"><span class="cls_025">installing  22</span></div>
<div style="position:absolute;left:115.00px;top:510.77px" class="cls_025"><span class="cls_025">about  150</span></div>
<div style="position:absolute;left:311.40px;top:513.77px" class="cls_027"><span class="cls_027">Docker for Windows</span></div>
<div style="position:absolute;left:115.00px;top:522.17px" class="cls_025"><span class="cls_025">versus imperative  150</span></div>
<div style="position:absolute;left:318.41px;top:525.17px" class="cls_025"><span class="cls_025">about  22</span></div>
<div style="position:absolute;left:108.00px;top:533.57px" class="cls_027"><span class="cls_027">defensive programming</span></div>
<div style="position:absolute;left:318.41px;top:536.57px" class="cls_025"><span class="cls_025">download link  24</span></div>
<div style="position:absolute;left:115.00px;top:544.97px" class="cls_025"><span class="cls_025">about  117</span></div>
<div style="position:absolute;left:318.41px;top:547.97px" class="cls_025"><span class="cls_025">installing  24</span></div>
<div style="position:absolute;left:115.00px;top:556.37px" class="cls_025"><span class="cls_025">error handling  117</span></div>
<div style="position:absolute;left:311.40px;top:559.37px" class="cls_027"><span class="cls_027">Docker images</span></div>
<div style="position:absolute;left:115.00px;top:567.77px" class="cls_025"><span class="cls_025">logging  117</span></div>
<div style="position:absolute;left:318.41px;top:570.77px" class="cls_025"><span class="cls_025">pushing  253, 254</span></div>
<div style="position:absolute;left:115.00px;top:579.17px" class="cls_025"><span class="cls_025">retries</span></div>
<div style="position:absolute;left:146.25px;top:579.17px" class="cls_025"><span class="cls_025">117</span></div>
<div style="position:absolute;left:318.41px;top:582.17px" class="cls_025"><span class="cls_025">pushing, to Azure Container Registry</span></div>
<div style="position:absolute;left:108.00px;top:590.57px" class="cls_027"><span class="cls_027">distributed application architecture</span></div>
<div style="position:absolute;left:339.41px;top:593.57px" class="cls_025"><span class="cls_025">(ACR)  251</span></div>
<div style="position:absolute;left:115.00px;top:601.97px" class="cls_025"><span class="cls_025">about  </span><span class="cls_027">110</span></div>
<div style="position:absolute;left:318.41px;top:604.97px" class="cls_025"><span class="cls_025">tagging  253, 254</span></div>
<div style="position:absolute;left:115.00px;top:613.37px" class="cls_025"><span class="cls_025">application updates  121</span></div>
<div style="position:absolute;left:311.40px;top:616.37px" class="cls_027"><span class="cls_027">docker-machine</span></div>
<div style="position:absolute;left:115.00px;top:624.77px" class="cls_025"><span class="cls_025">best practices  113</span></div>
<div style="position:absolute;left:318.41px;top:627.77px" class="cls_025"><span class="cls_025">using, on Windows  24, 25</span></div>
<div style="position:absolute;left:115.00px;top:636.17px" class="cls_025"><span class="cls_025">circuit breaker pattern  119</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 304 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:255036px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background328.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:114.76px" class="cls_027"><span class="cls_027">Docker products</span></div>
<div style="position:absolute;left:311.40px;top:114.76px" class="cls_027"><span class="cls_027">Hyper-V</span></div>
<div style="position:absolute;left:115.00px;top:126.16px" class="cls_025"><span class="cls_025">about  8</span></div>
<div style="position:absolute;left:318.41px;top:126.16px" class="cls_025"><span class="cls_025">docker-machine, using on Windows  24, 25</span></div>
<div style="position:absolute;left:115.00px;top:137.56px" class="cls_025"><span class="cls_025">Docker CE  8</span></div>
<div style="position:absolute;left:115.00px;top:148.96px" class="cls_025"><span class="cls_025">Docker EE  9</span></div>
<div style="position:absolute;left:311.40px;top:145.66px" class="cls_007"><span class="cls_007">I</span></div>
<div style="position:absolute;left:108.00px;top:160.36px" class="cls_027"><span class="cls_027">Docker Swarm  176, 177</span></div>
<div style="position:absolute;left:311.40px;top:168.76px" class="cls_027"><span class="cls_027">image registries  79</span></div>
<div style="position:absolute;left:108.00px;top:171.76px" class="cls_027"><span class="cls_027">Docker system events</span></div>
<div style="position:absolute;left:311.40px;top:180.16px" class="cls_027"><span class="cls_027">images</span></div>
<div style="position:absolute;left:115.00px;top:183.16px" class="cls_025"><span class="cls_025">consuming  104, 105</span></div>
<div style="position:absolute;left:318.40px;top:191.56px" class="cls_025"><span class="cls_025">about  56</span></div>
<div style="position:absolute;left:108.00px;top:194.56px" class="cls_027"><span class="cls_027">Docker system information</span></div>
<div style="position:absolute;left:318.40px;top:202.96px" class="cls_025"><span class="cls_025">copy-on-write  59</span></div>
<div style="position:absolute;left:115.00px;top:205.96px" class="cls_025"><span class="cls_025">obtaining  97, 98</span></div>
<div style="position:absolute;left:318.40px;top:214.36px" class="cls_025"><span class="cls_025">creating  60</span></div>
<div style="position:absolute;left:108.00px;top:217.36px" class="cls_027"><span class="cls_027">Docker Toolbox</span><span class="cls_025">  19, 20</span></div>
<div style="position:absolute;left:318.40px;top:225.76px" class="cls_025"><span class="cls_025">Dockerfiles, using  63</span></div>
<div style="position:absolute;left:108.00px;top:228.76px" class="cls_027"><span class="cls_027">Docker Trusted Registry (DTR)  9</span></div>
<div style="position:absolute;left:318.40px;top:237.16px" class="cls_025"><span class="cls_025">graph drivers  59</span></div>
<div style="position:absolute;left:108.00px;top:240.16px" class="cls_027"><span class="cls_027">Domain Name System (DNS)  115</span></div>
<div style="position:absolute;left:318.40px;top:248.56px" class="cls_025"><span class="cls_025">interactive image creation  60-62</span></div>
<div style="position:absolute;left:318.40px;top:259.96px" class="cls_025"><span class="cls_025">layered filesystem  56, 57</span></div>
<div style="position:absolute;left:108.00px;top:259.66px" class="cls_007"><span class="cls_007">E</span></div>
<div style="position:absolute;left:318.40px;top:271.36px" class="cls_025"><span class="cls_025">loading  79</span></div>
<div style="position:absolute;left:108.00px;top:282.76px" class="cls_027"><span class="cls_027">edit-and-continue style development</span></div>
<div style="position:absolute;left:318.40px;top:282.76px" class="cls_025"><span class="cls_025">namespaces  80, 81</span></div>
<div style="position:absolute;left:115.00px;top:294.16px" class="cls_025"><span class="cls_025">enabling, in cloud  282, 283</span></div>
<div style="position:absolute;left:318.40px;top:294.16px" class="cls_025"><span class="cls_025">official images  82</span></div>
<div style="position:absolute;left:108.00px;top:305.56px" class="cls_027"><span class="cls_027">Enterprise Edition (EE)  8</span></div>
<div style="position:absolute;left:318.40px;top:305.56px" class="cls_025"><span class="cls_025">pruning  102</span></div>
<div style="position:absolute;left:108.00px;top:316.96px" class="cls_027"><span class="cls_027">ENTRYPOINT keywords  68, 69</span></div>
<div style="position:absolute;left:318.40px;top:316.96px" class="cls_025"><span class="cls_025">pushing, to registry  82, 83</span></div>
<div style="position:absolute;left:108.00px;top:328.36px" class="cls_027"><span class="cls_027">etcd nodes  184</span></div>
<div style="position:absolute;left:318.40px;top:328.36px" class="cls_025"><span class="cls_025">references  80, 81</span></div>
<div style="position:absolute;left:108.00px;top:339.76px" class="cls_027"><span class="cls_027">exec form  68</span></div>
<div style="position:absolute;left:318.40px;top:339.76px" class="cls_025"><span class="cls_025">saving  79</span></div>
<div style="position:absolute;left:318.40px;top:351.16px" class="cls_025"><span class="cls_025">sharing  79</span></div>
<div style="position:absolute;left:108.00px;top:359.26px" class="cls_007"><span class="cls_007">F</span></div>
<div style="position:absolute;left:318.40px;top:362.56px" class="cls_025"><span class="cls_025">shipping  79</span></div>
<div style="position:absolute;left:318.40px;top:373.96px" class="cls_025"><span class="cls_025">tagging  80</span></div>
<div style="position:absolute;left:108.00px;top:382.36px" class="cls_027"><span class="cls_027">FROM keyword  64</span></div>
<div style="position:absolute;left:318.40px;top:385.36px" class="cls_025"><span class="cls_025">volumes, defining  95, 96</span></div>
<div style="position:absolute;left:108.00px;top:393.76px" class="cls_027"><span class="cls_027">fully managed Kubernetes cluster</span></div>
<div style="position:absolute;left:318.40px;top:396.76px" class="cls_025"><span class="cls_025">writable container layer  58</span></div>
<div style="position:absolute;left:115.00px;top:405.16px" class="cls_025"><span class="cls_025">creating, in Azure  244, 245</span></div>
<div style="position:absolute;left:311.40px;top:408.16px" class="cls_027"><span class="cls_027">imperative</span><span class="cls_025">  150</span></div>
<div style="position:absolute;left:108.00px;top:416.56px" class="cls_027"><span class="cls_027">Fully Qualified Domain Name (FQDN)  184</span></div>
<div style="position:absolute;left:311.40px;top:419.56px" class="cls_027"><span class="cls_027">Infrastructure as a Service (IaaS)  8</span></div>
<div style="position:absolute;left:108.00px;top:427.96px" class="cls_027"><span class="cls_027">Functions as a Service (FaaS)  9</span></div>
<div style="position:absolute;left:311.40px;top:430.96px" class="cls_027"><span class="cls_027">introspection  174, 175</span></div>
<div style="position:absolute;left:311.40px;top:442.36px" class="cls_027"><span class="cls_027">IP address management (IPAM)</span><span class="cls_025">  133</span></div>
<div style="position:absolute;left:108.00px;top:447.46px" class="cls_007"><span class="cls_007">G</span></div>
<div style="position:absolute;left:311.40px;top:461.86px" class="cls_007"><span class="cls_007">K</span></div>
<div style="position:absolute;left:108.00px;top:470.56px" class="cls_027"><span class="cls_027">general availability (GA)  176</span></div>
<div style="position:absolute;left:108.00px;top:481.96px" class="cls_027"><span class="cls_027">geo-awareness  170</span></div>
<div style="position:absolute;left:311.40px;top:484.96px" class="cls_027"><span class="cls_027">kubectl</span></div>
<div style="position:absolute;left:108.00px;top:493.36px" class="cls_027"><span class="cls_027">global service  164</span></div>
<div style="position:absolute;left:318.40px;top:496.36px" class="cls_025"><span class="cls_025">testing  27</span></div>
<div style="position:absolute;left:108.00px;top:504.76px" class="cls_027"><span class="cls_027">grants  172</span></div>
<div style="position:absolute;left:311.40px;top:507.76px" class="cls_027"><span class="cls_027">Kubelet  187</span></div>
<div style="position:absolute;left:108.00px;top:516.16px" class="cls_027"><span class="cls_027">graph drivers  59</span></div>
<div style="position:absolute;left:311.40px;top:519.16px" class="cls_027"><span class="cls_027">kube-proxy  187</span></div>
<div style="position:absolute;left:108.00px;top:527.56px" class="cls_027"><span class="cls_027">group ID (GID)  67</span></div>
<div style="position:absolute;left:311.40px;top:530.56px" class="cls_027"><span class="cls_027">Kubernetes</span></div>
<div style="position:absolute;left:318.40px;top:541.96px" class="cls_025"><span class="cls_025">about  175, 181</span></div>
<div style="position:absolute;left:108.00px;top:547.06px" class="cls_007"><span class="cls_007">H</span></div>
<div style="position:absolute;left:318.40px;top:553.36px" class="cls_025"><span class="cls_025">architecture  182-184</span></div>
<div style="position:absolute;left:318.40px;top:564.76px" class="cls_025"><span class="cls_025">secrets  235</span></div>
<div style="position:absolute;left:108.00px;top:570.16px" class="cls_027"><span class="cls_027">Helm  225</span></div>
<div style="position:absolute;left:318.40px;top:576.16px" class="cls_025"><span class="cls_025">secrets, defining  235-237</span></div>
<div style="position:absolute;left:108.00px;top:581.56px" class="cls_027"><span class="cls_027">Homebrew</span></div>
<div style="position:absolute;left:318.40px;top:587.56px" class="cls_025"><span class="cls_025">secrets, using in pod  237-239</span></div>
<div style="position:absolute;left:115.00px;top:592.96px" class="cls_025"><span class="cls_025">installing, on macOS  17</span></div>
<div style="position:absolute;left:318.40px;top:598.96px" class="cls_025"><span class="cls_025">secrets values, in environment</span></div>
<div style="position:absolute;left:108.00px;top:604.36px" class="cls_027"><span class="cls_027">host network</span><span class="cls_025">  141, 142</span></div>
<div style="position:absolute;left:339.41px;top:610.36px" class="cls_025"><span class="cls_025">variables  240, 241</span></div>
<div style="position:absolute;left:108.00px;top:615.76px" class="cls_027"><span class="cls_027">host volumes</span></div>
<div style="position:absolute;left:318.40px;top:621.76px" class="cls_025"><span class="cls_025">service, deploying  278, 279</span></div>
<div style="position:absolute;left:115.00px;top:627.16px" class="cls_025"><span class="cls_025">using  92-94</span></div>
<div style="position:absolute;left:318.40px;top:633.16px" class="cls_025"><span class="cls_025">service, running  278, 279</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 305 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:255838px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background329.jpg" width=612 height=792></div>
<div style="position:absolute;left:115.00px;top:114.77px" class="cls_025"><span class="cls_025">upgrading  273, 274</span></div>
<div style="position:absolute;left:311.40px;top:114.76px" class="cls_027"><span class="cls_027">Marathon  178</span></div>
<div style="position:absolute;left:115.00px;top:126.17px" class="cls_025"><span class="cls_025">working environment, configuring  277</span></div>
<div style="position:absolute;left:311.40px;top:126.16px" class="cls_027"><span class="cls_027">Microsoft Azure Kubernetes</span></div>
<div style="position:absolute;left:108.00px;top:137.57px" class="cls_027"><span class="cls_027">Kubernetes cluster</span></div>
<div style="position:absolute;left:339.41px;top:137.56px" class="cls_027"><span class="cls_027">Service (AKS)  178</span></div>
<div style="position:absolute;left:115.00px;top:148.97px" class="cls_025"><span class="cls_025">application, deploying into  255-257</span></div>
<div style="position:absolute;left:311.41px;top:148.96px" class="cls_027"><span class="cls_027">Minikube</span></div>
<div style="position:absolute;left:115.00px;top:160.37px" class="cls_025"><span class="cls_025">container health, monitoring  263</span></div>
<div style="position:absolute;left:318.42px;top:160.36px" class="cls_025"><span class="cls_025">about  26, 188, 189</span></div>
<div style="position:absolute;left:115.00px;top:171.77px" class="cls_025"><span class="cls_025">creating, for development  275, 276</span></div>
<div style="position:absolute;left:318.42px;top:171.76px" class="cls_025"><span class="cls_025">installing, on macOS  26, 27</span></div>
<div style="position:absolute;left:115.00px;top:183.17px" class="cls_025"><span class="cls_025">log analytics workspace, creating  261, 262</span></div>
<div style="position:absolute;left:318.42px;top:183.16px" class="cls_025"><span class="cls_025">installing, on Windows  26, 27</span></div>
<div style="position:absolute;left:115.00px;top:194.57px" class="cls_025"><span class="cls_025">monitoring  260</span></div>
<div style="position:absolute;left:318.42px;top:194.56px" class="cls_025"><span class="cls_025">starting  27</span></div>
<div style="position:absolute;left:115.00px;top:205.97px" class="cls_025"><span class="cls_025">provisioning  248-251</span></div>
<div style="position:absolute;left:318.42px;top:205.96px" class="cls_025"><span class="cls_025">testing  27</span></div>
<div style="position:absolute;left:108.00px;top:217.37px" class="cls_027"><span class="cls_027">Kubernetes deployment  209, 210</span></div>
<div style="position:absolute;left:311.41px;top:217.36px" class="cls_027"><span class="cls_027">Moby project  7</span></div>
<div style="position:absolute;left:108.00px;top:228.77px" class="cls_027"><span class="cls_027">Kubernetes master nodes  185, 186</span></div>
<div style="position:absolute;left:311.41px;top:228.76px" class="cls_027"><span class="cls_027">multi-service app</span></div>
<div style="position:absolute;left:108.00px;top:240.17px" class="cls_027"><span class="cls_027">Kubernetes masters</span></div>
<div style="position:absolute;left:318.42px;top:240.16px" class="cls_025"><span class="cls_025">executing  151-156</span></div>
<div style="position:absolute;left:115.00px;top:251.57px" class="cls_025"><span class="cls_025">logs, viewing of  264-267</span></div>
<div style="position:absolute;left:311.41px;top:251.56px" class="cls_027"><span class="cls_027">mutual transport layer security (MTLS)  171</span></div>
<div style="position:absolute;left:108.00px;top:262.97px" class="cls_027"><span class="cls_027">Kubernetes pod networking</span></div>
<div style="position:absolute;left:115.00px;top:274.37px" class="cls_025"><span class="cls_025">versus Docker Container  197</span></div>
<div style="position:absolute;left:311.40px;top:271.06px" class="cls_007"><span class="cls_007">N</span></div>
<div style="position:absolute;left:108.00px;top:285.77px" class="cls_027"><span class="cls_027">Kubernetes services</span></div>
<div style="position:absolute;left:311.40px;top:294.16px" class="cls_027"><span class="cls_027">namespaces  50, 51</span></div>
<div style="position:absolute;left:115.00px;top:297.17px" class="cls_025"><span class="cls_025">about  210, 211</span></div>
<div style="position:absolute;left:311.40px;top:305.56px" class="cls_027"><span class="cls_027">Network Address Translation (NAT)  183</span></div>
<div style="position:absolute;left:115.00px;top:308.57px" class="cls_025"><span class="cls_025">API server  185</span></div>
<div style="position:absolute;left:311.40px;top:316.96px" class="cls_027"><span class="cls_027">network firewalling</span><span class="cls_025">  130, 131</span></div>
<div style="position:absolute;left:115.00px;top:319.97px" class="cls_025"><span class="cls_025">cluster store  185</span></div>
<div style="position:absolute;left:311.40px;top:328.36px" class="cls_027"><span class="cls_027">network namespace</span></div>
<div style="position:absolute;left:115.00px;top:331.37px" class="cls_025"><span class="cls_025">controller  185</span></div>
<div style="position:absolute;left:318.40px;top:339.76px" class="cls_025"><span class="cls_025">executing  143, 144</span></div>
<div style="position:absolute;left:115.00px;top:342.77px" class="cls_025"><span class="cls_025">scheduler  185</span></div>
<div style="position:absolute;left:311.40px;top:351.16px" class="cls_027"><span class="cls_027">networks</span></div>
<div style="position:absolute;left:108.00px;top:354.17px" class="cls_027"><span class="cls_027">Kubernetes support</span></div>
<div style="position:absolute;left:318.40px;top:362.56px" class="cls_025"><span class="cls_025">about  </span><span class="cls_027">128</span></div>
<div style="position:absolute;left:115.00px;top:365.57px" class="cls_025"><span class="cls_025">in Docker for Desktop  190-195</span></div>
<div style="position:absolute;left:318.40px;top:373.96px" class="cls_025"><span class="cls_025">pruning  104</span></div>
<div style="position:absolute;left:108.00px;top:376.97px" class="cls_027"><span class="cls_027">kublet</span></div>
<div style="position:absolute;left:311.40px;top:385.36px" class="cls_027"><span class="cls_027">null network</span><span class="cls_025">  142</span></div>
<div style="position:absolute;left:115.00px;top:388.37px" class="cls_025"><span class="cls_025">viewing  267-270</span></div>
<div style="position:absolute;left:311.40px;top:404.86px" class="cls_007"><span class="cls_007">O</span></div>
<div style="position:absolute;left:108.00px;top:407.87px" class="cls_007"><span class="cls_007">L</span></div>
<div style="position:absolute;left:311.40px;top:427.96px" class="cls_027"><span class="cls_027">Operations Support System (OSS)  1</span></div>
<div style="position:absolute;left:108.00px;top:430.97px" class="cls_027"><span class="cls_027">layered filesystem  56, 57</span></div>
<div style="position:absolute;left:311.40px;top:439.36px" class="cls_027"><span class="cls_027">orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:442.37px" class="cls_027"><span class="cls_027">Linux Command Line Cheat Sheet</span></div>
<div style="position:absolute;left:318.40px;top:450.76px" class="cls_025"><span class="cls_025">about  175</span></div>
<div style="position:absolute;left:115.00px;top:453.77px" class="cls_025"><span class="cls_025">reference  17</span></div>
<div style="position:absolute;left:318.40px;top:462.16px" class="cls_025"><span class="cls_025">Amazon ECS  179</span></div>
<div style="position:absolute;left:108.00px;top:465.17px" class="cls_027"><span class="cls_027">Linux command shell  16</span></div>
<div style="position:absolute;left:318.40px;top:473.56px" class="cls_025"><span class="cls_025">Apache Mesos  178</span></div>
<div style="position:absolute;left:108.00px;top:476.57px" class="cls_027"><span class="cls_027">Linux security module (LSM)  177</span></div>
<div style="position:absolute;left:318.40px;top:484.96px" class="cls_025"><span class="cls_025">Docker Swarm  176, 177</span></div>
<div style="position:absolute;left:108.00px;top:487.97px" class="cls_027"><span class="cls_027">load balancer  116</span></div>
<div style="position:absolute;left:318.40px;top:496.36px" class="cls_025"><span class="cls_025">Kubernetes  175</span></div>
<div style="position:absolute;left:108.00px;top:499.37px" class="cls_027"><span class="cls_027">load balancing  167</span></div>
<div style="position:absolute;left:318.40px;top:507.76px" class="cls_025"><span class="cls_025">Marathon  178</span></div>
<div style="position:absolute;left:108.00px;top:510.77px" class="cls_027"><span class="cls_027">location awareness  170</span></div>
<div style="position:absolute;left:318.40px;top:519.16px" class="cls_025"><span class="cls_025">Microsoft Azure Kubernetes Service</span></div>
<div style="position:absolute;left:108.00px;top:522.17px" class="cls_027"><span class="cls_027">logging drivers</span></div>
<div style="position:absolute;left:341.77px;top:530.56px" class="cls_025"><span class="cls_025">(AKS)  178</span></div>
<div style="position:absolute;left:115.00px;top:533.57px" class="cls_025"><span class="cls_025">about  </span><span class="cls_027">46</span></div>
<div style="position:absolute;left:318.39px;top:541.96px" class="cls_025"><span class="cls_025">need for  162, 163</span></div>
<div style="position:absolute;left:115.00px;top:544.97px" class="cls_025"><span class="cls_025">changing  47, 48</span></div>
<div style="position:absolute;left:318.39px;top:553.36px" class="cls_025"><span class="cls_025">tasks  163</span></div>
<div style="position:absolute;left:115.00px;top:556.37px" class="cls_025"><span class="cls_025">using  47</span></div>
<div style="position:absolute;left:311.40px;top:572.86px" class="cls_007"><span class="cls_007">P</span></div>
<div style="position:absolute;left:108.00px;top:575.87px" class="cls_007"><span class="cls_007">M</span></div>
<div style="position:absolute;left:311.40px;top:595.96px" class="cls_027"><span class="cls_027">package manager</span></div>
<div style="position:absolute;left:108.00px;top:598.97px" class="cls_027"><span class="cls_027">macOS</span></div>
<div style="position:absolute;left:318.40px;top:607.36px" class="cls_025"><span class="cls_025">using  17</span></div>
<div style="position:absolute;left:115.00px;top:610.37px" class="cls_025"><span class="cls_025">Homebrew, installing on  17</span></div>
<div style="position:absolute;left:311.40px;top:618.76px" class="cls_027"><span class="cls_027">pet-api  112</span></div>
<div style="position:absolute;left:115.00px;top:621.77px" class="cls_025"><span class="cls_025">Minikube, installing on  26, 27</span></div>
<div style="position:absolute;left:311.40px;top:630.16px" class="cls_027"><span class="cls_027">pet-inventory  112</span></div>
<div style="position:absolute;left:108.00px;top:633.17px" class="cls_027"><span class="cls_027">manager node  164</span></div>
<div style="position:absolute;left:108.00px;top:644.57px" class="cls_027"><span class="cls_027">man-in-the-middle (MITM) attack  173</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 306 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:256640px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background330.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:114.76px" class="cls_027"><span class="cls_027">Pets application</span></div>
<div style="position:absolute;left:311.40px;top:113.55px" class="cls_007"><span class="cls_007">S</span></div>
<div style="position:absolute;left:115.00px;top:126.16px" class="cls_025"><span class="cls_025">debugging  275</span></div>
<div style="position:absolute;left:115.00px;top:137.56px" class="cls_025"><span class="cls_025">number of app instances, scaling  257, 258</span></div>
<div style="position:absolute;left:311.40px;top:136.65px" class="cls_027"><span class="cls_027">scaling  167</span></div>
<div style="position:absolute;left:115.00px;top:148.96px" class="cls_025"><span class="cls_025">number of cluster nodes, scaling  258-260</span></div>
<div style="position:absolute;left:311.40px;top:148.05px" class="cls_027"><span class="cls_027">scaling up  157</span></div>
<div style="position:absolute;left:115.00px;top:160.36px" class="cls_025"><span class="cls_025">scaling  257</span></div>
<div style="position:absolute;left:311.40px;top:159.45px" class="cls_027"><span class="cls_027">secrets  172, 173</span></div>
<div style="position:absolute;left:115.00px;top:171.76px" class="cls_025"><span class="cls_025">upgrading, with zero downtime  272</span></div>
<div style="position:absolute;left:311.40px;top:170.85px" class="cls_027"><span class="cls_027">security</span></div>
<div style="position:absolute;left:108.00px;top:183.16px" class="cls_027"><span class="cls_027">pet-shop application  111</span></div>
<div style="position:absolute;left:318.40px;top:182.25px" class="cls_025"><span class="cls_025">about  170</span></div>
<div style="position:absolute;left:108.00px;top:194.56px" class="cls_027"><span class="cls_027">pet-web  112</span></div>
<div style="position:absolute;left:318.40px;top:193.65px" class="cls_025"><span class="cls_025">cryptographic node identity  171</span></div>
<div style="position:absolute;left:108.00px;top:205.96px" class="cls_027"><span class="cls_027">pods</span></div>
<div style="position:absolute;left:318.40px;top:205.05px" class="cls_025"><span class="cls_025">Role-based access control (RBAC)  172</span></div>
<div style="position:absolute;left:115.00px;top:217.36px" class="cls_025"><span class="cls_025">about  196</span></div>
<div style="position:absolute;left:318.40px;top:216.45px" class="cls_025"><span class="cls_025">secure communication  171</span></div>
<div style="position:absolute;left:115.00px;top:228.76px" class="cls_025"><span class="cls_025">life cycle</span></div>
<div style="position:absolute;left:156.40px;top:228.76px" class="cls_025"><span class="cls_025">201</span></div>
<div style="position:absolute;left:318.40px;top:227.85px" class="cls_025"><span class="cls_025">secure network  171</span></div>
<div style="position:absolute;left:115.00px;top:240.16px" class="cls_025"><span class="cls_025">network namespace, sharing  198, 200</span></div>
<div style="position:absolute;left:318.40px;top:239.25px" class="cls_025"><span class="cls_025">secure network policies  171</span></div>
<div style="position:absolute;left:115.00px;top:251.56px" class="cls_025"><span class="cls_025">specification  202, 203</span></div>
<div style="position:absolute;left:311.40px;top:250.65px" class="cls_027"><span class="cls_027">self-healing  168</span></div>
<div style="position:absolute;left:115.00px;top:262.96px" class="cls_025"><span class="cls_025">volumes  204, 205</span></div>
<div style="position:absolute;left:311.40px;top:262.05px" class="cls_027"><span class="cls_027">service</span></div>
<div style="position:absolute;left:108.00px;top:274.36px" class="cls_027"><span class="cls_027">port management</span><span class="cls_025">  145-147</span></div>
<div style="position:absolute;left:318.40px;top:273.45px" class="cls_025"><span class="cls_025">scaling  156-158</span></div>
<div style="position:absolute;left:108.00px;top:285.76px" class="cls_027"><span class="cls_027">PowerShell Basic Cheat Sheet</span></div>
<div style="position:absolute;left:311.40px;top:284.85px" class="cls_027"><span class="cls_027">service discovery  165</span></div>
<div style="position:absolute;left:115.00px;top:297.16px" class="cls_025"><span class="cls_025">reference  17</span></div>
<div style="position:absolute;left:311.40px;top:296.25px" class="cls_027"><span class="cls_027">shell  68</span></div>
<div style="position:absolute;left:108.00px;top:308.56px" class="cls_027"><span class="cls_027">PowerShell for Windows  17</span></div>
<div style="position:absolute;left:311.40px;top:307.65px" class="cls_027"><span class="cls_027">software-defined network (SDN)  172</span></div>
<div style="position:absolute;left:108.00px;top:319.96px" class="cls_027"><span class="cls_027">primary node agent  187</span></div>
<div style="position:absolute;left:311.40px;top:319.05px" class="cls_027"><span class="cls_027">solid-state drive (SSD)  170</span></div>
<div style="position:absolute;left:108.00px;top:331.36px" class="cls_027"><span class="cls_027">process  11</span></div>
<div style="position:absolute;left:311.40px;top:330.45px" class="cls_027"><span class="cls_027">source code repository</span></div>
<div style="position:absolute;left:108.00px;top:342.76px" class="cls_027"><span class="cls_027">process ID (pid)  11</span></div>
<div style="position:absolute;left:318.40px;top:341.85px" class="cls_025"><span class="cls_025">cloning  28</span></div>
<div style="position:absolute;left:108.00px;top:354.16px" class="cls_027"><span class="cls_027">ps command</span></div>
<div style="position:absolute;left:115.00px;top:365.56px" class="cls_025"><span class="cls_025">executing, into running containers  42, 43</span></div>
<div style="position:absolute;left:311.40px;top:361.35px" class="cls_007"><span class="cls_007">T</span></div>
<div style="position:absolute;left:311.40px;top:384.45px" class="cls_027"><span class="cls_027">tag  80</span></div>
<div style="position:absolute;left:108.00px;top:385.06px" class="cls_007"><span class="cls_007">R</span></div>
<div style="position:absolute;left:311.40px;top:395.85px" class="cls_027"><span class="cls_027">tasks, orchestrators</span></div>
<div style="position:absolute;left:108.00px;top:408.16px" class="cls_027"><span class="cls_027">Raft consensus group  186</span></div>
<div style="position:absolute;left:318.40px;top:407.25px" class="cls_025"><span class="cls_025">affinity</span></div>
<div style="position:absolute;left:353.48px;top:407.25px" class="cls_025"><span class="cls_025">170</span></div>
<div style="position:absolute;left:108.00px;top:419.56px" class="cls_027"><span class="cls_027">Raft consensus protocol  184</span></div>
<div style="position:absolute;left:318.40px;top:418.65px" class="cls_025"><span class="cls_025">desired state, reconciling  163, 164</span></div>
<div style="position:absolute;left:108.00px;top:430.96px" class="cls_027"><span class="cls_027">random quotes containers</span></div>
<div style="position:absolute;left:318.40px;top:430.05px" class="cls_025"><span class="cls_025">load balancing  166</span></div>
<div style="position:absolute;left:115.00px;top:442.36px" class="cls_025"><span class="cls_025">executing  35, 36</span></div>
<div style="position:absolute;left:318.40px;top:441.45px" class="cls_025"><span class="cls_025">location awareness  170</span></div>
<div style="position:absolute;left:108.00px;top:453.76px" class="cls_027"><span class="cls_027">ReplicaSet</span></div>
<div style="position:absolute;left:318.40px;top:452.85px" class="cls_025"><span class="cls_025">routing  166</span></div>
<div style="position:absolute;left:115.00px;top:465.16px" class="cls_025"><span class="cls_025">about  206, 210</span></div>
<div style="position:absolute;left:318.40px;top:464.25px" class="cls_025"><span class="cls_025">scaling  167</span></div>
<div style="position:absolute;left:115.00px;top:476.56px" class="cls_025"><span class="cls_025">self-healing  208, 209</span></div>
<div style="position:absolute;left:318.40px;top:475.65px" class="cls_025"><span class="cls_025">self-healing  168</span></div>
<div style="position:absolute;left:115.00px;top:487.96px" class="cls_025"><span class="cls_025">specification  207, 208</span></div>
<div style="position:absolute;left:318.40px;top:487.05px" class="cls_025"><span class="cls_025">service discovery  165</span></div>
<div style="position:absolute;left:108.00px;top:499.36px" class="cls_027"><span class="cls_027">replicated service  164</span></div>
<div style="position:absolute;left:318.40px;top:498.45px" class="cls_025"><span class="cls_025">zero downtime deployments  169</span></div>
<div style="position:absolute;left:108.00px;top:510.76px" class="cls_027"><span class="cls_027">resource consumption</span></div>
<div style="position:absolute;left:311.40px;top:509.85px" class="cls_027"><span class="cls_027">terminology</span></div>
<div style="position:absolute;left:115.00px;top:522.16px" class="cls_025"><span class="cls_025">listing</span></div>
<div style="position:absolute;left:145.98px;top:522.16px" class="cls_025"><span class="cls_025">100, 101</span></div>
<div style="position:absolute;left:318.40px;top:521.25px" class="cls_025"><span class="cls_025">defining  110-112</span></div>
<div style="position:absolute;left:108.00px;top:533.56px" class="cls_027"><span class="cls_027">resource groups  247, 248</span></div>
<div style="position:absolute;left:108.00px;top:544.96px" class="cls_027"><span class="cls_027">Role-based access control (RBAC)  172</span></div>
<div style="position:absolute;left:311.40px;top:540.75px" class="cls_007"><span class="cls_007">U</span></div>
<div style="position:absolute;left:108.00px;top:556.36px" class="cls_027"><span class="cls_027">rolling updates</span></div>
<div style="position:absolute;left:311.40px;top:563.85px" class="cls_027"><span class="cls_027">underlay network  182</span></div>
<div style="position:absolute;left:115.00px;top:567.76px" class="cls_025"><span class="cls_025">about  121, </span><span class="cls_027">169</span></div>
<div style="position:absolute;left:311.40px;top:575.25px" class="cls_027"><span class="cls_027">union filesystem (UnionFS)  52</span></div>
<div style="position:absolute;left:115.00px;top:579.16px" class="cls_025"><span class="cls_025">blue-green deployments  122</span></div>
<div style="position:absolute;left:311.40px;top:586.65px" class="cls_027"><span class="cls_027">Universal Control Plane (UCP)  9</span></div>
<div style="position:absolute;left:115.00px;top:590.56px" class="cls_025"><span class="cls_025">canary releases  122</span></div>
<div style="position:absolute;left:311.40px;top:598.05px" class="cls_027"><span class="cls_027">universal unique identifier (UUID)  112</span></div>
<div style="position:absolute;left:115.00px;top:601.96px" class="cls_025"><span class="cls_025">irreversible data changes  123</span></div>
<div style="position:absolute;left:311.40px;top:609.45px" class="cls_027"><span class="cls_027">unused resources</span></div>
<div style="position:absolute;left:115.00px;top:613.36px" class="cls_025"><span class="cls_025">rollback  123</span></div>
<div style="position:absolute;left:318.40px;top:620.85px" class="cls_025"><span class="cls_025">pruning  101-104</span></div>
<div style="position:absolute;left:108.00px;top:624.76px" class="cls_027"><span class="cls_027">routing  166</span></div>
<div style="position:absolute;left:311.40px;top:632.25px" class="cls_027"><span class="cls_027">user ID (UID)  67</span></div>
<div style="position:absolute;left:108.00px;top:636.16px" class="cls_027"><span class="cls_027">RUN keyword  65</span></div>
<div style="position:absolute;left:293.76px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 307 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:257442px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background331.jpg" width=612 height=792></div>
<div style="position:absolute;left:108.00px;top:113.55px" class="cls_007"><span class="cls_007">V</span></div>
<div style="position:absolute;left:311.40px;top:113.55px" class="cls_007"><span class="cls_007">Y</span></div>
<div style="position:absolute;left:108.00px;top:136.65px" class="cls_027"><span class="cls_027">virtual ethernet (veth)</span><span class="cls_025">  134</span></div>
<div style="position:absolute;left:311.40px;top:136.65px" class="cls_027"><span class="cls_027">YAML format  187</span></div>
<div style="position:absolute;left:108.00px;top:148.05px" class="cls_027"><span class="cls_027">Virtual Extensible LAN (VXLan)</span><span class="cls_025">  129</span></div>
<div style="position:absolute;left:108.00px;top:159.45px" class="cls_027"><span class="cls_027">virtual IP (VIP)  211</span></div>
<div style="position:absolute;left:311.40px;top:156.15px" class="cls_007"><span class="cls_007">Z</span></div>
<div style="position:absolute;left:108.00px;top:170.85px" class="cls_027"><span class="cls_027">virtual machines (VMs)  4</span></div>
<div style="position:absolute;left:311.40px;top:179.25px" class="cls_027"><span class="cls_027">zero downtime deployment</span></div>
<div style="position:absolute;left:108.00px;top:182.25px" class="cls_027"><span class="cls_027">Visual Studio Code</span></div>
<div style="position:absolute;left:318.40px;top:190.65px" class="cls_025"><span class="cls_025">about  226</span></div>
<div style="position:absolute;left:115.00px;top:193.65px" class="cls_025"><span class="cls_025">remote debugging, as service  280, 281</span></div>
<div style="position:absolute;left:318.40px;top:202.05px" class="cls_025"><span class="cls_025">blue-green deployment  230-234</span></div>
<div style="position:absolute;left:108.00px;top:205.05px" class="cls_027"><span class="cls_027">volumes</span></div>
<div style="position:absolute;left:318.40px;top:213.45px" class="cls_025"><span class="cls_025">rolling updates, adding  227-230</span></div>
<div style="position:absolute;left:115.00px;top:216.45px" class="cls_025"><span class="cls_025">pruning  103</span></div>
<div style="position:absolute;left:108.00px;top:227.85px" class="cls_027"><span class="cls_027">VS Code</span></div>
<div style="position:absolute;left:115.00px;top:239.25px" class="cls_025"><span class="cls_025">download link  19</span></div>
<div style="position:absolute;left:108.00px;top:258.75px" class="cls_007"><span class="cls_007">W</span></div>
<div style="position:absolute;left:108.00px;top:281.85px" class="cls_027"><span class="cls_027">Windows</span></div>
<div style="position:absolute;left:115.00px;top:293.25px" class="cls_025"><span class="cls_025">Chocolatey, installing on  18</span></div>
<div style="position:absolute;left:115.00px;top:304.65px" class="cls_025"><span class="cls_025">docker-machine, using on  24, 25</span></div>
<div style="position:absolute;left:115.00px;top:316.05px" class="cls_025"><span class="cls_025">Minikube, installing on  26, 27</span></div>
<div style="position:absolute;left:108.00px;top:327.45px" class="cls_027"><span class="cls_027">WORKDIR keyword  67</span></div>
<div style="position:absolute;left:108.00px;top:338.85px" class="cls_027"><span class="cls_027">worker node  164</span></div>
<div style="position:absolute;left:108.00px;top:350.25px" class="cls_027"><span class="cls_027">writable container layer  58</span></div>
<div style="position:absolute;left:293.14px;top:665.55px" class="cls_013"><span class="cls_013">[</span><span class="cls_014"> 308 </span><span class="cls_013">]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:258244px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8c4343e8-43d5-11e9-9d71-0cc47a792c0a_id_8c4343e8-43d5-11e9-9d71-0cc47a792c0a_files/background332.jpg" width=612 height=792></div>
</div>

</body>
</html>
